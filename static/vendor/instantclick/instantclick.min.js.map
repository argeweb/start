{"version":3,"sources":["../../bower_components/instantclick/instantclick.js"],"names":["InstantClick","document","location","removeHash","url","index","indexOf","substr","getLinkTarget","target","nodeName","parentNode","isBlacklisted","elem","hasAttribute","isWhitelisted","isPreloadable","a","domain","protocol","host","href","$currentLocationWithoutHash","$useWhitelist","triggerPageEvent","eventType","arg1","arg2","arg3","returnValue","i","$eventsCallbacks","length","altered","body","title","changePage","newUrl","scrollY","documentElement","replaceChild","history","pushState","hashIndex","hashElem","getElementById","offset","offsetParent","offsetTop","scrollTo","$isChromeForIOS","String","fromCharCode","instantanize","bar","done","userscriptEvent","createEvent","initEvent","dispatchEvent","setPreloadingAsHalted","$isPreloading","$isWaitingForCompletion","removeNoscriptTags","html","replace","mousedown","e","$lastTouchTimestamp","Date","preload","mouseover","addEventListener","mouseout","$delayBeforePreload","$urlToPreload","$preloadTimer","setTimeout","touchstart","$preloadOnMousedown","removeEventListener","click","which","metaKey","ctrlKey","preventDefault","display","clearTimeout","$xhr","abort","readystatechange","readyState","status","$timing","ready","start","getResponseHeader","match","doc","implementation","createHTMLDocument","innerHTML","responseText","$title","$body","alteredOnReceive","$url","urlWithoutHash","$history","data","elems","head","children","found","getAttribute","j","$trackedAssets","$mustRedirect","isInitializing","script","copy","nextSibling","scripts","getElementsByTagName","createElement","src","removeChild","insertBefore","open","send","pageYOffset","init","supported","arguments","arg","push","XMLHttpRequest","loc","on","callback","$ua","navigator","userAgent","$hasTouch","fetch","receive","wait","change","$barContainer","id","$barElement","className","appendChild","vendors","$barTransformProperty","style","transitionProperty","toLowerCase","updatePositionAndScale","at","jump","$barProgress","opacity","update","jumpStart","$barTimer","inc","Math","random","left","pageXOffset","width","innerWidth","top","landscape","window","abs","orientation","scaleY","screen"],"mappings":"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","file":"instantclick.min.js","sourcesContent":["/* InstantClick 3.1.0 | (C) 2014 Alexandre Dieulot | http://instantclick.io/license */\n\nvar InstantClick = function(document, location) {\n  // Internal variables\n  var $ua = navigator.userAgent,\n      $isChromeForIOS = $ua.indexOf(' CriOS/') > -1,\n      $hasTouch = 'createTouch' in document,\n      $currentLocationWithoutHash,\n      $urlToPreload,\n      $preloadTimer,\n      $lastTouchTimestamp,\n\n  // Preloading-related variables\n      $history = {},\n      $xhr,\n      $url = false,\n      $title = false,\n      $mustRedirect = false,\n      $body = false,\n      $timing = {},\n      $isPreloading = false,\n      $isWaitingForCompletion = false,\n      $trackedAssets = [],\n\n  // Variables defined by public functions\n      $useWhitelist,\n      $preloadOnMousedown,\n      $delayBeforePreload,\n      $eventsCallbacks = {\n        fetch: [],\n        receive: [],\n        wait: [],\n        change: []\n      }\n\n\n  ////////// HELPERS //////////\n\n\n  function removeHash(url) {\n    var index = url.indexOf('#')\n    if (index < 0) {\n      return url\n    }\n    return url.substr(0, index)\n  }\n\n  function getLinkTarget(target) {\n    while (target && target.nodeName != 'A') {\n      target = target.parentNode\n    }\n    return target\n  }\n\n  function isBlacklisted(elem) {\n    do {\n      if (!elem.hasAttribute) { // Parent of <html>\n        break\n      }\n      if (elem.hasAttribute('data-instant')) {\n        return false\n      }\n      if (elem.hasAttribute('data-no-instant')) {\n        return true\n      }\n    }\n    while (elem = elem.parentNode);\n    return false\n  }\n\n  function isWhitelisted(elem) {\n    do {\n      if (!elem.hasAttribute) { // Parent of <html>\n        break\n      }\n      if (elem.hasAttribute('data-no-instant')) {\n        return false\n      }\n      if (elem.hasAttribute('data-instant')) {\n        return true\n      }\n    }\n    while (elem = elem.parentNode);\n    return false\n  }\n\n  function isPreloadable(a) {\n    var domain = location.protocol + '//' + location.host\n\n    if (a.target // target=\"_blank\" etc.\n        || a.hasAttribute('download')\n        || a.href.indexOf(domain + '/') != 0 // Another domain, or no href attribute\n        || (a.href.indexOf('#') > -1\n            && removeHash(a.href) == $currentLocationWithoutHash) // Anchor\n        || ($useWhitelist\n            ? !isWhitelisted(a)\n            : isBlacklisted(a))\n       ) {\n      return false\n    }\n    return true\n  }\n\n  function triggerPageEvent(eventType, arg1, arg2, arg3) {\n    var returnValue = false\n    for (var i = 0; i < $eventsCallbacks[eventType].length; i++) {\n      if (eventType == 'receive') {\n        var altered = $eventsCallbacks[eventType][i](arg1, arg2, arg3)\n        if (altered) {\n          /* Update args for the next iteration of the loop. */\n          if ('body' in altered) {\n            arg2 = altered.body\n          }\n          if ('title' in altered) {\n            arg3 = altered.title\n          }\n\n          returnValue = altered\n        }\n      }\n      else {\n        $eventsCallbacks[eventType][i](arg1, arg2, arg3)\n      }\n    }\n    return returnValue\n  }\n\n  function changePage(title, body, newUrl, scrollY) {\n    document.documentElement.replaceChild(body, document.body)\n    /* We cannot just use `document.body = doc.body`, it causes Safari (tested\n       5.1, 6.0 and Mobile 7.0) to execute script tags directly.\n    */\n\n    if (newUrl) {\n      history.pushState(null, null, newUrl)\n\n      var hashIndex = newUrl.indexOf('#'),\n          hashElem = hashIndex > -1\n                     && document.getElementById(newUrl.substr(hashIndex + 1)),\n          offset = 0\n\n      if (hashElem) {\n        while (hashElem.offsetParent) {\n          offset += hashElem.offsetTop\n\n          hashElem = hashElem.offsetParent\n        }\n      }\n      scrollTo(0, offset)\n\n      $currentLocationWithoutHash = removeHash(newUrl)\n    }\n    else {\n      scrollTo(0, scrollY)\n    }\n\n    if ($isChromeForIOS && document.title == title) {\n      /* Chrome for iOS:\n       *\n       * 1. Removes title on pushState, so the title needs to be set after.\n       *\n       * 2. Will not set the title if it’s identical when trimmed, so\n       *    appending a space won't do, but a non-breaking space works.\n       */\n      document.title = title + String.fromCharCode(160)\n    }\n    else {\n      document.title = title\n    }\n\n    instantanize()\n    bar.done()\n    triggerPageEvent('change', false)\n\n    // Real event, useful for combining userscripts, but only for that so it’s undocumented.\n    var userscriptEvent = document.createEvent('HTMLEvents')\n    userscriptEvent.initEvent('instantclick:newpage', true, true)\n    dispatchEvent(userscriptEvent)\n  }\n\n  function setPreloadingAsHalted() {\n    $isPreloading = false\n    $isWaitingForCompletion = false\n  }\n\n  function removeNoscriptTags(html) {\n    /* Must be done on text, not on a node's innerHTML, otherwise strange\n     * things happen with implicitly closed elements (see the Noscript test).\n     */\n    return html.replace(/<noscript[\\s\\S]+<\\/noscript>/gi, '')\n  }\n\n\n  ////////// EVENT HANDLERS //////////\n\n\n  function mousedown(e) {\n    if ($lastTouchTimestamp > (+new Date - 500)) {\n      return // Otherwise, click doesn’t fire\n    }\n\n    var a = getLinkTarget(e.target)\n\n    if (!a || !isPreloadable(a)) {\n      return\n    }\n\n    preload(a.href)\n  }\n\n  function mouseover(e) {\n    if ($lastTouchTimestamp > (+new Date - 500)) {\n      return // Otherwise, click doesn’t fire\n    }\n\n    var a = getLinkTarget(e.target)\n\n    if (!a || !isPreloadable(a)) {\n      return\n    }\n\n    a.addEventListener('mouseout', mouseout)\n\n    if (!$delayBeforePreload) {\n      preload(a.href)\n    }\n    else {\n      $urlToPreload = a.href\n      $preloadTimer = setTimeout(preload, $delayBeforePreload)\n    }\n  }\n\n  function touchstart(e) {\n    $lastTouchTimestamp = +new Date\n\n    var a = getLinkTarget(e.target)\n\n    if (!a || !isPreloadable(a)) {\n      return\n    }\n\n    if ($preloadOnMousedown) {\n      a.removeEventListener('mousedown', mousedown)\n    }\n    else {\n      a.removeEventListener('mouseover', mouseover)\n    }\n    preload(a.href)\n  }\n\n  function click(e) {\n    var a = getLinkTarget(e.target)\n\n    if (!a || !isPreloadable(a)) {\n      return\n    }\n\n    if (e.which > 1 || e.metaKey || e.ctrlKey) { // Opening in new tab\n      return\n    }\n    e.preventDefault()\n    display(a.href)\n  }\n\n  function mouseout() {\n    if ($preloadTimer) {\n      clearTimeout($preloadTimer)\n      $preloadTimer = false\n      return\n    }\n\n    if (!$isPreloading || $isWaitingForCompletion) {\n      return\n    }\n    $xhr.abort()\n    setPreloadingAsHalted()\n  }\n\n  function readystatechange() {\n    if ($xhr.readyState < 4) {\n      return\n    }\n    if ($xhr.status == 0) {\n      /* Request aborted */\n      return\n    }\n\n    $timing.ready = +new Date - $timing.start\n\n    if ($xhr.getResponseHeader('Content-Type').match(/\\/(x|ht|xht)ml/)) {\n      var doc = document.implementation.createHTMLDocument('')\n      doc.documentElement.innerHTML = removeNoscriptTags($xhr.responseText)\n      $title = doc.title\n      $body = doc.body\n\n      var alteredOnReceive = triggerPageEvent('receive', $url, $body, $title)\n      if (alteredOnReceive) {\n        if ('body' in alteredOnReceive) {\n          $body = alteredOnReceive.body\n        }\n        if ('title' in alteredOnReceive) {\n          $title = alteredOnReceive.title\n        }\n      }\n\n      var urlWithoutHash = removeHash($url)\n      $history[urlWithoutHash] = {\n        body: $body,\n        title: $title,\n        scrollY: urlWithoutHash in $history ? $history[urlWithoutHash].scrollY : 0\n      }\n\n      var elems = doc.head.children,\n          found = 0,\n          elem,\n          data\n\n      for (var i = elems.length - 1; i >= 0; i--) {\n        elem = elems[i]\n        if (elem.hasAttribute('data-instant-track')) {\n          data = elem.getAttribute('href') || elem.getAttribute('src') || elem.innerHTML\n          for (var j = $trackedAssets.length - 1; j >= 0; j--) {\n            if ($trackedAssets[j] == data) {\n              found++\n            }\n          }\n        }\n      }\n      if (found != $trackedAssets.length) {\n        $mustRedirect = true // Assets have changed\n      }\n    }\n    else {\n      $mustRedirect = true // Not an HTML document\n    }\n\n    if ($isWaitingForCompletion) {\n      $isWaitingForCompletion = false\n      display($url)\n    }\n  }\n\n\n  ////////// MAIN FUNCTIONS //////////\n\n\n  function instantanize(isInitializing) {\n    document.body.addEventListener('touchstart', touchstart, true)\n    if ($preloadOnMousedown) {\n      document.body.addEventListener('mousedown', mousedown, true)\n    }\n    else {\n      document.body.addEventListener('mouseover', mouseover, true)\n    }\n    document.body.addEventListener('click', click, true)\n\n    if (!isInitializing) {\n      var scripts = document.body.getElementsByTagName('script'),\n          script,\n          copy,\n          parentNode,\n          nextSibling\n\n      for (i = 0, j = scripts.length; i < j; i++) {\n        script = scripts[i]\n        if (script.hasAttribute('data-no-instant')) {\n          continue\n        }\n        copy = document.createElement('script')\n        if (script.src) {\n          copy.src = script.src\n        }\n        if (script.innerHTML) {\n          copy.innerHTML = script.innerHTML\n        }\n        parentNode = script.parentNode\n        nextSibling = script.nextSibling\n        parentNode.removeChild(script)\n        parentNode.insertBefore(copy, nextSibling)\n      }\n    }\n  }\n\n  function preload(url) {\n    if (!$preloadOnMousedown\n        && 'display' in $timing\n        && +new Date - ($timing.start + $timing.display) < 100) {\n      /* After a page is displayed, if the user's cursor happens to be above\n         a link a mouseover event will be in most browsers triggered\n         automatically, and in other browsers it will be triggered when the\n         user moves his mouse by 1px.\n\n         Here are the behavior I noticed, all on Windows:\n         - Safari 5.1: auto-triggers after 0 ms\n         - IE 11: auto-triggers after 30-80 ms (depends on page's size?)\n         - Firefox: auto-triggers after 10 ms\n         - Opera 18: auto-triggers after 10 ms\n\n         - Chrome: triggers when cursor moved\n         - Opera 12.16: triggers when cursor moved\n\n         To remedy to this, we do not start preloading if last display\n         occurred less than 100 ms ago. If they happen to click on the link,\n         they will be redirected.\n      */\n\n      return\n    }\n    if ($preloadTimer) {\n      clearTimeout($preloadTimer)\n      $preloadTimer = false\n    }\n\n    if (!url) {\n      url = $urlToPreload\n    }\n\n    if ($isPreloading && (url == $url || $isWaitingForCompletion)) {\n      return\n    }\n    $isPreloading = true\n    $isWaitingForCompletion = false\n\n    $url = url\n    $body = false\n    $mustRedirect = false\n    $timing = {\n      start: +new Date\n    }\n    triggerPageEvent('fetch')\n    $xhr.open('GET', url)\n    $xhr.send()\n  }\n\n  function display(url) {\n    if (!('display' in $timing)) {\n      $timing.display = +new Date - $timing.start\n    }\n    if ($preloadTimer || !$isPreloading) {\n      /* $preloadTimer:\n         Happens when there’s a delay before preloading and that delay\n         hasn't expired (preloading didn't kick in).\n\n         !$isPreloading:\n         A link has been clicked, and preloading hasn’t been initiated.\n         It happens with touch devices when a user taps *near* the link,\n         Safari/Chrome will trigger mousedown, mouseover, click (and others),\n         but when that happens we ignore mousedown/mouseover (otherwise click\n         doesn’t fire). Maybe there’s a way to make the click event fire, but\n         that’s not worth it as mousedown/over happen just 1ms before click\n         in this situation.\n\n         It also happens when a user uses his keyboard to navigate (with Tab\n         and Return), and possibly in other non-mainstream ways to navigate\n         a website.\n      */\n\n      if ($preloadTimer && $url && $url != url) {\n        /* Happens when the user clicks on a link before preloading\n           kicks in while another link is already preloading.\n        */\n\n        location.href = url\n        return\n      }\n\n      preload(url)\n      bar.start(0, true)\n      triggerPageEvent('wait')\n      $isWaitingForCompletion = true // Must be set *after* calling `preload`\n      return\n    }\n    if ($isWaitingForCompletion) {\n      /* The user clicked on a link while a page was preloading. Either on\n         the same link or on another link. If it's the same link something\n         might have gone wrong (or he could have double clicked, we don’t\n         handle that case), so we send him to the page without pjax.\n         If it's another link, it hasn't been preloaded, so we redirect the\n         user to it.\n      */\n      location.href = url\n      return\n    }\n    if ($mustRedirect) {\n      location.href = $url\n      return\n    }\n    if (!$body) {\n      bar.start(0, true)\n      triggerPageEvent('wait')\n      $isWaitingForCompletion = true\n      return\n    }\n    $history[$currentLocationWithoutHash].scrollY = pageYOffset\n    setPreloadingAsHalted()\n    changePage($title, $body, $url)\n  }\n\n\n  ////////// PROGRESS BAR FUNCTIONS //////////\n\n\n  var bar = function() {\n    var $barContainer,\n        $barElement,\n        $barTransformProperty,\n        $barProgress,\n        $barTimer\n\n    function init() {\n      $barContainer = document.createElement('div')\n      $barContainer.id = 'instantclick'\n      $barElement = document.createElement('div')\n      $barElement.id = 'instantclick-bar'\n      $barElement.className = 'instantclick-bar'\n      $barContainer.appendChild($barElement)\n\n      var vendors = ['Webkit', 'Moz', 'O']\n\n      $barTransformProperty = 'transform'\n      if (!($barTransformProperty in $barElement.style)) {\n        for (var i = 0; i < 3; i++) {\n          if (vendors[i] + 'Transform' in $barElement.style) {\n            $barTransformProperty = vendors[i] + 'Transform'\n          }\n        }\n      }\n\n      var transitionProperty = 'transition'\n      if (!(transitionProperty in $barElement.style)) {\n        for (var i = 0; i < 3; i++) {\n          if (vendors[i] + 'Transition' in $barElement.style) {\n            transitionProperty = '-' + vendors[i].toLowerCase() + '-' + transitionProperty\n          }\n        }\n      }\n\n      var style = document.createElement('style')\n      style.innerHTML = '#instantclick{position:' + ($hasTouch ? 'absolute' : 'fixed') + ';top:0;left:0;width:100%;pointer-events:none;z-index:2147483647;' + transitionProperty + ':opacity .25s .1s}'\n        + '.instantclick-bar{background:#29d;width:100%;margin-left:-100%;height:2px;' + transitionProperty + ':all .25s}'\n      /* We set the bar's background in `.instantclick-bar` so that it can be\n         overriden in CSS with `#instantclick-bar`, as IDs have higher priority.\n      */\n      document.head.appendChild(style)\n\n      if ($hasTouch) {\n        updatePositionAndScale()\n        addEventListener('resize', updatePositionAndScale)\n        addEventListener('scroll', updatePositionAndScale)\n      }\n\n    }\n\n    function start(at, jump) {\n      $barProgress = at\n      if (document.getElementById($barContainer.id)) {\n        document.body.removeChild($barContainer)\n      }\n      $barContainer.style.opacity = '1'\n      if (document.getElementById($barContainer.id)) {\n        document.body.removeChild($barContainer)\n        /* So there's no CSS animation if already done once and it goes from 1 to 0 */\n      }\n      update()\n      if (jump) {\n        setTimeout(jumpStart, 0)\n        /* Must be done in a timer, otherwise the CSS animation doesn't happen. */\n      }\n      clearTimeout($barTimer)\n      $barTimer = setTimeout(inc, 500)\n    }\n\n    function jumpStart() {\n      $barProgress = 10\n      update()\n    }\n\n    function inc() {\n      $barProgress += 1 + (Math.random() * 2)\n      if ($barProgress >= 98) {\n        $barProgress = 98\n      }\n      else {\n        $barTimer = setTimeout(inc, 500)\n      }\n      update()\n    }\n\n    function update() {\n      $barElement.style[$barTransformProperty] = 'translate(' + $barProgress + '%)'\n      if (!document.getElementById($barContainer.id)) {\n        document.body.appendChild($barContainer)\n      }\n    }\n\n    function done() {\n      if (document.getElementById($barContainer.id)) {\n        clearTimeout($barTimer)\n        $barProgress = 100\n        update()\n        $barContainer.style.opacity = '0'\n        /* If you're debugging, setting this to 0.5 is handy. */\n        return\n      }\n\n      /* The bar container hasn't been appended: It's a new page. */\n      start($barProgress == 100 ? 0 : $barProgress)\n      /* $barProgress is 100 on popstate, usually. */\n      setTimeout(done, 0)\n      /* Must be done in a timer, otherwise the CSS animation doesn't happen. */\n    }\n\n    function updatePositionAndScale() {\n      /* Adapted from code by Sam Stephenson and Mislav Marohnić\n         http://signalvnoise.com/posts/2407\n      */\n\n      $barContainer.style.left = pageXOffset + 'px'\n      $barContainer.style.width = innerWidth + 'px'\n      $barContainer.style.top = pageYOffset + 'px'\n\n      var landscape = 'orientation' in window && Math.abs(orientation) == 90,\n          scaleY = innerWidth / screen[landscape ? 'height' : 'width'] * 2\n      /* We multiply the size by 2 because the progress bar is harder\n         to notice on a mobile device.\n      */\n      $barContainer.style[$barTransformProperty] = 'scaleY(' + scaleY  + ')'\n    }\n\n    return {\n      init: init,\n      start: start,\n      done: done\n    }\n  }()\n\n\n  ////////// PUBLIC VARIABLE AND FUNCTIONS //////////\n\n  var supported = 'pushState' in history\n                  && (!$ua.match('Android') || $ua.match('Chrome/'))\n                  && location.protocol != \"file:\"\n\n  /* The state of Android's AOSP browsers:\n\n     2.3.7: pushState appears to work correctly, but\n            `doc.documentElement.innerHTML = body` is buggy.\n            See details here: http://stackoverflow.com/q/21918564\n            Not an issue anymore, but it may fail where 3.0 do, this needs\n            testing again.\n\n     3.0:   pushState appears to work correctly (though the URL bar is only\n            updated on focus), but\n            `document.documentElement.replaceChild(doc.body, document.body)`\n        throws DOMException: WRONG_DOCUMENT_ERR.\n\n     4.0.2: Doesn't support pushState.\n\n     4.0.4,\n     4.1.1,\n     4.2,\n     4.3:   pushState is here, but it doesn't update the URL bar.\n            (Great logic there.)\n\n     4.4:   Works correctly. Claims to be 'Chrome/30.0.0.0'.\n\n     All androids tested with Android SDK's Emulator.\n     Version numbers are from the browser's user agent.\n\n     Because of this mess, the only whitelisted browser on Android is Chrome.\n  */\n\n  function init() {\n    if ($currentLocationWithoutHash) {\n      /* Already initialized */\n      return\n    }\n    if (!supported) {\n      triggerPageEvent('change', true)\n      return\n    }\n    for (var i = arguments.length - 1; i >= 0; i--) {\n      var arg = arguments[i]\n      if (arg === true) {\n        $useWhitelist = true\n      }\n      else if (arg == 'mousedown') {\n        $preloadOnMousedown = true\n      }\n      else if (typeof arg == 'number') {\n        $delayBeforePreload = arg\n      }\n    }\n    $currentLocationWithoutHash = removeHash(location.href)\n    $history[$currentLocationWithoutHash] = {\n      body: document.body,\n      title: document.title,\n      scrollY: pageYOffset\n    }\n\n    var elems = document.head.children,\n        elem,\n        data\n    for (var i = elems.length - 1; i >= 0; i--) {\n      elem = elems[i]\n      if (elem.hasAttribute('data-instant-track')) {\n        data = elem.getAttribute('href') || elem.getAttribute('src') || elem.innerHTML\n        /* We can't use just `elem.href` and `elem.src` because we can't\n           retrieve `href`s and `src`s from the Ajax response.\n        */\n        $trackedAssets.push(data)\n      }\n    }\n\n    $xhr = new XMLHttpRequest()\n    $xhr.addEventListener('readystatechange', readystatechange)\n\n    instantanize(true)\n\n    bar.init()\n\n    triggerPageEvent('change', true)\n\n    addEventListener('popstate', function() {\n      var loc = removeHash(location.href)\n      if (loc == $currentLocationWithoutHash) {\n        return\n      }\n\n      if (!(loc in $history)) {\n        location.href = location.href\n        /* Reloads the page while using cache for scripts, styles and images,\n           unlike `location.reload()` */\n        return\n      }\n\n      $history[$currentLocationWithoutHash].scrollY = pageYOffset\n      $currentLocationWithoutHash = loc\n      changePage($history[loc].title, $history[loc].body, false, $history[loc].scrollY)\n    })\n  }\n\n  function on(eventType, callback) {\n    $eventsCallbacks[eventType].push(callback)\n  }\n\n\n  ////////////////////\n\n\n  return {\n    supported: supported,\n    init: init,\n    on: on\n  }\n\n}(document, location);\n"]}