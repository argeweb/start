{"version":3,"sources":["../../bower_components/codemirror/lib/codemirror.js"],"names":["mod","exports","module","define","amd","this","window","CodeMirror","place","options","copyObj","defaults","setGuttersForLineNumbers","doc","value","Doc","mode","lineSeparator","input","inputStyles","inputStyle","display","Display","wrapper","updateGutters","themeChanged","lineWrapping","className","autofocus","mobile","focus","initScrollbars","state","keyMaps","overlays","modeGen","overwrite","delayingBlurEvent","focused","suppressEdits","pasteIncoming","cutIncoming","selectingText","draggingText","highlight","Delayed","keySeq","specialChars","cm","ie","ie_version","setTimeout","reset","registerEventHandlers","ensureGlobalHandlers","startOperation","curOp","forceUpdate","attachDoc","hasFocus","bind","onFocus","onBlur","opt","optionHandlers","hasOwnProperty","Init","maybeUpdateLineNumberWidth","finishInit","i","initHooks","length","endOperation","webkit","getComputedStyle","lineDiv","textRendering","style","d","scrollbarFiller","elt","setAttribute","gutterFiller","selectionDiv","cursorDiv","measure","lineMeasure","lineSpace","mover","sizer","sizerWidth","heightForcer","scrollerGap","gutters","lineGutter","scroller","zIndex","paddingRight","gecko","draggable","appendChild","viewFrom","viewTo","first","reportedViewFrom","reportedViewTo","view","renderedView","externalMeasured","viewOffset","lastWrapHeight","lastWrapWidth","updateLineNumbers","nativeBarWidth","barHeight","barWidth","scrollbarsClipped","lineNumWidth","lineNumInnerWidth","lineNumChars","alignWidgets","cachedCharWidth","cachedTextHeight","cachedPaddingH","maxLine","maxLineLength","maxLineChanged","wheelDX","wheelDY","wheelStartX","wheelStartY","shift","selForContextMenu","activeTouch","init","loadMode","getMode","modeOption","resetModeState","iter","line","stateAfter","styles","frontier","startWorker","regChange","wrappingChanged","addClass","minWidth","rmClass","findMaxLine","estimateLineHeights","clearCaches","updateScrollbars","estimateHeight","th","textHeight","wrapping","perLine","Math","max","clientWidth","charWidth","lineIsHidden","widgetsHeight","widgets","height","ceil","text","est","estHeight","updateLineHeight","replace","theme","guttersChanged","alignHorizontally","specs","removeChildren","gutterClass","gElt","width","updateGutterSpace","offsetWidth","marginLeft","lineLength","merged","len","cur","collapsedSpanAtStart","found","find","from","ch","to","collapsedSpanAtEnd","getLine","indexOf","lineNumbers","concat","slice","splice","measureForScrollbars","gutterW","docH","round","paddingVert","clientHeight","viewHeight","scrollWidth","viewWidth","barLeft","fixedGutter","docHeight","scrollHeight","scrollGap","gutterWidth","NativeScrollbars","scroll","vert","horiz","on","scrollTop","scrollLeft","checkedZeroWidth","minHeight","NullScrollbars","scrollbars","clear","scrollbarModel","scrollbarStyle","node","insertBefore","pos","axis","setScrollLeft","setScrollTop","startWidth","startHeight","updateScrollbarsInner","updateHeightsInViewport","sizes","update","right","paddingBottom","bottom","borderBottom","coverGutterNextToScrollbar","visibleLines","viewport","top","floor","paddingTop","lineAtHeight","ensure","ensureFrom","ensureTo","heightAtLine","min","lastLine","firstChild","comp","compensateForHScroll","left","hidden","gutter","gutterBackground","align","alignable","j","last","lineNumberFor","size","test","innerW","padding","String","lineNumberFormatter","firstLineNumber","getBoundingClientRect","DisplayUpdate","force","visible","editorIsHidden","wrapperHeight","wrapperWidth","oldDisplayWidth","displayWidth","dims","getDimensions","events","maybeClipScrollbars","marginBottom","borderRightWidth","updateDisplayIfNeeded","resetView","countDirtyView","end","viewportMargin","sawCollapsedSpans","visualLineNo","visualLineEndNo","different","adjustView","toUpdate","activeElt","patchDisplay","offsetHeight","postUpdateDisplay","displayHeight","barMeasure","updateSelection","setDocumentHeight","signal","updateDisplaySimple","finish","prevBottom","offsetTop","bot","box","diff","updateWidgetHeight","rest","parentNode","gutterLeft","clientLeft","n","nextSibling","offsetLeft","fixedPos","gutterTotalWidth","updateNumbersFrom","rm","next","mac","currentWheelTarget","removeChild","container","lineN","lineView","updateNumber","lineNumber","changes","updateLineForChanges","document","createTextNode","buildLineElement","type","updateLineText","updateLineGutter","updateLineClasses","updateLineWidgets","ensureLineWrapped","replaceChild","updateLineBackground","cls","bgClass","background","wrap","getLineContent","ext","built","buildLineContent","pre","textClass","wrapClass","markers","gutterMarkers","gutterWrap","setUneditable","k","id","insertLineWidgets","insertLineWidgetsFor","allowAbove","ws","widget","handleMouseEvents","positionLineWidget","above","signalLater","noHScroll","push","coverGutter","paddingLeft","position","copyPos","x","Pos","maxPos","a","b","cmp","minPos","ensureFocus","applyTextInput","inserted","deleted","sel","origin","paste","textLines","splitLines","multiPaste","ranges","lastCopied","join","map","l","range","empty","lst","lineWise","updateInput","changeEvent","makeChange","triggerElectric","ensureCursorVisible","typing","handlePaste","e","pasted","clipboardData","getData","preventDefault","isReadOnly","disableInput","runInOp","electricChars","smartIndent","head","getModeAt","indented","charAt","indentLine","electricInput","copyableRanges","lineRange","anchor","getRange","disableBrowserMagic","field","spellcheck","TextareaInput","prevInput","pollingFast","polling","inaccurateSelection","hasSelection","composing","hiddenTextarea","te","div","ios","border","ContentEditableInput","lastAnchorNode","lastAnchorOffset","lastFocusNode","lastFocusOffset","gracePeriod","posToDOM","findViewForLine","info","mapFromLineView","order","getOrder","side","partPos","getBidiPartAt","result","nodeAndOffsetInLineMap","offset","collapse","start","badPos","bad","domToPos","lineNode","childNodes","clipPos","locateNodeInLineView","textNode","topNode","maps","curNode","lineNo","contains","nodeType","nodeValue","after","dist","textContent","before","previousSibling","domTextBetween","fromLine","toLine","recognizeMarker","marker","walk","cmText","getAttribute","markerID","findMarks","getBetween","lineSep","nodeName","closing","val","Selection","primIndex","Range","normalizeSelection","prim","sort","prev","inv","simpleSelection","clipLine","clipToLen","linelen","isLine","clipPosArray","array","out","extendRange","other","extend","posBefore","extendSelection","setSelection","primary","extendSelections","heads","newSel","replaceOneSelection","setSimpleSelection","filterSelectionChange","obj","setSelectionReplaceHistory","done","history","setSelectionNoUndo","addSelectionToHistory","NaN","hasHandler","bias","setSelectionInner","skipAtomicInSelection","equals","selectionChanged","signalCursorActivity","reCheckSelection","sel_dontScroll","mayClear","old","newAnchor","skipAtomic","newHead","skipAtomicInner","oldPos","dir","markedSpans","sp","m","inclusiveLeft","inclusiveRight","explicitlyCleared","atomic","near","movePos","far","cantEdit","showSelection","prepareSelection","curFragment","cursors","createDocumentFragment","selFragment","selection","collapsed","showCursorWhenSelecting","drawSelectionCursor","drawSelectionRange","output","cursorCoords","singleCursorHeightPerLine","cursor","cursorHeight","otherCursor","add","fragment","rightSide","drawForLine","fromArg","toArg","coords","charCoords","lineObj","lineLen","iterateBidiSections","rightPos","leftPos","tmp","leftSide","paddingH","sFrom","sTo","singleVLine","visualLine","leftEnd","rightStart","restartBlink","clearInterval","blinker","visibility","cursorBlinkRate","setInterval","time","startState","set","highlightWorker","Date","workTime","copyState","getStateBefore","changedLines","oldStyles","tooLong","maxHighlightLength","highlighted","highlightLine","oldCls","styleClasses","newCls","classes","ischange","processLine","workDelay","regLineChange","findStartLine","precise","minindent","minline","lim","innerMode","search","countColumn","tabSize","save","removeChildrenAndAdd","currentStyle","data","parseInt","isNaN","ensureLineHeights","rect","curWidth","heights","rects","getClientRects","abs","cache","caches","updateExternalMeasurement","LineView","measureChar","measureCharPrepared","prepareMeasureForLine","findViewIndex","hasHeights","prepared","varHeight","key","measureCharInner","bogus","rtop","rbottom","mStart","mEnd","insertLeft","coverStart","coverEnd","getUsefulRect","nullRect","isExtendingChar","maybeUpdateRectForZooming","rSpan","rbot","mid","screen","logicalXDPI","deviceXDPI","hasBadZoomedRects","scaleX","scaleY","logicalYDPI","deviceYDPI","clearLineMeasurementCacheFor","clearLineMeasurementCache","externalMeasure","pageScrollX","pageXOffset","documentElement","body","pageScrollY","pageYOffset","intoCoordSystem","context","widgetHeight","yOff","lOff","xOff","fromCoordSystem","localBox","lineSpaceBox","preparedMeasure","get","getBidi","part","level","bidiLeft","bidiRight","bidiOther","estimateCoords","PosWithInfo","outside","xRel","coordsChar","y","coordsCharInner","mergedPos","getX","wrongLine","innerOff","adjust","bidi","lineLeft","lineRight","fromX","fromOutside","toX","toOutside","moveVisually","xDiff","charSize","step","middle","middleX","measureText","viewChanged","changeObjs","cursorActivityHandlers","cursorActivityCalled","updateMaxLine","scrollToPos","nextOpId","operationGroup","ops","ownsGroup","delayedCallbacks","fireCallbacksForOps","group","callbacks","call","op","endOperations","endOperation_R1","endOperation_W1","endOperation_R2","endOperation_W2","endOperation_finish","mustUpdate","updatedDisplay","adjustWidthTo","maxScrollLeft","preparedSelection","takeFocus","forceScroll","scrollPosIntoView","margin","isCursor","maybeScrollWindow","maybeHiddenMarkers","unhidden","maybeUnhiddenMarkers","lines","f","operation","apply","arguments","methodOp","docMethodOp","visualLineContinued","buildViewArray","nextPos","lendiff","cut","viewCuttingPoint","index","cutTop","cutBot","arr","oldN","newN","dirty","finishTouch","touchFinished","prevTouch","isMouseLikeTouchEvent","touches","touch","radiusX","radiusY","farAway","dx","dy","onMouseDown","signalDOMEvent","posFromMouse","clickInGutter","eventInWidget","e_preventDefault","word","findWordAt","captureRightClick","onContextMenu","clearTimeout","now","moved","pageX","pageY","onScrollWheel","dragFunctions","enter","e_stop","over","onDragOver","onDragStart","drop","onDrop","leave","clearDragCursor","inp","getField","onKeyUp","onKeyDown","onKeyPress","dragDropChanged","wasOn","funcs","toggle","off","onResize","setSize","e_target","liberal","forRect","space","clientX","clientY","colDiff","supportsTouch","shiftKey","e_button","leftButtonDown","lastMiddleDown","delayBlurEvent","lastDoubleClick","lastClick","contained","modifier","metaKey","ctrlKey","dragDrop","dragAndDrop","leftButtonStartDrag","leftButtonSelect","startTime","dragEnd","e2","copy","altKey","addNew","extendTo","lastPos","startCol","posCol","findColumn","startSel","ourIndex","scrollIntoView","oldRange","ourRange","sel_mouse","curCount","counter","editorSize","Infinity","move","up","lastSelOrigin","chromeOS","gutterEvent","prevent","mX","mY","lineBox","e_defaultPrevented","g","lastDrop","files","dataTransfer","FileReader","File","Array","read","loadFile","file","allowDropFileTypes","reader","onload","content","change","changeEnd","readAsText","selected","listSelections","replaceRange","replaceSelection","setData","getSelection","effectAllowed","setDragImage","safari","img","src","presto","_top","frag","dragCursor","isScroller","delta","wheelEventDelta","canScrollX","canScrollY","outer","target","wheelPixelsPerUnit","pixels","wheelSamples","movedX","movedY","sample","doHandleBinding","bound","dropShift","commands","ensurePolled","prevShift","Pass","lookupKeyForEditor","name","handle","lookupKey","extraKeys","keyMap","dispatchKey","seq","isModifierKey","stopSeq","handleKeyBinding","keyName","motion","handleCharBinding","keyCode","returnValue","code","handled","lastStoppedKey","hasCopyEvent","showCrossHair","charCode","which","fromCharCode","readOnly","receivedFocus","contextMenuInGutter","adjustForChange","computeSelAfterChange","offsetPos","nw","computeReplacedSel","hint","oldPrev","newPrev","filterChange","canceled","cancel","undefined","ignoreReadOnly","split","sawReadOnlySpans","removeReadOnlyRanges","makeChangeInner","selAfter","addChangeToHistory","makeChangeSingleDoc","stretchSpansOverChange","rebased","linkedDocs","sharedHist","rebaseHist","makeChangeFromHistory","allowSelectionOnly","event","hist","source","undone","dest","lastOrigin","pop","pushSelectionToHistory","clearRedo","antiChanges","generation","maxGeneration","filter","historyChangeFromChange","mergeOldSpans","shiftDoc","distance","spans","removed","makeChangeSingleDocInEditor","updateDoc","recomputeMaxLength","checkWidthStart","full","isWholeLineUpdate","changesHandler","changeHandler","doScroll","innerHeight","phantom","scrollNode","limit","changed","endCoords","scrollPos","calculateScrollPos","startTop","startLeft","x1","y1","x2","y2","snapMargin","screentop","docBottom","atTop","atBottom","newTop","screenleft","screenw","tooWide","addToScrollPos","resolveScrollToPos","getCursor","cursorScrollMargin","sPos","scrollTo","how","aggressive","indent","curSpace","indentation","curSpaceString","match","indentUnit","indentString","indentWithTabs","spaceStr","changeLine","changeType","no","deleteNearSelection","compute","kill","toKill","replaced","findPosH","unit","visually","findNextLine","moveOnce","boundToLine","moveLogically","origDir","sawType","helper","getHelper","isWordChar","hitSide","findPosV","pageSize","option","deflt","notOnInit","normalizeKeyName","alt","ctrl","cmd","parts","Error","getKeyMap","markText","shared","markTextShared","TextMarker","clearWhenEmpty","replacedWith","widgetNode","conflictingCollapsedRange","addToHistory","curLine","addMarkedSpan","MarkedSpan","clearOnEnter","clearHistory","nextMarkerId","title","startStyle","endStyle","css","cloneNode","linked","isParent","SharedTextMarker","findSharedMarkers","parent","copySharedMarkers","mFrom","mTo","subMark","detachSharedMarkers","subMarker","getMarkedSpanFor","span","removeMarkedSpan","r","attachLine","markedSpansBefore","startCh","isInsert","startsBefore","endsAfter","markedSpansAfter","endCh","oldFirst","oldLast","sameLine","clearEmptySpans","newMarkers","gapMarkers","gap","getOldSpans","stretched","oldCur","stretchCur","mark","mk","p","newParts","dfrom","dto","detachMarkedSpans","detachLine","attachMarkedSpans","extraLeft","extraRight","compareCollapsedMarkers","lenDiff","aPos","bPos","fromCmp","toCmp","collapsedSpanAtSide","sps","vis","lineIsHiddenInner","adjustScrollWhenAboveVisible","parentStyle","addLineWidget","LineWidget","insertAt","aboveVisible","updateLine","cleanUpLine","extractLineClasses","lineClass","prop","RegExp","callBlankLine","blankLine","inner","readToken","stream","token","takeToken","asArray","getObj","string","current","tokens","StringStream","eol","runMode","lineClasses","forceToEnd","flattenSpans","curStart","curStyle","addModeClass","mName","st","o","overlay","at","i_end","opaque","getLineStyles","updateFrontier","startAt","interpretTokenStyle","styleToClassCacheWithMode","styleToClassCache","builder","col","trailingSpace","splitSpaces","getOption","addToken","buildToken","hasBadBidiRects","buildTokenBadBidi","allowFrontierUpdate","insertLineContent","joinClasses","zeroWidthElement","lastChild","querySelector","defaultSpecialCharPlaceholder","charCodeAt","toString","displayText","special","mustWrap","lastIndex","exec","skipped","txt","tabWidth","specialCharPlaceholder","fullStyle","trailingBefore","spaceBefore","buildCollapsedSpan","ignoreWidget","needsContentAttribute","createElement","allText","spanStyle","spanEndStyle","spanStartStyle","nextChange","endStyles","foundBookmarks","upto","tokenText","wholeLineUpdateBefore","spansFor","linesFor","Line","firstLine","lastText","lastSpans","nlines","insert","remove","added","LeafChunk","BranchChunk","children","chunkSize","sharedHistOnly","propagate","skip","rel","chunk","child","sz","getLines","h","lh","bidiOrdering","History","startGen","undoDepth","lastModTime","lastSelTime","lastOp","lastSelOp","histChange","attachLocalSpans","clearSelectionEvents","lastChangeEvent","opId","historyEventDelay","selectionEventCanBeMerged","somethingSelected","existing","removeClearedSpans","copyHistoryArray","newGroup","instantiateSel","prototype","deepCopy","newChanges","Number","rebaseHistSelSingle","rebaseHistArray","sub","ok","copied","defaultPrevented","srcElement","button","getHandlers","emitter","_handlers","noHandlers","bnd","args","list","orphanDelayedCallbacks","fireOrphanDelayed","delayed","override","codemirrorIgnore","cursorActivity","eventMixin","ctor","spaceStrs","insertSorted","score","priority","nothing","createObj","base","props","inst","Object","create","isWordCharBasic","isEmpty","extendingChars","tag","cssText","count","activeElement","root","classTest","as","forEachCodeMirror","getElementsByClassName","byClass","globalsRegistered","registerGlobalHandlers","resizeTimer","zwspSupported","badBidiRects","r0","r1","badZoomedRects","normal","fromRange","lineStart","visual","lineEnd","lineStartSmart","firstNonWS","inWS","compareBidiLevel","linedir","moveInLine","byUnit","userAgent","navigator","platform","ie_upto10","ie_11up","documentMode","qtwebkit","chrome","vendor","mac_geMountainLion","windows","presto_version","flipCtrlCmd","needsH","needsV","sWidth","totalHeight","totalWidth","zeroWidthHack","disableHoriz","enableZeroWidthBar","disableVert","w","pointerEvents","bar","delay","maybeDisable","elementFromPoint","native","null","cmpPos","prepareCopyCut","getSelections","selectInput","lineWiseCopyCut","setSelections","textarea","poll","fastPoll","moveInputWithCursor","headPos","wrapOff","lineOff","teTop","teLeft","drawn","contextMenuPending","minimal","blur","resetPosition","slowPoll","pollInterval","missed","execCommand","same","self","prepareSelectAllHack","selectionStart","extval","selectionEnd","rehide","oldWrapperCSS","oldCSS","selectAll","detectingSelectAll","resetSelectionOnContextMenu","wrapperBox","oldScrollY","scrollY","mouseup","readOnlyChanged","onCopyCut","clearData","kludge","hadFocus","showPrimarySelection","pollContent","startData","ours","applyComposition","forceCompositionEnd","showMultipleSelections","curAnchor","anchorNode","anchorOffset","curFocus","focusNode","focusOffset","rangeCount","getRangeAt","rng","addRange","removeAllRanges","startGracePeriod","rememberSelection","selectionInEditor","commonAncestorContainer","pollSelection","fromIndex","fromNode","toIndex","toNode","newText","oldText","cutFront","cutEnd","oldTop","maxCutFront","newBot","oldBot","maxCutEnd","chFrom","chTo","contentEditable","contenteditable","here","there","wheelDeltaX","wheelDeltaY","detail","HORIZONTAL_AXIS","VERTICAL_AXIS","wheelDelta","wheelEventPixels","constructor","setOption","getDoc","addKeyMap","removeKeyMap","addOverlay","spec","modeSpec","removeOverlay","indentSelection","newRanges","getTokenAt","getLineTokens","getTokenTypeAt","getHelpers","helpers","help","helperType","_global","pred","getStateAfter","defaultTextHeight","defaultCharWidth","setGutterMarker","gutterID","clearGutter","lineInfo","getViewport","addWidget","vspace","hspace","triggerOnKeyDown","triggerOnKeyPress","triggerOnKeyUp","amount","moveH","extendSelectionsBy","rtlMoveVisually","sel_move","deleteH","goalColumn","moveV","goals","startChar","check","toggleOverwrite","getScrollInfo","interpret","refresh","oldHeight","swapDoc","getInputField","getWrapperElement","getScrollerElement","getGutterElement","setValue","newBreaks","detach","attach","integer","disabled","tabIndex","modes","mimeModes","defineMode","dependencies","defineMIME","mime","resolveMode","mfactory","modeObj","modeExtensions","exts","modeProps","skipToEnd","extendMode","properties","defineExtension","func","defineDocExtension","defineOption","defineInitHook","registerHelper","registerGlobalHelper","predicate","nstate","a1","a2","singleSelection","killLine","deleteLine","delLineLeft","delWrappedLineLeft","delWrappedLineRight","undo","redo","undoSelection","redoSelection","goDocStart","goDocEnd","goLineStart","goLineStartSmart","goLineEnd","goLineRight","goLineLeft","goLineLeftSmart","goLineUp","goLineDown","goPageUp","goPageDown","goCharLeft","goCharRight","goColumnLeft","goColumnRight","goWordLeft","goGroupRight","goGroupLeft","goWordRight","delCharBefore","delCharAfter","delWordBefore","delWordAfter","delGroupBefore","delGroupAfter","indentAuto","indentMore","indentLess","insertTab","insertSoftTab","spaces","replaceSelections","defaultTab","transposeChars","newlineAndIndent","openLine","basic","Left","Right","Up","Down","End","Home","PageUp","PageDown","Delete","Backspace","Shift-Backspace","Tab","Shift-Tab","Enter","Insert","Esc","pcDefault","Ctrl-A","Ctrl-D","Ctrl-Z","Shift-Ctrl-Z","Ctrl-Y","Ctrl-Home","Ctrl-End","Ctrl-Up","Ctrl-Down","Ctrl-Left","Ctrl-Right","Alt-Left","Alt-Right","Ctrl-Backspace","Ctrl-Delete","Ctrl-S","Ctrl-F","Ctrl-G","Shift-Ctrl-G","Shift-Ctrl-F","Shift-Ctrl-R","Ctrl-[","Ctrl-]","Ctrl-U","Shift-Ctrl-U","Alt-U","fallthrough","emacsy","Ctrl-B","Ctrl-P","Ctrl-N","Alt-F","Alt-B","Ctrl-E","Ctrl-V","Shift-Ctrl-V","Ctrl-H","Alt-D","Alt-Backspace","Ctrl-K","Ctrl-T","Ctrl-O","macDefault","Cmd-A","Cmd-D","Cmd-Z","Shift-Cmd-Z","Cmd-Y","Cmd-Home","Cmd-Up","Cmd-End","Cmd-Down","Cmd-Left","Cmd-Right","Ctrl-Alt-Backspace","Alt-Delete","Cmd-S","Cmd-F","Cmd-G","Shift-Cmd-G","Cmd-Alt-F","Shift-Cmd-Alt-F","Cmd-[","Cmd-]","Cmd-Backspace","Cmd-Delete","Cmd-U","Shift-Cmd-U","normalizeKeyMap","keymap","keyname","keys","keyNames","noShift","altGraphKey","fromTextArea","getValue","tabindex","placeholder","form","leaveSubmitMethodAlone","realSubmit","submit","wrappedSubmit","getTextArea","toTextArea","lastColumnPos","lastColumnValue","sol","peek","eat","eatWhile","eatSpace","skipTo","backUp","column","pattern","consume","caseInsensitive","cased","str","toLowerCase","substr","hideFirstChars","withOp","dHeight","oldH","removeInner","insertInner","iterN","remaining","leaf","maybeSpill","me","spilled","sibling","myIndex","used","nextDocId","cleanGeneration","getLineHandle","getLineNumber","getLineHandleVisualStart","lineCount","setCursor","addSelection","dup","setExtending","getExtending","historySize","markClean","changeGeneration","forceSplit","isClean","gen","getHistory","setHistory","histData","addLineClass","where","removeLineClass","removeLineWidget","setBookmark","realOpts","findMarksAt","getAllMarks","posFromIndex","sepSize","indexFromPos","copyHistory","linkedDoc","unlinkDoc","link","splitIds","iterLinkedDocs","getEditor","splitLinesAuto","eachLine","dontDelegate","method","e_stopPropagation","stopPropagation","cancelBubble","addEventListener","attachEvent","removeEventListener","detachEvent","handlers","ms","startIndex","startValue","nextTab","goal","select","_e","nonASCIISingleCaseWordChar","toUpperCase","createRange","endNode","setEnd","setStart","createTextRange","moveToElementText","moveEnd","moveStart","host","nl","rt","ownerDocument","parentElement","compareEndPoints","oncopy","3","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","44","45","46","59","61","91","92","93","106","107","109","110","111","127","173","186","187","188","189","190","191","192","219","220","221","222","63232","63233","63234","63235","63272","63273","63275","63276","63277","63302","charType","lowTypes","arabicTypes","BidiSpan","bidiRE","isNeutral","isStrong","countsAsLeft","countsAsNum","outerType","types","nstart","unshift","version"],"mappings":"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","file":"codemirror.min.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: http://codemirror.net/LICENSE\r\n\r\n// This is CodeMirror (http://codemirror.net), a code editor\r\n// implemented in JavaScript on top of the browser's DOM.\r\n//\r\n// You can find some technical background for some of the code below\r\n// at http://marijnhaverbeke.nl/blog/#cm-internals .\r\n\r\n(function(mod) {\r\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\r\n    module.exports = mod();\r\n  else if (typeof define == \"function\" && define.amd) // AMD\r\n    return define([], mod);\r\n  else // Plain browser env\r\n    (this || window).CodeMirror = mod();\r\n})(function() {\r\n  \"use strict\";\r\n\r\n  // BROWSER SNIFFING\r\n\r\n  // Kludges for bugs and behavior differences that can't be feature\r\n  // detected are enabled based on userAgent etc sniffing.\r\n  var userAgent = navigator.userAgent;\r\n  var platform = navigator.platform;\r\n\r\n  var gecko = /gecko\\/\\d/i.test(userAgent);\r\n  var ie_upto10 = /MSIE \\d/.test(userAgent);\r\n  var ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(userAgent);\r\n  var ie = ie_upto10 || ie_11up;\r\n  var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : ie_11up[1]);\r\n  var webkit = /WebKit\\//.test(userAgent);\r\n  var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(userAgent);\r\n  var chrome = /Chrome\\//.test(userAgent);\r\n  var presto = /Opera\\//.test(userAgent);\r\n  var safari = /Apple Computer/.test(navigator.vendor);\r\n  var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(userAgent);\r\n  var phantom = /PhantomJS/.test(userAgent);\r\n\r\n  var ios = /AppleWebKit/.test(userAgent) && /Mobile\\/\\w+/.test(userAgent);\r\n  // This is woefully incomplete. Suggestions for alternative methods welcome.\r\n  var mobile = ios || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);\r\n  var mac = ios || /Mac/.test(platform);\r\n  var chromeOS = /\\bCrOS\\b/.test(userAgent);\r\n  var windows = /win/i.test(platform);\r\n\r\n  var presto_version = presto && userAgent.match(/Version\\/(\\d*\\.\\d*)/);\r\n  if (presto_version) presto_version = Number(presto_version[1]);\r\n  if (presto_version && presto_version >= 15) { presto = false; webkit = true; }\r\n  // Some browsers use the wrong event properties to signal cmd/ctrl on OS X\r\n  var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));\r\n  var captureRightClick = gecko || (ie && ie_version >= 9);\r\n\r\n  // Optimize some code when these features are not used.\r\n  var sawReadOnlySpans = false, sawCollapsedSpans = false;\r\n\r\n  // EDITOR CONSTRUCTOR\r\n\r\n  // A CodeMirror instance represents an editor. This is the object\r\n  // that user code is usually dealing with.\r\n\r\n  function CodeMirror(place, options) {\r\n    if (!(this instanceof CodeMirror)) return new CodeMirror(place, options);\r\n\r\n    this.options = options = options ? copyObj(options) : {};\r\n    // Determine effective options based on given values and defaults.\r\n    copyObj(defaults, options, false);\r\n    setGuttersForLineNumbers(options);\r\n\r\n    var doc = options.value;\r\n    if (typeof doc == \"string\") doc = new Doc(doc, options.mode, null, options.lineSeparator);\r\n    this.doc = doc;\r\n\r\n    var input = new CodeMirror.inputStyles[options.inputStyle](this);\r\n    var display = this.display = new Display(place, doc, input);\r\n    display.wrapper.CodeMirror = this;\r\n    updateGutters(this);\r\n    themeChanged(this);\r\n    if (options.lineWrapping)\r\n      this.display.wrapper.className += \" CodeMirror-wrap\";\r\n    if (options.autofocus && !mobile) display.input.focus();\r\n    initScrollbars(this);\r\n\r\n    this.state = {\r\n      keyMaps: [],  // stores maps added by addKeyMap\r\n      overlays: [], // highlighting overlays, as added by addOverlay\r\n      modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info\r\n      overwrite: false,\r\n      delayingBlurEvent: false,\r\n      focused: false,\r\n      suppressEdits: false, // used to disable editing during key handlers when in readOnly mode\r\n      pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in input.poll\r\n      selectingText: false,\r\n      draggingText: false,\r\n      highlight: new Delayed(), // stores highlight worker timeout\r\n      keySeq: null,  // Unfinished key sequence\r\n      specialChars: null\r\n    };\r\n\r\n    var cm = this;\r\n\r\n    // Override magic textarea content restore that IE sometimes does\r\n    // on our hidden textarea on reload\r\n    if (ie && ie_version < 11) setTimeout(function() { cm.display.input.reset(true); }, 20);\r\n\r\n    registerEventHandlers(this);\r\n    ensureGlobalHandlers();\r\n\r\n    startOperation(this);\r\n    this.curOp.forceUpdate = true;\r\n    attachDoc(this, doc);\r\n\r\n    if ((options.autofocus && !mobile) || cm.hasFocus())\r\n      setTimeout(bind(onFocus, this), 20);\r\n    else\r\n      onBlur(this);\r\n\r\n    for (var opt in optionHandlers) if (optionHandlers.hasOwnProperty(opt))\r\n      optionHandlers[opt](this, options[opt], Init);\r\n    maybeUpdateLineNumberWidth(this);\r\n    if (options.finishInit) options.finishInit(this);\r\n    for (var i = 0; i < initHooks.length; ++i) initHooks[i](this);\r\n    endOperation(this);\r\n    // Suppress optimizelegibility in Webkit, since it breaks text\r\n    // measuring on line wrapping boundaries.\r\n    if (webkit && options.lineWrapping &&\r\n        getComputedStyle(display.lineDiv).textRendering == \"optimizelegibility\")\r\n      display.lineDiv.style.textRendering = \"auto\";\r\n  }\r\n\r\n  // DISPLAY CONSTRUCTOR\r\n\r\n  // The display handles the DOM integration, both for input reading\r\n  // and content drawing. It holds references to DOM nodes and\r\n  // display-related state.\r\n\r\n  function Display(place, doc, input) {\r\n    var d = this;\r\n    this.input = input;\r\n\r\n    // Covers bottom-right square when both scrollbars are present.\r\n    d.scrollbarFiller = elt(\"div\", null, \"CodeMirror-scrollbar-filler\");\r\n    d.scrollbarFiller.setAttribute(\"cm-not-content\", \"true\");\r\n    // Covers bottom of gutter when coverGutterNextToScrollbar is on\r\n    // and h scrollbar is present.\r\n    d.gutterFiller = elt(\"div\", null, \"CodeMirror-gutter-filler\");\r\n    d.gutterFiller.setAttribute(\"cm-not-content\", \"true\");\r\n    // Will contain the actual code, positioned to cover the viewport.\r\n    d.lineDiv = elt(\"div\", null, \"CodeMirror-code\");\r\n    // Elements are added to these to represent selection and cursors.\r\n    d.selectionDiv = elt(\"div\", null, null, \"position: relative; z-index: 1\");\r\n    d.cursorDiv = elt(\"div\", null, \"CodeMirror-cursors\");\r\n    // A visibility: hidden element used to find the size of things.\r\n    d.measure = elt(\"div\", null, \"CodeMirror-measure\");\r\n    // When lines outside of the viewport are measured, they are drawn in this.\r\n    d.lineMeasure = elt(\"div\", null, \"CodeMirror-measure\");\r\n    // Wraps everything that needs to exist inside the vertically-padded coordinate system\r\n    d.lineSpace = elt(\"div\", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],\r\n                      null, \"position: relative; outline: none\");\r\n    // Moved around its parent to cover visible view.\r\n    d.mover = elt(\"div\", [elt(\"div\", [d.lineSpace], \"CodeMirror-lines\")], null, \"position: relative\");\r\n    // Set to the height of the document, allowing scrolling.\r\n    d.sizer = elt(\"div\", [d.mover], \"CodeMirror-sizer\");\r\n    d.sizerWidth = null;\r\n    // Behavior of elts with overflow: auto and padding is\r\n    // inconsistent across browsers. This is used to ensure the\r\n    // scrollable area is big enough.\r\n    d.heightForcer = elt(\"div\", null, null, \"position: absolute; height: \" + scrollerGap + \"px; width: 1px;\");\r\n    // Will contain the gutters, if any.\r\n    d.gutters = elt(\"div\", null, \"CodeMirror-gutters\");\r\n    d.lineGutter = null;\r\n    // Actual scrollable element.\r\n    d.scroller = elt(\"div\", [d.sizer, d.heightForcer, d.gutters], \"CodeMirror-scroll\");\r\n    d.scroller.setAttribute(\"tabIndex\", \"-1\");\r\n    // The element in which the editor lives.\r\n    d.wrapper = elt(\"div\", [d.scrollbarFiller, d.gutterFiller, d.scroller], \"CodeMirror\");\r\n\r\n    // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)\r\n    if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\r\n    if (!webkit && !(gecko && mobile)) d.scroller.draggable = true;\r\n\r\n    if (place) {\r\n      if (place.appendChild) place.appendChild(d.wrapper);\r\n      else place(d.wrapper);\r\n    }\r\n\r\n    // Current rendered range (may be bigger than the view window).\r\n    d.viewFrom = d.viewTo = doc.first;\r\n    d.reportedViewFrom = d.reportedViewTo = doc.first;\r\n    // Information about the rendered lines.\r\n    d.view = [];\r\n    d.renderedView = null;\r\n    // Holds info about a single rendered line when it was rendered\r\n    // for measurement, while not in view.\r\n    d.externalMeasured = null;\r\n    // Empty space (in pixels) above the view\r\n    d.viewOffset = 0;\r\n    d.lastWrapHeight = d.lastWrapWidth = 0;\r\n    d.updateLineNumbers = null;\r\n\r\n    d.nativeBarWidth = d.barHeight = d.barWidth = 0;\r\n    d.scrollbarsClipped = false;\r\n\r\n    // Used to only resize the line number gutter when necessary (when\r\n    // the amount of lines crosses a boundary that makes its width change)\r\n    d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\r\n    // Set to true when a non-horizontal-scrolling line widget is\r\n    // added. As an optimization, line widget aligning is skipped when\r\n    // this is false.\r\n    d.alignWidgets = false;\r\n\r\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\r\n\r\n    // Tracks the maximum line length so that the horizontal scrollbar\r\n    // can be kept static when scrolling.\r\n    d.maxLine = null;\r\n    d.maxLineLength = 0;\r\n    d.maxLineChanged = false;\r\n\r\n    // Used for measuring wheel scrolling granularity\r\n    d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\r\n\r\n    // True when shift is held down.\r\n    d.shift = false;\r\n\r\n    // Used to track whether anything happened since the context menu\r\n    // was opened.\r\n    d.selForContextMenu = null;\r\n\r\n    d.activeTouch = null;\r\n\r\n    input.init(d);\r\n  }\r\n\r\n  // STATE UPDATES\r\n\r\n  // Used to get the editor into a consistent state again when options change.\r\n\r\n  function loadMode(cm) {\r\n    cm.doc.mode = CodeMirror.getMode(cm.options, cm.doc.modeOption);\r\n    resetModeState(cm);\r\n  }\r\n\r\n  function resetModeState(cm) {\r\n    cm.doc.iter(function(line) {\r\n      if (line.stateAfter) line.stateAfter = null;\r\n      if (line.styles) line.styles = null;\r\n    });\r\n    cm.doc.frontier = cm.doc.first;\r\n    startWorker(cm, 100);\r\n    cm.state.modeGen++;\r\n    if (cm.curOp) regChange(cm);\r\n  }\r\n\r\n  function wrappingChanged(cm) {\r\n    if (cm.options.lineWrapping) {\r\n      addClass(cm.display.wrapper, \"CodeMirror-wrap\");\r\n      cm.display.sizer.style.minWidth = \"\";\r\n      cm.display.sizerWidth = null;\r\n    } else {\r\n      rmClass(cm.display.wrapper, \"CodeMirror-wrap\");\r\n      findMaxLine(cm);\r\n    }\r\n    estimateLineHeights(cm);\r\n    regChange(cm);\r\n    clearCaches(cm);\r\n    setTimeout(function(){updateScrollbars(cm);}, 100);\r\n  }\r\n\r\n  // Returns a function that estimates the height of a line, to use as\r\n  // first approximation until the line becomes visible (and is thus\r\n  // properly measurable).\r\n  function estimateHeight(cm) {\r\n    var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\r\n    var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\r\n    return function(line) {\r\n      if (lineIsHidden(cm.doc, line)) return 0;\r\n\r\n      var widgetsHeight = 0;\r\n      if (line.widgets) for (var i = 0; i < line.widgets.length; i++) {\r\n        if (line.widgets[i].height) widgetsHeight += line.widgets[i].height;\r\n      }\r\n\r\n      if (wrapping)\r\n        return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th;\r\n      else\r\n        return widgetsHeight + th;\r\n    };\r\n  }\r\n\r\n  function estimateLineHeights(cm) {\r\n    var doc = cm.doc, est = estimateHeight(cm);\r\n    doc.iter(function(line) {\r\n      var estHeight = est(line);\r\n      if (estHeight != line.height) updateLineHeight(line, estHeight);\r\n    });\r\n  }\r\n\r\n  function themeChanged(cm) {\r\n    cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, \"\") +\r\n      cm.options.theme.replace(/(^|\\s)\\s*/g, \" cm-s-\");\r\n    clearCaches(cm);\r\n  }\r\n\r\n  function guttersChanged(cm) {\r\n    updateGutters(cm);\r\n    regChange(cm);\r\n    setTimeout(function(){alignHorizontally(cm);}, 20);\r\n  }\r\n\r\n  // Rebuild the gutter elements, ensure the margin to the left of the\r\n  // code matches their width.\r\n  function updateGutters(cm) {\r\n    var gutters = cm.display.gutters, specs = cm.options.gutters;\r\n    removeChildren(gutters);\r\n    for (var i = 0; i < specs.length; ++i) {\r\n      var gutterClass = specs[i];\r\n      var gElt = gutters.appendChild(elt(\"div\", null, \"CodeMirror-gutter \" + gutterClass));\r\n      if (gutterClass == \"CodeMirror-linenumbers\") {\r\n        cm.display.lineGutter = gElt;\r\n        gElt.style.width = (cm.display.lineNumWidth || 1) + \"px\";\r\n      }\r\n    }\r\n    gutters.style.display = i ? \"\" : \"none\";\r\n    updateGutterSpace(cm);\r\n  }\r\n\r\n  function updateGutterSpace(cm) {\r\n    var width = cm.display.gutters.offsetWidth;\r\n    cm.display.sizer.style.marginLeft = width + \"px\";\r\n  }\r\n\r\n  // Compute the character length of a line, taking into account\r\n  // collapsed ranges (see markText) that might hide parts, and join\r\n  // other lines onto it.\r\n  function lineLength(line) {\r\n    if (line.height == 0) return 0;\r\n    var len = line.text.length, merged, cur = line;\r\n    while (merged = collapsedSpanAtStart(cur)) {\r\n      var found = merged.find(0, true);\r\n      cur = found.from.line;\r\n      len += found.from.ch - found.to.ch;\r\n    }\r\n    cur = line;\r\n    while (merged = collapsedSpanAtEnd(cur)) {\r\n      var found = merged.find(0, true);\r\n      len -= cur.text.length - found.from.ch;\r\n      cur = found.to.line;\r\n      len += cur.text.length - found.to.ch;\r\n    }\r\n    return len;\r\n  }\r\n\r\n  // Find the longest line in the document.\r\n  function findMaxLine(cm) {\r\n    var d = cm.display, doc = cm.doc;\r\n    d.maxLine = getLine(doc, doc.first);\r\n    d.maxLineLength = lineLength(d.maxLine);\r\n    d.maxLineChanged = true;\r\n    doc.iter(function(line) {\r\n      var len = lineLength(line);\r\n      if (len > d.maxLineLength) {\r\n        d.maxLineLength = len;\r\n        d.maxLine = line;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Make sure the gutters options contains the element\r\n  // \"CodeMirror-linenumbers\" when the lineNumbers option is true.\r\n  function setGuttersForLineNumbers(options) {\r\n    var found = indexOf(options.gutters, \"CodeMirror-linenumbers\");\r\n    if (found == -1 && options.lineNumbers) {\r\n      options.gutters = options.gutters.concat([\"CodeMirror-linenumbers\"]);\r\n    } else if (found > -1 && !options.lineNumbers) {\r\n      options.gutters = options.gutters.slice(0);\r\n      options.gutters.splice(found, 1);\r\n    }\r\n  }\r\n\r\n  // SCROLLBARS\r\n\r\n  // Prepare DOM reads needed to update the scrollbars. Done in one\r\n  // shot to minimize update/measure roundtrips.\r\n  function measureForScrollbars(cm) {\r\n    var d = cm.display, gutterW = d.gutters.offsetWidth;\r\n    var docH = Math.round(cm.doc.height + paddingVert(cm.display));\r\n    return {\r\n      clientHeight: d.scroller.clientHeight,\r\n      viewHeight: d.wrapper.clientHeight,\r\n      scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,\r\n      viewWidth: d.wrapper.clientWidth,\r\n      barLeft: cm.options.fixedGutter ? gutterW : 0,\r\n      docHeight: docH,\r\n      scrollHeight: docH + scrollGap(cm) + d.barHeight,\r\n      nativeBarWidth: d.nativeBarWidth,\r\n      gutterWidth: gutterW\r\n    };\r\n  }\r\n\r\n  function NativeScrollbars(place, scroll, cm) {\r\n    this.cm = cm;\r\n    var vert = this.vert = elt(\"div\", [elt(\"div\", null, null, \"min-width: 1px\")], \"CodeMirror-vscrollbar\");\r\n    var horiz = this.horiz = elt(\"div\", [elt(\"div\", null, null, \"height: 100%; min-height: 1px\")], \"CodeMirror-hscrollbar\");\r\n    place(vert); place(horiz);\r\n\r\n    on(vert, \"scroll\", function() {\r\n      if (vert.clientHeight) scroll(vert.scrollTop, \"vertical\");\r\n    });\r\n    on(horiz, \"scroll\", function() {\r\n      if (horiz.clientWidth) scroll(horiz.scrollLeft, \"horizontal\");\r\n    });\r\n\r\n    this.checkedZeroWidth = false;\r\n    // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\r\n    if (ie && ie_version < 8) this.horiz.style.minHeight = this.vert.style.minWidth = \"18px\";\r\n  }\r\n\r\n  NativeScrollbars.prototype = copyObj({\r\n    update: function(measure) {\r\n      var needsH = measure.scrollWidth > measure.clientWidth + 1;\r\n      var needsV = measure.scrollHeight > measure.clientHeight + 1;\r\n      var sWidth = measure.nativeBarWidth;\r\n\r\n      if (needsV) {\r\n        this.vert.style.display = \"block\";\r\n        this.vert.style.bottom = needsH ? sWidth + \"px\" : \"0\";\r\n        var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);\r\n        // A bug in IE8 can cause this value to be negative, so guard it.\r\n        this.vert.firstChild.style.height =\r\n          Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + \"px\";\r\n      } else {\r\n        this.vert.style.display = \"\";\r\n        this.vert.firstChild.style.height = \"0\";\r\n      }\r\n\r\n      if (needsH) {\r\n        this.horiz.style.display = \"block\";\r\n        this.horiz.style.right = needsV ? sWidth + \"px\" : \"0\";\r\n        this.horiz.style.left = measure.barLeft + \"px\";\r\n        var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);\r\n        this.horiz.firstChild.style.width =\r\n          (measure.scrollWidth - measure.clientWidth + totalWidth) + \"px\";\r\n      } else {\r\n        this.horiz.style.display = \"\";\r\n        this.horiz.firstChild.style.width = \"0\";\r\n      }\r\n\r\n      if (!this.checkedZeroWidth && measure.clientHeight > 0) {\r\n        if (sWidth == 0) this.zeroWidthHack();\r\n        this.checkedZeroWidth = true;\r\n      }\r\n\r\n      return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0};\r\n    },\r\n    setScrollLeft: function(pos) {\r\n      if (this.horiz.scrollLeft != pos) this.horiz.scrollLeft = pos;\r\n      if (this.disableHoriz) this.enableZeroWidthBar(this.horiz, this.disableHoriz);\r\n    },\r\n    setScrollTop: function(pos) {\r\n      if (this.vert.scrollTop != pos) this.vert.scrollTop = pos;\r\n      if (this.disableVert) this.enableZeroWidthBar(this.vert, this.disableVert);\r\n    },\r\n    zeroWidthHack: function() {\r\n      var w = mac && !mac_geMountainLion ? \"12px\" : \"18px\";\r\n      this.horiz.style.height = this.vert.style.width = w;\r\n      this.horiz.style.pointerEvents = this.vert.style.pointerEvents = \"none\";\r\n      this.disableHoriz = new Delayed;\r\n      this.disableVert = new Delayed;\r\n    },\r\n    enableZeroWidthBar: function(bar, delay) {\r\n      bar.style.pointerEvents = \"auto\";\r\n      function maybeDisable() {\r\n        // To find out whether the scrollbar is still visible, we\r\n        // check whether the element under the pixel in the bottom\r\n        // left corner of the scrollbar box is the scrollbar box\r\n        // itself (when the bar is still visible) or its filler child\r\n        // (when the bar is hidden). If it is still visible, we keep\r\n        // it enabled, if it's hidden, we disable pointer events.\r\n        var box = bar.getBoundingClientRect();\r\n        var elt = document.elementFromPoint(box.left + 1, box.bottom - 1);\r\n        if (elt != bar) bar.style.pointerEvents = \"none\";\r\n        else delay.set(1000, maybeDisable);\r\n      }\r\n      delay.set(1000, maybeDisable);\r\n    },\r\n    clear: function() {\r\n      var parent = this.horiz.parentNode;\r\n      parent.removeChild(this.horiz);\r\n      parent.removeChild(this.vert);\r\n    }\r\n  }, NativeScrollbars.prototype);\r\n\r\n  function NullScrollbars() {}\r\n\r\n  NullScrollbars.prototype = copyObj({\r\n    update: function() { return {bottom: 0, right: 0}; },\r\n    setScrollLeft: function() {},\r\n    setScrollTop: function() {},\r\n    clear: function() {}\r\n  }, NullScrollbars.prototype);\r\n\r\n  CodeMirror.scrollbarModel = {\"native\": NativeScrollbars, \"null\": NullScrollbars};\r\n\r\n  function initScrollbars(cm) {\r\n    if (cm.display.scrollbars) {\r\n      cm.display.scrollbars.clear();\r\n      if (cm.display.scrollbars.addClass)\r\n        rmClass(cm.display.wrapper, cm.display.scrollbars.addClass);\r\n    }\r\n\r\n    cm.display.scrollbars = new CodeMirror.scrollbarModel[cm.options.scrollbarStyle](function(node) {\r\n      cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);\r\n      // Prevent clicks in the scrollbars from killing focus\r\n      on(node, \"mousedown\", function() {\r\n        if (cm.state.focused) setTimeout(function() { cm.display.input.focus(); }, 0);\r\n      });\r\n      node.setAttribute(\"cm-not-content\", \"true\");\r\n    }, function(pos, axis) {\r\n      if (axis == \"horizontal\") setScrollLeft(cm, pos);\r\n      else setScrollTop(cm, pos);\r\n    }, cm);\r\n    if (cm.display.scrollbars.addClass)\r\n      addClass(cm.display.wrapper, cm.display.scrollbars.addClass);\r\n  }\r\n\r\n  function updateScrollbars(cm, measure) {\r\n    if (!measure) measure = measureForScrollbars(cm);\r\n    var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;\r\n    updateScrollbarsInner(cm, measure);\r\n    for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {\r\n      if (startWidth != cm.display.barWidth && cm.options.lineWrapping)\r\n        updateHeightsInViewport(cm);\r\n      updateScrollbarsInner(cm, measureForScrollbars(cm));\r\n      startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;\r\n    }\r\n  }\r\n\r\n  // Re-synchronize the fake scrollbars with the actual size of the\r\n  // content.\r\n  function updateScrollbarsInner(cm, measure) {\r\n    var d = cm.display;\r\n    var sizes = d.scrollbars.update(measure);\r\n\r\n    d.sizer.style.paddingRight = (d.barWidth = sizes.right) + \"px\";\r\n    d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + \"px\";\r\n    d.heightForcer.style.borderBottom = sizes.bottom + \"px solid transparent\"\r\n\r\n    if (sizes.right && sizes.bottom) {\r\n      d.scrollbarFiller.style.display = \"block\";\r\n      d.scrollbarFiller.style.height = sizes.bottom + \"px\";\r\n      d.scrollbarFiller.style.width = sizes.right + \"px\";\r\n    } else d.scrollbarFiller.style.display = \"\";\r\n    if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\r\n      d.gutterFiller.style.display = \"block\";\r\n      d.gutterFiller.style.height = sizes.bottom + \"px\";\r\n      d.gutterFiller.style.width = measure.gutterWidth + \"px\";\r\n    } else d.gutterFiller.style.display = \"\";\r\n  }\r\n\r\n  // Compute the lines that are visible in a given viewport (defaults\r\n  // the the current scroll position). viewport may contain top,\r\n  // height, and ensure (see op.scrollToPos) properties.\r\n  function visibleLines(display, doc, viewport) {\r\n    var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;\r\n    top = Math.floor(top - paddingTop(display));\r\n    var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;\r\n\r\n    var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);\r\n    // Ensure is a {from: {line, ch}, to: {line, ch}} object, and\r\n    // forces those lines into the viewport (if possible).\r\n    if (viewport && viewport.ensure) {\r\n      var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;\r\n      if (ensureFrom < from) {\r\n        from = ensureFrom;\r\n        to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);\r\n      } else if (Math.min(ensureTo, doc.lastLine()) >= to) {\r\n        from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);\r\n        to = ensureTo;\r\n      }\r\n    }\r\n    return {from: from, to: Math.max(to, from + 1)};\r\n  }\r\n\r\n  // LINE NUMBERS\r\n\r\n  // Re-align line numbers and gutter marks to compensate for\r\n  // horizontal scrolling.\r\n  function alignHorizontally(cm) {\r\n    var display = cm.display, view = display.view;\r\n    if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) return;\r\n    var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\r\n    var gutterW = display.gutters.offsetWidth, left = comp + \"px\";\r\n    for (var i = 0; i < view.length; i++) if (!view[i].hidden) {\r\n      if (cm.options.fixedGutter) {\r\n        if (view[i].gutter)\r\n          view[i].gutter.style.left = left;\r\n        if (view[i].gutterBackground)\r\n          view[i].gutterBackground.style.left = left;\r\n      }\r\n      var align = view[i].alignable;\r\n      if (align) for (var j = 0; j < align.length; j++)\r\n        align[j].style.left = left;\r\n    }\r\n    if (cm.options.fixedGutter)\r\n      display.gutters.style.left = (comp + gutterW) + \"px\";\r\n  }\r\n\r\n  // Used to ensure that the line number gutter is still the right\r\n  // size for the current document size. Returns true when an update\r\n  // is needed.\r\n  function maybeUpdateLineNumberWidth(cm) {\r\n    if (!cm.options.lineNumbers) return false;\r\n    var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\r\n    if (last.length != display.lineNumChars) {\r\n      var test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)],\r\n                                                 \"CodeMirror-linenumber CodeMirror-gutter-elt\"));\r\n      var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\r\n      display.lineGutter.style.width = \"\";\r\n      display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;\r\n      display.lineNumWidth = display.lineNumInnerWidth + padding;\r\n      display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\r\n      display.lineGutter.style.width = display.lineNumWidth + \"px\";\r\n      updateGutterSpace(cm);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function lineNumberFor(options, i) {\r\n    return String(options.lineNumberFormatter(i + options.firstLineNumber));\r\n  }\r\n\r\n  // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,\r\n  // but using getBoundingClientRect to get a sub-pixel-accurate\r\n  // result.\r\n  function compensateForHScroll(display) {\r\n    return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left;\r\n  }\r\n\r\n  // DISPLAY DRAWING\r\n\r\n  function DisplayUpdate(cm, viewport, force) {\r\n    var display = cm.display;\r\n\r\n    this.viewport = viewport;\r\n    // Store some values that we'll need later (but don't want to force a relayout for)\r\n    this.visible = visibleLines(display, cm.doc, viewport);\r\n    this.editorIsHidden = !display.wrapper.offsetWidth;\r\n    this.wrapperHeight = display.wrapper.clientHeight;\r\n    this.wrapperWidth = display.wrapper.clientWidth;\r\n    this.oldDisplayWidth = displayWidth(cm);\r\n    this.force = force;\r\n    this.dims = getDimensions(cm);\r\n    this.events = [];\r\n  }\r\n\r\n  DisplayUpdate.prototype.signal = function(emitter, type) {\r\n    if (hasHandler(emitter, type))\r\n      this.events.push(arguments);\r\n  };\r\n  DisplayUpdate.prototype.finish = function() {\r\n    for (var i = 0; i < this.events.length; i++)\r\n      signal.apply(null, this.events[i]);\r\n  };\r\n\r\n  function maybeClipScrollbars(cm) {\r\n    var display = cm.display;\r\n    if (!display.scrollbarsClipped && display.scroller.offsetWidth) {\r\n      display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;\r\n      display.heightForcer.style.height = scrollGap(cm) + \"px\";\r\n      display.sizer.style.marginBottom = -display.nativeBarWidth + \"px\";\r\n      display.sizer.style.borderRightWidth = scrollGap(cm) + \"px\";\r\n      display.scrollbarsClipped = true;\r\n    }\r\n  }\r\n\r\n  // Does the actual updating of the line display. Bails out\r\n  // (returning false) when there is nothing to be done and forced is\r\n  // false.\r\n  function updateDisplayIfNeeded(cm, update) {\r\n    var display = cm.display, doc = cm.doc;\r\n\r\n    if (update.editorIsHidden) {\r\n      resetView(cm);\r\n      return false;\r\n    }\r\n\r\n    // Bail out if the visible area is already rendered and nothing changed.\r\n    if (!update.force &&\r\n        update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&\r\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&\r\n        display.renderedView == display.view && countDirtyView(cm) == 0)\r\n      return false;\r\n\r\n    if (maybeUpdateLineNumberWidth(cm)) {\r\n      resetView(cm);\r\n      update.dims = getDimensions(cm);\r\n    }\r\n\r\n    // Compute a suitable new viewport (from & to)\r\n    var end = doc.first + doc.size;\r\n    var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\r\n    var to = Math.min(end, update.visible.to + cm.options.viewportMargin);\r\n    if (display.viewFrom < from && from - display.viewFrom < 20) from = Math.max(doc.first, display.viewFrom);\r\n    if (display.viewTo > to && display.viewTo - to < 20) to = Math.min(end, display.viewTo);\r\n    if (sawCollapsedSpans) {\r\n      from = visualLineNo(cm.doc, from);\r\n      to = visualLineEndNo(cm.doc, to);\r\n    }\r\n\r\n    var different = from != display.viewFrom || to != display.viewTo ||\r\n      display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\r\n    adjustView(cm, from, to);\r\n\r\n    display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));\r\n    // Position the mover div to align with the current scroll position\r\n    cm.display.mover.style.top = display.viewOffset + \"px\";\r\n\r\n    var toUpdate = countDirtyView(cm);\r\n    if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&\r\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\r\n      return false;\r\n\r\n    // For big changes, we hide the enclosing element during the\r\n    // update, since that speeds up the operations on most browsers.\r\n    var focused = activeElt();\r\n    if (toUpdate > 4) display.lineDiv.style.display = \"none\";\r\n    patchDisplay(cm, display.updateLineNumbers, update.dims);\r\n    if (toUpdate > 4) display.lineDiv.style.display = \"\";\r\n    display.renderedView = display.view;\r\n    // There might have been a widget with a focused element that got\r\n    // hidden or updated, if so re-focus it.\r\n    if (focused && activeElt() != focused && focused.offsetHeight) focused.focus();\r\n\r\n    // Prevent selection and cursors from interfering with the scroll\r\n    // width and height.\r\n    removeChildren(display.cursorDiv);\r\n    removeChildren(display.selectionDiv);\r\n    display.gutters.style.height = display.sizer.style.minHeight = 0;\r\n\r\n    if (different) {\r\n      display.lastWrapHeight = update.wrapperHeight;\r\n      display.lastWrapWidth = update.wrapperWidth;\r\n      startWorker(cm, 400);\r\n    }\r\n\r\n    display.updateLineNumbers = null;\r\n\r\n    return true;\r\n  }\r\n\r\n  function postUpdateDisplay(cm, update) {\r\n    var viewport = update.viewport;\r\n\r\n    for (var first = true;; first = false) {\r\n      if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {\r\n        // Clip forced viewport to actual scrollable area.\r\n        if (viewport && viewport.top != null)\r\n          viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)};\r\n        // Updated line heights might result in the drawn area not\r\n        // actually covering the viewport. Keep looping until it does.\r\n        update.visible = visibleLines(cm.display, cm.doc, viewport);\r\n        if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\r\n          break;\r\n      }\r\n      if (!updateDisplayIfNeeded(cm, update)) break;\r\n      updateHeightsInViewport(cm);\r\n      var barMeasure = measureForScrollbars(cm);\r\n      updateSelection(cm);\r\n      updateScrollbars(cm, barMeasure);\r\n      setDocumentHeight(cm, barMeasure);\r\n    }\r\n\r\n    update.signal(cm, \"update\", cm);\r\n    if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {\r\n      update.signal(cm, \"viewportChange\", cm, cm.display.viewFrom, cm.display.viewTo);\r\n      cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;\r\n    }\r\n  }\r\n\r\n  function updateDisplaySimple(cm, viewport) {\r\n    var update = new DisplayUpdate(cm, viewport);\r\n    if (updateDisplayIfNeeded(cm, update)) {\r\n      updateHeightsInViewport(cm);\r\n      postUpdateDisplay(cm, update);\r\n      var barMeasure = measureForScrollbars(cm);\r\n      updateSelection(cm);\r\n      updateScrollbars(cm, barMeasure);\r\n      setDocumentHeight(cm, barMeasure);\r\n      update.finish();\r\n    }\r\n  }\r\n\r\n  function setDocumentHeight(cm, measure) {\r\n    cm.display.sizer.style.minHeight = measure.docHeight + \"px\";\r\n    cm.display.heightForcer.style.top = measure.docHeight + \"px\";\r\n    cm.display.gutters.style.height = (measure.docHeight + cm.display.barHeight + scrollGap(cm)) + \"px\";\r\n  }\r\n\r\n  // Read the actual heights of the rendered lines, and update their\r\n  // stored heights to match.\r\n  function updateHeightsInViewport(cm) {\r\n    var display = cm.display;\r\n    var prevBottom = display.lineDiv.offsetTop;\r\n    for (var i = 0; i < display.view.length; i++) {\r\n      var cur = display.view[i], height;\r\n      if (cur.hidden) continue;\r\n      if (ie && ie_version < 8) {\r\n        var bot = cur.node.offsetTop + cur.node.offsetHeight;\r\n        height = bot - prevBottom;\r\n        prevBottom = bot;\r\n      } else {\r\n        var box = cur.node.getBoundingClientRect();\r\n        height = box.bottom - box.top;\r\n      }\r\n      var diff = cur.line.height - height;\r\n      if (height < 2) height = textHeight(display);\r\n      if (diff > .001 || diff < -.001) {\r\n        updateLineHeight(cur.line, height);\r\n        updateWidgetHeight(cur.line);\r\n        if (cur.rest) for (var j = 0; j < cur.rest.length; j++)\r\n          updateWidgetHeight(cur.rest[j]);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Read and store the height of line widgets associated with the\r\n  // given line.\r\n  function updateWidgetHeight(line) {\r\n    if (line.widgets) for (var i = 0; i < line.widgets.length; ++i)\r\n      line.widgets[i].height = line.widgets[i].node.parentNode.offsetHeight;\r\n  }\r\n\r\n  // Do a bulk-read of the DOM positions and sizes needed to draw the\r\n  // view, so that we don't interleave reading and writing to the DOM.\r\n  function getDimensions(cm) {\r\n    var d = cm.display, left = {}, width = {};\r\n    var gutterLeft = d.gutters.clientLeft;\r\n    for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\r\n      left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;\r\n      width[cm.options.gutters[i]] = n.clientWidth;\r\n    }\r\n    return {fixedPos: compensateForHScroll(d),\r\n            gutterTotalWidth: d.gutters.offsetWidth,\r\n            gutterLeft: left,\r\n            gutterWidth: width,\r\n            wrapperWidth: d.wrapper.clientWidth};\r\n  }\r\n\r\n  // Sync the actual display DOM structure with display.view, removing\r\n  // nodes for lines that are no longer in view, and creating the ones\r\n  // that are not there yet, and updating the ones that are out of\r\n  // date.\r\n  function patchDisplay(cm, updateNumbersFrom, dims) {\r\n    var display = cm.display, lineNumbers = cm.options.lineNumbers;\r\n    var container = display.lineDiv, cur = container.firstChild;\r\n\r\n    function rm(node) {\r\n      var next = node.nextSibling;\r\n      // Works around a throw-scroll bug in OS X Webkit\r\n      if (webkit && mac && cm.display.currentWheelTarget == node)\r\n        node.style.display = \"none\";\r\n      else\r\n        node.parentNode.removeChild(node);\r\n      return next;\r\n    }\r\n\r\n    var view = display.view, lineN = display.viewFrom;\r\n    // Loop over the elements in the view, syncing cur (the DOM nodes\r\n    // in display.lineDiv) with the view as we go.\r\n    for (var i = 0; i < view.length; i++) {\r\n      var lineView = view[i];\r\n      if (lineView.hidden) {\r\n      } else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet\r\n        var node = buildLineElement(cm, lineView, lineN, dims);\r\n        container.insertBefore(node, cur);\r\n      } else { // Already drawn\r\n        while (cur != lineView.node) cur = rm(cur);\r\n        var updateNumber = lineNumbers && updateNumbersFrom != null &&\r\n          updateNumbersFrom <= lineN && lineView.lineNumber;\r\n        if (lineView.changes) {\r\n          if (indexOf(lineView.changes, \"gutter\") > -1) updateNumber = false;\r\n          updateLineForChanges(cm, lineView, lineN, dims);\r\n        }\r\n        if (updateNumber) {\r\n          removeChildren(lineView.lineNumber);\r\n          lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));\r\n        }\r\n        cur = lineView.node.nextSibling;\r\n      }\r\n      lineN += lineView.size;\r\n    }\r\n    while (cur) cur = rm(cur);\r\n  }\r\n\r\n  // When an aspect of a line changes, a string is added to\r\n  // lineView.changes. This updates the relevant part of the line's\r\n  // DOM structure.\r\n  function updateLineForChanges(cm, lineView, lineN, dims) {\r\n    for (var j = 0; j < lineView.changes.length; j++) {\r\n      var type = lineView.changes[j];\r\n      if (type == \"text\") updateLineText(cm, lineView);\r\n      else if (type == \"gutter\") updateLineGutter(cm, lineView, lineN, dims);\r\n      else if (type == \"class\") updateLineClasses(lineView);\r\n      else if (type == \"widget\") updateLineWidgets(cm, lineView, dims);\r\n    }\r\n    lineView.changes = null;\r\n  }\r\n\r\n  // Lines with gutter elements, widgets or a background class need to\r\n  // be wrapped, and have the extra elements added to the wrapper div\r\n  function ensureLineWrapped(lineView) {\r\n    if (lineView.node == lineView.text) {\r\n      lineView.node = elt(\"div\", null, null, \"position: relative\");\r\n      if (lineView.text.parentNode)\r\n        lineView.text.parentNode.replaceChild(lineView.node, lineView.text);\r\n      lineView.node.appendChild(lineView.text);\r\n      if (ie && ie_version < 8) lineView.node.style.zIndex = 2;\r\n    }\r\n    return lineView.node;\r\n  }\r\n\r\n  function updateLineBackground(lineView) {\r\n    var cls = lineView.bgClass ? lineView.bgClass + \" \" + (lineView.line.bgClass || \"\") : lineView.line.bgClass;\r\n    if (cls) cls += \" CodeMirror-linebackground\";\r\n    if (lineView.background) {\r\n      if (cls) lineView.background.className = cls;\r\n      else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }\r\n    } else if (cls) {\r\n      var wrap = ensureLineWrapped(lineView);\r\n      lineView.background = wrap.insertBefore(elt(\"div\", null, cls), wrap.firstChild);\r\n    }\r\n  }\r\n\r\n  // Wrapper around buildLineContent which will reuse the structure\r\n  // in display.externalMeasured when possible.\r\n  function getLineContent(cm, lineView) {\r\n    var ext = cm.display.externalMeasured;\r\n    if (ext && ext.line == lineView.line) {\r\n      cm.display.externalMeasured = null;\r\n      lineView.measure = ext.measure;\r\n      return ext.built;\r\n    }\r\n    return buildLineContent(cm, lineView);\r\n  }\r\n\r\n  // Redraw the line's text. Interacts with the background and text\r\n  // classes because the mode may output tokens that influence these\r\n  // classes.\r\n  function updateLineText(cm, lineView) {\r\n    var cls = lineView.text.className;\r\n    var built = getLineContent(cm, lineView);\r\n    if (lineView.text == lineView.node) lineView.node = built.pre;\r\n    lineView.text.parentNode.replaceChild(built.pre, lineView.text);\r\n    lineView.text = built.pre;\r\n    if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {\r\n      lineView.bgClass = built.bgClass;\r\n      lineView.textClass = built.textClass;\r\n      updateLineClasses(lineView);\r\n    } else if (cls) {\r\n      lineView.text.className = cls;\r\n    }\r\n  }\r\n\r\n  function updateLineClasses(lineView) {\r\n    updateLineBackground(lineView);\r\n    if (lineView.line.wrapClass)\r\n      ensureLineWrapped(lineView).className = lineView.line.wrapClass;\r\n    else if (lineView.node != lineView.text)\r\n      lineView.node.className = \"\";\r\n    var textClass = lineView.textClass ? lineView.textClass + \" \" + (lineView.line.textClass || \"\") : lineView.line.textClass;\r\n    lineView.text.className = textClass || \"\";\r\n  }\r\n\r\n  function updateLineGutter(cm, lineView, lineN, dims) {\r\n    if (lineView.gutter) {\r\n      lineView.node.removeChild(lineView.gutter);\r\n      lineView.gutter = null;\r\n    }\r\n    if (lineView.gutterBackground) {\r\n      lineView.node.removeChild(lineView.gutterBackground);\r\n      lineView.gutterBackground = null;\r\n    }\r\n    if (lineView.line.gutterClass) {\r\n      var wrap = ensureLineWrapped(lineView);\r\n      lineView.gutterBackground = elt(\"div\", null, \"CodeMirror-gutter-background \" + lineView.line.gutterClass,\r\n                                      \"left: \" + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) +\r\n                                      \"px; width: \" + dims.gutterTotalWidth + \"px\");\r\n      wrap.insertBefore(lineView.gutterBackground, lineView.text);\r\n    }\r\n    var markers = lineView.line.gutterMarkers;\r\n    if (cm.options.lineNumbers || markers) {\r\n      var wrap = ensureLineWrapped(lineView);\r\n      var gutterWrap = lineView.gutter = elt(\"div\", null, \"CodeMirror-gutter-wrapper\", \"left: \" +\r\n                                             (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + \"px\");\r\n      cm.display.input.setUneditable(gutterWrap);\r\n      wrap.insertBefore(gutterWrap, lineView.text);\r\n      if (lineView.line.gutterClass)\r\n        gutterWrap.className += \" \" + lineView.line.gutterClass;\r\n      if (cm.options.lineNumbers && (!markers || !markers[\"CodeMirror-linenumbers\"]))\r\n        lineView.lineNumber = gutterWrap.appendChild(\r\n          elt(\"div\", lineNumberFor(cm.options, lineN),\r\n              \"CodeMirror-linenumber CodeMirror-gutter-elt\",\r\n              \"left: \" + dims.gutterLeft[\"CodeMirror-linenumbers\"] + \"px; width: \"\r\n              + cm.display.lineNumInnerWidth + \"px\"));\r\n      if (markers) for (var k = 0; k < cm.options.gutters.length; ++k) {\r\n        var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\r\n        if (found)\r\n          gutterWrap.appendChild(elt(\"div\", [found], \"CodeMirror-gutter-elt\", \"left: \" +\r\n                                     dims.gutterLeft[id] + \"px; width: \" + dims.gutterWidth[id] + \"px\"));\r\n      }\r\n    }\r\n  }\r\n\r\n  function updateLineWidgets(cm, lineView, dims) {\r\n    if (lineView.alignable) lineView.alignable = null;\r\n    for (var node = lineView.node.firstChild, next; node; node = next) {\r\n      var next = node.nextSibling;\r\n      if (node.className == \"CodeMirror-linewidget\")\r\n        lineView.node.removeChild(node);\r\n    }\r\n    insertLineWidgets(cm, lineView, dims);\r\n  }\r\n\r\n  // Build a line's DOM representation from scratch\r\n  function buildLineElement(cm, lineView, lineN, dims) {\r\n    var built = getLineContent(cm, lineView);\r\n    lineView.text = lineView.node = built.pre;\r\n    if (built.bgClass) lineView.bgClass = built.bgClass;\r\n    if (built.textClass) lineView.textClass = built.textClass;\r\n\r\n    updateLineClasses(lineView);\r\n    updateLineGutter(cm, lineView, lineN, dims);\r\n    insertLineWidgets(cm, lineView, dims);\r\n    return lineView.node;\r\n  }\r\n\r\n  // A lineView may contain multiple logical lines (when merged by\r\n  // collapsed spans). The widgets for all of them need to be drawn.\r\n  function insertLineWidgets(cm, lineView, dims) {\r\n    insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);\r\n    if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\r\n      insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false);\r\n  }\r\n\r\n  function insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {\r\n    if (!line.widgets) return;\r\n    var wrap = ensureLineWrapped(lineView);\r\n    for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\r\n      var widget = ws[i], node = elt(\"div\", [widget.node], \"CodeMirror-linewidget\");\r\n      if (!widget.handleMouseEvents) node.setAttribute(\"cm-ignore-events\", \"true\");\r\n      positionLineWidget(widget, node, lineView, dims);\r\n      cm.display.input.setUneditable(node);\r\n      if (allowAbove && widget.above)\r\n        wrap.insertBefore(node, lineView.gutter || lineView.text);\r\n      else\r\n        wrap.appendChild(node);\r\n      signalLater(widget, \"redraw\");\r\n    }\r\n  }\r\n\r\n  function positionLineWidget(widget, node, lineView, dims) {\r\n    if (widget.noHScroll) {\r\n      (lineView.alignable || (lineView.alignable = [])).push(node);\r\n      var width = dims.wrapperWidth;\r\n      node.style.left = dims.fixedPos + \"px\";\r\n      if (!widget.coverGutter) {\r\n        width -= dims.gutterTotalWidth;\r\n        node.style.paddingLeft = dims.gutterTotalWidth + \"px\";\r\n      }\r\n      node.style.width = width + \"px\";\r\n    }\r\n    if (widget.coverGutter) {\r\n      node.style.zIndex = 5;\r\n      node.style.position = \"relative\";\r\n      if (!widget.noHScroll) node.style.marginLeft = -dims.gutterTotalWidth + \"px\";\r\n    }\r\n  }\r\n\r\n  // POSITION OBJECT\r\n\r\n  // A Pos instance represents a position within the text.\r\n  var Pos = CodeMirror.Pos = function(line, ch) {\r\n    if (!(this instanceof Pos)) return new Pos(line, ch);\r\n    this.line = line; this.ch = ch;\r\n  };\r\n\r\n  // Compare two positions, return 0 if they are the same, a negative\r\n  // number when a is less, and a positive number otherwise.\r\n  var cmp = CodeMirror.cmpPos = function(a, b) { return a.line - b.line || a.ch - b.ch; };\r\n\r\n  function copyPos(x) {return Pos(x.line, x.ch);}\r\n  function maxPos(a, b) { return cmp(a, b) < 0 ? b : a; }\r\n  function minPos(a, b) { return cmp(a, b) < 0 ? a : b; }\r\n\r\n  // INPUT HANDLING\r\n\r\n  function ensureFocus(cm) {\r\n    if (!cm.state.focused) { cm.display.input.focus(); onFocus(cm); }\r\n  }\r\n\r\n  // This will be set to a {lineWise: bool, text: [string]} object, so\r\n  // that, when pasting, we know what kind of selections the copied\r\n  // text was made out of.\r\n  var lastCopied = null;\r\n\r\n  function applyTextInput(cm, inserted, deleted, sel, origin) {\r\n    var doc = cm.doc;\r\n    cm.display.shift = false;\r\n    if (!sel) sel = doc.sel;\r\n\r\n    var paste = cm.state.pasteIncoming || origin == \"paste\";\r\n    var textLines = doc.splitLines(inserted), multiPaste = null\r\n    // When pasing N lines into N selections, insert one line per selection\r\n    if (paste && sel.ranges.length > 1) {\r\n      if (lastCopied && lastCopied.text.join(\"\\n\") == inserted) {\r\n        if (sel.ranges.length % lastCopied.text.length == 0) {\r\n          multiPaste = [];\r\n          for (var i = 0; i < lastCopied.text.length; i++)\r\n            multiPaste.push(doc.splitLines(lastCopied.text[i]));\r\n        }\r\n      } else if (textLines.length == sel.ranges.length) {\r\n        multiPaste = map(textLines, function(l) { return [l]; });\r\n      }\r\n    }\r\n\r\n    // Normal behavior is to insert the new text into every selection\r\n    for (var i = sel.ranges.length - 1; i >= 0; i--) {\r\n      var range = sel.ranges[i];\r\n      var from = range.from(), to = range.to();\r\n      if (range.empty()) {\r\n        if (deleted && deleted > 0) // Handle deletion\r\n          from = Pos(from.line, from.ch - deleted);\r\n        else if (cm.state.overwrite && !paste) // Handle overwrite\r\n          to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length));\r\n        else if (lastCopied && lastCopied.lineWise && lastCopied.text.join(\"\\n\") == inserted)\r\n          from = to = Pos(from.line, 0)\r\n      }\r\n      var updateInput = cm.curOp.updateInput;\r\n      var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i % multiPaste.length] : textLines,\r\n                         origin: origin || (paste ? \"paste\" : cm.state.cutIncoming ? \"cut\" : \"+input\")};\r\n      makeChange(cm.doc, changeEvent);\r\n      signalLater(cm, \"inputRead\", cm, changeEvent);\r\n    }\r\n    if (inserted && !paste)\r\n      triggerElectric(cm, inserted);\r\n\r\n    ensureCursorVisible(cm);\r\n    cm.curOp.updateInput = updateInput;\r\n    cm.curOp.typing = true;\r\n    cm.state.pasteIncoming = cm.state.cutIncoming = false;\r\n  }\r\n\r\n  function handlePaste(e, cm) {\r\n    var pasted = e.clipboardData && e.clipboardData.getData(\"Text\");\r\n    if (pasted) {\r\n      e.preventDefault();\r\n      if (!cm.isReadOnly() && !cm.options.disableInput)\r\n        runInOp(cm, function() { applyTextInput(cm, pasted, 0, null, \"paste\"); });\r\n      return true;\r\n    }\r\n  }\r\n\r\n  function triggerElectric(cm, inserted) {\r\n    // When an 'electric' character is inserted, immediately trigger a reindent\r\n    if (!cm.options.electricChars || !cm.options.smartIndent) return;\r\n    var sel = cm.doc.sel;\r\n\r\n    for (var i = sel.ranges.length - 1; i >= 0; i--) {\r\n      var range = sel.ranges[i];\r\n      if (range.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range.head.line)) continue;\r\n      var mode = cm.getModeAt(range.head);\r\n      var indented = false;\r\n      if (mode.electricChars) {\r\n        for (var j = 0; j < mode.electricChars.length; j++)\r\n          if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {\r\n            indented = indentLine(cm, range.head.line, \"smart\");\r\n            break;\r\n          }\r\n      } else if (mode.electricInput) {\r\n        if (mode.electricInput.test(getLine(cm.doc, range.head.line).text.slice(0, range.head.ch)))\r\n          indented = indentLine(cm, range.head.line, \"smart\");\r\n      }\r\n      if (indented) signalLater(cm, \"electricInput\", cm, range.head.line);\r\n    }\r\n  }\r\n\r\n  function copyableRanges(cm) {\r\n    var text = [], ranges = [];\r\n    for (var i = 0; i < cm.doc.sel.ranges.length; i++) {\r\n      var line = cm.doc.sel.ranges[i].head.line;\r\n      var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};\r\n      ranges.push(lineRange);\r\n      text.push(cm.getRange(lineRange.anchor, lineRange.head));\r\n    }\r\n    return {text: text, ranges: ranges};\r\n  }\r\n\r\n  function disableBrowserMagic(field, spellcheck) {\r\n    field.setAttribute(\"autocorrect\", \"off\");\r\n    field.setAttribute(\"autocapitalize\", \"off\");\r\n    field.setAttribute(\"spellcheck\", !!spellcheck);\r\n  }\r\n\r\n  // TEXTAREA INPUT STYLE\r\n\r\n  function TextareaInput(cm) {\r\n    this.cm = cm;\r\n    // See input.poll and input.reset\r\n    this.prevInput = \"\";\r\n\r\n    // Flag that indicates whether we expect input to appear real soon\r\n    // now (after some event like 'keypress' or 'input') and are\r\n    // polling intensively.\r\n    this.pollingFast = false;\r\n    // Self-resetting timeout for the poller\r\n    this.polling = new Delayed();\r\n    // Tracks when input.reset has punted to just putting a short\r\n    // string into the textarea instead of the full selection.\r\n    this.inaccurateSelection = false;\r\n    // Used to work around IE issue with selection being forgotten when focus moves away from textarea\r\n    this.hasSelection = false;\r\n    this.composing = null;\r\n  };\r\n\r\n  function hiddenTextarea() {\r\n    var te = elt(\"textarea\", null, null, \"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none\");\r\n    var div = elt(\"div\", [te], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");\r\n    // The textarea is kept positioned near the cursor to prevent the\r\n    // fact that it'll be scrolled into view on input from scrolling\r\n    // our fake cursor out of view. On webkit, when wrap=off, paste is\r\n    // very slow. So make the area wide instead.\r\n    if (webkit) te.style.width = \"1000px\";\r\n    else te.setAttribute(\"wrap\", \"off\");\r\n    // If border: 0; -- iOS fails to open keyboard (issue #1287)\r\n    if (ios) te.style.border = \"1px solid black\";\r\n    disableBrowserMagic(te);\r\n    return div;\r\n  }\r\n\r\n  TextareaInput.prototype = copyObj({\r\n    init: function(display) {\r\n      var input = this, cm = this.cm;\r\n\r\n      // Wraps and hides input textarea\r\n      var div = this.wrapper = hiddenTextarea();\r\n      // The semihidden textarea that is focused when the editor is\r\n      // focused, and receives input.\r\n      var te = this.textarea = div.firstChild;\r\n      display.wrapper.insertBefore(div, display.wrapper.firstChild);\r\n\r\n      // Needed to hide big blue blinking cursor on Mobile Safari (doesn't seem to work in iOS 8 anymore)\r\n      if (ios) te.style.width = \"0px\";\r\n\r\n      on(te, \"input\", function() {\r\n        if (ie && ie_version >= 9 && input.hasSelection) input.hasSelection = null;\r\n        input.poll();\r\n      });\r\n\r\n      on(te, \"paste\", function(e) {\r\n        if (signalDOMEvent(cm, e) || handlePaste(e, cm)) return\r\n\r\n        cm.state.pasteIncoming = true;\r\n        input.fastPoll();\r\n      });\r\n\r\n      function prepareCopyCut(e) {\r\n        if (signalDOMEvent(cm, e)) return\r\n        if (cm.somethingSelected()) {\r\n          lastCopied = {lineWise: false, text: cm.getSelections()};\r\n          if (input.inaccurateSelection) {\r\n            input.prevInput = \"\";\r\n            input.inaccurateSelection = false;\r\n            te.value = lastCopied.text.join(\"\\n\");\r\n            selectInput(te);\r\n          }\r\n        } else if (!cm.options.lineWiseCopyCut) {\r\n          return;\r\n        } else {\r\n          var ranges = copyableRanges(cm);\r\n          lastCopied = {lineWise: true, text: ranges.text};\r\n          if (e.type == \"cut\") {\r\n            cm.setSelections(ranges.ranges, null, sel_dontScroll);\r\n          } else {\r\n            input.prevInput = \"\";\r\n            te.value = ranges.text.join(\"\\n\");\r\n            selectInput(te);\r\n          }\r\n        }\r\n        if (e.type == \"cut\") cm.state.cutIncoming = true;\r\n      }\r\n      on(te, \"cut\", prepareCopyCut);\r\n      on(te, \"copy\", prepareCopyCut);\r\n\r\n      on(display.scroller, \"paste\", function(e) {\r\n        if (eventInWidget(display, e) || signalDOMEvent(cm, e)) return;\r\n        cm.state.pasteIncoming = true;\r\n        input.focus();\r\n      });\r\n\r\n      // Prevent normal selection in the editor (we handle our own)\r\n      on(display.lineSpace, \"selectstart\", function(e) {\r\n        if (!eventInWidget(display, e)) e_preventDefault(e);\r\n      });\r\n\r\n      on(te, \"compositionstart\", function() {\r\n        var start = cm.getCursor(\"from\");\r\n        if (input.composing) input.composing.range.clear()\r\n        input.composing = {\r\n          start: start,\r\n          range: cm.markText(start, cm.getCursor(\"to\"), {className: \"CodeMirror-composing\"})\r\n        };\r\n      });\r\n      on(te, \"compositionend\", function() {\r\n        if (input.composing) {\r\n          input.poll();\r\n          input.composing.range.clear();\r\n          input.composing = null;\r\n        }\r\n      });\r\n    },\r\n\r\n    prepareSelection: function() {\r\n      // Redraw the selection and/or cursor\r\n      var cm = this.cm, display = cm.display, doc = cm.doc;\r\n      var result = prepareSelection(cm);\r\n\r\n      // Move the hidden textarea near the cursor to prevent scrolling artifacts\r\n      if (cm.options.moveInputWithCursor) {\r\n        var headPos = cursorCoords(cm, doc.sel.primary().head, \"div\");\r\n        var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();\r\n        result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\r\n                                            headPos.top + lineOff.top - wrapOff.top));\r\n        result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\r\n                                             headPos.left + lineOff.left - wrapOff.left));\r\n      }\r\n\r\n      return result;\r\n    },\r\n\r\n    showSelection: function(drawn) {\r\n      var cm = this.cm, display = cm.display;\r\n      removeChildrenAndAdd(display.cursorDiv, drawn.cursors);\r\n      removeChildrenAndAdd(display.selectionDiv, drawn.selection);\r\n      if (drawn.teTop != null) {\r\n        this.wrapper.style.top = drawn.teTop + \"px\";\r\n        this.wrapper.style.left = drawn.teLeft + \"px\";\r\n      }\r\n    },\r\n\r\n    // Reset the input to correspond to the selection (or to be empty,\r\n    // when not typing and nothing is selected)\r\n    reset: function(typing) {\r\n      if (this.contextMenuPending) return;\r\n      var minimal, selected, cm = this.cm, doc = cm.doc;\r\n      if (cm.somethingSelected()) {\r\n        this.prevInput = \"\";\r\n        var range = doc.sel.primary();\r\n        minimal = hasCopyEvent &&\r\n          (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000);\r\n        var content = minimal ? \"-\" : selected || cm.getSelection();\r\n        this.textarea.value = content;\r\n        if (cm.state.focused) selectInput(this.textarea);\r\n        if (ie && ie_version >= 9) this.hasSelection = content;\r\n      } else if (!typing) {\r\n        this.prevInput = this.textarea.value = \"\";\r\n        if (ie && ie_version >= 9) this.hasSelection = null;\r\n      }\r\n      this.inaccurateSelection = minimal;\r\n    },\r\n\r\n    getField: function() { return this.textarea; },\r\n\r\n    supportsTouch: function() { return false; },\r\n\r\n    focus: function() {\r\n      if (this.cm.options.readOnly != \"nocursor\" && (!mobile || activeElt() != this.textarea)) {\r\n        try { this.textarea.focus(); }\r\n        catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM\r\n      }\r\n    },\r\n\r\n    blur: function() { this.textarea.blur(); },\r\n\r\n    resetPosition: function() {\r\n      this.wrapper.style.top = this.wrapper.style.left = 0;\r\n    },\r\n\r\n    receivedFocus: function() { this.slowPoll(); },\r\n\r\n    // Poll for input changes, using the normal rate of polling. This\r\n    // runs as long as the editor is focused.\r\n    slowPoll: function() {\r\n      var input = this;\r\n      if (input.pollingFast) return;\r\n      input.polling.set(this.cm.options.pollInterval, function() {\r\n        input.poll();\r\n        if (input.cm.state.focused) input.slowPoll();\r\n      });\r\n    },\r\n\r\n    // When an event has just come in that is likely to add or change\r\n    // something in the input textarea, we poll faster, to ensure that\r\n    // the change appears on the screen quickly.\r\n    fastPoll: function() {\r\n      var missed = false, input = this;\r\n      input.pollingFast = true;\r\n      function p() {\r\n        var changed = input.poll();\r\n        if (!changed && !missed) {missed = true; input.polling.set(60, p);}\r\n        else {input.pollingFast = false; input.slowPoll();}\r\n      }\r\n      input.polling.set(20, p);\r\n    },\r\n\r\n    // Read input from the textarea, and update the document to match.\r\n    // When something is selected, it is present in the textarea, and\r\n    // selected (unless it is huge, in which case a placeholder is\r\n    // used). When nothing is selected, the cursor sits after previously\r\n    // seen text (can be empty), which is stored in prevInput (we must\r\n    // not reset the textarea when typing, because that breaks IME).\r\n    poll: function() {\r\n      var cm = this.cm, input = this.textarea, prevInput = this.prevInput;\r\n      // Since this is called a *lot*, try to bail out as cheaply as\r\n      // possible when it is clear that nothing happened. hasSelection\r\n      // will be the case when there is a lot of text in the textarea,\r\n      // in which case reading its value would be expensive.\r\n      if (this.contextMenuPending || !cm.state.focused ||\r\n          (hasSelection(input) && !prevInput && !this.composing) ||\r\n          cm.isReadOnly() || cm.options.disableInput || cm.state.keySeq)\r\n        return false;\r\n\r\n      var text = input.value;\r\n      // If nothing changed, bail.\r\n      if (text == prevInput && !cm.somethingSelected()) return false;\r\n      // Work around nonsensical selection resetting in IE9/10, and\r\n      // inexplicable appearance of private area unicode characters on\r\n      // some key combos in Mac (#2689).\r\n      if (ie && ie_version >= 9 && this.hasSelection === text ||\r\n          mac && /[\\uf700-\\uf7ff]/.test(text)) {\r\n        cm.display.input.reset();\r\n        return false;\r\n      }\r\n\r\n      if (cm.doc.sel == cm.display.selForContextMenu) {\r\n        var first = text.charCodeAt(0);\r\n        if (first == 0x200b && !prevInput) prevInput = \"\\u200b\";\r\n        if (first == 0x21da) { this.reset(); return this.cm.execCommand(\"undo\"); }\r\n      }\r\n      // Find the part of the input that is actually new\r\n      var same = 0, l = Math.min(prevInput.length, text.length);\r\n      while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) ++same;\r\n\r\n      var self = this;\r\n      runInOp(cm, function() {\r\n        applyTextInput(cm, text.slice(same), prevInput.length - same,\r\n                       null, self.composing ? \"*compose\" : null);\r\n\r\n        // Don't leave long text in the textarea, since it makes further polling slow\r\n        if (text.length > 1000 || text.indexOf(\"\\n\") > -1) input.value = self.prevInput = \"\";\r\n        else self.prevInput = text;\r\n\r\n        if (self.composing) {\r\n          self.composing.range.clear();\r\n          self.composing.range = cm.markText(self.composing.start, cm.getCursor(\"to\"),\r\n                                             {className: \"CodeMirror-composing\"});\r\n        }\r\n      });\r\n      return true;\r\n    },\r\n\r\n    ensurePolled: function() {\r\n      if (this.pollingFast && this.poll()) this.pollingFast = false;\r\n    },\r\n\r\n    onKeyPress: function() {\r\n      if (ie && ie_version >= 9) this.hasSelection = null;\r\n      this.fastPoll();\r\n    },\r\n\r\n    onContextMenu: function(e) {\r\n      var input = this, cm = input.cm, display = cm.display, te = input.textarea;\r\n      var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\r\n      if (!pos || presto) return; // Opera is difficult.\r\n\r\n      // Reset the current text selection only if the click is done outside of the selection\r\n      // and 'resetSelectionOnContextMenu' option is true.\r\n      var reset = cm.options.resetSelectionOnContextMenu;\r\n      if (reset && cm.doc.sel.contains(pos) == -1)\r\n        operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll);\r\n\r\n      var oldCSS = te.style.cssText, oldWrapperCSS = input.wrapper.style.cssText;\r\n      input.wrapper.style.cssText = \"position: absolute\"\r\n      var wrapperBox = input.wrapper.getBoundingClientRect()\r\n      te.style.cssText = \"position: absolute; width: 30px; height: 30px; top: \" + (e.clientY - wrapperBox.top - 5) +\r\n        \"px; left: \" + (e.clientX - wrapperBox.left - 5) + \"px; z-index: 1000; background: \" +\r\n        (ie ? \"rgba(255, 255, 255, .05)\" : \"transparent\") +\r\n        \"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);\";\r\n      if (webkit) var oldScrollY = window.scrollY; // Work around Chrome issue (#2712)\r\n      display.input.focus();\r\n      if (webkit) window.scrollTo(null, oldScrollY);\r\n      display.input.reset();\r\n      // Adds \"Select all\" to context menu in FF\r\n      if (!cm.somethingSelected()) te.value = input.prevInput = \" \";\r\n      input.contextMenuPending = true;\r\n      display.selForContextMenu = cm.doc.sel;\r\n      clearTimeout(display.detectingSelectAll);\r\n\r\n      // Select-all will be greyed out if there's nothing to select, so\r\n      // this adds a zero-width space so that we can later check whether\r\n      // it got selected.\r\n      function prepareSelectAllHack() {\r\n        if (te.selectionStart != null) {\r\n          var selected = cm.somethingSelected();\r\n          var extval = \"\\u200b\" + (selected ? te.value : \"\");\r\n          te.value = \"\\u21da\"; // Used to catch context-menu undo\r\n          te.value = extval;\r\n          input.prevInput = selected ? \"\" : \"\\u200b\";\r\n          te.selectionStart = 1; te.selectionEnd = extval.length;\r\n          // Re-set this, in case some other handler touched the\r\n          // selection in the meantime.\r\n          display.selForContextMenu = cm.doc.sel;\r\n        }\r\n      }\r\n      function rehide() {\r\n        input.contextMenuPending = false;\r\n        input.wrapper.style.cssText = oldWrapperCSS\r\n        te.style.cssText = oldCSS;\r\n        if (ie && ie_version < 9) display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos);\r\n\r\n        // Try to detect the user choosing select-all\r\n        if (te.selectionStart != null) {\r\n          if (!ie || (ie && ie_version < 9)) prepareSelectAllHack();\r\n          var i = 0, poll = function() {\r\n            if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&\r\n                te.selectionEnd > 0 && input.prevInput == \"\\u200b\")\r\n              operation(cm, commands.selectAll)(cm);\r\n            else if (i++ < 10) display.detectingSelectAll = setTimeout(poll, 500);\r\n            else display.input.reset();\r\n          };\r\n          display.detectingSelectAll = setTimeout(poll, 200);\r\n        }\r\n      }\r\n\r\n      if (ie && ie_version >= 9) prepareSelectAllHack();\r\n      if (captureRightClick) {\r\n        e_stop(e);\r\n        var mouseup = function() {\r\n          off(window, \"mouseup\", mouseup);\r\n          setTimeout(rehide, 20);\r\n        };\r\n        on(window, \"mouseup\", mouseup);\r\n      } else {\r\n        setTimeout(rehide, 50);\r\n      }\r\n    },\r\n\r\n    readOnlyChanged: function(val) {\r\n      if (!val) this.reset();\r\n    },\r\n\r\n    setUneditable: nothing,\r\n\r\n    needsContentAttribute: false\r\n  }, TextareaInput.prototype);\r\n\r\n  // CONTENTEDITABLE INPUT STYLE\r\n\r\n  function ContentEditableInput(cm) {\r\n    this.cm = cm;\r\n    this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;\r\n    this.polling = new Delayed();\r\n    this.gracePeriod = false;\r\n  }\r\n\r\n  ContentEditableInput.prototype = copyObj({\r\n    init: function(display) {\r\n      var input = this, cm = input.cm;\r\n      var div = input.div = display.lineDiv;\r\n      disableBrowserMagic(div, cm.options.spellcheck);\r\n\r\n      on(div, \"paste\", function(e) {\r\n        if (signalDOMEvent(cm, e) || handlePaste(e, cm)) return\r\n        // IE doesn't fire input events, so we schedule a read for the pasted content in this way\r\n        if (ie_version <= 11) setTimeout(operation(cm, function() {\r\n          if (!input.pollContent()) regChange(cm);\r\n        }), 20)\r\n      })\r\n\r\n      on(div, \"compositionstart\", function(e) {\r\n        var data = e.data;\r\n        input.composing = {sel: cm.doc.sel, data: data, startData: data};\r\n        if (!data) return;\r\n        var prim = cm.doc.sel.primary();\r\n        var line = cm.getLine(prim.head.line);\r\n        var found = line.indexOf(data, Math.max(0, prim.head.ch - data.length));\r\n        if (found > -1 && found <= prim.head.ch)\r\n          input.composing.sel = simpleSelection(Pos(prim.head.line, found),\r\n                                                Pos(prim.head.line, found + data.length));\r\n      });\r\n      on(div, \"compositionupdate\", function(e) {\r\n        input.composing.data = e.data;\r\n      });\r\n      on(div, \"compositionend\", function(e) {\r\n        var ours = input.composing;\r\n        if (!ours) return;\r\n        if (e.data != ours.startData && !/\\u200b/.test(e.data))\r\n          ours.data = e.data;\r\n        // Need a small delay to prevent other code (input event,\r\n        // selection polling) from doing damage when fired right after\r\n        // compositionend.\r\n        setTimeout(function() {\r\n          if (!ours.handled)\r\n            input.applyComposition(ours);\r\n          if (input.composing == ours)\r\n            input.composing = null;\r\n        }, 50);\r\n      });\r\n\r\n      on(div, \"touchstart\", function() {\r\n        input.forceCompositionEnd();\r\n      });\r\n\r\n      on(div, \"input\", function() {\r\n        if (input.composing) return;\r\n        if (cm.isReadOnly() || !input.pollContent())\r\n          runInOp(input.cm, function() {regChange(cm);});\r\n      });\r\n\r\n      function onCopyCut(e) {\r\n        if (signalDOMEvent(cm, e)) return\r\n        if (cm.somethingSelected()) {\r\n          lastCopied = {lineWise: false, text: cm.getSelections()};\r\n          if (e.type == \"cut\") cm.replaceSelection(\"\", null, \"cut\");\r\n        } else if (!cm.options.lineWiseCopyCut) {\r\n          return;\r\n        } else {\r\n          var ranges = copyableRanges(cm);\r\n          lastCopied = {lineWise: true, text: ranges.text};\r\n          if (e.type == \"cut\") {\r\n            cm.operation(function() {\r\n              cm.setSelections(ranges.ranges, 0, sel_dontScroll);\r\n              cm.replaceSelection(\"\", null, \"cut\");\r\n            });\r\n          }\r\n        }\r\n        if (e.clipboardData) {\r\n          e.clipboardData.clearData();\r\n          var content = lastCopied.text.join(\"\\n\")\r\n          // iOS exposes the clipboard API, but seems to discard content inserted into it\r\n          e.clipboardData.setData(\"Text\", content);\r\n          if (e.clipboardData.getData(\"Text\") == content) {\r\n            e.preventDefault();\r\n            return\r\n          }\r\n        }\r\n        // Old-fashioned briefly-focus-a-textarea hack\r\n        var kludge = hiddenTextarea(), te = kludge.firstChild;\r\n        cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);\r\n        te.value = lastCopied.text.join(\"\\n\");\r\n        var hadFocus = document.activeElement;\r\n        selectInput(te);\r\n        setTimeout(function() {\r\n          cm.display.lineSpace.removeChild(kludge);\r\n          hadFocus.focus();\r\n          if (hadFocus == div) input.showPrimarySelection()\r\n        }, 50);\r\n      }\r\n      on(div, \"copy\", onCopyCut);\r\n      on(div, \"cut\", onCopyCut);\r\n    },\r\n\r\n    prepareSelection: function() {\r\n      var result = prepareSelection(this.cm, false);\r\n      result.focus = this.cm.state.focused;\r\n      return result;\r\n    },\r\n\r\n    showSelection: function(info, takeFocus) {\r\n      if (!info || !this.cm.display.view.length) return;\r\n      if (info.focus || takeFocus) this.showPrimarySelection();\r\n      this.showMultipleSelections(info);\r\n    },\r\n\r\n    showPrimarySelection: function() {\r\n      var sel = window.getSelection(), prim = this.cm.doc.sel.primary();\r\n      var curAnchor = domToPos(this.cm, sel.anchorNode, sel.anchorOffset);\r\n      var curFocus = domToPos(this.cm, sel.focusNode, sel.focusOffset);\r\n      if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&\r\n          cmp(minPos(curAnchor, curFocus), prim.from()) == 0 &&\r\n          cmp(maxPos(curAnchor, curFocus), prim.to()) == 0)\r\n        return;\r\n\r\n      var start = posToDOM(this.cm, prim.from());\r\n      var end = posToDOM(this.cm, prim.to());\r\n      if (!start && !end) return;\r\n\r\n      var view = this.cm.display.view;\r\n      var old = sel.rangeCount && sel.getRangeAt(0);\r\n      if (!start) {\r\n        start = {node: view[0].measure.map[2], offset: 0};\r\n      } else if (!end) { // FIXME dangerously hacky\r\n        var measure = view[view.length - 1].measure;\r\n        var map = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;\r\n        end = {node: map[map.length - 1], offset: map[map.length - 2] - map[map.length - 3]};\r\n      }\r\n\r\n      try { var rng = range(start.node, start.offset, end.offset, end.node); }\r\n      catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible\r\n      if (rng) {\r\n        if (!gecko && this.cm.state.focused) {\r\n          sel.collapse(start.node, start.offset);\r\n          if (!rng.collapsed) sel.addRange(rng);\r\n        } else {\r\n          sel.removeAllRanges();\r\n          sel.addRange(rng);\r\n        }\r\n        if (old && sel.anchorNode == null) sel.addRange(old);\r\n        else if (gecko) this.startGracePeriod();\r\n      }\r\n      this.rememberSelection();\r\n    },\r\n\r\n    startGracePeriod: function() {\r\n      var input = this;\r\n      clearTimeout(this.gracePeriod);\r\n      this.gracePeriod = setTimeout(function() {\r\n        input.gracePeriod = false;\r\n        if (input.selectionChanged())\r\n          input.cm.operation(function() { input.cm.curOp.selectionChanged = true; });\r\n      }, 20);\r\n    },\r\n\r\n    showMultipleSelections: function(info) {\r\n      removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);\r\n      removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);\r\n    },\r\n\r\n    rememberSelection: function() {\r\n      var sel = window.getSelection();\r\n      this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;\r\n      this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;\r\n    },\r\n\r\n    selectionInEditor: function() {\r\n      var sel = window.getSelection();\r\n      if (!sel.rangeCount) return false;\r\n      var node = sel.getRangeAt(0).commonAncestorContainer;\r\n      return contains(this.div, node);\r\n    },\r\n\r\n    focus: function() {\r\n      if (this.cm.options.readOnly != \"nocursor\") this.div.focus();\r\n    },\r\n    blur: function() { this.div.blur(); },\r\n    getField: function() { return this.div; },\r\n\r\n    supportsTouch: function() { return true; },\r\n\r\n    receivedFocus: function() {\r\n      var input = this;\r\n      if (this.selectionInEditor())\r\n        this.pollSelection();\r\n      else\r\n        runInOp(this.cm, function() { input.cm.curOp.selectionChanged = true; });\r\n\r\n      function poll() {\r\n        if (input.cm.state.focused) {\r\n          input.pollSelection();\r\n          input.polling.set(input.cm.options.pollInterval, poll);\r\n        }\r\n      }\r\n      this.polling.set(this.cm.options.pollInterval, poll);\r\n    },\r\n\r\n    selectionChanged: function() {\r\n      var sel = window.getSelection();\r\n      return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||\r\n        sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset;\r\n    },\r\n\r\n    pollSelection: function() {\r\n      if (!this.composing && !this.gracePeriod && this.selectionChanged()) {\r\n        var sel = window.getSelection(), cm = this.cm;\r\n        this.rememberSelection();\r\n        var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);\r\n        var head = domToPos(cm, sel.focusNode, sel.focusOffset);\r\n        if (anchor && head) runInOp(cm, function() {\r\n          setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);\r\n          if (anchor.bad || head.bad) cm.curOp.selectionChanged = true;\r\n        });\r\n      }\r\n    },\r\n\r\n    pollContent: function() {\r\n      var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();\r\n      var from = sel.from(), to = sel.to();\r\n      if (from.line < display.viewFrom || to.line > display.viewTo - 1) return false;\r\n\r\n      var fromIndex;\r\n      if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {\r\n        var fromLine = lineNo(display.view[0].line);\r\n        var fromNode = display.view[0].node;\r\n      } else {\r\n        var fromLine = lineNo(display.view[fromIndex].line);\r\n        var fromNode = display.view[fromIndex - 1].node.nextSibling;\r\n      }\r\n      var toIndex = findViewIndex(cm, to.line);\r\n      if (toIndex == display.view.length - 1) {\r\n        var toLine = display.viewTo - 1;\r\n        var toNode = display.lineDiv.lastChild;\r\n      } else {\r\n        var toLine = lineNo(display.view[toIndex + 1].line) - 1;\r\n        var toNode = display.view[toIndex + 1].node.previousSibling;\r\n      }\r\n\r\n      var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));\r\n      var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));\r\n      while (newText.length > 1 && oldText.length > 1) {\r\n        if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }\r\n        else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }\r\n        else break;\r\n      }\r\n\r\n      var cutFront = 0, cutEnd = 0;\r\n      var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);\r\n      while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))\r\n        ++cutFront;\r\n      var newBot = lst(newText), oldBot = lst(oldText);\r\n      var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),\r\n                               oldBot.length - (oldText.length == 1 ? cutFront : 0));\r\n      while (cutEnd < maxCutEnd &&\r\n             newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))\r\n        ++cutEnd;\r\n\r\n      newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd);\r\n      newText[0] = newText[0].slice(cutFront);\r\n\r\n      var chFrom = Pos(fromLine, cutFront);\r\n      var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);\r\n      if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {\r\n        replaceRange(cm.doc, newText, chFrom, chTo, \"+input\");\r\n        return true;\r\n      }\r\n    },\r\n\r\n    ensurePolled: function() {\r\n      this.forceCompositionEnd();\r\n    },\r\n    reset: function() {\r\n      this.forceCompositionEnd();\r\n    },\r\n    forceCompositionEnd: function() {\r\n      if (!this.composing || this.composing.handled) return;\r\n      this.applyComposition(this.composing);\r\n      this.composing.handled = true;\r\n      this.div.blur();\r\n      this.div.focus();\r\n    },\r\n    applyComposition: function(composing) {\r\n      if (this.cm.isReadOnly())\r\n        operation(this.cm, regChange)(this.cm)\r\n      else if (composing.data && composing.data != composing.startData)\r\n        operation(this.cm, applyTextInput)(this.cm, composing.data, 0, composing.sel);\r\n    },\r\n\r\n    setUneditable: function(node) {\r\n      node.contentEditable = \"false\"\r\n    },\r\n\r\n    onKeyPress: function(e) {\r\n      e.preventDefault();\r\n      if (!this.cm.isReadOnly())\r\n        operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0);\r\n    },\r\n\r\n    readOnlyChanged: function(val) {\r\n      this.div.contentEditable = String(val != \"nocursor\")\r\n    },\r\n\r\n    onContextMenu: nothing,\r\n    resetPosition: nothing,\r\n\r\n    needsContentAttribute: true\r\n  }, ContentEditableInput.prototype);\r\n\r\n  function posToDOM(cm, pos) {\r\n    var view = findViewForLine(cm, pos.line);\r\n    if (!view || view.hidden) return null;\r\n    var line = getLine(cm.doc, pos.line);\r\n    var info = mapFromLineView(view, line, pos.line);\r\n\r\n    var order = getOrder(line), side = \"left\";\r\n    if (order) {\r\n      var partPos = getBidiPartAt(order, pos.ch);\r\n      side = partPos % 2 ? \"right\" : \"left\";\r\n    }\r\n    var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);\r\n    result.offset = result.collapse == \"right\" ? result.end : result.start;\r\n    return result;\r\n  }\r\n\r\n  function badPos(pos, bad) { if (bad) pos.bad = true; return pos; }\r\n\r\n  function domToPos(cm, node, offset) {\r\n    var lineNode;\r\n    if (node == cm.display.lineDiv) {\r\n      lineNode = cm.display.lineDiv.childNodes[offset];\r\n      if (!lineNode) return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true);\r\n      node = null; offset = 0;\r\n    } else {\r\n      for (lineNode = node;; lineNode = lineNode.parentNode) {\r\n        if (!lineNode || lineNode == cm.display.lineDiv) return null;\r\n        if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) break;\r\n      }\r\n    }\r\n    for (var i = 0; i < cm.display.view.length; i++) {\r\n      var lineView = cm.display.view[i];\r\n      if (lineView.node == lineNode)\r\n        return locateNodeInLineView(lineView, node, offset);\r\n    }\r\n  }\r\n\r\n  function locateNodeInLineView(lineView, node, offset) {\r\n    var wrapper = lineView.text.firstChild, bad = false;\r\n    if (!node || !contains(wrapper, node)) return badPos(Pos(lineNo(lineView.line), 0), true);\r\n    if (node == wrapper) {\r\n      bad = true;\r\n      node = wrapper.childNodes[offset];\r\n      offset = 0;\r\n      if (!node) {\r\n        var line = lineView.rest ? lst(lineView.rest) : lineView.line;\r\n        return badPos(Pos(lineNo(line), line.text.length), bad);\r\n      }\r\n    }\r\n\r\n    var textNode = node.nodeType == 3 ? node : null, topNode = node;\r\n    if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {\r\n      textNode = node.firstChild;\r\n      if (offset) offset = textNode.nodeValue.length;\r\n    }\r\n    while (topNode.parentNode != wrapper) topNode = topNode.parentNode;\r\n    var measure = lineView.measure, maps = measure.maps;\r\n\r\n    function find(textNode, topNode, offset) {\r\n      for (var i = -1; i < (maps ? maps.length : 0); i++) {\r\n        var map = i < 0 ? measure.map : maps[i];\r\n        for (var j = 0; j < map.length; j += 3) {\r\n          var curNode = map[j + 2];\r\n          if (curNode == textNode || curNode == topNode) {\r\n            var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);\r\n            var ch = map[j] + offset;\r\n            if (offset < 0 || curNode != textNode) ch = map[j + (offset ? 1 : 0)];\r\n            return Pos(line, ch);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    var found = find(textNode, topNode, offset);\r\n    if (found) return badPos(found, bad);\r\n\r\n    // FIXME this is all really shaky. might handle the few cases it needs to handle, but likely to cause problems\r\n    for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {\r\n      found = find(after, after.firstChild, 0);\r\n      if (found)\r\n        return badPos(Pos(found.line, found.ch - dist), bad);\r\n      else\r\n        dist += after.textContent.length;\r\n    }\r\n    for (var before = topNode.previousSibling, dist = offset; before; before = before.previousSibling) {\r\n      found = find(before, before.firstChild, -1);\r\n      if (found)\r\n        return badPos(Pos(found.line, found.ch + dist), bad);\r\n      else\r\n        dist += before.textContent.length;\r\n    }\r\n  }\r\n\r\n  function domTextBetween(cm, from, to, fromLine, toLine) {\r\n    var text = \"\", closing = false, lineSep = cm.doc.lineSeparator();\r\n    function recognizeMarker(id) { return function(marker) { return marker.id == id; }; }\r\n    function walk(node) {\r\n      if (node.nodeType == 1) {\r\n        var cmText = node.getAttribute(\"cm-text\");\r\n        if (cmText != null) {\r\n          if (cmText == \"\") cmText = node.textContent.replace(/\\u200b/g, \"\");\r\n          text += cmText;\r\n          return;\r\n        }\r\n        var markerID = node.getAttribute(\"cm-marker\"), range;\r\n        if (markerID) {\r\n          var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));\r\n          if (found.length && (range = found[0].find()))\r\n            text += getBetween(cm.doc, range.from, range.to).join(lineSep);\r\n          return;\r\n        }\r\n        if (node.getAttribute(\"contenteditable\") == \"false\") return;\r\n        for (var i = 0; i < node.childNodes.length; i++)\r\n          walk(node.childNodes[i]);\r\n        if (/^(pre|div|p)$/i.test(node.nodeName))\r\n          closing = true;\r\n      } else if (node.nodeType == 3) {\r\n        var val = node.nodeValue;\r\n        if (!val) return;\r\n        if (closing) {\r\n          text += lineSep;\r\n          closing = false;\r\n        }\r\n        text += val;\r\n      }\r\n    }\r\n    for (;;) {\r\n      walk(from);\r\n      if (from == to) break;\r\n      from = from.nextSibling;\r\n    }\r\n    return text;\r\n  }\r\n\r\n  CodeMirror.inputStyles = {\"textarea\": TextareaInput, \"contenteditable\": ContentEditableInput};\r\n\r\n  // SELECTION / CURSOR\r\n\r\n  // Selection objects are immutable. A new one is created every time\r\n  // the selection changes. A selection is one or more non-overlapping\r\n  // (and non-touching) ranges, sorted, and an integer that indicates\r\n  // which one is the primary selection (the one that's scrolled into\r\n  // view, that getCursor returns, etc).\r\n  function Selection(ranges, primIndex) {\r\n    this.ranges = ranges;\r\n    this.primIndex = primIndex;\r\n  }\r\n\r\n  Selection.prototype = {\r\n    primary: function() { return this.ranges[this.primIndex]; },\r\n    equals: function(other) {\r\n      if (other == this) return true;\r\n      if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) return false;\r\n      for (var i = 0; i < this.ranges.length; i++) {\r\n        var here = this.ranges[i], there = other.ranges[i];\r\n        if (cmp(here.anchor, there.anchor) != 0 || cmp(here.head, there.head) != 0) return false;\r\n      }\r\n      return true;\r\n    },\r\n    deepCopy: function() {\r\n      for (var out = [], i = 0; i < this.ranges.length; i++)\r\n        out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head));\r\n      return new Selection(out, this.primIndex);\r\n    },\r\n    somethingSelected: function() {\r\n      for (var i = 0; i < this.ranges.length; i++)\r\n        if (!this.ranges[i].empty()) return true;\r\n      return false;\r\n    },\r\n    contains: function(pos, end) {\r\n      if (!end) end = pos;\r\n      for (var i = 0; i < this.ranges.length; i++) {\r\n        var range = this.ranges[i];\r\n        if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)\r\n          return i;\r\n      }\r\n      return -1;\r\n    }\r\n  };\r\n\r\n  function Range(anchor, head) {\r\n    this.anchor = anchor; this.head = head;\r\n  }\r\n\r\n  Range.prototype = {\r\n    from: function() { return minPos(this.anchor, this.head); },\r\n    to: function() { return maxPos(this.anchor, this.head); },\r\n    empty: function() {\r\n      return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;\r\n    }\r\n  };\r\n\r\n  // Take an unsorted, potentially overlapping set of ranges, and\r\n  // build a selection out of it. 'Consumes' ranges array (modifying\r\n  // it).\r\n  function normalizeSelection(ranges, primIndex) {\r\n    var prim = ranges[primIndex];\r\n    ranges.sort(function(a, b) { return cmp(a.from(), b.from()); });\r\n    primIndex = indexOf(ranges, prim);\r\n    for (var i = 1; i < ranges.length; i++) {\r\n      var cur = ranges[i], prev = ranges[i - 1];\r\n      if (cmp(prev.to(), cur.from()) >= 0) {\r\n        var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());\r\n        var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\r\n        if (i <= primIndex) --primIndex;\r\n        ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\r\n      }\r\n    }\r\n    return new Selection(ranges, primIndex);\r\n  }\r\n\r\n  function simpleSelection(anchor, head) {\r\n    return new Selection([new Range(anchor, head || anchor)], 0);\r\n  }\r\n\r\n  // Most of the external API clips given positions to make sure they\r\n  // actually exist within the document.\r\n  function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1));}\r\n  function clipPos(doc, pos) {\r\n    if (pos.line < doc.first) return Pos(doc.first, 0);\r\n    var last = doc.first + doc.size - 1;\r\n    if (pos.line > last) return Pos(last, getLine(doc, last).text.length);\r\n    return clipToLen(pos, getLine(doc, pos.line).text.length);\r\n  }\r\n  function clipToLen(pos, linelen) {\r\n    var ch = pos.ch;\r\n    if (ch == null || ch > linelen) return Pos(pos.line, linelen);\r\n    else if (ch < 0) return Pos(pos.line, 0);\r\n    else return pos;\r\n  }\r\n  function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size;}\r\n  function clipPosArray(doc, array) {\r\n    for (var out = [], i = 0; i < array.length; i++) out[i] = clipPos(doc, array[i]);\r\n    return out;\r\n  }\r\n\r\n  // SELECTION UPDATES\r\n\r\n  // The 'scroll' parameter given to many of these indicated whether\r\n  // the new cursor position should be scrolled into view after\r\n  // modifying the selection.\r\n\r\n  // If shift is held or the extend flag is set, extends a range to\r\n  // include a given position (and optionally a second position).\r\n  // Otherwise, simply returns the range between the given positions.\r\n  // Used for cursor motion and such.\r\n  function extendRange(doc, range, head, other) {\r\n    if (doc.cm && doc.cm.display.shift || doc.extend) {\r\n      var anchor = range.anchor;\r\n      if (other) {\r\n        var posBefore = cmp(head, anchor) < 0;\r\n        if (posBefore != (cmp(other, anchor) < 0)) {\r\n          anchor = head;\r\n          head = other;\r\n        } else if (posBefore != (cmp(head, other) < 0)) {\r\n          head = other;\r\n        }\r\n      }\r\n      return new Range(anchor, head);\r\n    } else {\r\n      return new Range(other || head, head);\r\n    }\r\n  }\r\n\r\n  // Extend the primary selection range, discard the rest.\r\n  function extendSelection(doc, head, other, options) {\r\n    setSelection(doc, new Selection([extendRange(doc, doc.sel.primary(), head, other)], 0), options);\r\n  }\r\n\r\n  // Extend all selections (pos is an array of selections with length\r\n  // equal the number of selections)\r\n  function extendSelections(doc, heads, options) {\r\n    for (var out = [], i = 0; i < doc.sel.ranges.length; i++)\r\n      out[i] = extendRange(doc, doc.sel.ranges[i], heads[i], null);\r\n    var newSel = normalizeSelection(out, doc.sel.primIndex);\r\n    setSelection(doc, newSel, options);\r\n  }\r\n\r\n  // Updates a single range in the selection.\r\n  function replaceOneSelection(doc, i, range, options) {\r\n    var ranges = doc.sel.ranges.slice(0);\r\n    ranges[i] = range;\r\n    setSelection(doc, normalizeSelection(ranges, doc.sel.primIndex), options);\r\n  }\r\n\r\n  // Reset the selection to a single range.\r\n  function setSimpleSelection(doc, anchor, head, options) {\r\n    setSelection(doc, simpleSelection(anchor, head), options);\r\n  }\r\n\r\n  // Give beforeSelectionChange handlers a change to influence a\r\n  // selection update.\r\n  function filterSelectionChange(doc, sel, options) {\r\n    var obj = {\r\n      ranges: sel.ranges,\r\n      update: function(ranges) {\r\n        this.ranges = [];\r\n        for (var i = 0; i < ranges.length; i++)\r\n          this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),\r\n                                     clipPos(doc, ranges[i].head));\r\n      },\r\n      origin: options && options.origin\r\n    };\r\n    signal(doc, \"beforeSelectionChange\", doc, obj);\r\n    if (doc.cm) signal(doc.cm, \"beforeSelectionChange\", doc.cm, obj);\r\n    if (obj.ranges != sel.ranges) return normalizeSelection(obj.ranges, obj.ranges.length - 1);\r\n    else return sel;\r\n  }\r\n\r\n  function setSelectionReplaceHistory(doc, sel, options) {\r\n    var done = doc.history.done, last = lst(done);\r\n    if (last && last.ranges) {\r\n      done[done.length - 1] = sel;\r\n      setSelectionNoUndo(doc, sel, options);\r\n    } else {\r\n      setSelection(doc, sel, options);\r\n    }\r\n  }\r\n\r\n  // Set a new selection.\r\n  function setSelection(doc, sel, options) {\r\n    setSelectionNoUndo(doc, sel, options);\r\n    addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);\r\n  }\r\n\r\n  function setSelectionNoUndo(doc, sel, options) {\r\n    if (hasHandler(doc, \"beforeSelectionChange\") || doc.cm && hasHandler(doc.cm, \"beforeSelectionChange\"))\r\n      sel = filterSelectionChange(doc, sel, options);\r\n\r\n    var bias = options && options.bias ||\r\n      (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);\r\n    setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));\r\n\r\n    if (!(options && options.scroll === false) && doc.cm)\r\n      ensureCursorVisible(doc.cm);\r\n  }\r\n\r\n  function setSelectionInner(doc, sel) {\r\n    if (sel.equals(doc.sel)) return;\r\n\r\n    doc.sel = sel;\r\n\r\n    if (doc.cm) {\r\n      doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged = true;\r\n      signalCursorActivity(doc.cm);\r\n    }\r\n    signalLater(doc, \"cursorActivity\", doc);\r\n  }\r\n\r\n  // Verify that the selection does not partially select any atomic\r\n  // marked ranges.\r\n  function reCheckSelection(doc) {\r\n    setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false), sel_dontScroll);\r\n  }\r\n\r\n  // Return a selection that does not partially select any atomic\r\n  // ranges.\r\n  function skipAtomicInSelection(doc, sel, bias, mayClear) {\r\n    var out;\r\n    for (var i = 0; i < sel.ranges.length; i++) {\r\n      var range = sel.ranges[i];\r\n      var old = sel.ranges.length == doc.sel.ranges.length && doc.sel.ranges[i];\r\n      var newAnchor = skipAtomic(doc, range.anchor, old && old.anchor, bias, mayClear);\r\n      var newHead = skipAtomic(doc, range.head, old && old.head, bias, mayClear);\r\n      if (out || newAnchor != range.anchor || newHead != range.head) {\r\n        if (!out) out = sel.ranges.slice(0, i);\r\n        out[i] = new Range(newAnchor, newHead);\r\n      }\r\n    }\r\n    return out ? normalizeSelection(out, sel.primIndex) : sel;\r\n  }\r\n\r\n  function skipAtomicInner(doc, pos, oldPos, dir, mayClear) {\r\n    var line = getLine(doc, pos.line);\r\n    if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {\r\n      var sp = line.markedSpans[i], m = sp.marker;\r\n      if ((sp.from == null || (m.inclusiveLeft ? sp.from <= pos.ch : sp.from < pos.ch)) &&\r\n          (sp.to == null || (m.inclusiveRight ? sp.to >= pos.ch : sp.to > pos.ch))) {\r\n        if (mayClear) {\r\n          signal(m, \"beforeCursorEnter\");\r\n          if (m.explicitlyCleared) {\r\n            if (!line.markedSpans) break;\r\n            else {--i; continue;}\r\n          }\r\n        }\r\n        if (!m.atomic) continue;\r\n\r\n        if (oldPos) {\r\n          var near = m.find(dir < 0 ? 1 : -1), diff;\r\n          if (dir < 0 ? m.inclusiveRight : m.inclusiveLeft)\r\n            near = movePos(doc, near, -dir, near && near.line == pos.line ? line : null);\r\n          if (near && near.line == pos.line && (diff = cmp(near, oldPos)) && (dir < 0 ? diff < 0 : diff > 0))\r\n            return skipAtomicInner(doc, near, pos, dir, mayClear);\r\n        }\r\n\r\n        var far = m.find(dir < 0 ? -1 : 1);\r\n        if (dir < 0 ? m.inclusiveLeft : m.inclusiveRight)\r\n          far = movePos(doc, far, dir, far.line == pos.line ? line : null);\r\n        return far ? skipAtomicInner(doc, far, pos, dir, mayClear) : null;\r\n      }\r\n    }\r\n    return pos;\r\n  }\r\n\r\n  // Ensure a given position is not inside an atomic range.\r\n  function skipAtomic(doc, pos, oldPos, bias, mayClear) {\r\n    var dir = bias || 1;\r\n    var found = skipAtomicInner(doc, pos, oldPos, dir, mayClear) ||\r\n        (!mayClear && skipAtomicInner(doc, pos, oldPos, dir, true)) ||\r\n        skipAtomicInner(doc, pos, oldPos, -dir, mayClear) ||\r\n        (!mayClear && skipAtomicInner(doc, pos, oldPos, -dir, true));\r\n    if (!found) {\r\n      doc.cantEdit = true;\r\n      return Pos(doc.first, 0);\r\n    }\r\n    return found;\r\n  }\r\n\r\n  function movePos(doc, pos, dir, line) {\r\n    if (dir < 0 && pos.ch == 0) {\r\n      if (pos.line > doc.first) return clipPos(doc, Pos(pos.line - 1));\r\n      else return null;\r\n    } else if (dir > 0 && pos.ch == (line || getLine(doc, pos.line)).text.length) {\r\n      if (pos.line < doc.first + doc.size - 1) return Pos(pos.line + 1, 0);\r\n      else return null;\r\n    } else {\r\n      return new Pos(pos.line, pos.ch + dir);\r\n    }\r\n  }\r\n\r\n  // SELECTION DRAWING\r\n\r\n  function updateSelection(cm) {\r\n    cm.display.input.showSelection(cm.display.input.prepareSelection());\r\n  }\r\n\r\n  function prepareSelection(cm, primary) {\r\n    var doc = cm.doc, result = {};\r\n    var curFragment = result.cursors = document.createDocumentFragment();\r\n    var selFragment = result.selection = document.createDocumentFragment();\r\n\r\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\r\n      if (primary === false && i == doc.sel.primIndex) continue;\r\n      var range = doc.sel.ranges[i];\r\n      if (range.from().line >= cm.display.viewTo || range.to().line < cm.display.viewFrom) continue;\r\n      var collapsed = range.empty();\r\n      if (collapsed || cm.options.showCursorWhenSelecting)\r\n        drawSelectionCursor(cm, range.head, curFragment);\r\n      if (!collapsed)\r\n        drawSelectionRange(cm, range, selFragment);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  // Draws a cursor for the given range\r\n  function drawSelectionCursor(cm, head, output) {\r\n    var pos = cursorCoords(cm, head, \"div\", null, null, !cm.options.singleCursorHeightPerLine);\r\n\r\n    var cursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor\"));\r\n    cursor.style.left = pos.left + \"px\";\r\n    cursor.style.top = pos.top + \"px\";\r\n    cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + \"px\";\r\n\r\n    if (pos.other) {\r\n      // Secondary cursor, shown when on a 'jump' in bi-directional text\r\n      var otherCursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor CodeMirror-secondarycursor\"));\r\n      otherCursor.style.display = \"\";\r\n      otherCursor.style.left = pos.other.left + \"px\";\r\n      otherCursor.style.top = pos.other.top + \"px\";\r\n      otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + \"px\";\r\n    }\r\n  }\r\n\r\n  // Draws the given range as a highlighted selection\r\n  function drawSelectionRange(cm, range, output) {\r\n    var display = cm.display, doc = cm.doc;\r\n    var fragment = document.createDocumentFragment();\r\n    var padding = paddingH(cm.display), leftSide = padding.left;\r\n    var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;\r\n\r\n    function add(left, top, width, bottom) {\r\n      if (top < 0) top = 0;\r\n      top = Math.round(top);\r\n      bottom = Math.round(bottom);\r\n      fragment.appendChild(elt(\"div\", null, \"CodeMirror-selected\", \"position: absolute; left: \" + left +\r\n                               \"px; top: \" + top + \"px; width: \" + (width == null ? rightSide - left : width) +\r\n                               \"px; height: \" + (bottom - top) + \"px\"));\r\n    }\r\n\r\n    function drawForLine(line, fromArg, toArg) {\r\n      var lineObj = getLine(doc, line);\r\n      var lineLen = lineObj.text.length;\r\n      var start, end;\r\n      function coords(ch, bias) {\r\n        return charCoords(cm, Pos(line, ch), \"div\", lineObj, bias);\r\n      }\r\n\r\n      iterateBidiSections(getOrder(lineObj), fromArg || 0, toArg == null ? lineLen : toArg, function(from, to, dir) {\r\n        var leftPos = coords(from, \"left\"), rightPos, left, right;\r\n        if (from == to) {\r\n          rightPos = leftPos;\r\n          left = right = leftPos.left;\r\n        } else {\r\n          rightPos = coords(to - 1, \"right\");\r\n          if (dir == \"rtl\") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }\r\n          left = leftPos.left;\r\n          right = rightPos.right;\r\n        }\r\n        if (fromArg == null && from == 0) left = leftSide;\r\n        if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part\r\n          add(left, leftPos.top, null, leftPos.bottom);\r\n          left = leftSide;\r\n          if (leftPos.bottom < rightPos.top) add(left, leftPos.bottom, null, rightPos.top);\r\n        }\r\n        if (toArg == null && to == lineLen) right = rightSide;\r\n        if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)\r\n          start = leftPos;\r\n        if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)\r\n          end = rightPos;\r\n        if (left < leftSide + 1) left = leftSide;\r\n        add(left, rightPos.top, right - left, rightPos.bottom);\r\n      });\r\n      return {start: start, end: end};\r\n    }\r\n\r\n    var sFrom = range.from(), sTo = range.to();\r\n    if (sFrom.line == sTo.line) {\r\n      drawForLine(sFrom.line, sFrom.ch, sTo.ch);\r\n    } else {\r\n      var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);\r\n      var singleVLine = visualLine(fromLine) == visualLine(toLine);\r\n      var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;\r\n      var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;\r\n      if (singleVLine) {\r\n        if (leftEnd.top < rightStart.top - 2) {\r\n          add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\r\n          add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);\r\n        } else {\r\n          add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\r\n        }\r\n      }\r\n      if (leftEnd.bottom < rightStart.top)\r\n        add(leftSide, leftEnd.bottom, null, rightStart.top);\r\n    }\r\n\r\n    output.appendChild(fragment);\r\n  }\r\n\r\n  // Cursor-blinking\r\n  function restartBlink(cm) {\r\n    if (!cm.state.focused) return;\r\n    var display = cm.display;\r\n    clearInterval(display.blinker);\r\n    var on = true;\r\n    display.cursorDiv.style.visibility = \"\";\r\n    if (cm.options.cursorBlinkRate > 0)\r\n      display.blinker = setInterval(function() {\r\n        display.cursorDiv.style.visibility = (on = !on) ? \"\" : \"hidden\";\r\n      }, cm.options.cursorBlinkRate);\r\n    else if (cm.options.cursorBlinkRate < 0)\r\n      display.cursorDiv.style.visibility = \"hidden\";\r\n  }\r\n\r\n  // HIGHLIGHT WORKER\r\n\r\n  function startWorker(cm, time) {\r\n    if (cm.doc.mode.startState && cm.doc.frontier < cm.display.viewTo)\r\n      cm.state.highlight.set(time, bind(highlightWorker, cm));\r\n  }\r\n\r\n  function highlightWorker(cm) {\r\n    var doc = cm.doc;\r\n    if (doc.frontier < doc.first) doc.frontier = doc.first;\r\n    if (doc.frontier >= cm.display.viewTo) return;\r\n    var end = +new Date + cm.options.workTime;\r\n    var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));\r\n    var changedLines = [];\r\n\r\n    doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function(line) {\r\n      if (doc.frontier >= cm.display.viewFrom) { // Visible\r\n        var oldStyles = line.styles, tooLong = line.text.length > cm.options.maxHighlightLength;\r\n        var highlighted = highlightLine(cm, line, tooLong ? copyState(doc.mode, state) : state, true);\r\n        line.styles = highlighted.styles;\r\n        var oldCls = line.styleClasses, newCls = highlighted.classes;\r\n        if (newCls) line.styleClasses = newCls;\r\n        else if (oldCls) line.styleClasses = null;\r\n        var ischange = !oldStyles || oldStyles.length != line.styles.length ||\r\n          oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);\r\n        for (var i = 0; !ischange && i < oldStyles.length; ++i) ischange = oldStyles[i] != line.styles[i];\r\n        if (ischange) changedLines.push(doc.frontier);\r\n        line.stateAfter = tooLong ? state : copyState(doc.mode, state);\r\n      } else {\r\n        if (line.text.length <= cm.options.maxHighlightLength)\r\n          processLine(cm, line.text, state);\r\n        line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;\r\n      }\r\n      ++doc.frontier;\r\n      if (+new Date > end) {\r\n        startWorker(cm, cm.options.workDelay);\r\n        return true;\r\n      }\r\n    });\r\n    if (changedLines.length) runInOp(cm, function() {\r\n      for (var i = 0; i < changedLines.length; i++)\r\n        regLineChange(cm, changedLines[i], \"text\");\r\n    });\r\n  }\r\n\r\n  // Finds the line to start with when starting a parse. Tries to\r\n  // find a line with a stateAfter, so that it can start with a\r\n  // valid state. If that fails, it returns the line with the\r\n  // smallest indentation, which tends to need the least context to\r\n  // parse correctly.\r\n  function findStartLine(cm, n, precise) {\r\n    var minindent, minline, doc = cm.doc;\r\n    var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\r\n    for (var search = n; search > lim; --search) {\r\n      if (search <= doc.first) return doc.first;\r\n      var line = getLine(doc, search - 1);\r\n      if (line.stateAfter && (!precise || search <= doc.frontier)) return search;\r\n      var indented = countColumn(line.text, null, cm.options.tabSize);\r\n      if (minline == null || minindent > indented) {\r\n        minline = search - 1;\r\n        minindent = indented;\r\n      }\r\n    }\r\n    return minline;\r\n  }\r\n\r\n  function getStateBefore(cm, n, precise) {\r\n    var doc = cm.doc, display = cm.display;\r\n    if (!doc.mode.startState) return true;\r\n    var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;\r\n    if (!state) state = startState(doc.mode);\r\n    else state = copyState(doc.mode, state);\r\n    doc.iter(pos, n, function(line) {\r\n      processLine(cm, line.text, state);\r\n      var save = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo;\r\n      line.stateAfter = save ? copyState(doc.mode, state) : null;\r\n      ++pos;\r\n    });\r\n    if (precise) doc.frontier = pos;\r\n    return state;\r\n  }\r\n\r\n  // POSITION MEASUREMENT\r\n\r\n  function paddingTop(display) {return display.lineSpace.offsetTop;}\r\n  function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}\r\n  function paddingH(display) {\r\n    if (display.cachedPaddingH) return display.cachedPaddingH;\r\n    var e = removeChildrenAndAdd(display.measure, elt(\"pre\", \"x\"));\r\n    var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;\r\n    var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};\r\n    if (!isNaN(data.left) && !isNaN(data.right)) display.cachedPaddingH = data;\r\n    return data;\r\n  }\r\n\r\n  function scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth; }\r\n  function displayWidth(cm) {\r\n    return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth;\r\n  }\r\n  function displayHeight(cm) {\r\n    return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight;\r\n  }\r\n\r\n  // Ensure the lineView.wrapping.heights array is populated. This is\r\n  // an array of bottom offsets for the lines that make up a drawn\r\n  // line. When lineWrapping is on, there might be more than one\r\n  // height.\r\n  function ensureLineHeights(cm, lineView, rect) {\r\n    var wrapping = cm.options.lineWrapping;\r\n    var curWidth = wrapping && displayWidth(cm);\r\n    if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {\r\n      var heights = lineView.measure.heights = [];\r\n      if (wrapping) {\r\n        lineView.measure.width = curWidth;\r\n        var rects = lineView.text.firstChild.getClientRects();\r\n        for (var i = 0; i < rects.length - 1; i++) {\r\n          var cur = rects[i], next = rects[i + 1];\r\n          if (Math.abs(cur.bottom - next.bottom) > 2)\r\n            heights.push((cur.bottom + next.top) / 2 - rect.top);\r\n        }\r\n      }\r\n      heights.push(rect.bottom - rect.top);\r\n    }\r\n  }\r\n\r\n  // Find a line map (mapping character offsets to text nodes) and a\r\n  // measurement cache for the given line number. (A line view might\r\n  // contain multiple lines when collapsed ranges are present.)\r\n  function mapFromLineView(lineView, line, lineN) {\r\n    if (lineView.line == line)\r\n      return {map: lineView.measure.map, cache: lineView.measure.cache};\r\n    for (var i = 0; i < lineView.rest.length; i++)\r\n      if (lineView.rest[i] == line)\r\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]};\r\n    for (var i = 0; i < lineView.rest.length; i++)\r\n      if (lineNo(lineView.rest[i]) > lineN)\r\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i], before: true};\r\n  }\r\n\r\n  // Render a line into the hidden node display.externalMeasured. Used\r\n  // when measurement is needed for a line that's not in the viewport.\r\n  function updateExternalMeasurement(cm, line) {\r\n    line = visualLine(line);\r\n    var lineN = lineNo(line);\r\n    var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);\r\n    view.lineN = lineN;\r\n    var built = view.built = buildLineContent(cm, view);\r\n    view.text = built.pre;\r\n    removeChildrenAndAdd(cm.display.lineMeasure, built.pre);\r\n    return view;\r\n  }\r\n\r\n  // Get a {top, bottom, left, right} box (in line-local coordinates)\r\n  // for a given character.\r\n  function measureChar(cm, line, ch, bias) {\r\n    return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias);\r\n  }\r\n\r\n  // Find a line view that corresponds to the given line number.\r\n  function findViewForLine(cm, lineN) {\r\n    if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)\r\n      return cm.display.view[findViewIndex(cm, lineN)];\r\n    var ext = cm.display.externalMeasured;\r\n    if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)\r\n      return ext;\r\n  }\r\n\r\n  // Measurement can be split in two steps, the set-up work that\r\n  // applies to the whole line, and the measurement of the actual\r\n  // character. Functions like coordsChar, that need to do a lot of\r\n  // measurements in a row, can thus ensure that the set-up work is\r\n  // only done once.\r\n  function prepareMeasureForLine(cm, line) {\r\n    var lineN = lineNo(line);\r\n    var view = findViewForLine(cm, lineN);\r\n    if (view && !view.text) {\r\n      view = null;\r\n    } else if (view && view.changes) {\r\n      updateLineForChanges(cm, view, lineN, getDimensions(cm));\r\n      cm.curOp.forceUpdate = true;\r\n    }\r\n    if (!view)\r\n      view = updateExternalMeasurement(cm, line);\r\n\r\n    var info = mapFromLineView(view, line, lineN);\r\n    return {\r\n      line: line, view: view, rect: null,\r\n      map: info.map, cache: info.cache, before: info.before,\r\n      hasHeights: false\r\n    };\r\n  }\r\n\r\n  // Given a prepared measurement object, measures the position of an\r\n  // actual character (or fetches it from the cache).\r\n  function measureCharPrepared(cm, prepared, ch, bias, varHeight) {\r\n    if (prepared.before) ch = -1;\r\n    var key = ch + (bias || \"\"), found;\r\n    if (prepared.cache.hasOwnProperty(key)) {\r\n      found = prepared.cache[key];\r\n    } else {\r\n      if (!prepared.rect)\r\n        prepared.rect = prepared.view.text.getBoundingClientRect();\r\n      if (!prepared.hasHeights) {\r\n        ensureLineHeights(cm, prepared.view, prepared.rect);\r\n        prepared.hasHeights = true;\r\n      }\r\n      found = measureCharInner(cm, prepared, ch, bias);\r\n      if (!found.bogus) prepared.cache[key] = found;\r\n    }\r\n    return {left: found.left, right: found.right,\r\n            top: varHeight ? found.rtop : found.top,\r\n            bottom: varHeight ? found.rbottom : found.bottom};\r\n  }\r\n\r\n  var nullRect = {left: 0, right: 0, top: 0, bottom: 0};\r\n\r\n  function nodeAndOffsetInLineMap(map, ch, bias) {\r\n    var node, start, end, collapse;\r\n    // First, search the line map for the text node corresponding to,\r\n    // or closest to, the target character.\r\n    for (var i = 0; i < map.length; i += 3) {\r\n      var mStart = map[i], mEnd = map[i + 1];\r\n      if (ch < mStart) {\r\n        start = 0; end = 1;\r\n        collapse = \"left\";\r\n      } else if (ch < mEnd) {\r\n        start = ch - mStart;\r\n        end = start + 1;\r\n      } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {\r\n        end = mEnd - mStart;\r\n        start = end - 1;\r\n        if (ch >= mEnd) collapse = \"right\";\r\n      }\r\n      if (start != null) {\r\n        node = map[i + 2];\r\n        if (mStart == mEnd && bias == (node.insertLeft ? \"left\" : \"right\"))\r\n          collapse = bias;\r\n        if (bias == \"left\" && start == 0)\r\n          while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {\r\n            node = map[(i -= 3) + 2];\r\n            collapse = \"left\";\r\n          }\r\n        if (bias == \"right\" && start == mEnd - mStart)\r\n          while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {\r\n            node = map[(i += 3) + 2];\r\n            collapse = \"right\";\r\n          }\r\n        break;\r\n      }\r\n    }\r\n    return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd};\r\n  }\r\n\r\n  function getUsefulRect(rects, bias) {\r\n    var rect = nullRect\r\n    if (bias == \"left\") for (var i = 0; i < rects.length; i++) {\r\n      if ((rect = rects[i]).left != rect.right) break\r\n    } else for (var i = rects.length - 1; i >= 0; i--) {\r\n      if ((rect = rects[i]).left != rect.right) break\r\n    }\r\n    return rect\r\n  }\r\n\r\n  function measureCharInner(cm, prepared, ch, bias) {\r\n    var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);\r\n    var node = place.node, start = place.start, end = place.end, collapse = place.collapse;\r\n\r\n    var rect;\r\n    if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.\r\n      for (var i = 0; i < 4; i++) { // Retry a maximum of 4 times when nonsense rectangles are returned\r\n        while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) --start;\r\n        while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) ++end;\r\n        if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart)\r\n          rect = node.parentNode.getBoundingClientRect();\r\n        else\r\n          rect = getUsefulRect(range(node, start, end).getClientRects(), bias)\r\n        if (rect.left || rect.right || start == 0) break;\r\n        end = start;\r\n        start = start - 1;\r\n        collapse = \"right\";\r\n      }\r\n      if (ie && ie_version < 11) rect = maybeUpdateRectForZooming(cm.display.measure, rect);\r\n    } else { // If it is a widget, simply get the box for the whole widget.\r\n      if (start > 0) collapse = bias = \"right\";\r\n      var rects;\r\n      if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)\r\n        rect = rects[bias == \"right\" ? rects.length - 1 : 0];\r\n      else\r\n        rect = node.getBoundingClientRect();\r\n    }\r\n    if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {\r\n      var rSpan = node.parentNode.getClientRects()[0];\r\n      if (rSpan)\r\n        rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom};\r\n      else\r\n        rect = nullRect;\r\n    }\r\n\r\n    var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;\r\n    var mid = (rtop + rbot) / 2;\r\n    var heights = prepared.view.measure.heights;\r\n    for (var i = 0; i < heights.length - 1; i++)\r\n      if (mid < heights[i]) break;\r\n    var top = i ? heights[i - 1] : 0, bot = heights[i];\r\n    var result = {left: (collapse == \"right\" ? rect.right : rect.left) - prepared.rect.left,\r\n                  right: (collapse == \"left\" ? rect.left : rect.right) - prepared.rect.left,\r\n                  top: top, bottom: bot};\r\n    if (!rect.left && !rect.right) result.bogus = true;\r\n    if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }\r\n\r\n    return result;\r\n  }\r\n\r\n  // Work around problem with bounding client rects on ranges being\r\n  // returned incorrectly when zoomed on IE10 and below.\r\n  function maybeUpdateRectForZooming(measure, rect) {\r\n    if (!window.screen || screen.logicalXDPI == null ||\r\n        screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))\r\n      return rect;\r\n    var scaleX = screen.logicalXDPI / screen.deviceXDPI;\r\n    var scaleY = screen.logicalYDPI / screen.deviceYDPI;\r\n    return {left: rect.left * scaleX, right: rect.right * scaleX,\r\n            top: rect.top * scaleY, bottom: rect.bottom * scaleY};\r\n  }\r\n\r\n  function clearLineMeasurementCacheFor(lineView) {\r\n    if (lineView.measure) {\r\n      lineView.measure.cache = {};\r\n      lineView.measure.heights = null;\r\n      if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\r\n        lineView.measure.caches[i] = {};\r\n    }\r\n  }\r\n\r\n  function clearLineMeasurementCache(cm) {\r\n    cm.display.externalMeasure = null;\r\n    removeChildren(cm.display.lineMeasure);\r\n    for (var i = 0; i < cm.display.view.length; i++)\r\n      clearLineMeasurementCacheFor(cm.display.view[i]);\r\n  }\r\n\r\n  function clearCaches(cm) {\r\n    clearLineMeasurementCache(cm);\r\n    cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;\r\n    if (!cm.options.lineWrapping) cm.display.maxLineChanged = true;\r\n    cm.display.lineNumChars = null;\r\n  }\r\n\r\n  function pageScrollX() { return window.pageXOffset || (document.documentElement || document.body).scrollLeft; }\r\n  function pageScrollY() { return window.pageYOffset || (document.documentElement || document.body).scrollTop; }\r\n\r\n  // Converts a {top, bottom, left, right} box from line-local\r\n  // coordinates into another coordinate system. Context may be one of\r\n  // \"line\", \"div\" (display.lineDiv), \"local\"/null (editor), \"window\",\r\n  // or \"page\".\r\n  function intoCoordSystem(cm, lineObj, rect, context) {\r\n    if (lineObj.widgets) for (var i = 0; i < lineObj.widgets.length; ++i) if (lineObj.widgets[i].above) {\r\n      var size = widgetHeight(lineObj.widgets[i]);\r\n      rect.top += size; rect.bottom += size;\r\n    }\r\n    if (context == \"line\") return rect;\r\n    if (!context) context = \"local\";\r\n    var yOff = heightAtLine(lineObj);\r\n    if (context == \"local\") yOff += paddingTop(cm.display);\r\n    else yOff -= cm.display.viewOffset;\r\n    if (context == \"page\" || context == \"window\") {\r\n      var lOff = cm.display.lineSpace.getBoundingClientRect();\r\n      yOff += lOff.top + (context == \"window\" ? 0 : pageScrollY());\r\n      var xOff = lOff.left + (context == \"window\" ? 0 : pageScrollX());\r\n      rect.left += xOff; rect.right += xOff;\r\n    }\r\n    rect.top += yOff; rect.bottom += yOff;\r\n    return rect;\r\n  }\r\n\r\n  // Coverts a box from \"div\" coords to another coordinate system.\r\n  // Context may be \"window\", \"page\", \"div\", or \"local\"/null.\r\n  function fromCoordSystem(cm, coords, context) {\r\n    if (context == \"div\") return coords;\r\n    var left = coords.left, top = coords.top;\r\n    // First move into \"page\" coordinate system\r\n    if (context == \"page\") {\r\n      left -= pageScrollX();\r\n      top -= pageScrollY();\r\n    } else if (context == \"local\" || !context) {\r\n      var localBox = cm.display.sizer.getBoundingClientRect();\r\n      left += localBox.left;\r\n      top += localBox.top;\r\n    }\r\n\r\n    var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();\r\n    return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top};\r\n  }\r\n\r\n  function charCoords(cm, pos, context, lineObj, bias) {\r\n    if (!lineObj) lineObj = getLine(cm.doc, pos.line);\r\n    return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context);\r\n  }\r\n\r\n  // Returns a box for a given cursor position, which may have an\r\n  // 'other' property containing the position of the secondary cursor\r\n  // on a bidi boundary.\r\n  function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {\r\n    lineObj = lineObj || getLine(cm.doc, pos.line);\r\n    if (!preparedMeasure) preparedMeasure = prepareMeasureForLine(cm, lineObj);\r\n    function get(ch, right) {\r\n      var m = measureCharPrepared(cm, preparedMeasure, ch, right ? \"right\" : \"left\", varHeight);\r\n      if (right) m.left = m.right; else m.right = m.left;\r\n      return intoCoordSystem(cm, lineObj, m, context);\r\n    }\r\n    function getBidi(ch, partPos) {\r\n      var part = order[partPos], right = part.level % 2;\r\n      if (ch == bidiLeft(part) && partPos && part.level < order[partPos - 1].level) {\r\n        part = order[--partPos];\r\n        ch = bidiRight(part) - (part.level % 2 ? 0 : 1);\r\n        right = true;\r\n      } else if (ch == bidiRight(part) && partPos < order.length - 1 && part.level < order[partPos + 1].level) {\r\n        part = order[++partPos];\r\n        ch = bidiLeft(part) - part.level % 2;\r\n        right = false;\r\n      }\r\n      if (right && ch == part.to && ch > part.from) return get(ch - 1);\r\n      return get(ch, right);\r\n    }\r\n    var order = getOrder(lineObj), ch = pos.ch;\r\n    if (!order) return get(ch);\r\n    var partPos = getBidiPartAt(order, ch);\r\n    var val = getBidi(ch, partPos);\r\n    if (bidiOther != null) val.other = getBidi(ch, bidiOther);\r\n    return val;\r\n  }\r\n\r\n  // Used to cheaply estimate the coordinates for a position. Used for\r\n  // intermediate scroll updates.\r\n  function estimateCoords(cm, pos) {\r\n    var left = 0, pos = clipPos(cm.doc, pos);\r\n    if (!cm.options.lineWrapping) left = charWidth(cm.display) * pos.ch;\r\n    var lineObj = getLine(cm.doc, pos.line);\r\n    var top = heightAtLine(lineObj) + paddingTop(cm.display);\r\n    return {left: left, right: left, top: top, bottom: top + lineObj.height};\r\n  }\r\n\r\n  // Positions returned by coordsChar contain some extra information.\r\n  // xRel is the relative x position of the input coordinates compared\r\n  // to the found position (so xRel > 0 means the coordinates are to\r\n  // the right of the character position, for example). When outside\r\n  // is true, that means the coordinates lie outside the line's\r\n  // vertical range.\r\n  function PosWithInfo(line, ch, outside, xRel) {\r\n    var pos = Pos(line, ch);\r\n    pos.xRel = xRel;\r\n    if (outside) pos.outside = true;\r\n    return pos;\r\n  }\r\n\r\n  // Compute the character position closest to the given coordinates.\r\n  // Input must be lineSpace-local (\"div\" coordinate system).\r\n  function coordsChar(cm, x, y) {\r\n    var doc = cm.doc;\r\n    y += cm.display.viewOffset;\r\n    if (y < 0) return PosWithInfo(doc.first, 0, true, -1);\r\n    var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\r\n    if (lineN > last)\r\n      return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, true, 1);\r\n    if (x < 0) x = 0;\r\n\r\n    var lineObj = getLine(doc, lineN);\r\n    for (;;) {\r\n      var found = coordsCharInner(cm, lineObj, lineN, x, y);\r\n      var merged = collapsedSpanAtEnd(lineObj);\r\n      var mergedPos = merged && merged.find(0, true);\r\n      if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))\r\n        lineN = lineNo(lineObj = mergedPos.to.line);\r\n      else\r\n        return found;\r\n    }\r\n  }\r\n\r\n  function coordsCharInner(cm, lineObj, lineNo, x, y) {\r\n    var innerOff = y - heightAtLine(lineObj);\r\n    var wrongLine = false, adjust = 2 * cm.display.wrapper.clientWidth;\r\n    var preparedMeasure = prepareMeasureForLine(cm, lineObj);\r\n\r\n    function getX(ch) {\r\n      var sp = cursorCoords(cm, Pos(lineNo, ch), \"line\", lineObj, preparedMeasure);\r\n      wrongLine = true;\r\n      if (innerOff > sp.bottom) return sp.left - adjust;\r\n      else if (innerOff < sp.top) return sp.left + adjust;\r\n      else wrongLine = false;\r\n      return sp.left;\r\n    }\r\n\r\n    var bidi = getOrder(lineObj), dist = lineObj.text.length;\r\n    var from = lineLeft(lineObj), to = lineRight(lineObj);\r\n    var fromX = getX(from), fromOutside = wrongLine, toX = getX(to), toOutside = wrongLine;\r\n\r\n    if (x > toX) return PosWithInfo(lineNo, to, toOutside, 1);\r\n    // Do a binary search between these bounds.\r\n    for (;;) {\r\n      if (bidi ? to == from || to == moveVisually(lineObj, from, 1) : to - from <= 1) {\r\n        var ch = x < fromX || x - fromX <= toX - x ? from : to;\r\n        var outside = ch == from ? fromOutside : toOutside\r\n        var xDiff = x - (ch == from ? fromX : toX);\r\n        // This is a kludge to handle the case where the coordinates\r\n        // are after a line-wrapped line. We should replace it with a\r\n        // more general handling of cursor positions around line\r\n        // breaks. (Issue #4078)\r\n        if (toOutside && !bidi && !/\\s/.test(lineObj.text.charAt(ch)) && xDiff > 0 &&\r\n            ch < lineObj.text.length && preparedMeasure.view.measure.heights.length > 1) {\r\n          var charSize = measureCharPrepared(cm, preparedMeasure, ch, \"right\");\r\n          if (innerOff <= charSize.bottom && innerOff >= charSize.top && Math.abs(x - charSize.right) < xDiff) {\r\n            outside = false\r\n            ch++\r\n            xDiff = x - charSize.right\r\n          }\r\n        }\r\n        while (isExtendingChar(lineObj.text.charAt(ch))) ++ch;\r\n        var pos = PosWithInfo(lineNo, ch, outside, xDiff < -1 ? -1 : xDiff > 1 ? 1 : 0);\r\n        return pos;\r\n      }\r\n      var step = Math.ceil(dist / 2), middle = from + step;\r\n      if (bidi) {\r\n        middle = from;\r\n        for (var i = 0; i < step; ++i) middle = moveVisually(lineObj, middle, 1);\r\n      }\r\n      var middleX = getX(middle);\r\n      if (middleX > x) {to = middle; toX = middleX; if (toOutside = wrongLine) toX += 1000; dist = step;}\r\n      else {from = middle; fromX = middleX; fromOutside = wrongLine; dist -= step;}\r\n    }\r\n  }\r\n\r\n  var measureText;\r\n  // Compute the default text height.\r\n  function textHeight(display) {\r\n    if (display.cachedTextHeight != null) return display.cachedTextHeight;\r\n    if (measureText == null) {\r\n      measureText = elt(\"pre\");\r\n      // Measure a bunch of lines, for browsers that compute\r\n      // fractional heights.\r\n      for (var i = 0; i < 49; ++i) {\r\n        measureText.appendChild(document.createTextNode(\"x\"));\r\n        measureText.appendChild(elt(\"br\"));\r\n      }\r\n      measureText.appendChild(document.createTextNode(\"x\"));\r\n    }\r\n    removeChildrenAndAdd(display.measure, measureText);\r\n    var height = measureText.offsetHeight / 50;\r\n    if (height > 3) display.cachedTextHeight = height;\r\n    removeChildren(display.measure);\r\n    return height || 1;\r\n  }\r\n\r\n  // Compute the default character width.\r\n  function charWidth(display) {\r\n    if (display.cachedCharWidth != null) return display.cachedCharWidth;\r\n    var anchor = elt(\"span\", \"xxxxxxxxxx\");\r\n    var pre = elt(\"pre\", [anchor]);\r\n    removeChildrenAndAdd(display.measure, pre);\r\n    var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;\r\n    if (width > 2) display.cachedCharWidth = width;\r\n    return width || 10;\r\n  }\r\n\r\n  // OPERATIONS\r\n\r\n  // Operations are used to wrap a series of changes to the editor\r\n  // state in such a way that each change won't have to update the\r\n  // cursor and display (which would be awkward, slow, and\r\n  // error-prone). Instead, display updates are batched and then all\r\n  // combined and executed at once.\r\n\r\n  var operationGroup = null;\r\n\r\n  var nextOpId = 0;\r\n  // Start a new operation.\r\n  function startOperation(cm) {\r\n    cm.curOp = {\r\n      cm: cm,\r\n      viewChanged: false,      // Flag that indicates that lines might need to be redrawn\r\n      startHeight: cm.doc.height, // Used to detect need to update scrollbar\r\n      forceUpdate: false,      // Used to force a redraw\r\n      updateInput: null,       // Whether to reset the input textarea\r\n      typing: false,           // Whether this reset should be careful to leave existing text (for compositing)\r\n      changeObjs: null,        // Accumulated changes, for firing change events\r\n      cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on\r\n      cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already\r\n      selectionChanged: false, // Whether the selection needs to be redrawn\r\n      updateMaxLine: false,    // Set when the widest line needs to be determined anew\r\n      scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet\r\n      scrollToPos: null,       // Used to scroll to a specific position\r\n      focus: false,\r\n      id: ++nextOpId           // Unique ID\r\n    };\r\n    if (operationGroup) {\r\n      operationGroup.ops.push(cm.curOp);\r\n    } else {\r\n      cm.curOp.ownsGroup = operationGroup = {\r\n        ops: [cm.curOp],\r\n        delayedCallbacks: []\r\n      };\r\n    }\r\n  }\r\n\r\n  function fireCallbacksForOps(group) {\r\n    // Calls delayed callbacks and cursorActivity handlers until no\r\n    // new ones appear\r\n    var callbacks = group.delayedCallbacks, i = 0;\r\n    do {\r\n      for (; i < callbacks.length; i++)\r\n        callbacks[i].call(null);\r\n      for (var j = 0; j < group.ops.length; j++) {\r\n        var op = group.ops[j];\r\n        if (op.cursorActivityHandlers)\r\n          while (op.cursorActivityCalled < op.cursorActivityHandlers.length)\r\n            op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm);\r\n      }\r\n    } while (i < callbacks.length);\r\n  }\r\n\r\n  // Finish an operation, updating the display and signalling delayed events\r\n  function endOperation(cm) {\r\n    var op = cm.curOp, group = op.ownsGroup;\r\n    if (!group) return;\r\n\r\n    try { fireCallbacksForOps(group); }\r\n    finally {\r\n      operationGroup = null;\r\n      for (var i = 0; i < group.ops.length; i++)\r\n        group.ops[i].cm.curOp = null;\r\n      endOperations(group);\r\n    }\r\n  }\r\n\r\n  // The DOM updates done when an operation finishes are batched so\r\n  // that the minimum number of relayouts are required.\r\n  function endOperations(group) {\r\n    var ops = group.ops;\r\n    for (var i = 0; i < ops.length; i++) // Read DOM\r\n      endOperation_R1(ops[i]);\r\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\r\n      endOperation_W1(ops[i]);\r\n    for (var i = 0; i < ops.length; i++) // Read DOM\r\n      endOperation_R2(ops[i]);\r\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\r\n      endOperation_W2(ops[i]);\r\n    for (var i = 0; i < ops.length; i++) // Read DOM\r\n      endOperation_finish(ops[i]);\r\n  }\r\n\r\n  function endOperation_R1(op) {\r\n    var cm = op.cm, display = cm.display;\r\n    maybeClipScrollbars(cm);\r\n    if (op.updateMaxLine) findMaxLine(cm);\r\n\r\n    op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||\r\n      op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||\r\n                         op.scrollToPos.to.line >= display.viewTo) ||\r\n      display.maxLineChanged && cm.options.lineWrapping;\r\n    op.update = op.mustUpdate &&\r\n      new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);\r\n  }\r\n\r\n  function endOperation_W1(op) {\r\n    op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);\r\n  }\r\n\r\n  function endOperation_R2(op) {\r\n    var cm = op.cm, display = cm.display;\r\n    if (op.updatedDisplay) updateHeightsInViewport(cm);\r\n\r\n    op.barMeasure = measureForScrollbars(cm);\r\n\r\n    // If the max line changed since it was last measured, measure it,\r\n    // and ensure the document's width matches it.\r\n    // updateDisplay_W2 will use these properties to do the actual resizing\r\n    if (display.maxLineChanged && !cm.options.lineWrapping) {\r\n      op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;\r\n      cm.display.sizerWidth = op.adjustWidthTo;\r\n      op.barMeasure.scrollWidth =\r\n        Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);\r\n      op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));\r\n    }\r\n\r\n    if (op.updatedDisplay || op.selectionChanged)\r\n      op.preparedSelection = display.input.prepareSelection(op.focus);\r\n  }\r\n\r\n  function endOperation_W2(op) {\r\n    var cm = op.cm;\r\n\r\n    if (op.adjustWidthTo != null) {\r\n      cm.display.sizer.style.minWidth = op.adjustWidthTo + \"px\";\r\n      if (op.maxScrollLeft < cm.doc.scrollLeft)\r\n        setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true);\r\n      cm.display.maxLineChanged = false;\r\n    }\r\n\r\n    var takeFocus = op.focus && op.focus == activeElt() && (!document.hasFocus || document.hasFocus())\r\n    if (op.preparedSelection)\r\n      cm.display.input.showSelection(op.preparedSelection, takeFocus);\r\n    if (op.updatedDisplay || op.startHeight != cm.doc.height)\r\n      updateScrollbars(cm, op.barMeasure);\r\n    if (op.updatedDisplay)\r\n      setDocumentHeight(cm, op.barMeasure);\r\n\r\n    if (op.selectionChanged) restartBlink(cm);\r\n\r\n    if (cm.state.focused && op.updateInput)\r\n      cm.display.input.reset(op.typing);\r\n    if (takeFocus) ensureFocus(op.cm);\r\n  }\r\n\r\n  function endOperation_finish(op) {\r\n    var cm = op.cm, display = cm.display, doc = cm.doc;\r\n\r\n    if (op.updatedDisplay) postUpdateDisplay(cm, op.update);\r\n\r\n    // Abort mouse wheel delta measurement, when scrolling explicitly\r\n    if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))\r\n      display.wheelStartX = display.wheelStartY = null;\r\n\r\n    // Propagate the scroll position to the actual DOM scroller\r\n    if (op.scrollTop != null && (display.scroller.scrollTop != op.scrollTop || op.forceScroll)) {\r\n      doc.scrollTop = Math.max(0, Math.min(display.scroller.scrollHeight - display.scroller.clientHeight, op.scrollTop));\r\n      display.scrollbars.setScrollTop(doc.scrollTop);\r\n      display.scroller.scrollTop = doc.scrollTop;\r\n    }\r\n    if (op.scrollLeft != null && (display.scroller.scrollLeft != op.scrollLeft || op.forceScroll)) {\r\n      doc.scrollLeft = Math.max(0, Math.min(display.scroller.scrollWidth - display.scroller.clientWidth, op.scrollLeft));\r\n      display.scrollbars.setScrollLeft(doc.scrollLeft);\r\n      display.scroller.scrollLeft = doc.scrollLeft;\r\n      alignHorizontally(cm);\r\n    }\r\n    // If we need to scroll a specific position into view, do so.\r\n    if (op.scrollToPos) {\r\n      var coords = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),\r\n                                     clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);\r\n      if (op.scrollToPos.isCursor && cm.state.focused) maybeScrollWindow(cm, coords);\r\n    }\r\n\r\n    // Fire events for markers that are hidden/unidden by editing or\r\n    // undoing\r\n    var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\r\n    if (hidden) for (var i = 0; i < hidden.length; ++i)\r\n      if (!hidden[i].lines.length) signal(hidden[i], \"hide\");\r\n    if (unhidden) for (var i = 0; i < unhidden.length; ++i)\r\n      if (unhidden[i].lines.length) signal(unhidden[i], \"unhide\");\r\n\r\n    if (display.wrapper.offsetHeight)\r\n      doc.scrollTop = cm.display.scroller.scrollTop;\r\n\r\n    // Fire change events, and delayed event handlers\r\n    if (op.changeObjs)\r\n      signal(cm, \"changes\", cm, op.changeObjs);\r\n    if (op.update)\r\n      op.update.finish();\r\n  }\r\n\r\n  // Run the given function in an operation\r\n  function runInOp(cm, f) {\r\n    if (cm.curOp) return f();\r\n    startOperation(cm);\r\n    try { return f(); }\r\n    finally { endOperation(cm); }\r\n  }\r\n  // Wraps a function in an operation. Returns the wrapped function.\r\n  function operation(cm, f) {\r\n    return function() {\r\n      if (cm.curOp) return f.apply(cm, arguments);\r\n      startOperation(cm);\r\n      try { return f.apply(cm, arguments); }\r\n      finally { endOperation(cm); }\r\n    };\r\n  }\r\n  // Used to add methods to editor and doc instances, wrapping them in\r\n  // operations.\r\n  function methodOp(f) {\r\n    return function() {\r\n      if (this.curOp) return f.apply(this, arguments);\r\n      startOperation(this);\r\n      try { return f.apply(this, arguments); }\r\n      finally { endOperation(this); }\r\n    };\r\n  }\r\n  function docMethodOp(f) {\r\n    return function() {\r\n      var cm = this.cm;\r\n      if (!cm || cm.curOp) return f.apply(this, arguments);\r\n      startOperation(cm);\r\n      try { return f.apply(this, arguments); }\r\n      finally { endOperation(cm); }\r\n    };\r\n  }\r\n\r\n  // VIEW TRACKING\r\n\r\n  // These objects are used to represent the visible (currently drawn)\r\n  // part of the document. A LineView may correspond to multiple\r\n  // logical lines, if those are connected by collapsed ranges.\r\n  function LineView(doc, line, lineN) {\r\n    // The starting line\r\n    this.line = line;\r\n    // Continuing lines, if any\r\n    this.rest = visualLineContinued(line);\r\n    // Number of logical lines in this visual line\r\n    this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;\r\n    this.node = this.text = null;\r\n    this.hidden = lineIsHidden(doc, line);\r\n  }\r\n\r\n  // Create a range of LineView objects for the given lines.\r\n  function buildViewArray(cm, from, to) {\r\n    var array = [], nextPos;\r\n    for (var pos = from; pos < to; pos = nextPos) {\r\n      var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);\r\n      nextPos = pos + view.size;\r\n      array.push(view);\r\n    }\r\n    return array;\r\n  }\r\n\r\n  // Updates the display.view data structure for a given change to the\r\n  // document. From and to are in pre-change coordinates. Lendiff is\r\n  // the amount of lines added or subtracted by the change. This is\r\n  // used for changes that span multiple lines, or change the way\r\n  // lines are divided into visual lines. regLineChange (below)\r\n  // registers single-line changes.\r\n  function regChange(cm, from, to, lendiff) {\r\n    if (from == null) from = cm.doc.first;\r\n    if (to == null) to = cm.doc.first + cm.doc.size;\r\n    if (!lendiff) lendiff = 0;\r\n\r\n    var display = cm.display;\r\n    if (lendiff && to < display.viewTo &&\r\n        (display.updateLineNumbers == null || display.updateLineNumbers > from))\r\n      display.updateLineNumbers = from;\r\n\r\n    cm.curOp.viewChanged = true;\r\n\r\n    if (from >= display.viewTo) { // Change after\r\n      if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)\r\n        resetView(cm);\r\n    } else if (to <= display.viewFrom) { // Change before\r\n      if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {\r\n        resetView(cm);\r\n      } else {\r\n        display.viewFrom += lendiff;\r\n        display.viewTo += lendiff;\r\n      }\r\n    } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap\r\n      resetView(cm);\r\n    } else if (from <= display.viewFrom) { // Top overlap\r\n      var cut = viewCuttingPoint(cm, to, to + lendiff, 1);\r\n      if (cut) {\r\n        display.view = display.view.slice(cut.index);\r\n        display.viewFrom = cut.lineN;\r\n        display.viewTo += lendiff;\r\n      } else {\r\n        resetView(cm);\r\n      }\r\n    } else if (to >= display.viewTo) { // Bottom overlap\r\n      var cut = viewCuttingPoint(cm, from, from, -1);\r\n      if (cut) {\r\n        display.view = display.view.slice(0, cut.index);\r\n        display.viewTo = cut.lineN;\r\n      } else {\r\n        resetView(cm);\r\n      }\r\n    } else { // Gap in the middle\r\n      var cutTop = viewCuttingPoint(cm, from, from, -1);\r\n      var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);\r\n      if (cutTop && cutBot) {\r\n        display.view = display.view.slice(0, cutTop.index)\r\n          .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))\r\n          .concat(display.view.slice(cutBot.index));\r\n        display.viewTo += lendiff;\r\n      } else {\r\n        resetView(cm);\r\n      }\r\n    }\r\n\r\n    var ext = display.externalMeasured;\r\n    if (ext) {\r\n      if (to < ext.lineN)\r\n        ext.lineN += lendiff;\r\n      else if (from < ext.lineN + ext.size)\r\n        display.externalMeasured = null;\r\n    }\r\n  }\r\n\r\n  // Register a change to a single line. Type must be one of \"text\",\r\n  // \"gutter\", \"class\", \"widget\"\r\n  function regLineChange(cm, line, type) {\r\n    cm.curOp.viewChanged = true;\r\n    var display = cm.display, ext = cm.display.externalMeasured;\r\n    if (ext && line >= ext.lineN && line < ext.lineN + ext.size)\r\n      display.externalMeasured = null;\r\n\r\n    if (line < display.viewFrom || line >= display.viewTo) return;\r\n    var lineView = display.view[findViewIndex(cm, line)];\r\n    if (lineView.node == null) return;\r\n    var arr = lineView.changes || (lineView.changes = []);\r\n    if (indexOf(arr, type) == -1) arr.push(type);\r\n  }\r\n\r\n  // Clear the view.\r\n  function resetView(cm) {\r\n    cm.display.viewFrom = cm.display.viewTo = cm.doc.first;\r\n    cm.display.view = [];\r\n    cm.display.viewOffset = 0;\r\n  }\r\n\r\n  // Find the view element corresponding to a given line. Return null\r\n  // when the line isn't visible.\r\n  function findViewIndex(cm, n) {\r\n    if (n >= cm.display.viewTo) return null;\r\n    n -= cm.display.viewFrom;\r\n    if (n < 0) return null;\r\n    var view = cm.display.view;\r\n    for (var i = 0; i < view.length; i++) {\r\n      n -= view[i].size;\r\n      if (n < 0) return i;\r\n    }\r\n  }\r\n\r\n  function viewCuttingPoint(cm, oldN, newN, dir) {\r\n    var index = findViewIndex(cm, oldN), diff, view = cm.display.view;\r\n    if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)\r\n      return {index: index, lineN: newN};\r\n    for (var i = 0, n = cm.display.viewFrom; i < index; i++)\r\n      n += view[i].size;\r\n    if (n != oldN) {\r\n      if (dir > 0) {\r\n        if (index == view.length - 1) return null;\r\n        diff = (n + view[index].size) - oldN;\r\n        index++;\r\n      } else {\r\n        diff = n - oldN;\r\n      }\r\n      oldN += diff; newN += diff;\r\n    }\r\n    while (visualLineNo(cm.doc, newN) != newN) {\r\n      if (index == (dir < 0 ? 0 : view.length - 1)) return null;\r\n      newN += dir * view[index - (dir < 0 ? 1 : 0)].size;\r\n      index += dir;\r\n    }\r\n    return {index: index, lineN: newN};\r\n  }\r\n\r\n  // Force the view to cover a given range, adding empty view element\r\n  // or clipping off existing ones as needed.\r\n  function adjustView(cm, from, to) {\r\n    var display = cm.display, view = display.view;\r\n    if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {\r\n      display.view = buildViewArray(cm, from, to);\r\n      display.viewFrom = from;\r\n    } else {\r\n      if (display.viewFrom > from)\r\n        display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view);\r\n      else if (display.viewFrom < from)\r\n        display.view = display.view.slice(findViewIndex(cm, from));\r\n      display.viewFrom = from;\r\n      if (display.viewTo < to)\r\n        display.view = display.view.concat(buildViewArray(cm, display.viewTo, to));\r\n      else if (display.viewTo > to)\r\n        display.view = display.view.slice(0, findViewIndex(cm, to));\r\n    }\r\n    display.viewTo = to;\r\n  }\r\n\r\n  // Count the number of lines in the view whose DOM representation is\r\n  // out of date (or nonexistent).\r\n  function countDirtyView(cm) {\r\n    var view = cm.display.view, dirty = 0;\r\n    for (var i = 0; i < view.length; i++) {\r\n      var lineView = view[i];\r\n      if (!lineView.hidden && (!lineView.node || lineView.changes)) ++dirty;\r\n    }\r\n    return dirty;\r\n  }\r\n\r\n  // EVENT HANDLERS\r\n\r\n  // Attach the necessary event handlers when initializing the editor\r\n  function registerEventHandlers(cm) {\r\n    var d = cm.display;\r\n    on(d.scroller, \"mousedown\", operation(cm, onMouseDown));\r\n    // Older IE's will not fire a second mousedown for a double click\r\n    if (ie && ie_version < 11)\r\n      on(d.scroller, \"dblclick\", operation(cm, function(e) {\r\n        if (signalDOMEvent(cm, e)) return;\r\n        var pos = posFromMouse(cm, e);\r\n        if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) return;\r\n        e_preventDefault(e);\r\n        var word = cm.findWordAt(pos);\r\n        extendSelection(cm.doc, word.anchor, word.head);\r\n      }));\r\n    else\r\n      on(d.scroller, \"dblclick\", function(e) { signalDOMEvent(cm, e) || e_preventDefault(e); });\r\n    // Some browsers fire contextmenu *after* opening the menu, at\r\n    // which point we can't mess with it anymore. Context menu is\r\n    // handled in onMouseDown for these browsers.\r\n    if (!captureRightClick) on(d.scroller, \"contextmenu\", function(e) {onContextMenu(cm, e);});\r\n\r\n    // Used to suppress mouse event handling when a touch happens\r\n    var touchFinished, prevTouch = {end: 0};\r\n    function finishTouch() {\r\n      if (d.activeTouch) {\r\n        touchFinished = setTimeout(function() {d.activeTouch = null;}, 1000);\r\n        prevTouch = d.activeTouch;\r\n        prevTouch.end = +new Date;\r\n      }\r\n    };\r\n    function isMouseLikeTouchEvent(e) {\r\n      if (e.touches.length != 1) return false;\r\n      var touch = e.touches[0];\r\n      return touch.radiusX <= 1 && touch.radiusY <= 1;\r\n    }\r\n    function farAway(touch, other) {\r\n      if (other.left == null) return true;\r\n      var dx = other.left - touch.left, dy = other.top - touch.top;\r\n      return dx * dx + dy * dy > 20 * 20;\r\n    }\r\n    on(d.scroller, \"touchstart\", function(e) {\r\n      if (!signalDOMEvent(cm, e) && !isMouseLikeTouchEvent(e)) {\r\n        clearTimeout(touchFinished);\r\n        var now = +new Date;\r\n        d.activeTouch = {start: now, moved: false,\r\n                         prev: now - prevTouch.end <= 300 ? prevTouch : null};\r\n        if (e.touches.length == 1) {\r\n          d.activeTouch.left = e.touches[0].pageX;\r\n          d.activeTouch.top = e.touches[0].pageY;\r\n        }\r\n      }\r\n    });\r\n    on(d.scroller, \"touchmove\", function() {\r\n      if (d.activeTouch) d.activeTouch.moved = true;\r\n    });\r\n    on(d.scroller, \"touchend\", function(e) {\r\n      var touch = d.activeTouch;\r\n      if (touch && !eventInWidget(d, e) && touch.left != null &&\r\n          !touch.moved && new Date - touch.start < 300) {\r\n        var pos = cm.coordsChar(d.activeTouch, \"page\"), range;\r\n        if (!touch.prev || farAway(touch, touch.prev)) // Single tap\r\n          range = new Range(pos, pos);\r\n        else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap\r\n          range = cm.findWordAt(pos);\r\n        else // Triple tap\r\n          range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0)));\r\n        cm.setSelection(range.anchor, range.head);\r\n        cm.focus();\r\n        e_preventDefault(e);\r\n      }\r\n      finishTouch();\r\n    });\r\n    on(d.scroller, \"touchcancel\", finishTouch);\r\n\r\n    // Sync scrolling between fake scrollbars and real scrollable\r\n    // area, ensure viewport is updated when scrolling.\r\n    on(d.scroller, \"scroll\", function() {\r\n      if (d.scroller.clientHeight) {\r\n        setScrollTop(cm, d.scroller.scrollTop);\r\n        setScrollLeft(cm, d.scroller.scrollLeft, true);\r\n        signal(cm, \"scroll\", cm);\r\n      }\r\n    });\r\n\r\n    // Listen to wheel events in order to try and update the viewport on time.\r\n    on(d.scroller, \"mousewheel\", function(e){onScrollWheel(cm, e);});\r\n    on(d.scroller, \"DOMMouseScroll\", function(e){onScrollWheel(cm, e);});\r\n\r\n    // Prevent wrapper from ever scrolling\r\n    on(d.wrapper, \"scroll\", function() { d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\r\n\r\n    d.dragFunctions = {\r\n      enter: function(e) {if (!signalDOMEvent(cm, e)) e_stop(e);},\r\n      over: function(e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},\r\n      start: function(e){onDragStart(cm, e);},\r\n      drop: operation(cm, onDrop),\r\n      leave: function(e) {if (!signalDOMEvent(cm, e)) { clearDragCursor(cm); }}\r\n    };\r\n\r\n    var inp = d.input.getField();\r\n    on(inp, \"keyup\", function(e) { onKeyUp.call(cm, e); });\r\n    on(inp, \"keydown\", operation(cm, onKeyDown));\r\n    on(inp, \"keypress\", operation(cm, onKeyPress));\r\n    on(inp, \"focus\", bind(onFocus, cm));\r\n    on(inp, \"blur\", bind(onBlur, cm));\r\n  }\r\n\r\n  function dragDropChanged(cm, value, old) {\r\n    var wasOn = old && old != CodeMirror.Init;\r\n    if (!value != !wasOn) {\r\n      var funcs = cm.display.dragFunctions;\r\n      var toggle = value ? on : off;\r\n      toggle(cm.display.scroller, \"dragstart\", funcs.start);\r\n      toggle(cm.display.scroller, \"dragenter\", funcs.enter);\r\n      toggle(cm.display.scroller, \"dragover\", funcs.over);\r\n      toggle(cm.display.scroller, \"dragleave\", funcs.leave);\r\n      toggle(cm.display.scroller, \"drop\", funcs.drop);\r\n    }\r\n  }\r\n\r\n  // Called when the window resizes\r\n  function onResize(cm) {\r\n    var d = cm.display;\r\n    if (d.lastWrapHeight == d.wrapper.clientHeight && d.lastWrapWidth == d.wrapper.clientWidth)\r\n      return;\r\n    // Might be a text scaling operation, clear size caches.\r\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\r\n    d.scrollbarsClipped = false;\r\n    cm.setSize();\r\n  }\r\n\r\n  // MOUSE EVENTS\r\n\r\n  // Return true when the given mouse event happened in a widget\r\n  function eventInWidget(display, e) {\r\n    for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\r\n      if (!n || (n.nodeType == 1 && n.getAttribute(\"cm-ignore-events\") == \"true\") ||\r\n          (n.parentNode == display.sizer && n != display.mover))\r\n        return true;\r\n    }\r\n  }\r\n\r\n  // Given a mouse event, find the corresponding position. If liberal\r\n  // is false, it checks whether a gutter or scrollbar was clicked,\r\n  // and returns null if it was. forRect is used by rectangular\r\n  // selections, and tries to estimate a character position even for\r\n  // coordinates beyond the right of the text.\r\n  function posFromMouse(cm, e, liberal, forRect) {\r\n    var display = cm.display;\r\n    if (!liberal && e_target(e).getAttribute(\"cm-not-content\") == \"true\") return null;\r\n\r\n    var x, y, space = display.lineSpace.getBoundingClientRect();\r\n    // Fails unpredictably on IE[67] when mouse is dragged around quickly.\r\n    try { x = e.clientX - space.left; y = e.clientY - space.top; }\r\n    catch (e) { return null; }\r\n    var coords = coordsChar(cm, x, y), line;\r\n    if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {\r\n      var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;\r\n      coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));\r\n    }\r\n    return coords;\r\n  }\r\n\r\n  // A mouse down can be a single click, double click, triple click,\r\n  // start of selection drag, start of text drag, new cursor\r\n  // (ctrl-click), rectangle drag (alt-drag), or xwin\r\n  // middle-click-paste. Or it might be a click on something we should\r\n  // not interfere with, such as a scrollbar or widget.\r\n  function onMouseDown(e) {\r\n    var cm = this, display = cm.display;\r\n    if (signalDOMEvent(cm, e) || display.activeTouch && display.input.supportsTouch()) return;\r\n    display.shift = e.shiftKey;\r\n\r\n    if (eventInWidget(display, e)) {\r\n      if (!webkit) {\r\n        // Briefly turn off draggability, to allow widgets to do\r\n        // normal dragging things.\r\n        display.scroller.draggable = false;\r\n        setTimeout(function(){display.scroller.draggable = true;}, 100);\r\n      }\r\n      return;\r\n    }\r\n    if (clickInGutter(cm, e)) return;\r\n    var start = posFromMouse(cm, e);\r\n    window.focus();\r\n\r\n    switch (e_button(e)) {\r\n    case 1:\r\n      // #3261: make sure, that we're not starting a second selection\r\n      if (cm.state.selectingText)\r\n        cm.state.selectingText(e);\r\n      else if (start)\r\n        leftButtonDown(cm, e, start);\r\n      else if (e_target(e) == display.scroller)\r\n        e_preventDefault(e);\r\n      break;\r\n    case 2:\r\n      if (webkit) cm.state.lastMiddleDown = +new Date;\r\n      if (start) extendSelection(cm.doc, start);\r\n      setTimeout(function() {display.input.focus();}, 20);\r\n      e_preventDefault(e);\r\n      break;\r\n    case 3:\r\n      if (captureRightClick) onContextMenu(cm, e);\r\n      else delayBlurEvent(cm);\r\n      break;\r\n    }\r\n  }\r\n\r\n  var lastClick, lastDoubleClick;\r\n  function leftButtonDown(cm, e, start) {\r\n    if (ie) setTimeout(bind(ensureFocus, cm), 0);\r\n    else cm.curOp.focus = activeElt();\r\n\r\n    var now = +new Date, type;\r\n    if (lastDoubleClick && lastDoubleClick.time > now - 400 && cmp(lastDoubleClick.pos, start) == 0) {\r\n      type = \"triple\";\r\n    } else if (lastClick && lastClick.time > now - 400 && cmp(lastClick.pos, start) == 0) {\r\n      type = \"double\";\r\n      lastDoubleClick = {time: now, pos: start};\r\n    } else {\r\n      type = \"single\";\r\n      lastClick = {time: now, pos: start};\r\n    }\r\n\r\n    var sel = cm.doc.sel, modifier = mac ? e.metaKey : e.ctrlKey, contained;\r\n    if (cm.options.dragDrop && dragAndDrop && !cm.isReadOnly() &&\r\n        type == \"single\" && (contained = sel.contains(start)) > -1 &&\r\n        (cmp((contained = sel.ranges[contained]).from(), start) < 0 || start.xRel > 0) &&\r\n        (cmp(contained.to(), start) > 0 || start.xRel < 0))\r\n      leftButtonStartDrag(cm, e, start, modifier);\r\n    else\r\n      leftButtonSelect(cm, e, start, type, modifier);\r\n  }\r\n\r\n  // Start a text drag. When it ends, see if any dragging actually\r\n  // happen, and treat as a click if it didn't.\r\n  function leftButtonStartDrag(cm, e, start, modifier) {\r\n    var display = cm.display, startTime = +new Date;\r\n    var dragEnd = operation(cm, function(e2) {\r\n      if (webkit) display.scroller.draggable = false;\r\n      cm.state.draggingText = false;\r\n      off(document, \"mouseup\", dragEnd);\r\n      off(display.scroller, \"drop\", dragEnd);\r\n      if (Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) < 10) {\r\n        e_preventDefault(e2);\r\n        if (!modifier && +new Date - 200 < startTime)\r\n          extendSelection(cm.doc, start);\r\n        // Work around unexplainable focus problem in IE9 (#2127) and Chrome (#3081)\r\n        if (webkit || ie && ie_version == 9)\r\n          setTimeout(function() {document.body.focus(); display.input.focus();}, 20);\r\n        else\r\n          display.input.focus();\r\n      }\r\n    });\r\n    // Let the drag handler handle this.\r\n    if (webkit) display.scroller.draggable = true;\r\n    cm.state.draggingText = dragEnd;\r\n    dragEnd.copy = mac ? e.altKey : e.ctrlKey\r\n    // IE's approach to draggable\r\n    if (display.scroller.dragDrop) display.scroller.dragDrop();\r\n    on(document, \"mouseup\", dragEnd);\r\n    on(display.scroller, \"drop\", dragEnd);\r\n  }\r\n\r\n  // Normal selection, as opposed to text dragging.\r\n  function leftButtonSelect(cm, e, start, type, addNew) {\r\n    var display = cm.display, doc = cm.doc;\r\n    e_preventDefault(e);\r\n\r\n    var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;\r\n    if (addNew && !e.shiftKey) {\r\n      ourIndex = doc.sel.contains(start);\r\n      if (ourIndex > -1)\r\n        ourRange = ranges[ourIndex];\r\n      else\r\n        ourRange = new Range(start, start);\r\n    } else {\r\n      ourRange = doc.sel.primary();\r\n      ourIndex = doc.sel.primIndex;\r\n    }\r\n\r\n    if (chromeOS ? e.shiftKey && e.metaKey : e.altKey) {\r\n      type = \"rect\";\r\n      if (!addNew) ourRange = new Range(start, start);\r\n      start = posFromMouse(cm, e, true, true);\r\n      ourIndex = -1;\r\n    } else if (type == \"double\") {\r\n      var word = cm.findWordAt(start);\r\n      if (cm.display.shift || doc.extend)\r\n        ourRange = extendRange(doc, ourRange, word.anchor, word.head);\r\n      else\r\n        ourRange = word;\r\n    } else if (type == \"triple\") {\r\n      var line = new Range(Pos(start.line, 0), clipPos(doc, Pos(start.line + 1, 0)));\r\n      if (cm.display.shift || doc.extend)\r\n        ourRange = extendRange(doc, ourRange, line.anchor, line.head);\r\n      else\r\n        ourRange = line;\r\n    } else {\r\n      ourRange = extendRange(doc, ourRange, start);\r\n    }\r\n\r\n    if (!addNew) {\r\n      ourIndex = 0;\r\n      setSelection(doc, new Selection([ourRange], 0), sel_mouse);\r\n      startSel = doc.sel;\r\n    } else if (ourIndex == -1) {\r\n      ourIndex = ranges.length;\r\n      setSelection(doc, normalizeSelection(ranges.concat([ourRange]), ourIndex),\r\n                   {scroll: false, origin: \"*mouse\"});\r\n    } else if (ranges.length > 1 && ranges[ourIndex].empty() && type == \"single\" && !e.shiftKey) {\r\n      setSelection(doc, normalizeSelection(ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),\r\n                   {scroll: false, origin: \"*mouse\"});\r\n      startSel = doc.sel;\r\n    } else {\r\n      replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);\r\n    }\r\n\r\n    var lastPos = start;\r\n    function extendTo(pos) {\r\n      if (cmp(lastPos, pos) == 0) return;\r\n      lastPos = pos;\r\n\r\n      if (type == \"rect\") {\r\n        var ranges = [], tabSize = cm.options.tabSize;\r\n        var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);\r\n        var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);\r\n        var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);\r\n        for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));\r\n             line <= end; line++) {\r\n          var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);\r\n          if (left == right)\r\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos)));\r\n          else if (text.length > leftPos)\r\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize))));\r\n        }\r\n        if (!ranges.length) ranges.push(new Range(start, start));\r\n        setSelection(doc, normalizeSelection(startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),\r\n                     {origin: \"*mouse\", scroll: false});\r\n        cm.scrollIntoView(pos);\r\n      } else {\r\n        var oldRange = ourRange;\r\n        var anchor = oldRange.anchor, head = pos;\r\n        if (type != \"single\") {\r\n          if (type == \"double\")\r\n            var range = cm.findWordAt(pos);\r\n          else\r\n            var range = new Range(Pos(pos.line, 0), clipPos(doc, Pos(pos.line + 1, 0)));\r\n          if (cmp(range.anchor, anchor) > 0) {\r\n            head = range.head;\r\n            anchor = minPos(oldRange.from(), range.anchor);\r\n          } else {\r\n            head = range.anchor;\r\n            anchor = maxPos(oldRange.to(), range.head);\r\n          }\r\n        }\r\n        var ranges = startSel.ranges.slice(0);\r\n        ranges[ourIndex] = new Range(clipPos(doc, anchor), head);\r\n        setSelection(doc, normalizeSelection(ranges, ourIndex), sel_mouse);\r\n      }\r\n    }\r\n\r\n    var editorSize = display.wrapper.getBoundingClientRect();\r\n    // Used to ensure timeout re-tries don't fire when another extend\r\n    // happened in the meantime (clearTimeout isn't reliable -- at\r\n    // least on Chrome, the timeouts still happen even when cleared,\r\n    // if the clear happens after their scheduled firing time).\r\n    var counter = 0;\r\n\r\n    function extend(e) {\r\n      var curCount = ++counter;\r\n      var cur = posFromMouse(cm, e, true, type == \"rect\");\r\n      if (!cur) return;\r\n      if (cmp(cur, lastPos) != 0) {\r\n        cm.curOp.focus = activeElt();\r\n        extendTo(cur);\r\n        var visible = visibleLines(display, doc);\r\n        if (cur.line >= visible.to || cur.line < visible.from)\r\n          setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);\r\n      } else {\r\n        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\r\n        if (outside) setTimeout(operation(cm, function() {\r\n          if (counter != curCount) return;\r\n          display.scroller.scrollTop += outside;\r\n          extend(e);\r\n        }), 50);\r\n      }\r\n    }\r\n\r\n    function done(e) {\r\n      cm.state.selectingText = false;\r\n      counter = Infinity;\r\n      e_preventDefault(e);\r\n      display.input.focus();\r\n      off(document, \"mousemove\", move);\r\n      off(document, \"mouseup\", up);\r\n      doc.history.lastSelOrigin = null;\r\n    }\r\n\r\n    var move = operation(cm, function(e) {\r\n      if (!e_button(e)) done(e);\r\n      else extend(e);\r\n    });\r\n    var up = operation(cm, done);\r\n    cm.state.selectingText = up;\r\n    on(document, \"mousemove\", move);\r\n    on(document, \"mouseup\", up);\r\n  }\r\n\r\n  // Determines whether an event happened in the gutter, and fires the\r\n  // handlers for the corresponding event.\r\n  function gutterEvent(cm, e, type, prevent) {\r\n    try { var mX = e.clientX, mY = e.clientY; }\r\n    catch(e) { return false; }\r\n    if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) return false;\r\n    if (prevent) e_preventDefault(e);\r\n\r\n    var display = cm.display;\r\n    var lineBox = display.lineDiv.getBoundingClientRect();\r\n\r\n    if (mY > lineBox.bottom || !hasHandler(cm, type)) return e_defaultPrevented(e);\r\n    mY -= lineBox.top - display.viewOffset;\r\n\r\n    for (var i = 0; i < cm.options.gutters.length; ++i) {\r\n      var g = display.gutters.childNodes[i];\r\n      if (g && g.getBoundingClientRect().right >= mX) {\r\n        var line = lineAtHeight(cm.doc, mY);\r\n        var gutter = cm.options.gutters[i];\r\n        signal(cm, type, cm, line, gutter, e);\r\n        return e_defaultPrevented(e);\r\n      }\r\n    }\r\n  }\r\n\r\n  function clickInGutter(cm, e) {\r\n    return gutterEvent(cm, e, \"gutterClick\", true);\r\n  }\r\n\r\n  // Kludge to work around strange IE behavior where it'll sometimes\r\n  // re-fire a series of drag-related events right after the drop (#1551)\r\n  var lastDrop = 0;\r\n\r\n  function onDrop(e) {\r\n    var cm = this;\r\n    clearDragCursor(cm);\r\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))\r\n      return;\r\n    e_preventDefault(e);\r\n    if (ie) lastDrop = +new Date;\r\n    var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\r\n    if (!pos || cm.isReadOnly()) return;\r\n    // Might be a file drop, in which case we simply extract the text\r\n    // and insert it.\r\n    if (files && files.length && window.FileReader && window.File) {\r\n      var n = files.length, text = Array(n), read = 0;\r\n      var loadFile = function(file, i) {\r\n        if (cm.options.allowDropFileTypes &&\r\n            indexOf(cm.options.allowDropFileTypes, file.type) == -1)\r\n          return;\r\n\r\n        var reader = new FileReader;\r\n        reader.onload = operation(cm, function() {\r\n          var content = reader.result;\r\n          if (/[\\x00-\\x08\\x0e-\\x1f]{2}/.test(content)) content = \"\";\r\n          text[i] = content;\r\n          if (++read == n) {\r\n            pos = clipPos(cm.doc, pos);\r\n            var change = {from: pos, to: pos,\r\n                          text: cm.doc.splitLines(text.join(cm.doc.lineSeparator())),\r\n                          origin: \"paste\"};\r\n            makeChange(cm.doc, change);\r\n            setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));\r\n          }\r\n        });\r\n        reader.readAsText(file);\r\n      };\r\n      for (var i = 0; i < n; ++i) loadFile(files[i], i);\r\n    } else { // Normal drop\r\n      // Don't do a replace if the drop happened inside of the selected text.\r\n      if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {\r\n        cm.state.draggingText(e);\r\n        // Ensure the editor is re-focused\r\n        setTimeout(function() {cm.display.input.focus();}, 20);\r\n        return;\r\n      }\r\n      try {\r\n        var text = e.dataTransfer.getData(\"Text\");\r\n        if (text) {\r\n          if (cm.state.draggingText && !cm.state.draggingText.copy)\r\n            var selected = cm.listSelections();\r\n          setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));\r\n          if (selected) for (var i = 0; i < selected.length; ++i)\r\n            replaceRange(cm.doc, \"\", selected[i].anchor, selected[i].head, \"drag\");\r\n          cm.replaceSelection(text, \"around\", \"paste\");\r\n          cm.display.input.focus();\r\n        }\r\n      }\r\n      catch(e){}\r\n    }\r\n  }\r\n\r\n  function onDragStart(cm, e) {\r\n    if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return; }\r\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) return;\r\n\r\n    e.dataTransfer.setData(\"Text\", cm.getSelection());\r\n    e.dataTransfer.effectAllowed = \"copyMove\"\r\n\r\n    // Use dummy image instead of default browsers image.\r\n    // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.\r\n    if (e.dataTransfer.setDragImage && !safari) {\r\n      var img = elt(\"img\", null, null, \"position: fixed; left: 0; top: 0;\");\r\n      img.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\r\n      if (presto) {\r\n        img.width = img.height = 1;\r\n        cm.display.wrapper.appendChild(img);\r\n        // Force a relayout, or Opera won't use our image for some obscure reason\r\n        img._top = img.offsetTop;\r\n      }\r\n      e.dataTransfer.setDragImage(img, 0, 0);\r\n      if (presto) img.parentNode.removeChild(img);\r\n    }\r\n  }\r\n\r\n  function onDragOver(cm, e) {\r\n    var pos = posFromMouse(cm, e);\r\n    if (!pos) return;\r\n    var frag = document.createDocumentFragment();\r\n    drawSelectionCursor(cm, pos, frag);\r\n    if (!cm.display.dragCursor) {\r\n      cm.display.dragCursor = elt(\"div\", null, \"CodeMirror-cursors CodeMirror-dragcursors\");\r\n      cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);\r\n    }\r\n    removeChildrenAndAdd(cm.display.dragCursor, frag);\r\n  }\r\n\r\n  function clearDragCursor(cm) {\r\n    if (cm.display.dragCursor) {\r\n      cm.display.lineSpace.removeChild(cm.display.dragCursor);\r\n      cm.display.dragCursor = null;\r\n    }\r\n  }\r\n\r\n  // SCROLL EVENTS\r\n\r\n  // Sync the scrollable area and scrollbars, ensure the viewport\r\n  // covers the visible area.\r\n  function setScrollTop(cm, val) {\r\n    if (Math.abs(cm.doc.scrollTop - val) < 2) return;\r\n    cm.doc.scrollTop = val;\r\n    if (!gecko) updateDisplaySimple(cm, {top: val});\r\n    if (cm.display.scroller.scrollTop != val) cm.display.scroller.scrollTop = val;\r\n    cm.display.scrollbars.setScrollTop(val);\r\n    if (gecko) updateDisplaySimple(cm);\r\n    startWorker(cm, 100);\r\n  }\r\n  // Sync scroller and scrollbar, ensure the gutter elements are\r\n  // aligned.\r\n  function setScrollLeft(cm, val, isScroller) {\r\n    if (isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) return;\r\n    val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\r\n    cm.doc.scrollLeft = val;\r\n    alignHorizontally(cm);\r\n    if (cm.display.scroller.scrollLeft != val) cm.display.scroller.scrollLeft = val;\r\n    cm.display.scrollbars.setScrollLeft(val);\r\n  }\r\n\r\n  // Since the delta values reported on mouse wheel events are\r\n  // unstandardized between browsers and even browser versions, and\r\n  // generally horribly unpredictable, this code starts by measuring\r\n  // the scroll effect that the first few mouse wheel events have,\r\n  // and, from that, detects the way it can convert deltas to pixel\r\n  // offsets afterwards.\r\n  //\r\n  // The reason we want to know the amount a wheel event will scroll\r\n  // is that it gives us a chance to update the display before the\r\n  // actual scrolling happens, reducing flickering.\r\n\r\n  var wheelSamples = 0, wheelPixelsPerUnit = null;\r\n  // Fill in a browser-detected starting value on browsers where we\r\n  // know one. These don't have to be accurate -- the result of them\r\n  // being wrong would just be a slight flicker on the first wheel\r\n  // scroll (if it is large enough).\r\n  if (ie) wheelPixelsPerUnit = -.53;\r\n  else if (gecko) wheelPixelsPerUnit = 15;\r\n  else if (chrome) wheelPixelsPerUnit = -.7;\r\n  else if (safari) wheelPixelsPerUnit = -1/3;\r\n\r\n  var wheelEventDelta = function(e) {\r\n    var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\r\n    if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) dx = e.detail;\r\n    if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) dy = e.detail;\r\n    else if (dy == null) dy = e.wheelDelta;\r\n    return {x: dx, y: dy};\r\n  };\r\n  CodeMirror.wheelEventPixels = function(e) {\r\n    var delta = wheelEventDelta(e);\r\n    delta.x *= wheelPixelsPerUnit;\r\n    delta.y *= wheelPixelsPerUnit;\r\n    return delta;\r\n  };\r\n\r\n  function onScrollWheel(cm, e) {\r\n    var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;\r\n\r\n    var display = cm.display, scroll = display.scroller;\r\n    // Quit if there's nothing to scroll here\r\n    var canScrollX = scroll.scrollWidth > scroll.clientWidth;\r\n    var canScrollY = scroll.scrollHeight > scroll.clientHeight;\r\n    if (!(dx && canScrollX || dy && canScrollY)) return;\r\n\r\n    // Webkit browsers on OS X abort momentum scrolls when the target\r\n    // of the scroll event is removed from the scrollable element.\r\n    // This hack (see related code in patchDisplay) makes sure the\r\n    // element is kept around.\r\n    if (dy && mac && webkit) {\r\n      outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {\r\n        for (var i = 0; i < view.length; i++) {\r\n          if (view[i].node == cur) {\r\n            cm.display.currentWheelTarget = cur;\r\n            break outer;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // On some browsers, horizontal scrolling will cause redraws to\r\n    // happen before the gutter has been realigned, causing it to\r\n    // wriggle around in a most unseemly way. When we have an\r\n    // estimated pixels/delta value, we just handle horizontal\r\n    // scrolling entirely here. It'll be slightly off from native, but\r\n    // better than glitching out.\r\n    if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {\r\n      if (dy && canScrollY)\r\n        setScrollTop(cm, Math.max(0, Math.min(scroll.scrollTop + dy * wheelPixelsPerUnit, scroll.scrollHeight - scroll.clientHeight)));\r\n      setScrollLeft(cm, Math.max(0, Math.min(scroll.scrollLeft + dx * wheelPixelsPerUnit, scroll.scrollWidth - scroll.clientWidth)));\r\n      // Only prevent default scrolling if vertical scrolling is\r\n      // actually possible. Otherwise, it causes vertical scroll\r\n      // jitter on OSX trackpads when deltaX is small and deltaY\r\n      // is large (issue #3579)\r\n      if (!dy || (dy && canScrollY))\r\n        e_preventDefault(e);\r\n      display.wheelStartX = null; // Abort measurement, if in progress\r\n      return;\r\n    }\r\n\r\n    // 'Project' the visible viewport to cover the area that is being\r\n    // scrolled into view (if we know enough to estimate it).\r\n    if (dy && wheelPixelsPerUnit != null) {\r\n      var pixels = dy * wheelPixelsPerUnit;\r\n      var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\r\n      if (pixels < 0) top = Math.max(0, top + pixels - 50);\r\n      else bot = Math.min(cm.doc.height, bot + pixels + 50);\r\n      updateDisplaySimple(cm, {top: top, bottom: bot});\r\n    }\r\n\r\n    if (wheelSamples < 20) {\r\n      if (display.wheelStartX == null) {\r\n        display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\r\n        display.wheelDX = dx; display.wheelDY = dy;\r\n        setTimeout(function() {\r\n          if (display.wheelStartX == null) return;\r\n          var movedX = scroll.scrollLeft - display.wheelStartX;\r\n          var movedY = scroll.scrollTop - display.wheelStartY;\r\n          var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\r\n            (movedX && display.wheelDX && movedX / display.wheelDX);\r\n          display.wheelStartX = display.wheelStartY = null;\r\n          if (!sample) return;\r\n          wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\r\n          ++wheelSamples;\r\n        }, 200);\r\n      } else {\r\n        display.wheelDX += dx; display.wheelDY += dy;\r\n      }\r\n    }\r\n  }\r\n\r\n  // KEY EVENTS\r\n\r\n  // Run a handler that was bound to a key.\r\n  function doHandleBinding(cm, bound, dropShift) {\r\n    if (typeof bound == \"string\") {\r\n      bound = commands[bound];\r\n      if (!bound) return false;\r\n    }\r\n    // Ensure previous input has been read, so that the handler sees a\r\n    // consistent view of the document\r\n    cm.display.input.ensurePolled();\r\n    var prevShift = cm.display.shift, done = false;\r\n    try {\r\n      if (cm.isReadOnly()) cm.state.suppressEdits = true;\r\n      if (dropShift) cm.display.shift = false;\r\n      done = bound(cm) != Pass;\r\n    } finally {\r\n      cm.display.shift = prevShift;\r\n      cm.state.suppressEdits = false;\r\n    }\r\n    return done;\r\n  }\r\n\r\n  function lookupKeyForEditor(cm, name, handle) {\r\n    for (var i = 0; i < cm.state.keyMaps.length; i++) {\r\n      var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);\r\n      if (result) return result;\r\n    }\r\n    return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))\r\n      || lookupKey(name, cm.options.keyMap, handle, cm);\r\n  }\r\n\r\n  var stopSeq = new Delayed;\r\n  function dispatchKey(cm, name, e, handle) {\r\n    var seq = cm.state.keySeq;\r\n    if (seq) {\r\n      if (isModifierKey(name)) return \"handled\";\r\n      stopSeq.set(50, function() {\r\n        if (cm.state.keySeq == seq) {\r\n          cm.state.keySeq = null;\r\n          cm.display.input.reset();\r\n        }\r\n      });\r\n      name = seq + \" \" + name;\r\n    }\r\n    var result = lookupKeyForEditor(cm, name, handle);\r\n\r\n    if (result == \"multi\")\r\n      cm.state.keySeq = name;\r\n    if (result == \"handled\")\r\n      signalLater(cm, \"keyHandled\", cm, name, e);\r\n\r\n    if (result == \"handled\" || result == \"multi\") {\r\n      e_preventDefault(e);\r\n      restartBlink(cm);\r\n    }\r\n\r\n    if (seq && !result && /\\'$/.test(name)) {\r\n      e_preventDefault(e);\r\n      return true;\r\n    }\r\n    return !!result;\r\n  }\r\n\r\n  // Handle a key from the keydown event.\r\n  function handleKeyBinding(cm, e) {\r\n    var name = keyName(e, true);\r\n    if (!name) return false;\r\n\r\n    if (e.shiftKey && !cm.state.keySeq) {\r\n      // First try to resolve full name (including 'Shift-'). Failing\r\n      // that, see if there is a cursor-motion command (starting with\r\n      // 'go') bound to the keyname without 'Shift-'.\r\n      return dispatchKey(cm, \"Shift-\" + name, e, function(b) {return doHandleBinding(cm, b, true);})\r\n          || dispatchKey(cm, name, e, function(b) {\r\n               if (typeof b == \"string\" ? /^go[A-Z]/.test(b) : b.motion)\r\n                 return doHandleBinding(cm, b);\r\n             });\r\n    } else {\r\n      return dispatchKey(cm, name, e, function(b) { return doHandleBinding(cm, b); });\r\n    }\r\n  }\r\n\r\n  // Handle a key from the keypress event\r\n  function handleCharBinding(cm, e, ch) {\r\n    return dispatchKey(cm, \"'\" + ch + \"'\", e,\r\n                       function(b) { return doHandleBinding(cm, b, true); });\r\n  }\r\n\r\n  var lastStoppedKey = null;\r\n  function onKeyDown(e) {\r\n    var cm = this;\r\n    cm.curOp.focus = activeElt();\r\n    if (signalDOMEvent(cm, e)) return;\r\n    // IE does strange things with escape.\r\n    if (ie && ie_version < 11 && e.keyCode == 27) e.returnValue = false;\r\n    var code = e.keyCode;\r\n    cm.display.shift = code == 16 || e.shiftKey;\r\n    var handled = handleKeyBinding(cm, e);\r\n    if (presto) {\r\n      lastStoppedKey = handled ? code : null;\r\n      // Opera has no cut event... we try to at least catch the key combo\r\n      if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\r\n        cm.replaceSelection(\"\", null, \"cut\");\r\n    }\r\n\r\n    // Turn mouse into crosshair when Alt is held on Mac.\r\n    if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))\r\n      showCrossHair(cm);\r\n  }\r\n\r\n  function showCrossHair(cm) {\r\n    var lineDiv = cm.display.lineDiv;\r\n    addClass(lineDiv, \"CodeMirror-crosshair\");\r\n\r\n    function up(e) {\r\n      if (e.keyCode == 18 || !e.altKey) {\r\n        rmClass(lineDiv, \"CodeMirror-crosshair\");\r\n        off(document, \"keyup\", up);\r\n        off(document, \"mouseover\", up);\r\n      }\r\n    }\r\n    on(document, \"keyup\", up);\r\n    on(document, \"mouseover\", up);\r\n  }\r\n\r\n  function onKeyUp(e) {\r\n    if (e.keyCode == 16) this.doc.sel.shift = false;\r\n    signalDOMEvent(this, e);\r\n  }\r\n\r\n  function onKeyPress(e) {\r\n    var cm = this;\r\n    if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) return;\r\n    var keyCode = e.keyCode, charCode = e.charCode;\r\n    if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return;}\r\n    if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) return;\r\n    var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\r\n    if (handleCharBinding(cm, e, ch)) return;\r\n    cm.display.input.onKeyPress(e);\r\n  }\r\n\r\n  // FOCUS/BLUR EVENTS\r\n\r\n  function delayBlurEvent(cm) {\r\n    cm.state.delayingBlurEvent = true;\r\n    setTimeout(function() {\r\n      if (cm.state.delayingBlurEvent) {\r\n        cm.state.delayingBlurEvent = false;\r\n        onBlur(cm);\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  function onFocus(cm) {\r\n    if (cm.state.delayingBlurEvent) cm.state.delayingBlurEvent = false;\r\n\r\n    if (cm.options.readOnly == \"nocursor\") return;\r\n    if (!cm.state.focused) {\r\n      signal(cm, \"focus\", cm);\r\n      cm.state.focused = true;\r\n      addClass(cm.display.wrapper, \"CodeMirror-focused\");\r\n      // This test prevents this from firing when a context\r\n      // menu is closed (since the input reset would kill the\r\n      // select-all detection hack)\r\n      if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\r\n        cm.display.input.reset();\r\n        if (webkit) setTimeout(function() { cm.display.input.reset(true); }, 20); // Issue #1730\r\n      }\r\n      cm.display.input.receivedFocus();\r\n    }\r\n    restartBlink(cm);\r\n  }\r\n  function onBlur(cm) {\r\n    if (cm.state.delayingBlurEvent) return;\r\n\r\n    if (cm.state.focused) {\r\n      signal(cm, \"blur\", cm);\r\n      cm.state.focused = false;\r\n      rmClass(cm.display.wrapper, \"CodeMirror-focused\");\r\n    }\r\n    clearInterval(cm.display.blinker);\r\n    setTimeout(function() {if (!cm.state.focused) cm.display.shift = false;}, 150);\r\n  }\r\n\r\n  // CONTEXT MENU HANDLING\r\n\r\n  // To make the context menu work, we need to briefly unhide the\r\n  // textarea (making it as unobtrusive as possible) to let the\r\n  // right-click take effect on it.\r\n  function onContextMenu(cm, e) {\r\n    if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) return;\r\n    if (signalDOMEvent(cm, e, \"contextmenu\")) return;\r\n    cm.display.input.onContextMenu(e);\r\n  }\r\n\r\n  function contextMenuInGutter(cm, e) {\r\n    if (!hasHandler(cm, \"gutterContextMenu\")) return false;\r\n    return gutterEvent(cm, e, \"gutterContextMenu\", false);\r\n  }\r\n\r\n  // UPDATING\r\n\r\n  // Compute the position of the end of a change (its 'to' property\r\n  // refers to the pre-change end).\r\n  var changeEnd = CodeMirror.changeEnd = function(change) {\r\n    if (!change.text) return change.to;\r\n    return Pos(change.from.line + change.text.length - 1,\r\n               lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0));\r\n  };\r\n\r\n  // Adjust a position to refer to the post-change position of the\r\n  // same text, or the end of the change if the change covers it.\r\n  function adjustForChange(pos, change) {\r\n    if (cmp(pos, change.from) < 0) return pos;\r\n    if (cmp(pos, change.to) <= 0) return changeEnd(change);\r\n\r\n    var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\r\n    if (pos.line == change.to.line) ch += changeEnd(change).ch - change.to.ch;\r\n    return Pos(line, ch);\r\n  }\r\n\r\n  function computeSelAfterChange(doc, change) {\r\n    var out = [];\r\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\r\n      var range = doc.sel.ranges[i];\r\n      out.push(new Range(adjustForChange(range.anchor, change),\r\n                         adjustForChange(range.head, change)));\r\n    }\r\n    return normalizeSelection(out, doc.sel.primIndex);\r\n  }\r\n\r\n  function offsetPos(pos, old, nw) {\r\n    if (pos.line == old.line)\r\n      return Pos(nw.line, pos.ch - old.ch + nw.ch);\r\n    else\r\n      return Pos(nw.line + (pos.line - old.line), pos.ch);\r\n  }\r\n\r\n  // Used by replaceSelections to allow moving the selection to the\r\n  // start or around the replaced test. Hint may be \"start\" or \"around\".\r\n  function computeReplacedSel(doc, changes, hint) {\r\n    var out = [];\r\n    var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;\r\n    for (var i = 0; i < changes.length; i++) {\r\n      var change = changes[i];\r\n      var from = offsetPos(change.from, oldPrev, newPrev);\r\n      var to = offsetPos(changeEnd(change), oldPrev, newPrev);\r\n      oldPrev = change.to;\r\n      newPrev = to;\r\n      if (hint == \"around\") {\r\n        var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;\r\n        out[i] = new Range(inv ? to : from, inv ? from : to);\r\n      } else {\r\n        out[i] = new Range(from, from);\r\n      }\r\n    }\r\n    return new Selection(out, doc.sel.primIndex);\r\n  }\r\n\r\n  // Allow \"beforeChange\" event handlers to influence a change\r\n  function filterChange(doc, change, update) {\r\n    var obj = {\r\n      canceled: false,\r\n      from: change.from,\r\n      to: change.to,\r\n      text: change.text,\r\n      origin: change.origin,\r\n      cancel: function() { this.canceled = true; }\r\n    };\r\n    if (update) obj.update = function(from, to, text, origin) {\r\n      if (from) this.from = clipPos(doc, from);\r\n      if (to) this.to = clipPos(doc, to);\r\n      if (text) this.text = text;\r\n      if (origin !== undefined) this.origin = origin;\r\n    };\r\n    signal(doc, \"beforeChange\", doc, obj);\r\n    if (doc.cm) signal(doc.cm, \"beforeChange\", doc.cm, obj);\r\n\r\n    if (obj.canceled) return null;\r\n    return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};\r\n  }\r\n\r\n  // Apply a change to a document, and add it to the document's\r\n  // history, and propagating it to all linked documents.\r\n  function makeChange(doc, change, ignoreReadOnly) {\r\n    if (doc.cm) {\r\n      if (!doc.cm.curOp) return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly);\r\n      if (doc.cm.state.suppressEdits) return;\r\n    }\r\n\r\n    if (hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\")) {\r\n      change = filterChange(doc, change, true);\r\n      if (!change) return;\r\n    }\r\n\r\n    // Possibly split or suppress the update based on the presence\r\n    // of read-only spans in its range.\r\n    var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\r\n    if (split) {\r\n      for (var i = split.length - 1; i >= 0; --i)\r\n        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text});\r\n    } else {\r\n      makeChangeInner(doc, change);\r\n    }\r\n  }\r\n\r\n  function makeChangeInner(doc, change) {\r\n    if (change.text.length == 1 && change.text[0] == \"\" && cmp(change.from, change.to) == 0) return;\r\n    var selAfter = computeSelAfterChange(doc, change);\r\n    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\r\n\r\n    makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\r\n    var rebased = [];\r\n\r\n    linkedDocs(doc, function(doc, sharedHist) {\r\n      if (!sharedHist && indexOf(rebased, doc.history) == -1) {\r\n        rebaseHist(doc.history, change);\r\n        rebased.push(doc.history);\r\n      }\r\n      makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\r\n    });\r\n  }\r\n\r\n  // Revert a change stored in a document's history.\r\n  function makeChangeFromHistory(doc, type, allowSelectionOnly) {\r\n    if (doc.cm && doc.cm.state.suppressEdits && !allowSelectionOnly) return;\r\n\r\n    var hist = doc.history, event, selAfter = doc.sel;\r\n    var source = type == \"undo\" ? hist.done : hist.undone, dest = type == \"undo\" ? hist.undone : hist.done;\r\n\r\n    // Verify that there is a useable event (so that ctrl-z won't\r\n    // needlessly clear selection events)\r\n    for (var i = 0; i < source.length; i++) {\r\n      event = source[i];\r\n      if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)\r\n        break;\r\n    }\r\n    if (i == source.length) return;\r\n    hist.lastOrigin = hist.lastSelOrigin = null;\r\n\r\n    for (;;) {\r\n      event = source.pop();\r\n      if (event.ranges) {\r\n        pushSelectionToHistory(event, dest);\r\n        if (allowSelectionOnly && !event.equals(doc.sel)) {\r\n          setSelection(doc, event, {clearRedo: false});\r\n          return;\r\n        }\r\n        selAfter = event;\r\n      }\r\n      else break;\r\n    }\r\n\r\n    // Build up a reverse change object to add to the opposite history\r\n    // stack (redo when undoing, and vice versa).\r\n    var antiChanges = [];\r\n    pushSelectionToHistory(selAfter, dest);\r\n    dest.push({changes: antiChanges, generation: hist.generation});\r\n    hist.generation = event.generation || ++hist.maxGeneration;\r\n\r\n    var filter = hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\");\r\n\r\n    for (var i = event.changes.length - 1; i >= 0; --i) {\r\n      var change = event.changes[i];\r\n      change.origin = type;\r\n      if (filter && !filterChange(doc, change, false)) {\r\n        source.length = 0;\r\n        return;\r\n      }\r\n\r\n      antiChanges.push(historyChangeFromChange(doc, change));\r\n\r\n      var after = i ? computeSelAfterChange(doc, change) : lst(source);\r\n      makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\r\n      if (!i && doc.cm) doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)});\r\n      var rebased = [];\r\n\r\n      // Propagate to the linked documents\r\n      linkedDocs(doc, function(doc, sharedHist) {\r\n        if (!sharedHist && indexOf(rebased, doc.history) == -1) {\r\n          rebaseHist(doc.history, change);\r\n          rebased.push(doc.history);\r\n        }\r\n        makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\r\n      });\r\n    }\r\n  }\r\n\r\n  // Sub-views need their line numbers shifted when text is added\r\n  // above or below them in the parent document.\r\n  function shiftDoc(doc, distance) {\r\n    if (distance == 0) return;\r\n    doc.first += distance;\r\n    doc.sel = new Selection(map(doc.sel.ranges, function(range) {\r\n      return new Range(Pos(range.anchor.line + distance, range.anchor.ch),\r\n                       Pos(range.head.line + distance, range.head.ch));\r\n    }), doc.sel.primIndex);\r\n    if (doc.cm) {\r\n      regChange(doc.cm, doc.first, doc.first - distance, distance);\r\n      for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)\r\n        regLineChange(doc.cm, l, \"gutter\");\r\n    }\r\n  }\r\n\r\n  // More lower-level change function, handling only a single document\r\n  // (not linked ones).\r\n  function makeChangeSingleDoc(doc, change, selAfter, spans) {\r\n    if (doc.cm && !doc.cm.curOp)\r\n      return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans);\r\n\r\n    if (change.to.line < doc.first) {\r\n      shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\r\n      return;\r\n    }\r\n    if (change.from.line > doc.lastLine()) return;\r\n\r\n    // Clip the change to the size of this doc\r\n    if (change.from.line < doc.first) {\r\n      var shift = change.text.length - 1 - (doc.first - change.from.line);\r\n      shiftDoc(doc, shift);\r\n      change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\r\n                text: [lst(change.text)], origin: change.origin};\r\n    }\r\n    var last = doc.lastLine();\r\n    if (change.to.line > last) {\r\n      change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\r\n                text: [change.text[0]], origin: change.origin};\r\n    }\r\n\r\n    change.removed = getBetween(doc, change.from, change.to);\r\n\r\n    if (!selAfter) selAfter = computeSelAfterChange(doc, change);\r\n    if (doc.cm) makeChangeSingleDocInEditor(doc.cm, change, spans);\r\n    else updateDoc(doc, change, spans);\r\n    setSelectionNoUndo(doc, selAfter, sel_dontScroll);\r\n  }\r\n\r\n  // Handle the interaction of a change to a document with the editor\r\n  // that this document is part of.\r\n  function makeChangeSingleDocInEditor(cm, change, spans) {\r\n    var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\r\n\r\n    var recomputeMaxLength = false, checkWidthStart = from.line;\r\n    if (!cm.options.lineWrapping) {\r\n      checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));\r\n      doc.iter(checkWidthStart, to.line + 1, function(line) {\r\n        if (line == display.maxLine) {\r\n          recomputeMaxLength = true;\r\n          return true;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (doc.sel.contains(change.from, change.to) > -1)\r\n      signalCursorActivity(cm);\r\n\r\n    updateDoc(doc, change, spans, estimateHeight(cm));\r\n\r\n    if (!cm.options.lineWrapping) {\r\n      doc.iter(checkWidthStart, from.line + change.text.length, function(line) {\r\n        var len = lineLength(line);\r\n        if (len > display.maxLineLength) {\r\n          display.maxLine = line;\r\n          display.maxLineLength = len;\r\n          display.maxLineChanged = true;\r\n          recomputeMaxLength = false;\r\n        }\r\n      });\r\n      if (recomputeMaxLength) cm.curOp.updateMaxLine = true;\r\n    }\r\n\r\n    // Adjust frontier, schedule worker\r\n    doc.frontier = Math.min(doc.frontier, from.line);\r\n    startWorker(cm, 400);\r\n\r\n    var lendiff = change.text.length - (to.line - from.line) - 1;\r\n    // Remember that these lines changed, for updating the display\r\n    if (change.full)\r\n      regChange(cm);\r\n    else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))\r\n      regLineChange(cm, from.line, \"text\");\r\n    else\r\n      regChange(cm, from.line, to.line + 1, lendiff);\r\n\r\n    var changesHandler = hasHandler(cm, \"changes\"), changeHandler = hasHandler(cm, \"change\");\r\n    if (changeHandler || changesHandler) {\r\n      var obj = {\r\n        from: from, to: to,\r\n        text: change.text,\r\n        removed: change.removed,\r\n        origin: change.origin\r\n      };\r\n      if (changeHandler) signalLater(cm, \"change\", cm, obj);\r\n      if (changesHandler) (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj);\r\n    }\r\n    cm.display.selForContextMenu = null;\r\n  }\r\n\r\n  function replaceRange(doc, code, from, to, origin) {\r\n    if (!to) to = from;\r\n    if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }\r\n    if (typeof code == \"string\") code = doc.splitLines(code);\r\n    makeChange(doc, {from: from, to: to, text: code, origin: origin});\r\n  }\r\n\r\n  // SCROLLING THINGS INTO VIEW\r\n\r\n  // If an editor sits on the top or bottom of the window, partially\r\n  // scrolled out of view, this ensures that the cursor is visible.\r\n  function maybeScrollWindow(cm, coords) {\r\n    if (signalDOMEvent(cm, \"scrollCursorIntoView\")) return;\r\n\r\n    var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;\r\n    if (coords.top + box.top < 0) doScroll = true;\r\n    else if (coords.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) doScroll = false;\r\n    if (doScroll != null && !phantom) {\r\n      var scrollNode = elt(\"div\", \"\\u200b\", null, \"position: absolute; top: \" +\r\n                           (coords.top - display.viewOffset - paddingTop(cm.display)) + \"px; height: \" +\r\n                           (coords.bottom - coords.top + scrollGap(cm) + display.barHeight) + \"px; left: \" +\r\n                           coords.left + \"px; width: 2px;\");\r\n      cm.display.lineSpace.appendChild(scrollNode);\r\n      scrollNode.scrollIntoView(doScroll);\r\n      cm.display.lineSpace.removeChild(scrollNode);\r\n    }\r\n  }\r\n\r\n  // Scroll a given position into view (immediately), verifying that\r\n  // it actually became visible (as line heights are accurately\r\n  // measured, the position of something may 'drift' during drawing).\r\n  function scrollPosIntoView(cm, pos, end, margin) {\r\n    if (margin == null) margin = 0;\r\n    for (var limit = 0; limit < 5; limit++) {\r\n      var changed = false, coords = cursorCoords(cm, pos);\r\n      var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\r\n      var scrollPos = calculateScrollPos(cm, Math.min(coords.left, endCoords.left),\r\n                                         Math.min(coords.top, endCoords.top) - margin,\r\n                                         Math.max(coords.left, endCoords.left),\r\n                                         Math.max(coords.bottom, endCoords.bottom) + margin);\r\n      var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\r\n      if (scrollPos.scrollTop != null) {\r\n        setScrollTop(cm, scrollPos.scrollTop);\r\n        if (Math.abs(cm.doc.scrollTop - startTop) > 1) changed = true;\r\n      }\r\n      if (scrollPos.scrollLeft != null) {\r\n        setScrollLeft(cm, scrollPos.scrollLeft);\r\n        if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;\r\n      }\r\n      if (!changed) break;\r\n    }\r\n    return coords;\r\n  }\r\n\r\n  // Scroll a given set of coordinates into view (immediately).\r\n  function scrollIntoView(cm, x1, y1, x2, y2) {\r\n    var scrollPos = calculateScrollPos(cm, x1, y1, x2, y2);\r\n    if (scrollPos.scrollTop != null) setScrollTop(cm, scrollPos.scrollTop);\r\n    if (scrollPos.scrollLeft != null) setScrollLeft(cm, scrollPos.scrollLeft);\r\n  }\r\n\r\n  // Calculate a new scroll position needed to scroll the given\r\n  // rectangle into view. Returns an object with scrollTop and\r\n  // scrollLeft properties. When these are undefined, the\r\n  // vertical/horizontal position does not need to be adjusted.\r\n  function calculateScrollPos(cm, x1, y1, x2, y2) {\r\n    var display = cm.display, snapMargin = textHeight(cm.display);\r\n    if (y1 < 0) y1 = 0;\r\n    var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;\r\n    var screen = displayHeight(cm), result = {};\r\n    if (y2 - y1 > screen) y2 = y1 + screen;\r\n    var docBottom = cm.doc.height + paddingVert(display);\r\n    var atTop = y1 < snapMargin, atBottom = y2 > docBottom - snapMargin;\r\n    if (y1 < screentop) {\r\n      result.scrollTop = atTop ? 0 : y1;\r\n    } else if (y2 > screentop + screen) {\r\n      var newTop = Math.min(y1, (atBottom ? docBottom : y2) - screen);\r\n      if (newTop != screentop) result.scrollTop = newTop;\r\n    }\r\n\r\n    var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;\r\n    var screenw = displayWidth(cm) - (cm.options.fixedGutter ? display.gutters.offsetWidth : 0);\r\n    var tooWide = x2 - x1 > screenw;\r\n    if (tooWide) x2 = x1 + screenw;\r\n    if (x1 < 10)\r\n      result.scrollLeft = 0;\r\n    else if (x1 < screenleft)\r\n      result.scrollLeft = Math.max(0, x1 - (tooWide ? 0 : 10));\r\n    else if (x2 > screenw + screenleft - 3)\r\n      result.scrollLeft = x2 + (tooWide ? 0 : 10) - screenw;\r\n    return result;\r\n  }\r\n\r\n  // Store a relative adjustment to the scroll position in the current\r\n  // operation (to be applied when the operation finishes).\r\n  function addToScrollPos(cm, left, top) {\r\n    if (left != null || top != null) resolveScrollToPos(cm);\r\n    if (left != null)\r\n      cm.curOp.scrollLeft = (cm.curOp.scrollLeft == null ? cm.doc.scrollLeft : cm.curOp.scrollLeft) + left;\r\n    if (top != null)\r\n      cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;\r\n  }\r\n\r\n  // Make sure that at the end of the operation the current cursor is\r\n  // shown.\r\n  function ensureCursorVisible(cm) {\r\n    resolveScrollToPos(cm);\r\n    var cur = cm.getCursor(), from = cur, to = cur;\r\n    if (!cm.options.lineWrapping) {\r\n      from = cur.ch ? Pos(cur.line, cur.ch - 1) : cur;\r\n      to = Pos(cur.line, cur.ch + 1);\r\n    }\r\n    cm.curOp.scrollToPos = {from: from, to: to, margin: cm.options.cursorScrollMargin, isCursor: true};\r\n  }\r\n\r\n  // When an operation has its scrollToPos property set, and another\r\n  // scroll action is applied before the end of the operation, this\r\n  // 'simulates' scrolling that position into view in a cheap way, so\r\n  // that the effect of intermediate scroll commands is not ignored.\r\n  function resolveScrollToPos(cm) {\r\n    var range = cm.curOp.scrollToPos;\r\n    if (range) {\r\n      cm.curOp.scrollToPos = null;\r\n      var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);\r\n      var sPos = calculateScrollPos(cm, Math.min(from.left, to.left),\r\n                                    Math.min(from.top, to.top) - range.margin,\r\n                                    Math.max(from.right, to.right),\r\n                                    Math.max(from.bottom, to.bottom) + range.margin);\r\n      cm.scrollTo(sPos.scrollLeft, sPos.scrollTop);\r\n    }\r\n  }\r\n\r\n  // API UTILITIES\r\n\r\n  // Indent the given line. The how parameter can be \"smart\",\r\n  // \"add\"/null, \"subtract\", or \"prev\". When aggressive is false\r\n  // (typically set to true for forced single-line indents), empty\r\n  // lines are not indented, and places where the mode returns Pass\r\n  // are left alone.\r\n  function indentLine(cm, n, how, aggressive) {\r\n    var doc = cm.doc, state;\r\n    if (how == null) how = \"add\";\r\n    if (how == \"smart\") {\r\n      // Fall back to \"prev\" when the mode doesn't have an indentation\r\n      // method.\r\n      if (!doc.mode.indent) how = \"prev\";\r\n      else state = getStateBefore(cm, n);\r\n    }\r\n\r\n    var tabSize = cm.options.tabSize;\r\n    var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\r\n    if (line.stateAfter) line.stateAfter = null;\r\n    var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\r\n    if (!aggressive && !/\\S/.test(line.text)) {\r\n      indentation = 0;\r\n      how = \"not\";\r\n    } else if (how == \"smart\") {\r\n      indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\r\n      if (indentation == Pass || indentation > 150) {\r\n        if (!aggressive) return;\r\n        how = \"prev\";\r\n      }\r\n    }\r\n    if (how == \"prev\") {\r\n      if (n > doc.first) indentation = countColumn(getLine(doc, n-1).text, null, tabSize);\r\n      else indentation = 0;\r\n    } else if (how == \"add\") {\r\n      indentation = curSpace + cm.options.indentUnit;\r\n    } else if (how == \"subtract\") {\r\n      indentation = curSpace - cm.options.indentUnit;\r\n    } else if (typeof how == \"number\") {\r\n      indentation = curSpace + how;\r\n    }\r\n    indentation = Math.max(0, indentation);\r\n\r\n    var indentString = \"\", pos = 0;\r\n    if (cm.options.indentWithTabs)\r\n      for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += \"\\t\";}\r\n    if (pos < indentation) indentString += spaceStr(indentation - pos);\r\n\r\n    if (indentString != curSpaceString) {\r\n      replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), \"+input\");\r\n      line.stateAfter = null;\r\n      return true;\r\n    } else {\r\n      // Ensure that, if the cursor was in the whitespace at the start\r\n      // of the line, it is moved to the end of that space.\r\n      for (var i = 0; i < doc.sel.ranges.length; i++) {\r\n        var range = doc.sel.ranges[i];\r\n        if (range.head.line == n && range.head.ch < curSpaceString.length) {\r\n          var pos = Pos(n, curSpaceString.length);\r\n          replaceOneSelection(doc, i, new Range(pos, pos));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Utility for applying a change to a line by handle or number,\r\n  // returning the number and optionally registering the line as\r\n  // changed.\r\n  function changeLine(doc, handle, changeType, op) {\r\n    var no = handle, line = handle;\r\n    if (typeof handle == \"number\") line = getLine(doc, clipLine(doc, handle));\r\n    else no = lineNo(handle);\r\n    if (no == null) return null;\r\n    if (op(line, no) && doc.cm) regLineChange(doc.cm, no, changeType);\r\n    return line;\r\n  }\r\n\r\n  // Helper for deleting text near the selection(s), used to implement\r\n  // backspace, delete, and similar functionality.\r\n  function deleteNearSelection(cm, compute) {\r\n    var ranges = cm.doc.sel.ranges, kill = [];\r\n    // Build up a set of ranges to kill first, merging overlapping\r\n    // ranges.\r\n    for (var i = 0; i < ranges.length; i++) {\r\n      var toKill = compute(ranges[i]);\r\n      while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {\r\n        var replaced = kill.pop();\r\n        if (cmp(replaced.from, toKill.from) < 0) {\r\n          toKill.from = replaced.from;\r\n          break;\r\n        }\r\n      }\r\n      kill.push(toKill);\r\n    }\r\n    // Next, remove those actual ranges.\r\n    runInOp(cm, function() {\r\n      for (var i = kill.length - 1; i >= 0; i--)\r\n        replaceRange(cm.doc, \"\", kill[i].from, kill[i].to, \"+delete\");\r\n      ensureCursorVisible(cm);\r\n    });\r\n  }\r\n\r\n  // Used for horizontal relative motion. Dir is -1 or 1 (left or\r\n  // right), unit can be \"char\", \"column\" (like char, but doesn't\r\n  // cross line boundaries), \"word\" (across next word), or \"group\" (to\r\n  // the start of next group of word or non-word-non-whitespace\r\n  // chars). The visually param controls whether, in right-to-left\r\n  // text, direction 1 means to move towards the next index in the\r\n  // string, or towards the character to the right of the current\r\n  // position. The resulting position will have a hitSide=true\r\n  // property if it reached the end of the document.\r\n  function findPosH(doc, pos, dir, unit, visually) {\r\n    var line = pos.line, ch = pos.ch, origDir = dir;\r\n    var lineObj = getLine(doc, line);\r\n    function findNextLine() {\r\n      var l = line + dir;\r\n      if (l < doc.first || l >= doc.first + doc.size) return false\r\n      line = l;\r\n      return lineObj = getLine(doc, l);\r\n    }\r\n    function moveOnce(boundToLine) {\r\n      var next = (visually ? moveVisually : moveLogically)(lineObj, ch, dir, true);\r\n      if (next == null) {\r\n        if (!boundToLine && findNextLine()) {\r\n          if (visually) ch = (dir < 0 ? lineRight : lineLeft)(lineObj);\r\n          else ch = dir < 0 ? lineObj.text.length : 0;\r\n        } else return false\r\n      } else ch = next;\r\n      return true;\r\n    }\r\n\r\n    if (unit == \"char\") {\r\n      moveOnce()\r\n    } else if (unit == \"column\") {\r\n      moveOnce(true)\r\n    } else if (unit == \"word\" || unit == \"group\") {\r\n      var sawType = null, group = unit == \"group\";\r\n      var helper = doc.cm && doc.cm.getHelper(pos, \"wordChars\");\r\n      for (var first = true;; first = false) {\r\n        if (dir < 0 && !moveOnce(!first)) break;\r\n        var cur = lineObj.text.charAt(ch) || \"\\n\";\r\n        var type = isWordChar(cur, helper) ? \"w\"\r\n          : group && cur == \"\\n\" ? \"n\"\r\n          : !group || /\\s/.test(cur) ? null\r\n          : \"p\";\r\n        if (group && !first && !type) type = \"s\";\r\n        if (sawType && sawType != type) {\r\n          if (dir < 0) {dir = 1; moveOnce();}\r\n          break;\r\n        }\r\n\r\n        if (type) sawType = type;\r\n        if (dir > 0 && !moveOnce(!first)) break;\r\n      }\r\n    }\r\n    var result = skipAtomic(doc, Pos(line, ch), pos, origDir, true);\r\n    if (!cmp(pos, result)) result.hitSide = true;\r\n    return result;\r\n  }\r\n\r\n  // For relative vertical movement. Dir may be -1 or 1. Unit can be\r\n  // \"page\" or \"line\". The resulting position will have a hitSide=true\r\n  // property if it reached the end of the document.\r\n  function findPosV(cm, pos, dir, unit) {\r\n    var doc = cm.doc, x = pos.left, y;\r\n    if (unit == \"page\") {\r\n      var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\r\n      y = pos.top + dir * (pageSize - (dir < 0 ? 1.5 : .5) * textHeight(cm.display));\r\n    } else if (unit == \"line\") {\r\n      y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\r\n    }\r\n    for (;;) {\r\n      var target = coordsChar(cm, x, y);\r\n      if (!target.outside) break;\r\n      if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break; }\r\n      y += dir * 5;\r\n    }\r\n    return target;\r\n  }\r\n\r\n  // EDITOR METHODS\r\n\r\n  // The publicly visible API. Note that methodOp(f) means\r\n  // 'wrap f in an operation, performed on its `this` parameter'.\r\n\r\n  // This is not the complete set of editor methods. Most of the\r\n  // methods defined on the Doc type are also injected into\r\n  // CodeMirror.prototype, for backwards compatibility and\r\n  // convenience.\r\n\r\n  CodeMirror.prototype = {\r\n    constructor: CodeMirror,\r\n    focus: function(){window.focus(); this.display.input.focus();},\r\n\r\n    setOption: function(option, value) {\r\n      var options = this.options, old = options[option];\r\n      if (options[option] == value && option != \"mode\") return;\r\n      options[option] = value;\r\n      if (optionHandlers.hasOwnProperty(option))\r\n        operation(this, optionHandlers[option])(this, value, old);\r\n    },\r\n\r\n    getOption: function(option) {return this.options[option];},\r\n    getDoc: function() {return this.doc;},\r\n\r\n    addKeyMap: function(map, bottom) {\r\n      this.state.keyMaps[bottom ? \"push\" : \"unshift\"](getKeyMap(map));\r\n    },\r\n    removeKeyMap: function(map) {\r\n      var maps = this.state.keyMaps;\r\n      for (var i = 0; i < maps.length; ++i)\r\n        if (maps[i] == map || maps[i].name == map) {\r\n          maps.splice(i, 1);\r\n          return true;\r\n        }\r\n    },\r\n\r\n    addOverlay: methodOp(function(spec, options) {\r\n      var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\r\n      if (mode.startState) throw new Error(\"Overlays may not be stateful.\");\r\n      insertSorted(this.state.overlays,\r\n                   {mode: mode, modeSpec: spec, opaque: options && options.opaque,\r\n                    priority: (options && options.priority) || 0},\r\n                   function(overlay) { return overlay.priority })\r\n      this.state.modeGen++;\r\n      regChange(this);\r\n    }),\r\n    removeOverlay: methodOp(function(spec) {\r\n      var overlays = this.state.overlays;\r\n      for (var i = 0; i < overlays.length; ++i) {\r\n        var cur = overlays[i].modeSpec;\r\n        if (cur == spec || typeof spec == \"string\" && cur.name == spec) {\r\n          overlays.splice(i, 1);\r\n          this.state.modeGen++;\r\n          regChange(this);\r\n          return;\r\n        }\r\n      }\r\n    }),\r\n\r\n    indentLine: methodOp(function(n, dir, aggressive) {\r\n      if (typeof dir != \"string\" && typeof dir != \"number\") {\r\n        if (dir == null) dir = this.options.smartIndent ? \"smart\" : \"prev\";\r\n        else dir = dir ? \"add\" : \"subtract\";\r\n      }\r\n      if (isLine(this.doc, n)) indentLine(this, n, dir, aggressive);\r\n    }),\r\n    indentSelection: methodOp(function(how) {\r\n      var ranges = this.doc.sel.ranges, end = -1;\r\n      for (var i = 0; i < ranges.length; i++) {\r\n        var range = ranges[i];\r\n        if (!range.empty()) {\r\n          var from = range.from(), to = range.to();\r\n          var start = Math.max(end, from.line);\r\n          end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;\r\n          for (var j = start; j < end; ++j)\r\n            indentLine(this, j, how);\r\n          var newRanges = this.doc.sel.ranges;\r\n          if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)\r\n            replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll);\r\n        } else if (range.head.line > end) {\r\n          indentLine(this, range.head.line, how, true);\r\n          end = range.head.line;\r\n          if (i == this.doc.sel.primIndex) ensureCursorVisible(this);\r\n        }\r\n      }\r\n    }),\r\n\r\n    // Fetch the parser token for a given character. Useful for hacks\r\n    // that want to inspect the mode state (say, for completion).\r\n    getTokenAt: function(pos, precise) {\r\n      return takeToken(this, pos, precise);\r\n    },\r\n\r\n    getLineTokens: function(line, precise) {\r\n      return takeToken(this, Pos(line), precise, true);\r\n    },\r\n\r\n    getTokenTypeAt: function(pos) {\r\n      pos = clipPos(this.doc, pos);\r\n      var styles = getLineStyles(this, getLine(this.doc, pos.line));\r\n      var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\r\n      var type;\r\n      if (ch == 0) type = styles[2];\r\n      else for (;;) {\r\n        var mid = (before + after) >> 1;\r\n        if ((mid ? styles[mid * 2 - 1] : 0) >= ch) after = mid;\r\n        else if (styles[mid * 2 + 1] < ch) before = mid + 1;\r\n        else { type = styles[mid * 2 + 2]; break; }\r\n      }\r\n      var cut = type ? type.indexOf(\"cm-overlay \") : -1;\r\n      return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1);\r\n    },\r\n\r\n    getModeAt: function(pos) {\r\n      var mode = this.doc.mode;\r\n      if (!mode.innerMode) return mode;\r\n      return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode;\r\n    },\r\n\r\n    getHelper: function(pos, type) {\r\n      return this.getHelpers(pos, type)[0];\r\n    },\r\n\r\n    getHelpers: function(pos, type) {\r\n      var found = [];\r\n      if (!helpers.hasOwnProperty(type)) return found;\r\n      var help = helpers[type], mode = this.getModeAt(pos);\r\n      if (typeof mode[type] == \"string\") {\r\n        if (help[mode[type]]) found.push(help[mode[type]]);\r\n      } else if (mode[type]) {\r\n        for (var i = 0; i < mode[type].length; i++) {\r\n          var val = help[mode[type][i]];\r\n          if (val) found.push(val);\r\n        }\r\n      } else if (mode.helperType && help[mode.helperType]) {\r\n        found.push(help[mode.helperType]);\r\n      } else if (help[mode.name]) {\r\n        found.push(help[mode.name]);\r\n      }\r\n      for (var i = 0; i < help._global.length; i++) {\r\n        var cur = help._global[i];\r\n        if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)\r\n          found.push(cur.val);\r\n      }\r\n      return found;\r\n    },\r\n\r\n    getStateAfter: function(line, precise) {\r\n      var doc = this.doc;\r\n      line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\r\n      return getStateBefore(this, line + 1, precise);\r\n    },\r\n\r\n    cursorCoords: function(start, mode) {\r\n      var pos, range = this.doc.sel.primary();\r\n      if (start == null) pos = range.head;\r\n      else if (typeof start == \"object\") pos = clipPos(this.doc, start);\r\n      else pos = start ? range.from() : range.to();\r\n      return cursorCoords(this, pos, mode || \"page\");\r\n    },\r\n\r\n    charCoords: function(pos, mode) {\r\n      return charCoords(this, clipPos(this.doc, pos), mode || \"page\");\r\n    },\r\n\r\n    coordsChar: function(coords, mode) {\r\n      coords = fromCoordSystem(this, coords, mode || \"page\");\r\n      return coordsChar(this, coords.left, coords.top);\r\n    },\r\n\r\n    lineAtHeight: function(height, mode) {\r\n      height = fromCoordSystem(this, {top: height, left: 0}, mode || \"page\").top;\r\n      return lineAtHeight(this.doc, height + this.display.viewOffset);\r\n    },\r\n    heightAtLine: function(line, mode) {\r\n      var end = false, lineObj;\r\n      if (typeof line == \"number\") {\r\n        var last = this.doc.first + this.doc.size - 1;\r\n        if (line < this.doc.first) line = this.doc.first;\r\n        else if (line > last) { line = last; end = true; }\r\n        lineObj = getLine(this.doc, line);\r\n      } else {\r\n        lineObj = line;\r\n      }\r\n      return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || \"page\").top +\r\n        (end ? this.doc.height - heightAtLine(lineObj) : 0);\r\n    },\r\n\r\n    defaultTextHeight: function() { return textHeight(this.display); },\r\n    defaultCharWidth: function() { return charWidth(this.display); },\r\n\r\n    setGutterMarker: methodOp(function(line, gutterID, value) {\r\n      return changeLine(this.doc, line, \"gutter\", function(line) {\r\n        var markers = line.gutterMarkers || (line.gutterMarkers = {});\r\n        markers[gutterID] = value;\r\n        if (!value && isEmpty(markers)) line.gutterMarkers = null;\r\n        return true;\r\n      });\r\n    }),\r\n\r\n    clearGutter: methodOp(function(gutterID) {\r\n      var cm = this, doc = cm.doc, i = doc.first;\r\n      doc.iter(function(line) {\r\n        if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\r\n          line.gutterMarkers[gutterID] = null;\r\n          regLineChange(cm, i, \"gutter\");\r\n          if (isEmpty(line.gutterMarkers)) line.gutterMarkers = null;\r\n        }\r\n        ++i;\r\n      });\r\n    }),\r\n\r\n    lineInfo: function(line) {\r\n      if (typeof line == \"number\") {\r\n        if (!isLine(this.doc, line)) return null;\r\n        var n = line;\r\n        line = getLine(this.doc, line);\r\n        if (!line) return null;\r\n      } else {\r\n        var n = lineNo(line);\r\n        if (n == null) return null;\r\n      }\r\n      return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\r\n              textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\r\n              widgets: line.widgets};\r\n    },\r\n\r\n    getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo};},\r\n\r\n    addWidget: function(pos, node, scroll, vert, horiz) {\r\n      var display = this.display;\r\n      pos = cursorCoords(this, clipPos(this.doc, pos));\r\n      var top = pos.bottom, left = pos.left;\r\n      node.style.position = \"absolute\";\r\n      node.setAttribute(\"cm-ignore-events\", \"true\");\r\n      this.display.input.setUneditable(node);\r\n      display.sizer.appendChild(node);\r\n      if (vert == \"over\") {\r\n        top = pos.top;\r\n      } else if (vert == \"above\" || vert == \"near\") {\r\n        var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\r\n        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\r\n        // Default to positioning above (if specified and possible); otherwise default to positioning below\r\n        if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\r\n          top = pos.top - node.offsetHeight;\r\n        else if (pos.bottom + node.offsetHeight <= vspace)\r\n          top = pos.bottom;\r\n        if (left + node.offsetWidth > hspace)\r\n          left = hspace - node.offsetWidth;\r\n      }\r\n      node.style.top = top + \"px\";\r\n      node.style.left = node.style.right = \"\";\r\n      if (horiz == \"right\") {\r\n        left = display.sizer.clientWidth - node.offsetWidth;\r\n        node.style.right = \"0px\";\r\n      } else {\r\n        if (horiz == \"left\") left = 0;\r\n        else if (horiz == \"middle\") left = (display.sizer.clientWidth - node.offsetWidth) / 2;\r\n        node.style.left = left + \"px\";\r\n      }\r\n      if (scroll)\r\n        scrollIntoView(this, left, top, left + node.offsetWidth, top + node.offsetHeight);\r\n    },\r\n\r\n    triggerOnKeyDown: methodOp(onKeyDown),\r\n    triggerOnKeyPress: methodOp(onKeyPress),\r\n    triggerOnKeyUp: onKeyUp,\r\n\r\n    execCommand: function(cmd) {\r\n      if (commands.hasOwnProperty(cmd))\r\n        return commands[cmd].call(null, this);\r\n    },\r\n\r\n    triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),\r\n\r\n    findPosH: function(from, amount, unit, visually) {\r\n      var dir = 1;\r\n      if (amount < 0) { dir = -1; amount = -amount; }\r\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\r\n        cur = findPosH(this.doc, cur, dir, unit, visually);\r\n        if (cur.hitSide) break;\r\n      }\r\n      return cur;\r\n    },\r\n\r\n    moveH: methodOp(function(dir, unit) {\r\n      var cm = this;\r\n      cm.extendSelectionsBy(function(range) {\r\n        if (cm.display.shift || cm.doc.extend || range.empty())\r\n          return findPosH(cm.doc, range.head, dir, unit, cm.options.rtlMoveVisually);\r\n        else\r\n          return dir < 0 ? range.from() : range.to();\r\n      }, sel_move);\r\n    }),\r\n\r\n    deleteH: methodOp(function(dir, unit) {\r\n      var sel = this.doc.sel, doc = this.doc;\r\n      if (sel.somethingSelected())\r\n        doc.replaceSelection(\"\", null, \"+delete\");\r\n      else\r\n        deleteNearSelection(this, function(range) {\r\n          var other = findPosH(doc, range.head, dir, unit, false);\r\n          return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other};\r\n        });\r\n    }),\r\n\r\n    findPosV: function(from, amount, unit, goalColumn) {\r\n      var dir = 1, x = goalColumn;\r\n      if (amount < 0) { dir = -1; amount = -amount; }\r\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\r\n        var coords = cursorCoords(this, cur, \"div\");\r\n        if (x == null) x = coords.left;\r\n        else coords.left = x;\r\n        cur = findPosV(this, coords, dir, unit);\r\n        if (cur.hitSide) break;\r\n      }\r\n      return cur;\r\n    },\r\n\r\n    moveV: methodOp(function(dir, unit) {\r\n      var cm = this, doc = this.doc, goals = [];\r\n      var collapse = !cm.display.shift && !doc.extend && doc.sel.somethingSelected();\r\n      doc.extendSelectionsBy(function(range) {\r\n        if (collapse)\r\n          return dir < 0 ? range.from() : range.to();\r\n        var headPos = cursorCoords(cm, range.head, \"div\");\r\n        if (range.goalColumn != null) headPos.left = range.goalColumn;\r\n        goals.push(headPos.left);\r\n        var pos = findPosV(cm, headPos, dir, unit);\r\n        if (unit == \"page\" && range == doc.sel.primary())\r\n          addToScrollPos(cm, null, charCoords(cm, pos, \"div\").top - headPos.top);\r\n        return pos;\r\n      }, sel_move);\r\n      if (goals.length) for (var i = 0; i < doc.sel.ranges.length; i++)\r\n        doc.sel.ranges[i].goalColumn = goals[i];\r\n    }),\r\n\r\n    // Find the word at the given position (as returned by coordsChar).\r\n    findWordAt: function(pos) {\r\n      var doc = this.doc, line = getLine(doc, pos.line).text;\r\n      var start = pos.ch, end = pos.ch;\r\n      if (line) {\r\n        var helper = this.getHelper(pos, \"wordChars\");\r\n        if ((pos.xRel < 0 || end == line.length) && start) --start; else ++end;\r\n        var startChar = line.charAt(start);\r\n        var check = isWordChar(startChar, helper)\r\n          ? function(ch) { return isWordChar(ch, helper); }\r\n          : /\\s/.test(startChar) ? function(ch) {return /\\s/.test(ch);}\r\n          : function(ch) {return !/\\s/.test(ch) && !isWordChar(ch);};\r\n        while (start > 0 && check(line.charAt(start - 1))) --start;\r\n        while (end < line.length && check(line.charAt(end))) ++end;\r\n      }\r\n      return new Range(Pos(pos.line, start), Pos(pos.line, end));\r\n    },\r\n\r\n    toggleOverwrite: function(value) {\r\n      if (value != null && value == this.state.overwrite) return;\r\n      if (this.state.overwrite = !this.state.overwrite)\r\n        addClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\r\n      else\r\n        rmClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\r\n\r\n      signal(this, \"overwriteToggle\", this, this.state.overwrite);\r\n    },\r\n    hasFocus: function() { return this.display.input.getField() == activeElt(); },\r\n    isReadOnly: function() { return !!(this.options.readOnly || this.doc.cantEdit); },\r\n\r\n    scrollTo: methodOp(function(x, y) {\r\n      if (x != null || y != null) resolveScrollToPos(this);\r\n      if (x != null) this.curOp.scrollLeft = x;\r\n      if (y != null) this.curOp.scrollTop = y;\r\n    }),\r\n    getScrollInfo: function() {\r\n      var scroller = this.display.scroller;\r\n      return {left: scroller.scrollLeft, top: scroller.scrollTop,\r\n              height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,\r\n              width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,\r\n              clientHeight: displayHeight(this), clientWidth: displayWidth(this)};\r\n    },\r\n\r\n    scrollIntoView: methodOp(function(range, margin) {\r\n      if (range == null) {\r\n        range = {from: this.doc.sel.primary().head, to: null};\r\n        if (margin == null) margin = this.options.cursorScrollMargin;\r\n      } else if (typeof range == \"number\") {\r\n        range = {from: Pos(range, 0), to: null};\r\n      } else if (range.from == null) {\r\n        range = {from: range, to: null};\r\n      }\r\n      if (!range.to) range.to = range.from;\r\n      range.margin = margin || 0;\r\n\r\n      if (range.from.line != null) {\r\n        resolveScrollToPos(this);\r\n        this.curOp.scrollToPos = range;\r\n      } else {\r\n        var sPos = calculateScrollPos(this, Math.min(range.from.left, range.to.left),\r\n                                      Math.min(range.from.top, range.to.top) - range.margin,\r\n                                      Math.max(range.from.right, range.to.right),\r\n                                      Math.max(range.from.bottom, range.to.bottom) + range.margin);\r\n        this.scrollTo(sPos.scrollLeft, sPos.scrollTop);\r\n      }\r\n    }),\r\n\r\n    setSize: methodOp(function(width, height) {\r\n      var cm = this;\r\n      function interpret(val) {\r\n        return typeof val == \"number\" || /^\\d+$/.test(String(val)) ? val + \"px\" : val;\r\n      }\r\n      if (width != null) cm.display.wrapper.style.width = interpret(width);\r\n      if (height != null) cm.display.wrapper.style.height = interpret(height);\r\n      if (cm.options.lineWrapping) clearLineMeasurementCache(this);\r\n      var lineNo = cm.display.viewFrom;\r\n      cm.doc.iter(lineNo, cm.display.viewTo, function(line) {\r\n        if (line.widgets) for (var i = 0; i < line.widgets.length; i++)\r\n          if (line.widgets[i].noHScroll) { regLineChange(cm, lineNo, \"widget\"); break; }\r\n        ++lineNo;\r\n      });\r\n      cm.curOp.forceUpdate = true;\r\n      signal(cm, \"refresh\", this);\r\n    }),\r\n\r\n    operation: function(f){return runInOp(this, f);},\r\n\r\n    refresh: methodOp(function() {\r\n      var oldHeight = this.display.cachedTextHeight;\r\n      regChange(this);\r\n      this.curOp.forceUpdate = true;\r\n      clearCaches(this);\r\n      this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);\r\n      updateGutterSpace(this);\r\n      if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)\r\n        estimateLineHeights(this);\r\n      signal(this, \"refresh\", this);\r\n    }),\r\n\r\n    swapDoc: methodOp(function(doc) {\r\n      var old = this.doc;\r\n      old.cm = null;\r\n      attachDoc(this, doc);\r\n      clearCaches(this);\r\n      this.display.input.reset();\r\n      this.scrollTo(doc.scrollLeft, doc.scrollTop);\r\n      this.curOp.forceScroll = true;\r\n      signalLater(this, \"swapDoc\", this, old);\r\n      return old;\r\n    }),\r\n\r\n    getInputField: function(){return this.display.input.getField();},\r\n    getWrapperElement: function(){return this.display.wrapper;},\r\n    getScrollerElement: function(){return this.display.scroller;},\r\n    getGutterElement: function(){return this.display.gutters;}\r\n  };\r\n  eventMixin(CodeMirror);\r\n\r\n  // OPTION DEFAULTS\r\n\r\n  // The default configuration options.\r\n  var defaults = CodeMirror.defaults = {};\r\n  // Functions to run when options are changed.\r\n  var optionHandlers = CodeMirror.optionHandlers = {};\r\n\r\n  function option(name, deflt, handle, notOnInit) {\r\n    CodeMirror.defaults[name] = deflt;\r\n    if (handle) optionHandlers[name] =\r\n      notOnInit ? function(cm, val, old) {if (old != Init) handle(cm, val, old);} : handle;\r\n  }\r\n\r\n  // Passed to option handlers when there is no old value.\r\n  var Init = CodeMirror.Init = {toString: function(){return \"CodeMirror.Init\";}};\r\n\r\n  // These two are, on init, called from the constructor because they\r\n  // have to be initialized before the editor can start at all.\r\n  option(\"value\", \"\", function(cm, val) {\r\n    cm.setValue(val);\r\n  }, true);\r\n  option(\"mode\", null, function(cm, val) {\r\n    cm.doc.modeOption = val;\r\n    loadMode(cm);\r\n  }, true);\r\n\r\n  option(\"indentUnit\", 2, loadMode, true);\r\n  option(\"indentWithTabs\", false);\r\n  option(\"smartIndent\", true);\r\n  option(\"tabSize\", 4, function(cm) {\r\n    resetModeState(cm);\r\n    clearCaches(cm);\r\n    regChange(cm);\r\n  }, true);\r\n  option(\"lineSeparator\", null, function(cm, val) {\r\n    cm.doc.lineSep = val;\r\n    if (!val) return;\r\n    var newBreaks = [], lineNo = cm.doc.first;\r\n    cm.doc.iter(function(line) {\r\n      for (var pos = 0;;) {\r\n        var found = line.text.indexOf(val, pos);\r\n        if (found == -1) break;\r\n        pos = found + val.length;\r\n        newBreaks.push(Pos(lineNo, found));\r\n      }\r\n      lineNo++;\r\n    });\r\n    for (var i = newBreaks.length - 1; i >= 0; i--)\r\n      replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length))\r\n  });\r\n  option(\"specialChars\", /[\\u0000-\\u001f\\u007f\\u00ad\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, function(cm, val, old) {\r\n    cm.state.specialChars = new RegExp(val.source + (val.test(\"\\t\") ? \"\" : \"|\\t\"), \"g\");\r\n    if (old != CodeMirror.Init) cm.refresh();\r\n  });\r\n  option(\"specialCharPlaceholder\", defaultSpecialCharPlaceholder, function(cm) {cm.refresh();}, true);\r\n  option(\"electricChars\", true);\r\n  option(\"inputStyle\", mobile ? \"contenteditable\" : \"textarea\", function() {\r\n    throw new Error(\"inputStyle can not (yet) be changed in a running editor\"); // FIXME\r\n  }, true);\r\n  option(\"spellcheck\", false, function(cm, val) {\r\n    cm.getInputField().spellcheck = val\r\n  }, true);\r\n  option(\"rtlMoveVisually\", !windows);\r\n  option(\"wholeLineUpdateBefore\", true);\r\n\r\n  option(\"theme\", \"default\", function(cm) {\r\n    themeChanged(cm);\r\n    guttersChanged(cm);\r\n  }, true);\r\n  option(\"keyMap\", \"default\", function(cm, val, old) {\r\n    var next = getKeyMap(val);\r\n    var prev = old != CodeMirror.Init && getKeyMap(old);\r\n    if (prev && prev.detach) prev.detach(cm, next);\r\n    if (next.attach) next.attach(cm, prev || null);\r\n  });\r\n  option(\"extraKeys\", null);\r\n\r\n  option(\"lineWrapping\", false, wrappingChanged, true);\r\n  option(\"gutters\", [], function(cm) {\r\n    setGuttersForLineNumbers(cm.options);\r\n    guttersChanged(cm);\r\n  }, true);\r\n  option(\"fixedGutter\", true, function(cm, val) {\r\n    cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + \"px\" : \"0\";\r\n    cm.refresh();\r\n  }, true);\r\n  option(\"coverGutterNextToScrollbar\", false, function(cm) {updateScrollbars(cm);}, true);\r\n  option(\"scrollbarStyle\", \"native\", function(cm) {\r\n    initScrollbars(cm);\r\n    updateScrollbars(cm);\r\n    cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);\r\n    cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);\r\n  }, true);\r\n  option(\"lineNumbers\", false, function(cm) {\r\n    setGuttersForLineNumbers(cm.options);\r\n    guttersChanged(cm);\r\n  }, true);\r\n  option(\"firstLineNumber\", 1, guttersChanged, true);\r\n  option(\"lineNumberFormatter\", function(integer) {return integer;}, guttersChanged, true);\r\n  option(\"showCursorWhenSelecting\", false, updateSelection, true);\r\n\r\n  option(\"resetSelectionOnContextMenu\", true);\r\n  option(\"lineWiseCopyCut\", true);\r\n\r\n  option(\"readOnly\", false, function(cm, val) {\r\n    if (val == \"nocursor\") {\r\n      onBlur(cm);\r\n      cm.display.input.blur();\r\n      cm.display.disabled = true;\r\n    } else {\r\n      cm.display.disabled = false;\r\n    }\r\n    cm.display.input.readOnlyChanged(val)\r\n  });\r\n  option(\"disableInput\", false, function(cm, val) {if (!val) cm.display.input.reset();}, true);\r\n  option(\"dragDrop\", true, dragDropChanged);\r\n  option(\"allowDropFileTypes\", null);\r\n\r\n  option(\"cursorBlinkRate\", 530);\r\n  option(\"cursorScrollMargin\", 0);\r\n  option(\"cursorHeight\", 1, updateSelection, true);\r\n  option(\"singleCursorHeightPerLine\", true, updateSelection, true);\r\n  option(\"workTime\", 100);\r\n  option(\"workDelay\", 100);\r\n  option(\"flattenSpans\", true, resetModeState, true);\r\n  option(\"addModeClass\", false, resetModeState, true);\r\n  option(\"pollInterval\", 100);\r\n  option(\"undoDepth\", 200, function(cm, val){cm.doc.history.undoDepth = val;});\r\n  option(\"historyEventDelay\", 1250);\r\n  option(\"viewportMargin\", 10, function(cm){cm.refresh();}, true);\r\n  option(\"maxHighlightLength\", 10000, resetModeState, true);\r\n  option(\"moveInputWithCursor\", true, function(cm, val) {\r\n    if (!val) cm.display.input.resetPosition();\r\n  });\r\n\r\n  option(\"tabindex\", null, function(cm, val) {\r\n    cm.display.input.getField().tabIndex = val || \"\";\r\n  });\r\n  option(\"autofocus\", null);\r\n\r\n  // MODE DEFINITION AND QUERYING\r\n\r\n  // Known modes, by name and by MIME\r\n  var modes = CodeMirror.modes = {}, mimeModes = CodeMirror.mimeModes = {};\r\n\r\n  // Extra arguments are stored as the mode's dependencies, which is\r\n  // used by (legacy) mechanisms like loadmode.js to automatically\r\n  // load a mode. (Preferred mechanism is the require/define calls.)\r\n  CodeMirror.defineMode = function(name, mode) {\r\n    if (!CodeMirror.defaults.mode && name != \"null\") CodeMirror.defaults.mode = name;\r\n    if (arguments.length > 2)\r\n      mode.dependencies = Array.prototype.slice.call(arguments, 2);\r\n    modes[name] = mode;\r\n  };\r\n\r\n  CodeMirror.defineMIME = function(mime, spec) {\r\n    mimeModes[mime] = spec;\r\n  };\r\n\r\n  // Given a MIME type, a {name, ...options} config object, or a name\r\n  // string, return a mode config object.\r\n  CodeMirror.resolveMode = function(spec) {\r\n    if (typeof spec == \"string\" && mimeModes.hasOwnProperty(spec)) {\r\n      spec = mimeModes[spec];\r\n    } else if (spec && typeof spec.name == \"string\" && mimeModes.hasOwnProperty(spec.name)) {\r\n      var found = mimeModes[spec.name];\r\n      if (typeof found == \"string\") found = {name: found};\r\n      spec = createObj(found, spec);\r\n      spec.name = found.name;\r\n    } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\r\n      return CodeMirror.resolveMode(\"application/xml\");\r\n    } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+json$/.test(spec)) {\r\n      return CodeMirror.resolveMode(\"application/json\");\r\n    }\r\n    if (typeof spec == \"string\") return {name: spec};\r\n    else return spec || {name: \"null\"};\r\n  };\r\n\r\n  // Given a mode spec (anything that resolveMode accepts), find and\r\n  // initialize an actual mode object.\r\n  CodeMirror.getMode = function(options, spec) {\r\n    var spec = CodeMirror.resolveMode(spec);\r\n    var mfactory = modes[spec.name];\r\n    if (!mfactory) return CodeMirror.getMode(options, \"text/plain\");\r\n    var modeObj = mfactory(options, spec);\r\n    if (modeExtensions.hasOwnProperty(spec.name)) {\r\n      var exts = modeExtensions[spec.name];\r\n      for (var prop in exts) {\r\n        if (!exts.hasOwnProperty(prop)) continue;\r\n        if (modeObj.hasOwnProperty(prop)) modeObj[\"_\" + prop] = modeObj[prop];\r\n        modeObj[prop] = exts[prop];\r\n      }\r\n    }\r\n    modeObj.name = spec.name;\r\n    if (spec.helperType) modeObj.helperType = spec.helperType;\r\n    if (spec.modeProps) for (var prop in spec.modeProps)\r\n      modeObj[prop] = spec.modeProps[prop];\r\n\r\n    return modeObj;\r\n  };\r\n\r\n  // Minimal default mode.\r\n  CodeMirror.defineMode(\"null\", function() {\r\n    return {token: function(stream) {stream.skipToEnd();}};\r\n  });\r\n  CodeMirror.defineMIME(\"text/plain\", \"null\");\r\n\r\n  // This can be used to attach properties to mode objects from\r\n  // outside the actual mode definition.\r\n  var modeExtensions = CodeMirror.modeExtensions = {};\r\n  CodeMirror.extendMode = function(mode, properties) {\r\n    var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\r\n    copyObj(properties, exts);\r\n  };\r\n\r\n  // EXTENSIONS\r\n\r\n  CodeMirror.defineExtension = function(name, func) {\r\n    CodeMirror.prototype[name] = func;\r\n  };\r\n  CodeMirror.defineDocExtension = function(name, func) {\r\n    Doc.prototype[name] = func;\r\n  };\r\n  CodeMirror.defineOption = option;\r\n\r\n  var initHooks = [];\r\n  CodeMirror.defineInitHook = function(f) {initHooks.push(f);};\r\n\r\n  var helpers = CodeMirror.helpers = {};\r\n  CodeMirror.registerHelper = function(type, name, value) {\r\n    if (!helpers.hasOwnProperty(type)) helpers[type] = CodeMirror[type] = {_global: []};\r\n    helpers[type][name] = value;\r\n  };\r\n  CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {\r\n    CodeMirror.registerHelper(type, name, value);\r\n    helpers[type]._global.push({pred: predicate, val: value});\r\n  };\r\n\r\n  // MODE STATE HANDLING\r\n\r\n  // Utility functions for working with state. Exported because nested\r\n  // modes need to do this for their inner modes.\r\n\r\n  var copyState = CodeMirror.copyState = function(mode, state) {\r\n    if (state === true) return state;\r\n    if (mode.copyState) return mode.copyState(state);\r\n    var nstate = {};\r\n    for (var n in state) {\r\n      var val = state[n];\r\n      if (val instanceof Array) val = val.concat([]);\r\n      nstate[n] = val;\r\n    }\r\n    return nstate;\r\n  };\r\n\r\n  var startState = CodeMirror.startState = function(mode, a1, a2) {\r\n    return mode.startState ? mode.startState(a1, a2) : true;\r\n  };\r\n\r\n  // Given a mode and a state (for that mode), find the inner mode and\r\n  // state at the position that the state refers to.\r\n  CodeMirror.innerMode = function(mode, state) {\r\n    while (mode.innerMode) {\r\n      var info = mode.innerMode(state);\r\n      if (!info || info.mode == mode) break;\r\n      state = info.state;\r\n      mode = info.mode;\r\n    }\r\n    return info || {mode: mode, state: state};\r\n  };\r\n\r\n  // STANDARD COMMANDS\r\n\r\n  // Commands are parameter-less actions that can be performed on an\r\n  // editor, mostly used for keybindings.\r\n  var commands = CodeMirror.commands = {\r\n    selectAll: function(cm) {cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);},\r\n    singleSelection: function(cm) {\r\n      cm.setSelection(cm.getCursor(\"anchor\"), cm.getCursor(\"head\"), sel_dontScroll);\r\n    },\r\n    killLine: function(cm) {\r\n      deleteNearSelection(cm, function(range) {\r\n        if (range.empty()) {\r\n          var len = getLine(cm.doc, range.head.line).text.length;\r\n          if (range.head.ch == len && range.head.line < cm.lastLine())\r\n            return {from: range.head, to: Pos(range.head.line + 1, 0)};\r\n          else\r\n            return {from: range.head, to: Pos(range.head.line, len)};\r\n        } else {\r\n          return {from: range.from(), to: range.to()};\r\n        }\r\n      });\r\n    },\r\n    deleteLine: function(cm) {\r\n      deleteNearSelection(cm, function(range) {\r\n        return {from: Pos(range.from().line, 0),\r\n                to: clipPos(cm.doc, Pos(range.to().line + 1, 0))};\r\n      });\r\n    },\r\n    delLineLeft: function(cm) {\r\n      deleteNearSelection(cm, function(range) {\r\n        return {from: Pos(range.from().line, 0), to: range.from()};\r\n      });\r\n    },\r\n    delWrappedLineLeft: function(cm) {\r\n      deleteNearSelection(cm, function(range) {\r\n        var top = cm.charCoords(range.head, \"div\").top + 5;\r\n        var leftPos = cm.coordsChar({left: 0, top: top}, \"div\");\r\n        return {from: leftPos, to: range.from()};\r\n      });\r\n    },\r\n    delWrappedLineRight: function(cm) {\r\n      deleteNearSelection(cm, function(range) {\r\n        var top = cm.charCoords(range.head, \"div\").top + 5;\r\n        var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\r\n        return {from: range.from(), to: rightPos };\r\n      });\r\n    },\r\n    undo: function(cm) {cm.undo();},\r\n    redo: function(cm) {cm.redo();},\r\n    undoSelection: function(cm) {cm.undoSelection();},\r\n    redoSelection: function(cm) {cm.redoSelection();},\r\n    goDocStart: function(cm) {cm.extendSelection(Pos(cm.firstLine(), 0));},\r\n    goDocEnd: function(cm) {cm.extendSelection(Pos(cm.lastLine()));},\r\n    goLineStart: function(cm) {\r\n      cm.extendSelectionsBy(function(range) { return lineStart(cm, range.head.line); },\r\n                            {origin: \"+move\", bias: 1});\r\n    },\r\n    goLineStartSmart: function(cm) {\r\n      cm.extendSelectionsBy(function(range) {\r\n        return lineStartSmart(cm, range.head);\r\n      }, {origin: \"+move\", bias: 1});\r\n    },\r\n    goLineEnd: function(cm) {\r\n      cm.extendSelectionsBy(function(range) { return lineEnd(cm, range.head.line); },\r\n                            {origin: \"+move\", bias: -1});\r\n    },\r\n    goLineRight: function(cm) {\r\n      cm.extendSelectionsBy(function(range) {\r\n        var top = cm.charCoords(range.head, \"div\").top + 5;\r\n        return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\r\n      }, sel_move);\r\n    },\r\n    goLineLeft: function(cm) {\r\n      cm.extendSelectionsBy(function(range) {\r\n        var top = cm.charCoords(range.head, \"div\").top + 5;\r\n        return cm.coordsChar({left: 0, top: top}, \"div\");\r\n      }, sel_move);\r\n    },\r\n    goLineLeftSmart: function(cm) {\r\n      cm.extendSelectionsBy(function(range) {\r\n        var top = cm.charCoords(range.head, \"div\").top + 5;\r\n        var pos = cm.coordsChar({left: 0, top: top}, \"div\");\r\n        if (pos.ch < cm.getLine(pos.line).search(/\\S/)) return lineStartSmart(cm, range.head);\r\n        return pos;\r\n      }, sel_move);\r\n    },\r\n    goLineUp: function(cm) {cm.moveV(-1, \"line\");},\r\n    goLineDown: function(cm) {cm.moveV(1, \"line\");},\r\n    goPageUp: function(cm) {cm.moveV(-1, \"page\");},\r\n    goPageDown: function(cm) {cm.moveV(1, \"page\");},\r\n    goCharLeft: function(cm) {cm.moveH(-1, \"char\");},\r\n    goCharRight: function(cm) {cm.moveH(1, \"char\");},\r\n    goColumnLeft: function(cm) {cm.moveH(-1, \"column\");},\r\n    goColumnRight: function(cm) {cm.moveH(1, \"column\");},\r\n    goWordLeft: function(cm) {cm.moveH(-1, \"word\");},\r\n    goGroupRight: function(cm) {cm.moveH(1, \"group\");},\r\n    goGroupLeft: function(cm) {cm.moveH(-1, \"group\");},\r\n    goWordRight: function(cm) {cm.moveH(1, \"word\");},\r\n    delCharBefore: function(cm) {cm.deleteH(-1, \"char\");},\r\n    delCharAfter: function(cm) {cm.deleteH(1, \"char\");},\r\n    delWordBefore: function(cm) {cm.deleteH(-1, \"word\");},\r\n    delWordAfter: function(cm) {cm.deleteH(1, \"word\");},\r\n    delGroupBefore: function(cm) {cm.deleteH(-1, \"group\");},\r\n    delGroupAfter: function(cm) {cm.deleteH(1, \"group\");},\r\n    indentAuto: function(cm) {cm.indentSelection(\"smart\");},\r\n    indentMore: function(cm) {cm.indentSelection(\"add\");},\r\n    indentLess: function(cm) {cm.indentSelection(\"subtract\");},\r\n    insertTab: function(cm) {cm.replaceSelection(\"\\t\");},\r\n    insertSoftTab: function(cm) {\r\n      var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;\r\n      for (var i = 0; i < ranges.length; i++) {\r\n        var pos = ranges[i].from();\r\n        var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);\r\n        spaces.push(spaceStr(tabSize - col % tabSize));\r\n      }\r\n      cm.replaceSelections(spaces);\r\n    },\r\n    defaultTab: function(cm) {\r\n      if (cm.somethingSelected()) cm.indentSelection(\"add\");\r\n      else cm.execCommand(\"insertTab\");\r\n    },\r\n    transposeChars: function(cm) {\r\n      runInOp(cm, function() {\r\n        var ranges = cm.listSelections(), newSel = [];\r\n        for (var i = 0; i < ranges.length; i++) {\r\n          var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;\r\n          if (line) {\r\n            if (cur.ch == line.length) cur = new Pos(cur.line, cur.ch - 1);\r\n            if (cur.ch > 0) {\r\n              cur = new Pos(cur.line, cur.ch + 1);\r\n              cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),\r\n                              Pos(cur.line, cur.ch - 2), cur, \"+transpose\");\r\n            } else if (cur.line > cm.doc.first) {\r\n              var prev = getLine(cm.doc, cur.line - 1).text;\r\n              if (prev)\r\n                cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +\r\n                                prev.charAt(prev.length - 1),\r\n                                Pos(cur.line - 1, prev.length - 1), Pos(cur.line, 1), \"+transpose\");\r\n            }\r\n          }\r\n          newSel.push(new Range(cur, cur));\r\n        }\r\n        cm.setSelections(newSel);\r\n      });\r\n    },\r\n    newlineAndIndent: function(cm) {\r\n      runInOp(cm, function() {\r\n        var len = cm.listSelections().length;\r\n        for (var i = 0; i < len; i++) {\r\n          var range = cm.listSelections()[i];\r\n          cm.replaceRange(cm.doc.lineSeparator(), range.anchor, range.head, \"+input\");\r\n          cm.indentLine(range.from().line + 1, null, true);\r\n        }\r\n        ensureCursorVisible(cm);\r\n      });\r\n    },\r\n    openLine: function(cm) {cm.replaceSelection(\"\\n\", \"start\")},\r\n    toggleOverwrite: function(cm) {cm.toggleOverwrite();}\r\n  };\r\n\r\n\r\n  // STANDARD KEYMAPS\r\n\r\n  var keyMap = CodeMirror.keyMap = {};\r\n\r\n  keyMap.basic = {\r\n    \"Left\": \"goCharLeft\", \"Right\": \"goCharRight\", \"Up\": \"goLineUp\", \"Down\": \"goLineDown\",\r\n    \"End\": \"goLineEnd\", \"Home\": \"goLineStartSmart\", \"PageUp\": \"goPageUp\", \"PageDown\": \"goPageDown\",\r\n    \"Delete\": \"delCharAfter\", \"Backspace\": \"delCharBefore\", \"Shift-Backspace\": \"delCharBefore\",\r\n    \"Tab\": \"defaultTab\", \"Shift-Tab\": \"indentAuto\",\r\n    \"Enter\": \"newlineAndIndent\", \"Insert\": \"toggleOverwrite\",\r\n    \"Esc\": \"singleSelection\"\r\n  };\r\n  // Note that the save and find-related commands aren't defined by\r\n  // default. User code or addons can define them. Unknown commands\r\n  // are simply ignored.\r\n  keyMap.pcDefault = {\r\n    \"Ctrl-A\": \"selectAll\", \"Ctrl-D\": \"deleteLine\", \"Ctrl-Z\": \"undo\", \"Shift-Ctrl-Z\": \"redo\", \"Ctrl-Y\": \"redo\",\r\n    \"Ctrl-Home\": \"goDocStart\", \"Ctrl-End\": \"goDocEnd\", \"Ctrl-Up\": \"goLineUp\", \"Ctrl-Down\": \"goLineDown\",\r\n    \"Ctrl-Left\": \"goGroupLeft\", \"Ctrl-Right\": \"goGroupRight\", \"Alt-Left\": \"goLineStart\", \"Alt-Right\": \"goLineEnd\",\r\n    \"Ctrl-Backspace\": \"delGroupBefore\", \"Ctrl-Delete\": \"delGroupAfter\", \"Ctrl-S\": \"save\", \"Ctrl-F\": \"find\",\r\n    \"Ctrl-G\": \"findNext\", \"Shift-Ctrl-G\": \"findPrev\", \"Shift-Ctrl-F\": \"replace\", \"Shift-Ctrl-R\": \"replaceAll\",\r\n    \"Ctrl-[\": \"indentLess\", \"Ctrl-]\": \"indentMore\",\r\n    \"Ctrl-U\": \"undoSelection\", \"Shift-Ctrl-U\": \"redoSelection\", \"Alt-U\": \"redoSelection\",\r\n    fallthrough: \"basic\"\r\n  };\r\n  // Very basic readline/emacs-style bindings, which are standard on Mac.\r\n  keyMap.emacsy = {\r\n    \"Ctrl-F\": \"goCharRight\", \"Ctrl-B\": \"goCharLeft\", \"Ctrl-P\": \"goLineUp\", \"Ctrl-N\": \"goLineDown\",\r\n    \"Alt-F\": \"goWordRight\", \"Alt-B\": \"goWordLeft\", \"Ctrl-A\": \"goLineStart\", \"Ctrl-E\": \"goLineEnd\",\r\n    \"Ctrl-V\": \"goPageDown\", \"Shift-Ctrl-V\": \"goPageUp\", \"Ctrl-D\": \"delCharAfter\", \"Ctrl-H\": \"delCharBefore\",\r\n    \"Alt-D\": \"delWordAfter\", \"Alt-Backspace\": \"delWordBefore\", \"Ctrl-K\": \"killLine\", \"Ctrl-T\": \"transposeChars\",\r\n    \"Ctrl-O\": \"openLine\"\r\n  };\r\n  keyMap.macDefault = {\r\n    \"Cmd-A\": \"selectAll\", \"Cmd-D\": \"deleteLine\", \"Cmd-Z\": \"undo\", \"Shift-Cmd-Z\": \"redo\", \"Cmd-Y\": \"redo\",\r\n    \"Cmd-Home\": \"goDocStart\", \"Cmd-Up\": \"goDocStart\", \"Cmd-End\": \"goDocEnd\", \"Cmd-Down\": \"goDocEnd\", \"Alt-Left\": \"goGroupLeft\",\r\n    \"Alt-Right\": \"goGroupRight\", \"Cmd-Left\": \"goLineLeft\", \"Cmd-Right\": \"goLineRight\", \"Alt-Backspace\": \"delGroupBefore\",\r\n    \"Ctrl-Alt-Backspace\": \"delGroupAfter\", \"Alt-Delete\": \"delGroupAfter\", \"Cmd-S\": \"save\", \"Cmd-F\": \"find\",\r\n    \"Cmd-G\": \"findNext\", \"Shift-Cmd-G\": \"findPrev\", \"Cmd-Alt-F\": \"replace\", \"Shift-Cmd-Alt-F\": \"replaceAll\",\r\n    \"Cmd-[\": \"indentLess\", \"Cmd-]\": \"indentMore\", \"Cmd-Backspace\": \"delWrappedLineLeft\", \"Cmd-Delete\": \"delWrappedLineRight\",\r\n    \"Cmd-U\": \"undoSelection\", \"Shift-Cmd-U\": \"redoSelection\", \"Ctrl-Up\": \"goDocStart\", \"Ctrl-Down\": \"goDocEnd\",\r\n    fallthrough: [\"basic\", \"emacsy\"]\r\n  };\r\n  keyMap[\"default\"] = mac ? keyMap.macDefault : keyMap.pcDefault;\r\n\r\n  // KEYMAP DISPATCH\r\n\r\n  function normalizeKeyName(name) {\r\n    var parts = name.split(/-(?!$)/), name = parts[parts.length - 1];\r\n    var alt, ctrl, shift, cmd;\r\n    for (var i = 0; i < parts.length - 1; i++) {\r\n      var mod = parts[i];\r\n      if (/^(cmd|meta|m)$/i.test(mod)) cmd = true;\r\n      else if (/^a(lt)?$/i.test(mod)) alt = true;\r\n      else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true;\r\n      else if (/^s(hift)$/i.test(mod)) shift = true;\r\n      else throw new Error(\"Unrecognized modifier name: \" + mod);\r\n    }\r\n    if (alt) name = \"Alt-\" + name;\r\n    if (ctrl) name = \"Ctrl-\" + name;\r\n    if (cmd) name = \"Cmd-\" + name;\r\n    if (shift) name = \"Shift-\" + name;\r\n    return name;\r\n  }\r\n\r\n  // This is a kludge to keep keymaps mostly working as raw objects\r\n  // (backwards compatibility) while at the same time support features\r\n  // like normalization and multi-stroke key bindings. It compiles a\r\n  // new normalized keymap, and then updates the old object to reflect\r\n  // this.\r\n  CodeMirror.normalizeKeyMap = function(keymap) {\r\n    var copy = {};\r\n    for (var keyname in keymap) if (keymap.hasOwnProperty(keyname)) {\r\n      var value = keymap[keyname];\r\n      if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) continue;\r\n      if (value == \"...\") { delete keymap[keyname]; continue; }\r\n\r\n      var keys = map(keyname.split(\" \"), normalizeKeyName);\r\n      for (var i = 0; i < keys.length; i++) {\r\n        var val, name;\r\n        if (i == keys.length - 1) {\r\n          name = keys.join(\" \");\r\n          val = value;\r\n        } else {\r\n          name = keys.slice(0, i + 1).join(\" \");\r\n          val = \"...\";\r\n        }\r\n        var prev = copy[name];\r\n        if (!prev) copy[name] = val;\r\n        else if (prev != val) throw new Error(\"Inconsistent bindings for \" + name);\r\n      }\r\n      delete keymap[keyname];\r\n    }\r\n    for (var prop in copy) keymap[prop] = copy[prop];\r\n    return keymap;\r\n  };\r\n\r\n  var lookupKey = CodeMirror.lookupKey = function(key, map, handle, context) {\r\n    map = getKeyMap(map);\r\n    var found = map.call ? map.call(key, context) : map[key];\r\n    if (found === false) return \"nothing\";\r\n    if (found === \"...\") return \"multi\";\r\n    if (found != null && handle(found)) return \"handled\";\r\n\r\n    if (map.fallthrough) {\r\n      if (Object.prototype.toString.call(map.fallthrough) != \"[object Array]\")\r\n        return lookupKey(key, map.fallthrough, handle, context);\r\n      for (var i = 0; i < map.fallthrough.length; i++) {\r\n        var result = lookupKey(key, map.fallthrough[i], handle, context);\r\n        if (result) return result;\r\n      }\r\n    }\r\n  };\r\n\r\n  // Modifier key presses don't count as 'real' key presses for the\r\n  // purpose of keymap fallthrough.\r\n  var isModifierKey = CodeMirror.isModifierKey = function(value) {\r\n    var name = typeof value == \"string\" ? value : keyNames[value.keyCode];\r\n    return name == \"Ctrl\" || name == \"Alt\" || name == \"Shift\" || name == \"Mod\";\r\n  };\r\n\r\n  // Look up the name of a key as indicated by an event object.\r\n  var keyName = CodeMirror.keyName = function(event, noShift) {\r\n    if (presto && event.keyCode == 34 && event[\"char\"]) return false;\r\n    var base = keyNames[event.keyCode], name = base;\r\n    if (name == null || event.altGraphKey) return false;\r\n    if (event.altKey && base != \"Alt\") name = \"Alt-\" + name;\r\n    if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != \"Ctrl\") name = \"Ctrl-\" + name;\r\n    if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != \"Cmd\") name = \"Cmd-\" + name;\r\n    if (!noShift && event.shiftKey && base != \"Shift\") name = \"Shift-\" + name;\r\n    return name;\r\n  };\r\n\r\n  function getKeyMap(val) {\r\n    return typeof val == \"string\" ? keyMap[val] : val;\r\n  }\r\n\r\n  // FROMTEXTAREA\r\n\r\n  CodeMirror.fromTextArea = function(textarea, options) {\r\n    options = options ? copyObj(options) : {};\r\n    options.value = textarea.value;\r\n    if (!options.tabindex && textarea.tabIndex)\r\n      options.tabindex = textarea.tabIndex;\r\n    if (!options.placeholder && textarea.placeholder)\r\n      options.placeholder = textarea.placeholder;\r\n    // Set autofocus to true if this textarea is focused, or if it has\r\n    // autofocus and no other element is focused.\r\n    if (options.autofocus == null) {\r\n      var hasFocus = activeElt();\r\n      options.autofocus = hasFocus == textarea ||\r\n        textarea.getAttribute(\"autofocus\") != null && hasFocus == document.body;\r\n    }\r\n\r\n    function save() {textarea.value = cm.getValue();}\r\n    if (textarea.form) {\r\n      on(textarea.form, \"submit\", save);\r\n      // Deplorable hack to make the submit method do the right thing.\r\n      if (!options.leaveSubmitMethodAlone) {\r\n        var form = textarea.form, realSubmit = form.submit;\r\n        try {\r\n          var wrappedSubmit = form.submit = function() {\r\n            save();\r\n            form.submit = realSubmit;\r\n            form.submit();\r\n            form.submit = wrappedSubmit;\r\n          };\r\n        } catch(e) {}\r\n      }\r\n    }\r\n\r\n    options.finishInit = function(cm) {\r\n      cm.save = save;\r\n      cm.getTextArea = function() { return textarea; };\r\n      cm.toTextArea = function() {\r\n        cm.toTextArea = isNaN; // Prevent this from being ran twice\r\n        save();\r\n        textarea.parentNode.removeChild(cm.getWrapperElement());\r\n        textarea.style.display = \"\";\r\n        if (textarea.form) {\r\n          off(textarea.form, \"submit\", save);\r\n          if (typeof textarea.form.submit == \"function\")\r\n            textarea.form.submit = realSubmit;\r\n        }\r\n      };\r\n    };\r\n\r\n    textarea.style.display = \"none\";\r\n    var cm = CodeMirror(function(node) {\r\n      textarea.parentNode.insertBefore(node, textarea.nextSibling);\r\n    }, options);\r\n    return cm;\r\n  };\r\n\r\n  // STRING STREAM\r\n\r\n  // Fed to the mode parsers, provides helper functions to make\r\n  // parsers more succinct.\r\n\r\n  var StringStream = CodeMirror.StringStream = function(string, tabSize) {\r\n    this.pos = this.start = 0;\r\n    this.string = string;\r\n    this.tabSize = tabSize || 8;\r\n    this.lastColumnPos = this.lastColumnValue = 0;\r\n    this.lineStart = 0;\r\n  };\r\n\r\n  StringStream.prototype = {\r\n    eol: function() {return this.pos >= this.string.length;},\r\n    sol: function() {return this.pos == this.lineStart;},\r\n    peek: function() {return this.string.charAt(this.pos) || undefined;},\r\n    next: function() {\r\n      if (this.pos < this.string.length)\r\n        return this.string.charAt(this.pos++);\r\n    },\r\n    eat: function(match) {\r\n      var ch = this.string.charAt(this.pos);\r\n      if (typeof match == \"string\") var ok = ch == match;\r\n      else var ok = ch && (match.test ? match.test(ch) : match(ch));\r\n      if (ok) {++this.pos; return ch;}\r\n    },\r\n    eatWhile: function(match) {\r\n      var start = this.pos;\r\n      while (this.eat(match)){}\r\n      return this.pos > start;\r\n    },\r\n    eatSpace: function() {\r\n      var start = this.pos;\r\n      while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) ++this.pos;\r\n      return this.pos > start;\r\n    },\r\n    skipToEnd: function() {this.pos = this.string.length;},\r\n    skipTo: function(ch) {\r\n      var found = this.string.indexOf(ch, this.pos);\r\n      if (found > -1) {this.pos = found; return true;}\r\n    },\r\n    backUp: function(n) {this.pos -= n;},\r\n    column: function() {\r\n      if (this.lastColumnPos < this.start) {\r\n        this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\r\n        this.lastColumnPos = this.start;\r\n      }\r\n      return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\r\n    },\r\n    indentation: function() {\r\n      return countColumn(this.string, null, this.tabSize) -\r\n        (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\r\n    },\r\n    match: function(pattern, consume, caseInsensitive) {\r\n      if (typeof pattern == \"string\") {\r\n        var cased = function(str) {return caseInsensitive ? str.toLowerCase() : str;};\r\n        var substr = this.string.substr(this.pos, pattern.length);\r\n        if (cased(substr) == cased(pattern)) {\r\n          if (consume !== false) this.pos += pattern.length;\r\n          return true;\r\n        }\r\n      } else {\r\n        var match = this.string.slice(this.pos).match(pattern);\r\n        if (match && match.index > 0) return null;\r\n        if (match && consume !== false) this.pos += match[0].length;\r\n        return match;\r\n      }\r\n    },\r\n    current: function(){return this.string.slice(this.start, this.pos);},\r\n    hideFirstChars: function(n, inner) {\r\n      this.lineStart += n;\r\n      try { return inner(); }\r\n      finally { this.lineStart -= n; }\r\n    }\r\n  };\r\n\r\n  // TEXTMARKERS\r\n\r\n  // Created with markText and setBookmark methods. A TextMarker is a\r\n  // handle that can be used to clear or find a marked position in the\r\n  // document. Line objects hold arrays (markedSpans) containing\r\n  // {from, to, marker} object pointing to such marker objects, and\r\n  // indicating that such a marker is present on that line. Multiple\r\n  // lines may point to the same marker when it spans across lines.\r\n  // The spans will have null for their from/to properties when the\r\n  // marker continues beyond the start/end of the line. Markers have\r\n  // links back to the lines they currently touch.\r\n\r\n  var nextMarkerId = 0;\r\n\r\n  var TextMarker = CodeMirror.TextMarker = function(doc, type) {\r\n    this.lines = [];\r\n    this.type = type;\r\n    this.doc = doc;\r\n    this.id = ++nextMarkerId;\r\n  };\r\n  eventMixin(TextMarker);\r\n\r\n  // Clear the marker.\r\n  TextMarker.prototype.clear = function() {\r\n    if (this.explicitlyCleared) return;\r\n    var cm = this.doc.cm, withOp = cm && !cm.curOp;\r\n    if (withOp) startOperation(cm);\r\n    if (hasHandler(this, \"clear\")) {\r\n      var found = this.find();\r\n      if (found) signalLater(this, \"clear\", found.from, found.to);\r\n    }\r\n    var min = null, max = null;\r\n    for (var i = 0; i < this.lines.length; ++i) {\r\n      var line = this.lines[i];\r\n      var span = getMarkedSpanFor(line.markedSpans, this);\r\n      if (cm && !this.collapsed) regLineChange(cm, lineNo(line), \"text\");\r\n      else if (cm) {\r\n        if (span.to != null) max = lineNo(line);\r\n        if (span.from != null) min = lineNo(line);\r\n      }\r\n      line.markedSpans = removeMarkedSpan(line.markedSpans, span);\r\n      if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)\r\n        updateLineHeight(line, textHeight(cm.display));\r\n    }\r\n    if (cm && this.collapsed && !cm.options.lineWrapping) for (var i = 0; i < this.lines.length; ++i) {\r\n      var visual = visualLine(this.lines[i]), len = lineLength(visual);\r\n      if (len > cm.display.maxLineLength) {\r\n        cm.display.maxLine = visual;\r\n        cm.display.maxLineLength = len;\r\n        cm.display.maxLineChanged = true;\r\n      }\r\n    }\r\n\r\n    if (min != null && cm && this.collapsed) regChange(cm, min, max + 1);\r\n    this.lines.length = 0;\r\n    this.explicitlyCleared = true;\r\n    if (this.atomic && this.doc.cantEdit) {\r\n      this.doc.cantEdit = false;\r\n      if (cm) reCheckSelection(cm.doc);\r\n    }\r\n    if (cm) signalLater(cm, \"markerCleared\", cm, this);\r\n    if (withOp) endOperation(cm);\r\n    if (this.parent) this.parent.clear();\r\n  };\r\n\r\n  // Find the position of the marker in the document. Returns a {from,\r\n  // to} object by default. Side can be passed to get a specific side\r\n  // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the\r\n  // Pos objects returned contain a line object, rather than a line\r\n  // number (used to prevent looking up the same line twice).\r\n  TextMarker.prototype.find = function(side, lineObj) {\r\n    if (side == null && this.type == \"bookmark\") side = 1;\r\n    var from, to;\r\n    for (var i = 0; i < this.lines.length; ++i) {\r\n      var line = this.lines[i];\r\n      var span = getMarkedSpanFor(line.markedSpans, this);\r\n      if (span.from != null) {\r\n        from = Pos(lineObj ? line : lineNo(line), span.from);\r\n        if (side == -1) return from;\r\n      }\r\n      if (span.to != null) {\r\n        to = Pos(lineObj ? line : lineNo(line), span.to);\r\n        if (side == 1) return to;\r\n      }\r\n    }\r\n    return from && {from: from, to: to};\r\n  };\r\n\r\n  // Signals that the marker's widget changed, and surrounding layout\r\n  // should be recomputed.\r\n  TextMarker.prototype.changed = function() {\r\n    var pos = this.find(-1, true), widget = this, cm = this.doc.cm;\r\n    if (!pos || !cm) return;\r\n    runInOp(cm, function() {\r\n      var line = pos.line, lineN = lineNo(pos.line);\r\n      var view = findViewForLine(cm, lineN);\r\n      if (view) {\r\n        clearLineMeasurementCacheFor(view);\r\n        cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;\r\n      }\r\n      cm.curOp.updateMaxLine = true;\r\n      if (!lineIsHidden(widget.doc, line) && widget.height != null) {\r\n        var oldHeight = widget.height;\r\n        widget.height = null;\r\n        var dHeight = widgetHeight(widget) - oldHeight;\r\n        if (dHeight)\r\n          updateLineHeight(line, line.height + dHeight);\r\n      }\r\n    });\r\n  };\r\n\r\n  TextMarker.prototype.attachLine = function(line) {\r\n    if (!this.lines.length && this.doc.cm) {\r\n      var op = this.doc.cm.curOp;\r\n      if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\r\n        (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this);\r\n    }\r\n    this.lines.push(line);\r\n  };\r\n  TextMarker.prototype.detachLine = function(line) {\r\n    this.lines.splice(indexOf(this.lines, line), 1);\r\n    if (!this.lines.length && this.doc.cm) {\r\n      var op = this.doc.cm.curOp;\r\n      (op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\r\n    }\r\n  };\r\n\r\n  // Collapsed markers have unique ids, in order to be able to order\r\n  // them, which is needed for uniquely determining an outer marker\r\n  // when they overlap (they may nest, but not partially overlap).\r\n  var nextMarkerId = 0;\r\n\r\n  // Create a marker, wire it up to the right lines, and\r\n  function markText(doc, from, to, options, type) {\r\n    // Shared markers (across linked documents) are handled separately\r\n    // (markTextShared will call out to this again, once per\r\n    // document).\r\n    if (options && options.shared) return markTextShared(doc, from, to, options, type);\r\n    // Ensure we are in an operation.\r\n    if (doc.cm && !doc.cm.curOp) return operation(doc.cm, markText)(doc, from, to, options, type);\r\n\r\n    var marker = new TextMarker(doc, type), diff = cmp(from, to);\r\n    if (options) copyObj(options, marker, false);\r\n    // Don't connect empty markers unless clearWhenEmpty is false\r\n    if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)\r\n      return marker;\r\n    if (marker.replacedWith) {\r\n      // Showing up as a widget implies collapsed (widget replaces text)\r\n      marker.collapsed = true;\r\n      marker.widgetNode = elt(\"span\", [marker.replacedWith], \"CodeMirror-widget\");\r\n      if (!options.handleMouseEvents) marker.widgetNode.setAttribute(\"cm-ignore-events\", \"true\");\r\n      if (options.insertLeft) marker.widgetNode.insertLeft = true;\r\n    }\r\n    if (marker.collapsed) {\r\n      if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||\r\n          from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))\r\n        throw new Error(\"Inserting collapsed marker partially overlapping an existing one\");\r\n      sawCollapsedSpans = true;\r\n    }\r\n\r\n    if (marker.addToHistory)\r\n      addChangeToHistory(doc, {from: from, to: to, origin: \"markText\"}, doc.sel, NaN);\r\n\r\n    var curLine = from.line, cm = doc.cm, updateMaxLine;\r\n    doc.iter(curLine, to.line + 1, function(line) {\r\n      if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)\r\n        updateMaxLine = true;\r\n      if (marker.collapsed && curLine != from.line) updateLineHeight(line, 0);\r\n      addMarkedSpan(line, new MarkedSpan(marker,\r\n                                         curLine == from.line ? from.ch : null,\r\n                                         curLine == to.line ? to.ch : null));\r\n      ++curLine;\r\n    });\r\n    // lineIsHidden depends on the presence of the spans, so needs a second pass\r\n    if (marker.collapsed) doc.iter(from.line, to.line + 1, function(line) {\r\n      if (lineIsHidden(doc, line)) updateLineHeight(line, 0);\r\n    });\r\n\r\n    if (marker.clearOnEnter) on(marker, \"beforeCursorEnter\", function() { marker.clear(); });\r\n\r\n    if (marker.readOnly) {\r\n      sawReadOnlySpans = true;\r\n      if (doc.history.done.length || doc.history.undone.length)\r\n        doc.clearHistory();\r\n    }\r\n    if (marker.collapsed) {\r\n      marker.id = ++nextMarkerId;\r\n      marker.atomic = true;\r\n    }\r\n    if (cm) {\r\n      // Sync editor state\r\n      if (updateMaxLine) cm.curOp.updateMaxLine = true;\r\n      if (marker.collapsed)\r\n        regChange(cm, from.line, to.line + 1);\r\n      else if (marker.className || marker.title || marker.startStyle || marker.endStyle || marker.css)\r\n        for (var i = from.line; i <= to.line; i++) regLineChange(cm, i, \"text\");\r\n      if (marker.atomic) reCheckSelection(cm.doc);\r\n      signalLater(cm, \"markerAdded\", cm, marker);\r\n    }\r\n    return marker;\r\n  }\r\n\r\n  // SHARED TEXTMARKERS\r\n\r\n  // A shared marker spans multiple linked documents. It is\r\n  // implemented as a meta-marker-object controlling multiple normal\r\n  // markers.\r\n  var SharedTextMarker = CodeMirror.SharedTextMarker = function(markers, primary) {\r\n    this.markers = markers;\r\n    this.primary = primary;\r\n    for (var i = 0; i < markers.length; ++i)\r\n      markers[i].parent = this;\r\n  };\r\n  eventMixin(SharedTextMarker);\r\n\r\n  SharedTextMarker.prototype.clear = function() {\r\n    if (this.explicitlyCleared) return;\r\n    this.explicitlyCleared = true;\r\n    for (var i = 0; i < this.markers.length; ++i)\r\n      this.markers[i].clear();\r\n    signalLater(this, \"clear\");\r\n  };\r\n  SharedTextMarker.prototype.find = function(side, lineObj) {\r\n    return this.primary.find(side, lineObj);\r\n  };\r\n\r\n  function markTextShared(doc, from, to, options, type) {\r\n    options = copyObj(options);\r\n    options.shared = false;\r\n    var markers = [markText(doc, from, to, options, type)], primary = markers[0];\r\n    var widget = options.widgetNode;\r\n    linkedDocs(doc, function(doc) {\r\n      if (widget) options.widgetNode = widget.cloneNode(true);\r\n      markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\r\n      for (var i = 0; i < doc.linked.length; ++i)\r\n        if (doc.linked[i].isParent) return;\r\n      primary = lst(markers);\r\n    });\r\n    return new SharedTextMarker(markers, primary);\r\n  }\r\n\r\n  function findSharedMarkers(doc) {\r\n    return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())),\r\n                         function(m) { return m.parent; });\r\n  }\r\n\r\n  function copySharedMarkers(doc, markers) {\r\n    for (var i = 0; i < markers.length; i++) {\r\n      var marker = markers[i], pos = marker.find();\r\n      var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);\r\n      if (cmp(mFrom, mTo)) {\r\n        var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);\r\n        marker.markers.push(subMark);\r\n        subMark.parent = marker;\r\n      }\r\n    }\r\n  }\r\n\r\n  function detachSharedMarkers(markers) {\r\n    for (var i = 0; i < markers.length; i++) {\r\n      var marker = markers[i], linked = [marker.primary.doc];;\r\n      linkedDocs(marker.primary.doc, function(d) { linked.push(d); });\r\n      for (var j = 0; j < marker.markers.length; j++) {\r\n        var subMarker = marker.markers[j];\r\n        if (indexOf(linked, subMarker.doc) == -1) {\r\n          subMarker.parent = null;\r\n          marker.markers.splice(j--, 1);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // TEXTMARKER SPANS\r\n\r\n  function MarkedSpan(marker, from, to) {\r\n    this.marker = marker;\r\n    this.from = from; this.to = to;\r\n  }\r\n\r\n  // Search an array of spans for a span matching the given marker.\r\n  function getMarkedSpanFor(spans, marker) {\r\n    if (spans) for (var i = 0; i < spans.length; ++i) {\r\n      var span = spans[i];\r\n      if (span.marker == marker) return span;\r\n    }\r\n  }\r\n  // Remove a span from an array, returning undefined if no spans are\r\n  // left (we don't store arrays for lines without spans).\r\n  function removeMarkedSpan(spans, span) {\r\n    for (var r, i = 0; i < spans.length; ++i)\r\n      if (spans[i] != span) (r || (r = [])).push(spans[i]);\r\n    return r;\r\n  }\r\n  // Add a span to a line.\r\n  function addMarkedSpan(line, span) {\r\n    line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\r\n    span.marker.attachLine(line);\r\n  }\r\n\r\n  // Used for the algorithm that adjusts markers for a change in the\r\n  // document. These functions cut an array of spans at a given\r\n  // character position, returning an array of remaining chunks (or\r\n  // undefined if nothing remains).\r\n  function markedSpansBefore(old, startCh, isInsert) {\r\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\r\n      var span = old[i], marker = span.marker;\r\n      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\r\n      if (startsBefore || span.from == startCh && marker.type == \"bookmark\" && (!isInsert || !span.marker.insertLeft)) {\r\n        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);\r\n        (nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));\r\n      }\r\n    }\r\n    return nw;\r\n  }\r\n  function markedSpansAfter(old, endCh, isInsert) {\r\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\r\n      var span = old[i], marker = span.marker;\r\n      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\r\n      if (endsAfter || span.from == endCh && marker.type == \"bookmark\" && (!isInsert || span.marker.insertLeft)) {\r\n        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);\r\n        (nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,\r\n                                              span.to == null ? null : span.to - endCh));\r\n      }\r\n    }\r\n    return nw;\r\n  }\r\n\r\n  // Given a change object, compute the new set of marker spans that\r\n  // cover the line in which the change took place. Removes spans\r\n  // entirely within the change, reconnects spans belonging to the\r\n  // same marker that appear on both sides of the change, and cuts off\r\n  // spans partially within the change. Returns an array of span\r\n  // arrays with one element for each line in (after) the change.\r\n  function stretchSpansOverChange(doc, change) {\r\n    if (change.full) return null;\r\n    var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\r\n    var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\r\n    if (!oldFirst && !oldLast) return null;\r\n\r\n    var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;\r\n    // Get the spans that 'stick out' on both sides\r\n    var first = markedSpansBefore(oldFirst, startCh, isInsert);\r\n    var last = markedSpansAfter(oldLast, endCh, isInsert);\r\n\r\n    // Next, merge those two ends\r\n    var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\r\n    if (first) {\r\n      // Fix up .to properties of first\r\n      for (var i = 0; i < first.length; ++i) {\r\n        var span = first[i];\r\n        if (span.to == null) {\r\n          var found = getMarkedSpanFor(last, span.marker);\r\n          if (!found) span.to = startCh;\r\n          else if (sameLine) span.to = found.to == null ? null : found.to + offset;\r\n        }\r\n      }\r\n    }\r\n    if (last) {\r\n      // Fix up .from in last (or move them into first in case of sameLine)\r\n      for (var i = 0; i < last.length; ++i) {\r\n        var span = last[i];\r\n        if (span.to != null) span.to += offset;\r\n        if (span.from == null) {\r\n          var found = getMarkedSpanFor(first, span.marker);\r\n          if (!found) {\r\n            span.from = offset;\r\n            if (sameLine) (first || (first = [])).push(span);\r\n          }\r\n        } else {\r\n          span.from += offset;\r\n          if (sameLine) (first || (first = [])).push(span);\r\n        }\r\n      }\r\n    }\r\n    // Make sure we didn't create any zero-length spans\r\n    if (first) first = clearEmptySpans(first);\r\n    if (last && last != first) last = clearEmptySpans(last);\r\n\r\n    var newMarkers = [first];\r\n    if (!sameLine) {\r\n      // Fill gap with whole-line-spans\r\n      var gap = change.text.length - 2, gapMarkers;\r\n      if (gap > 0 && first)\r\n        for (var i = 0; i < first.length; ++i)\r\n          if (first[i].to == null)\r\n            (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i].marker, null, null));\r\n      for (var i = 0; i < gap; ++i)\r\n        newMarkers.push(gapMarkers);\r\n      newMarkers.push(last);\r\n    }\r\n    return newMarkers;\r\n  }\r\n\r\n  // Remove spans that are empty and don't have a clearWhenEmpty\r\n  // option of false.\r\n  function clearEmptySpans(spans) {\r\n    for (var i = 0; i < spans.length; ++i) {\r\n      var span = spans[i];\r\n      if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)\r\n        spans.splice(i--, 1);\r\n    }\r\n    if (!spans.length) return null;\r\n    return spans;\r\n  }\r\n\r\n  // Used for un/re-doing changes from the history. Combines the\r\n  // result of computing the existing spans with the set of spans that\r\n  // existed in the history (so that deleting around a span and then\r\n  // undoing brings back the span).\r\n  function mergeOldSpans(doc, change) {\r\n    var old = getOldSpans(doc, change);\r\n    var stretched = stretchSpansOverChange(doc, change);\r\n    if (!old) return stretched;\r\n    if (!stretched) return old;\r\n\r\n    for (var i = 0; i < old.length; ++i) {\r\n      var oldCur = old[i], stretchCur = stretched[i];\r\n      if (oldCur && stretchCur) {\r\n        spans: for (var j = 0; j < stretchCur.length; ++j) {\r\n          var span = stretchCur[j];\r\n          for (var k = 0; k < oldCur.length; ++k)\r\n            if (oldCur[k].marker == span.marker) continue spans;\r\n          oldCur.push(span);\r\n        }\r\n      } else if (stretchCur) {\r\n        old[i] = stretchCur;\r\n      }\r\n    }\r\n    return old;\r\n  }\r\n\r\n  // Used to 'clip' out readOnly ranges when making a change.\r\n  function removeReadOnlyRanges(doc, from, to) {\r\n    var markers = null;\r\n    doc.iter(from.line, to.line + 1, function(line) {\r\n      if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {\r\n        var mark = line.markedSpans[i].marker;\r\n        if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\r\n          (markers || (markers = [])).push(mark);\r\n      }\r\n    });\r\n    if (!markers) return null;\r\n    var parts = [{from: from, to: to}];\r\n    for (var i = 0; i < markers.length; ++i) {\r\n      var mk = markers[i], m = mk.find(0);\r\n      for (var j = 0; j < parts.length; ++j) {\r\n        var p = parts[j];\r\n        if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) continue;\r\n        var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);\r\n        if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)\r\n          newParts.push({from: p.from, to: m.from});\r\n        if (dto > 0 || !mk.inclusiveRight && !dto)\r\n          newParts.push({from: m.to, to: p.to});\r\n        parts.splice.apply(parts, newParts);\r\n        j += newParts.length - 1;\r\n      }\r\n    }\r\n    return parts;\r\n  }\r\n\r\n  // Connect or disconnect spans from a line.\r\n  function detachMarkedSpans(line) {\r\n    var spans = line.markedSpans;\r\n    if (!spans) return;\r\n    for (var i = 0; i < spans.length; ++i)\r\n      spans[i].marker.detachLine(line);\r\n    line.markedSpans = null;\r\n  }\r\n  function attachMarkedSpans(line, spans) {\r\n    if (!spans) return;\r\n    for (var i = 0; i < spans.length; ++i)\r\n      spans[i].marker.attachLine(line);\r\n    line.markedSpans = spans;\r\n  }\r\n\r\n  // Helpers used when computing which overlapping collapsed span\r\n  // counts as the larger one.\r\n  function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0; }\r\n  function extraRight(marker) { return marker.inclusiveRight ? 1 : 0; }\r\n\r\n  // Returns a number indicating which of two overlapping collapsed\r\n  // spans is larger (and thus includes the other). Falls back to\r\n  // comparing ids when the spans cover exactly the same range.\r\n  function compareCollapsedMarkers(a, b) {\r\n    var lenDiff = a.lines.length - b.lines.length;\r\n    if (lenDiff != 0) return lenDiff;\r\n    var aPos = a.find(), bPos = b.find();\r\n    var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);\r\n    if (fromCmp) return -fromCmp;\r\n    var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);\r\n    if (toCmp) return toCmp;\r\n    return b.id - a.id;\r\n  }\r\n\r\n  // Find out whether a line ends or starts in a collapsed span. If\r\n  // so, return the marker for that span.\r\n  function collapsedSpanAtSide(line, start) {\r\n    var sps = sawCollapsedSpans && line.markedSpans, found;\r\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\r\n      sp = sps[i];\r\n      if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&\r\n          (!found || compareCollapsedMarkers(found, sp.marker) < 0))\r\n        found = sp.marker;\r\n    }\r\n    return found;\r\n  }\r\n  function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true); }\r\n  function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false); }\r\n\r\n  // Test whether there exists a collapsed span that partially\r\n  // overlaps (covers the start or end, but not both) of a new span.\r\n  // Such overlap is not allowed.\r\n  function conflictingCollapsedRange(doc, lineNo, from, to, marker) {\r\n    var line = getLine(doc, lineNo);\r\n    var sps = sawCollapsedSpans && line.markedSpans;\r\n    if (sps) for (var i = 0; i < sps.length; ++i) {\r\n      var sp = sps[i];\r\n      if (!sp.marker.collapsed) continue;\r\n      var found = sp.marker.find(0);\r\n      var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);\r\n      var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);\r\n      if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) continue;\r\n      if (fromCmp <= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.to, from) >= 0 : cmp(found.to, from) > 0) ||\r\n          fromCmp >= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.from, to) <= 0 : cmp(found.from, to) < 0))\r\n        return true;\r\n    }\r\n  }\r\n\r\n  // A visual line is a line as drawn on the screen. Folding, for\r\n  // example, can cause multiple logical lines to appear on the same\r\n  // visual line. This finds the start of the visual line that the\r\n  // given line is part of (usually that is the line itself).\r\n  function visualLine(line) {\r\n    var merged;\r\n    while (merged = collapsedSpanAtStart(line))\r\n      line = merged.find(-1, true).line;\r\n    return line;\r\n  }\r\n\r\n  // Returns an array of logical lines that continue the visual line\r\n  // started by the argument, or undefined if there are no such lines.\r\n  function visualLineContinued(line) {\r\n    var merged, lines;\r\n    while (merged = collapsedSpanAtEnd(line)) {\r\n      line = merged.find(1, true).line;\r\n      (lines || (lines = [])).push(line);\r\n    }\r\n    return lines;\r\n  }\r\n\r\n  // Get the line number of the start of the visual line that the\r\n  // given line number is part of.\r\n  function visualLineNo(doc, lineN) {\r\n    var line = getLine(doc, lineN), vis = visualLine(line);\r\n    if (line == vis) return lineN;\r\n    return lineNo(vis);\r\n  }\r\n  // Get the line number of the start of the next visual line after\r\n  // the given line.\r\n  function visualLineEndNo(doc, lineN) {\r\n    if (lineN > doc.lastLine()) return lineN;\r\n    var line = getLine(doc, lineN), merged;\r\n    if (!lineIsHidden(doc, line)) return lineN;\r\n    while (merged = collapsedSpanAtEnd(line))\r\n      line = merged.find(1, true).line;\r\n    return lineNo(line) + 1;\r\n  }\r\n\r\n  // Compute whether a line is hidden. Lines count as hidden when they\r\n  // are part of a visual line that starts with another line, or when\r\n  // they are entirely covered by collapsed, non-widget span.\r\n  function lineIsHidden(doc, line) {\r\n    var sps = sawCollapsedSpans && line.markedSpans;\r\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\r\n      sp = sps[i];\r\n      if (!sp.marker.collapsed) continue;\r\n      if (sp.from == null) return true;\r\n      if (sp.marker.widgetNode) continue;\r\n      if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\r\n        return true;\r\n    }\r\n  }\r\n  function lineIsHiddenInner(doc, line, span) {\r\n    if (span.to == null) {\r\n      var end = span.marker.find(1, true);\r\n      return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker));\r\n    }\r\n    if (span.marker.inclusiveRight && span.to == line.text.length)\r\n      return true;\r\n    for (var sp, i = 0; i < line.markedSpans.length; ++i) {\r\n      sp = line.markedSpans[i];\r\n      if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&\r\n          (sp.to == null || sp.to != span.from) &&\r\n          (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\r\n          lineIsHiddenInner(doc, line, sp)) return true;\r\n    }\r\n  }\r\n\r\n  // LINE WIDGETS\r\n\r\n  // Line widgets are block elements displayed above or below a line.\r\n\r\n  var LineWidget = CodeMirror.LineWidget = function(doc, node, options) {\r\n    if (options) for (var opt in options) if (options.hasOwnProperty(opt))\r\n      this[opt] = options[opt];\r\n    this.doc = doc;\r\n    this.node = node;\r\n  };\r\n  eventMixin(LineWidget);\r\n\r\n  function adjustScrollWhenAboveVisible(cm, line, diff) {\r\n    if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))\r\n      addToScrollPos(cm, null, diff);\r\n  }\r\n\r\n  LineWidget.prototype.clear = function() {\r\n    var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);\r\n    if (no == null || !ws) return;\r\n    for (var i = 0; i < ws.length; ++i) if (ws[i] == this) ws.splice(i--, 1);\r\n    if (!ws.length) line.widgets = null;\r\n    var height = widgetHeight(this);\r\n    updateLineHeight(line, Math.max(0, line.height - height));\r\n    if (cm) runInOp(cm, function() {\r\n      adjustScrollWhenAboveVisible(cm, line, -height);\r\n      regLineChange(cm, no, \"widget\");\r\n    });\r\n  };\r\n  LineWidget.prototype.changed = function() {\r\n    var oldH = this.height, cm = this.doc.cm, line = this.line;\r\n    this.height = null;\r\n    var diff = widgetHeight(this) - oldH;\r\n    if (!diff) return;\r\n    updateLineHeight(line, line.height + diff);\r\n    if (cm) runInOp(cm, function() {\r\n      cm.curOp.forceUpdate = true;\r\n      adjustScrollWhenAboveVisible(cm, line, diff);\r\n    });\r\n  };\r\n\r\n  function widgetHeight(widget) {\r\n    if (widget.height != null) return widget.height;\r\n    var cm = widget.doc.cm;\r\n    if (!cm) return 0;\r\n    if (!contains(document.body, widget.node)) {\r\n      var parentStyle = \"position: relative;\";\r\n      if (widget.coverGutter)\r\n        parentStyle += \"margin-left: -\" + cm.display.gutters.offsetWidth + \"px;\";\r\n      if (widget.noHScroll)\r\n        parentStyle += \"width: \" + cm.display.wrapper.clientWidth + \"px;\";\r\n      removeChildrenAndAdd(cm.display.measure, elt(\"div\", [widget.node], null, parentStyle));\r\n    }\r\n    return widget.height = widget.node.parentNode.offsetHeight;\r\n  }\r\n\r\n  function addLineWidget(doc, handle, node, options) {\r\n    var widget = new LineWidget(doc, node, options);\r\n    var cm = doc.cm;\r\n    if (cm && widget.noHScroll) cm.display.alignWidgets = true;\r\n    changeLine(doc, handle, \"widget\", function(line) {\r\n      var widgets = line.widgets || (line.widgets = []);\r\n      if (widget.insertAt == null) widgets.push(widget);\r\n      else widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget);\r\n      widget.line = line;\r\n      if (cm && !lineIsHidden(doc, line)) {\r\n        var aboveVisible = heightAtLine(line) < doc.scrollTop;\r\n        updateLineHeight(line, line.height + widgetHeight(widget));\r\n        if (aboveVisible) addToScrollPos(cm, null, widget.height);\r\n        cm.curOp.forceUpdate = true;\r\n      }\r\n      return true;\r\n    });\r\n    return widget;\r\n  }\r\n\r\n  // LINE DATA STRUCTURE\r\n\r\n  // Line objects. These hold state related to a line, including\r\n  // highlighting info (the styles array).\r\n  var Line = CodeMirror.Line = function(text, markedSpans, estimateHeight) {\r\n    this.text = text;\r\n    attachMarkedSpans(this, markedSpans);\r\n    this.height = estimateHeight ? estimateHeight(this) : 1;\r\n  };\r\n  eventMixin(Line);\r\n  Line.prototype.lineNo = function() { return lineNo(this); };\r\n\r\n  // Change the content (text, markers) of a line. Automatically\r\n  // invalidates cached information and tries to re-estimate the\r\n  // line's height.\r\n  function updateLine(line, text, markedSpans, estimateHeight) {\r\n    line.text = text;\r\n    if (line.stateAfter) line.stateAfter = null;\r\n    if (line.styles) line.styles = null;\r\n    if (line.order != null) line.order = null;\r\n    detachMarkedSpans(line);\r\n    attachMarkedSpans(line, markedSpans);\r\n    var estHeight = estimateHeight ? estimateHeight(line) : 1;\r\n    if (estHeight != line.height) updateLineHeight(line, estHeight);\r\n  }\r\n\r\n  // Detach a line from the document tree and its markers.\r\n  function cleanUpLine(line) {\r\n    line.parent = null;\r\n    detachMarkedSpans(line);\r\n  }\r\n\r\n  function extractLineClasses(type, output) {\r\n    if (type) for (;;) {\r\n      var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);\r\n      if (!lineClass) break;\r\n      type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);\r\n      var prop = lineClass[1] ? \"bgClass\" : \"textClass\";\r\n      if (output[prop] == null)\r\n        output[prop] = lineClass[2];\r\n      else if (!(new RegExp(\"(?:^|\\s)\" + lineClass[2] + \"(?:$|\\s)\")).test(output[prop]))\r\n        output[prop] += \" \" + lineClass[2];\r\n    }\r\n    return type;\r\n  }\r\n\r\n  function callBlankLine(mode, state) {\r\n    if (mode.blankLine) return mode.blankLine(state);\r\n    if (!mode.innerMode) return;\r\n    var inner = CodeMirror.innerMode(mode, state);\r\n    if (inner.mode.blankLine) return inner.mode.blankLine(inner.state);\r\n  }\r\n\r\n  function readToken(mode, stream, state, inner) {\r\n    for (var i = 0; i < 10; i++) {\r\n      if (inner) inner[0] = CodeMirror.innerMode(mode, state).mode;\r\n      var style = mode.token(stream, state);\r\n      if (stream.pos > stream.start) return style;\r\n    }\r\n    throw new Error(\"Mode \" + mode.name + \" failed to advance stream.\");\r\n  }\r\n\r\n  // Utility for getTokenAt and getLineTokens\r\n  function takeToken(cm, pos, precise, asArray) {\r\n    function getObj(copy) {\r\n      return {start: stream.start, end: stream.pos,\r\n              string: stream.current(),\r\n              type: style || null,\r\n              state: copy ? copyState(doc.mode, state) : state};\r\n    }\r\n\r\n    var doc = cm.doc, mode = doc.mode, style;\r\n    pos = clipPos(doc, pos);\r\n    var line = getLine(doc, pos.line), state = getStateBefore(cm, pos.line, precise);\r\n    var stream = new StringStream(line.text, cm.options.tabSize), tokens;\r\n    if (asArray) tokens = [];\r\n    while ((asArray || stream.pos < pos.ch) && !stream.eol()) {\r\n      stream.start = stream.pos;\r\n      style = readToken(mode, stream, state);\r\n      if (asArray) tokens.push(getObj(true));\r\n    }\r\n    return asArray ? tokens : getObj();\r\n  }\r\n\r\n  // Run the given mode's parser over a line, calling f for each token.\r\n  function runMode(cm, text, mode, state, f, lineClasses, forceToEnd) {\r\n    var flattenSpans = mode.flattenSpans;\r\n    if (flattenSpans == null) flattenSpans = cm.options.flattenSpans;\r\n    var curStart = 0, curStyle = null;\r\n    var stream = new StringStream(text, cm.options.tabSize), style;\r\n    var inner = cm.options.addModeClass && [null];\r\n    if (text == \"\") extractLineClasses(callBlankLine(mode, state), lineClasses);\r\n    while (!stream.eol()) {\r\n      if (stream.pos > cm.options.maxHighlightLength) {\r\n        flattenSpans = false;\r\n        if (forceToEnd) processLine(cm, text, state, stream.pos);\r\n        stream.pos = text.length;\r\n        style = null;\r\n      } else {\r\n        style = extractLineClasses(readToken(mode, stream, state, inner), lineClasses);\r\n      }\r\n      if (inner) {\r\n        var mName = inner[0].name;\r\n        if (mName) style = \"m-\" + (style ? mName + \" \" + style : mName);\r\n      }\r\n      if (!flattenSpans || curStyle != style) {\r\n        while (curStart < stream.start) {\r\n          curStart = Math.min(stream.start, curStart + 50000);\r\n          f(curStart, curStyle);\r\n        }\r\n        curStyle = style;\r\n      }\r\n      stream.start = stream.pos;\r\n    }\r\n    while (curStart < stream.pos) {\r\n      // Webkit seems to refuse to render text nodes longer than 57444 characters\r\n      var pos = Math.min(stream.pos, curStart + 50000);\r\n      f(pos, curStyle);\r\n      curStart = pos;\r\n    }\r\n  }\r\n\r\n  // Compute a style array (an array starting with a mode generation\r\n  // -- for invalidation -- followed by pairs of end positions and\r\n  // style strings), which is used to highlight the tokens on the\r\n  // line.\r\n  function highlightLine(cm, line, state, forceToEnd) {\r\n    // A styles array always starts with a number identifying the\r\n    // mode/overlays that it is based on (for easy invalidation).\r\n    var st = [cm.state.modeGen], lineClasses = {};\r\n    // Compute the base array of styles\r\n    runMode(cm, line.text, cm.doc.mode, state, function(end, style) {\r\n      st.push(end, style);\r\n    }, lineClasses, forceToEnd);\r\n\r\n    // Run overlays, adjust style array.\r\n    for (var o = 0; o < cm.state.overlays.length; ++o) {\r\n      var overlay = cm.state.overlays[o], i = 1, at = 0;\r\n      runMode(cm, line.text, overlay.mode, true, function(end, style) {\r\n        var start = i;\r\n        // Ensure there's a token end at the current position, and that i points at it\r\n        while (at < end) {\r\n          var i_end = st[i];\r\n          if (i_end > end)\r\n            st.splice(i, 1, end, st[i+1], i_end);\r\n          i += 2;\r\n          at = Math.min(end, i_end);\r\n        }\r\n        if (!style) return;\r\n        if (overlay.opaque) {\r\n          st.splice(start, i - start, end, \"cm-overlay \" + style);\r\n          i = start + 2;\r\n        } else {\r\n          for (; start < i; start += 2) {\r\n            var cur = st[start+1];\r\n            st[start+1] = (cur ? cur + \" \" : \"\") + \"cm-overlay \" + style;\r\n          }\r\n        }\r\n      }, lineClasses);\r\n    }\r\n\r\n    return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null};\r\n  }\r\n\r\n  function getLineStyles(cm, line, updateFrontier) {\r\n    if (!line.styles || line.styles[0] != cm.state.modeGen) {\r\n      var state = getStateBefore(cm, lineNo(line));\r\n      var result = highlightLine(cm, line, line.text.length > cm.options.maxHighlightLength ? copyState(cm.doc.mode, state) : state);\r\n      line.stateAfter = state;\r\n      line.styles = result.styles;\r\n      if (result.classes) line.styleClasses = result.classes;\r\n      else if (line.styleClasses) line.styleClasses = null;\r\n      if (updateFrontier === cm.doc.frontier) cm.doc.frontier++;\r\n    }\r\n    return line.styles;\r\n  }\r\n\r\n  // Lightweight form of highlight -- proceed over this line and\r\n  // update state, but don't save a style array. Used for lines that\r\n  // aren't currently visible.\r\n  function processLine(cm, text, state, startAt) {\r\n    var mode = cm.doc.mode;\r\n    var stream = new StringStream(text, cm.options.tabSize);\r\n    stream.start = stream.pos = startAt || 0;\r\n    if (text == \"\") callBlankLine(mode, state);\r\n    while (!stream.eol()) {\r\n      readToken(mode, stream, state);\r\n      stream.start = stream.pos;\r\n    }\r\n  }\r\n\r\n  // Convert a style as returned by a mode (either null, or a string\r\n  // containing one or more styles) to a CSS style. This is cached,\r\n  // and also looks for line-wide styles.\r\n  var styleToClassCache = {}, styleToClassCacheWithMode = {};\r\n  function interpretTokenStyle(style, options) {\r\n    if (!style || /^\\s*$/.test(style)) return null;\r\n    var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;\r\n    return cache[style] ||\r\n      (cache[style] = style.replace(/\\S+/g, \"cm-$&\"));\r\n  }\r\n\r\n  // Render the DOM representation of the text of a line. Also builds\r\n  // up a 'line map', which points at the DOM nodes that represent\r\n  // specific stretches of text, and is used by the measuring code.\r\n  // The returned object contains the DOM node, this map, and\r\n  // information about line-wide styles that were set by the mode.\r\n  function buildLineContent(cm, lineView) {\r\n    // The padding-right forces the element to have a 'border', which\r\n    // is needed on Webkit to be able to get line-level bounding\r\n    // rectangles for it (in measureChar).\r\n    var content = elt(\"span\", null, null, webkit ? \"padding-right: .1px\" : null);\r\n    var builder = {pre: elt(\"pre\", [content], \"CodeMirror-line\"), content: content,\r\n                   col: 0, pos: 0, cm: cm,\r\n                   trailingSpace: false,\r\n                   splitSpaces: (ie || webkit) && cm.getOption(\"lineWrapping\")};\r\n    lineView.measure = {};\r\n\r\n    // Iterate over the logical lines that make up this visual line.\r\n    for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {\r\n      var line = i ? lineView.rest[i - 1] : lineView.line, order;\r\n      builder.pos = 0;\r\n      builder.addToken = buildToken;\r\n      // Optionally wire in some hacks into the token-rendering\r\n      // algorithm, to deal with browser quirks.\r\n      if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line)))\r\n        builder.addToken = buildTokenBadBidi(builder.addToken, order);\r\n      builder.map = [];\r\n      var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);\r\n      insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));\r\n      if (line.styleClasses) {\r\n        if (line.styleClasses.bgClass)\r\n          builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || \"\");\r\n        if (line.styleClasses.textClass)\r\n          builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || \"\");\r\n      }\r\n\r\n      // Ensure at least a single node is present, for measuring.\r\n      if (builder.map.length == 0)\r\n        builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure)));\r\n\r\n      // Store the map and a cache object for the current logical line\r\n      if (i == 0) {\r\n        lineView.measure.map = builder.map;\r\n        lineView.measure.cache = {};\r\n      } else {\r\n        (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map);\r\n        (lineView.measure.caches || (lineView.measure.caches = [])).push({});\r\n      }\r\n    }\r\n\r\n    // See issue #2901\r\n    if (webkit) {\r\n      var last = builder.content.lastChild\r\n      if (/\\bcm-tab\\b/.test(last.className) || (last.querySelector && last.querySelector(\".cm-tab\")))\r\n        builder.content.className = \"cm-tab-wrap-hack\";\r\n    }\r\n\r\n    signal(cm, \"renderLine\", cm, lineView.line, builder.pre);\r\n    if (builder.pre.className)\r\n      builder.textClass = joinClasses(builder.pre.className, builder.textClass || \"\");\r\n\r\n    return builder;\r\n  }\r\n\r\n  function defaultSpecialCharPlaceholder(ch) {\r\n    var token = elt(\"span\", \"\\u2022\", \"cm-invalidchar\");\r\n    token.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);\r\n    token.setAttribute(\"aria-label\", token.title);\r\n    return token;\r\n  }\r\n\r\n  // Build up the DOM representation for a single token, and add it to\r\n  // the line map. Takes care to render special characters separately.\r\n  function buildToken(builder, text, style, startStyle, endStyle, title, css) {\r\n    if (!text) return;\r\n    var displayText = builder.splitSpaces ? splitSpaces(text, builder.trailingSpace) : text\r\n    var special = builder.cm.state.specialChars, mustWrap = false;\r\n    if (!special.test(text)) {\r\n      builder.col += text.length;\r\n      var content = document.createTextNode(displayText);\r\n      builder.map.push(builder.pos, builder.pos + text.length, content);\r\n      if (ie && ie_version < 9) mustWrap = true;\r\n      builder.pos += text.length;\r\n    } else {\r\n      var content = document.createDocumentFragment(), pos = 0;\r\n      while (true) {\r\n        special.lastIndex = pos;\r\n        var m = special.exec(text);\r\n        var skipped = m ? m.index - pos : text.length - pos;\r\n        if (skipped) {\r\n          var txt = document.createTextNode(displayText.slice(pos, pos + skipped));\r\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\r\n          else content.appendChild(txt);\r\n          builder.map.push(builder.pos, builder.pos + skipped, txt);\r\n          builder.col += skipped;\r\n          builder.pos += skipped;\r\n        }\r\n        if (!m) break;\r\n        pos += skipped + 1;\r\n        if (m[0] == \"\\t\") {\r\n          var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\r\n          var txt = content.appendChild(elt(\"span\", spaceStr(tabWidth), \"cm-tab\"));\r\n          txt.setAttribute(\"role\", \"presentation\");\r\n          txt.setAttribute(\"cm-text\", \"\\t\");\r\n          builder.col += tabWidth;\r\n        } else if (m[0] == \"\\r\" || m[0] == \"\\n\") {\r\n          var txt = content.appendChild(elt(\"span\", m[0] == \"\\r\" ? \"\\u240d\" : \"\\u2424\", \"cm-invalidchar\"));\r\n          txt.setAttribute(\"cm-text\", m[0]);\r\n          builder.col += 1;\r\n        } else {\r\n          var txt = builder.cm.options.specialCharPlaceholder(m[0]);\r\n          txt.setAttribute(\"cm-text\", m[0]);\r\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\r\n          else content.appendChild(txt);\r\n          builder.col += 1;\r\n        }\r\n        builder.map.push(builder.pos, builder.pos + 1, txt);\r\n        builder.pos++;\r\n      }\r\n    }\r\n    builder.trailingSpace = displayText.charCodeAt(text.length - 1) == 32\r\n    if (style || startStyle || endStyle || mustWrap || css) {\r\n      var fullStyle = style || \"\";\r\n      if (startStyle) fullStyle += startStyle;\r\n      if (endStyle) fullStyle += endStyle;\r\n      var token = elt(\"span\", [content], fullStyle, css);\r\n      if (title) token.title = title;\r\n      return builder.content.appendChild(token);\r\n    }\r\n    builder.content.appendChild(content);\r\n  }\r\n\r\n  function splitSpaces(text, trailingBefore) {\r\n    if (text.length > 1 && !/  /.test(text)) return text\r\n    var spaceBefore = trailingBefore, result = \"\"\r\n    for (var i = 0; i < text.length; i++) {\r\n      var ch = text.charAt(i)\r\n      if (ch == \" \" && spaceBefore && (i == text.length - 1 || text.charCodeAt(i + 1) == 32))\r\n        ch = \"\\u00a0\"\r\n      result += ch\r\n      spaceBefore = ch == \" \"\r\n    }\r\n    return result\r\n  }\r\n\r\n  // Work around nonsense dimensions being reported for stretches of\r\n  // right-to-left text.\r\n  function buildTokenBadBidi(inner, order) {\r\n    return function(builder, text, style, startStyle, endStyle, title, css) {\r\n      style = style ? style + \" cm-force-border\" : \"cm-force-border\";\r\n      var start = builder.pos, end = start + text.length;\r\n      for (;;) {\r\n        // Find the part that overlaps with the start of this text\r\n        for (var i = 0; i < order.length; i++) {\r\n          var part = order[i];\r\n          if (part.to > start && part.from <= start) break;\r\n        }\r\n        if (part.to >= end) return inner(builder, text, style, startStyle, endStyle, title, css);\r\n        inner(builder, text.slice(0, part.to - start), style, startStyle, null, title, css);\r\n        startStyle = null;\r\n        text = text.slice(part.to - start);\r\n        start = part.to;\r\n      }\r\n    };\r\n  }\r\n\r\n  function buildCollapsedSpan(builder, size, marker, ignoreWidget) {\r\n    var widget = !ignoreWidget && marker.widgetNode;\r\n    if (widget) builder.map.push(builder.pos, builder.pos + size, widget);\r\n    if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {\r\n      if (!widget)\r\n        widget = builder.content.appendChild(document.createElement(\"span\"));\r\n      widget.setAttribute(\"cm-marker\", marker.id);\r\n    }\r\n    if (widget) {\r\n      builder.cm.display.input.setUneditable(widget);\r\n      builder.content.appendChild(widget);\r\n    }\r\n    builder.pos += size;\r\n    builder.trailingSpace = false\r\n  }\r\n\r\n  // Outputs a number of spans to make up a line, taking highlighting\r\n  // and marked text into account.\r\n  function insertLineContent(line, builder, styles) {\r\n    var spans = line.markedSpans, allText = line.text, at = 0;\r\n    if (!spans) {\r\n      for (var i = 1; i < styles.length; i+=2)\r\n        builder.addToken(builder, allText.slice(at, at = styles[i]), interpretTokenStyle(styles[i+1], builder.cm.options));\r\n      return;\r\n    }\r\n\r\n    var len = allText.length, pos = 0, i = 1, text = \"\", style, css;\r\n    var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;\r\n    for (;;) {\r\n      if (nextChange == pos) { // Update current marker set\r\n        spanStyle = spanEndStyle = spanStartStyle = title = css = \"\";\r\n        collapsed = null; nextChange = Infinity;\r\n        var foundBookmarks = [], endStyles\r\n        for (var j = 0; j < spans.length; ++j) {\r\n          var sp = spans[j], m = sp.marker;\r\n          if (m.type == \"bookmark\" && sp.from == pos && m.widgetNode) {\r\n            foundBookmarks.push(m);\r\n          } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {\r\n            if (sp.to != null && sp.to != pos && nextChange > sp.to) {\r\n              nextChange = sp.to;\r\n              spanEndStyle = \"\";\r\n            }\r\n            if (m.className) spanStyle += \" \" + m.className;\r\n            if (m.css) css = (css ? css + \";\" : \"\") + m.css;\r\n            if (m.startStyle && sp.from == pos) spanStartStyle += \" \" + m.startStyle;\r\n            if (m.endStyle && sp.to == nextChange) (endStyles || (endStyles = [])).push(m.endStyle, sp.to)\r\n            if (m.title && !title) title = m.title;\r\n            if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))\r\n              collapsed = sp;\r\n          } else if (sp.from > pos && nextChange > sp.from) {\r\n            nextChange = sp.from;\r\n          }\r\n        }\r\n        if (endStyles) for (var j = 0; j < endStyles.length; j += 2)\r\n          if (endStyles[j + 1] == nextChange) spanEndStyle += \" \" + endStyles[j]\r\n\r\n        if (!collapsed || collapsed.from == pos) for (var j = 0; j < foundBookmarks.length; ++j)\r\n          buildCollapsedSpan(builder, 0, foundBookmarks[j]);\r\n        if (collapsed && (collapsed.from || 0) == pos) {\r\n          buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,\r\n                             collapsed.marker, collapsed.from == null);\r\n          if (collapsed.to == null) return;\r\n          if (collapsed.to == pos) collapsed = false;\r\n        }\r\n      }\r\n      if (pos >= len) break;\r\n\r\n      var upto = Math.min(len, nextChange);\r\n      while (true) {\r\n        if (text) {\r\n          var end = pos + text.length;\r\n          if (!collapsed) {\r\n            var tokenText = end > upto ? text.slice(0, upto - pos) : text;\r\n            builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\r\n                             spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : \"\", title, css);\r\n          }\r\n          if (end >= upto) {text = text.slice(upto - pos); pos = upto; break;}\r\n          pos = end;\r\n          spanStartStyle = \"\";\r\n        }\r\n        text = allText.slice(at, at = styles[i++]);\r\n        style = interpretTokenStyle(styles[i++], builder.cm.options);\r\n      }\r\n    }\r\n  }\r\n\r\n  // DOCUMENT DATA STRUCTURE\r\n\r\n  // By default, updates that start and end at the beginning of a line\r\n  // are treated specially, in order to make the association of line\r\n  // widgets and marker elements with the text behave more intuitive.\r\n  function isWholeLineUpdate(doc, change) {\r\n    return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == \"\" &&\r\n      (!doc.cm || doc.cm.options.wholeLineUpdateBefore);\r\n  }\r\n\r\n  // Perform a change on the document data structure.\r\n  function updateDoc(doc, change, markedSpans, estimateHeight) {\r\n    function spansFor(n) {return markedSpans ? markedSpans[n] : null;}\r\n    function update(line, text, spans) {\r\n      updateLine(line, text, spans, estimateHeight);\r\n      signalLater(line, \"change\", line, change);\r\n    }\r\n    function linesFor(start, end) {\r\n      for (var i = start, result = []; i < end; ++i)\r\n        result.push(new Line(text[i], spansFor(i), estimateHeight));\r\n      return result;\r\n    }\r\n\r\n    var from = change.from, to = change.to, text = change.text;\r\n    var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\r\n    var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\r\n\r\n    // Adjust the line structure\r\n    if (change.full) {\r\n      doc.insert(0, linesFor(0, text.length));\r\n      doc.remove(text.length, doc.size - text.length);\r\n    } else if (isWholeLineUpdate(doc, change)) {\r\n      // This is a whole-line replace. Treated specially to make\r\n      // sure line objects move the way they are supposed to.\r\n      var added = linesFor(0, text.length - 1);\r\n      update(lastLine, lastLine.text, lastSpans);\r\n      if (nlines) doc.remove(from.line, nlines);\r\n      if (added.length) doc.insert(from.line, added);\r\n    } else if (firstLine == lastLine) {\r\n      if (text.length == 1) {\r\n        update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\r\n      } else {\r\n        var added = linesFor(1, text.length - 1);\r\n        added.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));\r\n        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\r\n        doc.insert(from.line + 1, added);\r\n      }\r\n    } else if (text.length == 1) {\r\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\r\n      doc.remove(from.line + 1, nlines);\r\n    } else {\r\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\r\n      update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\r\n      var added = linesFor(1, text.length - 1);\r\n      if (nlines > 1) doc.remove(from.line + 1, nlines - 1);\r\n      doc.insert(from.line + 1, added);\r\n    }\r\n\r\n    signalLater(doc, \"change\", doc, change);\r\n  }\r\n\r\n  // The document is represented as a BTree consisting of leaves, with\r\n  // chunk of lines in them, and branches, with up to ten leaves or\r\n  // other branch nodes below them. The top node is always a branch\r\n  // node, and is the document object itself (meaning it has\r\n  // additional methods and properties).\r\n  //\r\n  // All nodes have parent links. The tree is used both to go from\r\n  // line numbers to line objects, and to go from objects to numbers.\r\n  // It also indexes by height, and is used to convert between height\r\n  // and line object, and to find the total height of the document.\r\n  //\r\n  // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html\r\n\r\n  function LeafChunk(lines) {\r\n    this.lines = lines;\r\n    this.parent = null;\r\n    for (var i = 0, height = 0; i < lines.length; ++i) {\r\n      lines[i].parent = this;\r\n      height += lines[i].height;\r\n    }\r\n    this.height = height;\r\n  }\r\n\r\n  LeafChunk.prototype = {\r\n    chunkSize: function() { return this.lines.length; },\r\n    // Remove the n lines at offset 'at'.\r\n    removeInner: function(at, n) {\r\n      for (var i = at, e = at + n; i < e; ++i) {\r\n        var line = this.lines[i];\r\n        this.height -= line.height;\r\n        cleanUpLine(line);\r\n        signalLater(line, \"delete\");\r\n      }\r\n      this.lines.splice(at, n);\r\n    },\r\n    // Helper used to collapse a small branch into a single leaf.\r\n    collapse: function(lines) {\r\n      lines.push.apply(lines, this.lines);\r\n    },\r\n    // Insert the given array of lines at offset 'at', count them as\r\n    // having the given height.\r\n    insertInner: function(at, lines, height) {\r\n      this.height += height;\r\n      this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\r\n      for (var i = 0; i < lines.length; ++i) lines[i].parent = this;\r\n    },\r\n    // Used to iterate over a part of the tree.\r\n    iterN: function(at, n, op) {\r\n      for (var e = at + n; at < e; ++at)\r\n        if (op(this.lines[at])) return true;\r\n    }\r\n  };\r\n\r\n  function BranchChunk(children) {\r\n    this.children = children;\r\n    var size = 0, height = 0;\r\n    for (var i = 0; i < children.length; ++i) {\r\n      var ch = children[i];\r\n      size += ch.chunkSize(); height += ch.height;\r\n      ch.parent = this;\r\n    }\r\n    this.size = size;\r\n    this.height = height;\r\n    this.parent = null;\r\n  }\r\n\r\n  BranchChunk.prototype = {\r\n    chunkSize: function() { return this.size; },\r\n    removeInner: function(at, n) {\r\n      this.size -= n;\r\n      for (var i = 0; i < this.children.length; ++i) {\r\n        var child = this.children[i], sz = child.chunkSize();\r\n        if (at < sz) {\r\n          var rm = Math.min(n, sz - at), oldHeight = child.height;\r\n          child.removeInner(at, rm);\r\n          this.height -= oldHeight - child.height;\r\n          if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }\r\n          if ((n -= rm) == 0) break;\r\n          at = 0;\r\n        } else at -= sz;\r\n      }\r\n      // If the result is smaller than 25 lines, ensure that it is a\r\n      // single leaf node.\r\n      if (this.size - n < 25 &&\r\n          (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {\r\n        var lines = [];\r\n        this.collapse(lines);\r\n        this.children = [new LeafChunk(lines)];\r\n        this.children[0].parent = this;\r\n      }\r\n    },\r\n    collapse: function(lines) {\r\n      for (var i = 0; i < this.children.length; ++i) this.children[i].collapse(lines);\r\n    },\r\n    insertInner: function(at, lines, height) {\r\n      this.size += lines.length;\r\n      this.height += height;\r\n      for (var i = 0; i < this.children.length; ++i) {\r\n        var child = this.children[i], sz = child.chunkSize();\r\n        if (at <= sz) {\r\n          child.insertInner(at, lines, height);\r\n          if (child.lines && child.lines.length > 50) {\r\n            // To avoid memory thrashing when child.lines is huge (e.g. first view of a large file), it's never spliced.\r\n            // Instead, small slices are taken. They're taken in order because sequential memory accesses are fastest.\r\n            var remaining = child.lines.length % 25 + 25\r\n            for (var pos = remaining; pos < child.lines.length;) {\r\n              var leaf = new LeafChunk(child.lines.slice(pos, pos += 25));\r\n              child.height -= leaf.height;\r\n              this.children.splice(++i, 0, leaf);\r\n              leaf.parent = this;\r\n            }\r\n            child.lines = child.lines.slice(0, remaining);\r\n            this.maybeSpill();\r\n          }\r\n          break;\r\n        }\r\n        at -= sz;\r\n      }\r\n    },\r\n    // When a node has grown, check whether it should be split.\r\n    maybeSpill: function() {\r\n      if (this.children.length <= 10) return;\r\n      var me = this;\r\n      do {\r\n        var spilled = me.children.splice(me.children.length - 5, 5);\r\n        var sibling = new BranchChunk(spilled);\r\n        if (!me.parent) { // Become the parent node\r\n          var copy = new BranchChunk(me.children);\r\n          copy.parent = me;\r\n          me.children = [copy, sibling];\r\n          me = copy;\r\n       } else {\r\n          me.size -= sibling.size;\r\n          me.height -= sibling.height;\r\n          var myIndex = indexOf(me.parent.children, me);\r\n          me.parent.children.splice(myIndex + 1, 0, sibling);\r\n        }\r\n        sibling.parent = me.parent;\r\n      } while (me.children.length > 10);\r\n      me.parent.maybeSpill();\r\n    },\r\n    iterN: function(at, n, op) {\r\n      for (var i = 0; i < this.children.length; ++i) {\r\n        var child = this.children[i], sz = child.chunkSize();\r\n        if (at < sz) {\r\n          var used = Math.min(n, sz - at);\r\n          if (child.iterN(at, used, op)) return true;\r\n          if ((n -= used) == 0) break;\r\n          at = 0;\r\n        } else at -= sz;\r\n      }\r\n    }\r\n  };\r\n\r\n  var nextDocId = 0;\r\n  var Doc = CodeMirror.Doc = function(text, mode, firstLine, lineSep) {\r\n    if (!(this instanceof Doc)) return new Doc(text, mode, firstLine, lineSep);\r\n    if (firstLine == null) firstLine = 0;\r\n\r\n    BranchChunk.call(this, [new LeafChunk([new Line(\"\", null)])]);\r\n    this.first = firstLine;\r\n    this.scrollTop = this.scrollLeft = 0;\r\n    this.cantEdit = false;\r\n    this.cleanGeneration = 1;\r\n    this.frontier = firstLine;\r\n    var start = Pos(firstLine, 0);\r\n    this.sel = simpleSelection(start);\r\n    this.history = new History(null);\r\n    this.id = ++nextDocId;\r\n    this.modeOption = mode;\r\n    this.lineSep = lineSep;\r\n    this.extend = false;\r\n\r\n    if (typeof text == \"string\") text = this.splitLines(text);\r\n    updateDoc(this, {from: start, to: start, text: text});\r\n    setSelection(this, simpleSelection(start), sel_dontScroll);\r\n  };\r\n\r\n  Doc.prototype = createObj(BranchChunk.prototype, {\r\n    constructor: Doc,\r\n    // Iterate over the document. Supports two forms -- with only one\r\n    // argument, it calls that for each line in the document. With\r\n    // three, it iterates over the range given by the first two (with\r\n    // the second being non-inclusive).\r\n    iter: function(from, to, op) {\r\n      if (op) this.iterN(from - this.first, to - from, op);\r\n      else this.iterN(this.first, this.first + this.size, from);\r\n    },\r\n\r\n    // Non-public interface for adding and removing lines.\r\n    insert: function(at, lines) {\r\n      var height = 0;\r\n      for (var i = 0; i < lines.length; ++i) height += lines[i].height;\r\n      this.insertInner(at - this.first, lines, height);\r\n    },\r\n    remove: function(at, n) { this.removeInner(at - this.first, n); },\r\n\r\n    // From here, the methods are part of the public interface. Most\r\n    // are also available from CodeMirror (editor) instances.\r\n\r\n    getValue: function(lineSep) {\r\n      var lines = getLines(this, this.first, this.first + this.size);\r\n      if (lineSep === false) return lines;\r\n      return lines.join(lineSep || this.lineSeparator());\r\n    },\r\n    setValue: docMethodOp(function(code) {\r\n      var top = Pos(this.first, 0), last = this.first + this.size - 1;\r\n      makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\r\n                        text: this.splitLines(code), origin: \"setValue\", full: true}, true);\r\n      setSelection(this, simpleSelection(top));\r\n    }),\r\n    replaceRange: function(code, from, to, origin) {\r\n      from = clipPos(this, from);\r\n      to = to ? clipPos(this, to) : from;\r\n      replaceRange(this, code, from, to, origin);\r\n    },\r\n    getRange: function(from, to, lineSep) {\r\n      var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\r\n      if (lineSep === false) return lines;\r\n      return lines.join(lineSep || this.lineSeparator());\r\n    },\r\n\r\n    getLine: function(line) {var l = this.getLineHandle(line); return l && l.text;},\r\n\r\n    getLineHandle: function(line) {if (isLine(this, line)) return getLine(this, line);},\r\n    getLineNumber: function(line) {return lineNo(line);},\r\n\r\n    getLineHandleVisualStart: function(line) {\r\n      if (typeof line == \"number\") line = getLine(this, line);\r\n      return visualLine(line);\r\n    },\r\n\r\n    lineCount: function() {return this.size;},\r\n    firstLine: function() {return this.first;},\r\n    lastLine: function() {return this.first + this.size - 1;},\r\n\r\n    clipPos: function(pos) {return clipPos(this, pos);},\r\n\r\n    getCursor: function(start) {\r\n      var range = this.sel.primary(), pos;\r\n      if (start == null || start == \"head\") pos = range.head;\r\n      else if (start == \"anchor\") pos = range.anchor;\r\n      else if (start == \"end\" || start == \"to\" || start === false) pos = range.to();\r\n      else pos = range.from();\r\n      return pos;\r\n    },\r\n    listSelections: function() { return this.sel.ranges; },\r\n    somethingSelected: function() {return this.sel.somethingSelected();},\r\n\r\n    setCursor: docMethodOp(function(line, ch, options) {\r\n      setSimpleSelection(this, clipPos(this, typeof line == \"number\" ? Pos(line, ch || 0) : line), null, options);\r\n    }),\r\n    setSelection: docMethodOp(function(anchor, head, options) {\r\n      setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);\r\n    }),\r\n    extendSelection: docMethodOp(function(head, other, options) {\r\n      extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);\r\n    }),\r\n    extendSelections: docMethodOp(function(heads, options) {\r\n      extendSelections(this, clipPosArray(this, heads), options);\r\n    }),\r\n    extendSelectionsBy: docMethodOp(function(f, options) {\r\n      var heads = map(this.sel.ranges, f);\r\n      extendSelections(this, clipPosArray(this, heads), options);\r\n    }),\r\n    setSelections: docMethodOp(function(ranges, primary, options) {\r\n      if (!ranges.length) return;\r\n      for (var i = 0, out = []; i < ranges.length; i++)\r\n        out[i] = new Range(clipPos(this, ranges[i].anchor),\r\n                           clipPos(this, ranges[i].head));\r\n      if (primary == null) primary = Math.min(ranges.length - 1, this.sel.primIndex);\r\n      setSelection(this, normalizeSelection(out, primary), options);\r\n    }),\r\n    addSelection: docMethodOp(function(anchor, head, options) {\r\n      var ranges = this.sel.ranges.slice(0);\r\n      ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));\r\n      setSelection(this, normalizeSelection(ranges, ranges.length - 1), options);\r\n    }),\r\n\r\n    getSelection: function(lineSep) {\r\n      var ranges = this.sel.ranges, lines;\r\n      for (var i = 0; i < ranges.length; i++) {\r\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\r\n        lines = lines ? lines.concat(sel) : sel;\r\n      }\r\n      if (lineSep === false) return lines;\r\n      else return lines.join(lineSep || this.lineSeparator());\r\n    },\r\n    getSelections: function(lineSep) {\r\n      var parts = [], ranges = this.sel.ranges;\r\n      for (var i = 0; i < ranges.length; i++) {\r\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\r\n        if (lineSep !== false) sel = sel.join(lineSep || this.lineSeparator());\r\n        parts[i] = sel;\r\n      }\r\n      return parts;\r\n    },\r\n    replaceSelection: function(code, collapse, origin) {\r\n      var dup = [];\r\n      for (var i = 0; i < this.sel.ranges.length; i++)\r\n        dup[i] = code;\r\n      this.replaceSelections(dup, collapse, origin || \"+input\");\r\n    },\r\n    replaceSelections: docMethodOp(function(code, collapse, origin) {\r\n      var changes = [], sel = this.sel;\r\n      for (var i = 0; i < sel.ranges.length; i++) {\r\n        var range = sel.ranges[i];\r\n        changes[i] = {from: range.from(), to: range.to(), text: this.splitLines(code[i]), origin: origin};\r\n      }\r\n      var newSel = collapse && collapse != \"end\" && computeReplacedSel(this, changes, collapse);\r\n      for (var i = changes.length - 1; i >= 0; i--)\r\n        makeChange(this, changes[i]);\r\n      if (newSel) setSelectionReplaceHistory(this, newSel);\r\n      else if (this.cm) ensureCursorVisible(this.cm);\r\n    }),\r\n    undo: docMethodOp(function() {makeChangeFromHistory(this, \"undo\");}),\r\n    redo: docMethodOp(function() {makeChangeFromHistory(this, \"redo\");}),\r\n    undoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"undo\", true);}),\r\n    redoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"redo\", true);}),\r\n\r\n    setExtending: function(val) {this.extend = val;},\r\n    getExtending: function() {return this.extend;},\r\n\r\n    historySize: function() {\r\n      var hist = this.history, done = 0, undone = 0;\r\n      for (var i = 0; i < hist.done.length; i++) if (!hist.done[i].ranges) ++done;\r\n      for (var i = 0; i < hist.undone.length; i++) if (!hist.undone[i].ranges) ++undone;\r\n      return {undo: done, redo: undone};\r\n    },\r\n    clearHistory: function() {this.history = new History(this.history.maxGeneration);},\r\n\r\n    markClean: function() {\r\n      this.cleanGeneration = this.changeGeneration(true);\r\n    },\r\n    changeGeneration: function(forceSplit) {\r\n      if (forceSplit)\r\n        this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;\r\n      return this.history.generation;\r\n    },\r\n    isClean: function (gen) {\r\n      return this.history.generation == (gen || this.cleanGeneration);\r\n    },\r\n\r\n    getHistory: function() {\r\n      return {done: copyHistoryArray(this.history.done),\r\n              undone: copyHistoryArray(this.history.undone)};\r\n    },\r\n    setHistory: function(histData) {\r\n      var hist = this.history = new History(this.history.maxGeneration);\r\n      hist.done = copyHistoryArray(histData.done.slice(0), null, true);\r\n      hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);\r\n    },\r\n\r\n    addLineClass: docMethodOp(function(handle, where, cls) {\r\n      return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function(line) {\r\n        var prop = where == \"text\" ? \"textClass\"\r\n                 : where == \"background\" ? \"bgClass\"\r\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\r\n        if (!line[prop]) line[prop] = cls;\r\n        else if (classTest(cls).test(line[prop])) return false;\r\n        else line[prop] += \" \" + cls;\r\n        return true;\r\n      });\r\n    }),\r\n    removeLineClass: docMethodOp(function(handle, where, cls) {\r\n      return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function(line) {\r\n        var prop = where == \"text\" ? \"textClass\"\r\n                 : where == \"background\" ? \"bgClass\"\r\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\r\n        var cur = line[prop];\r\n        if (!cur) return false;\r\n        else if (cls == null) line[prop] = null;\r\n        else {\r\n          var found = cur.match(classTest(cls));\r\n          if (!found) return false;\r\n          var end = found.index + found[0].length;\r\n          line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? \"\" : \" \") + cur.slice(end) || null;\r\n        }\r\n        return true;\r\n      });\r\n    }),\r\n\r\n    addLineWidget: docMethodOp(function(handle, node, options) {\r\n      return addLineWidget(this, handle, node, options);\r\n    }),\r\n    removeLineWidget: function(widget) { widget.clear(); },\r\n\r\n    markText: function(from, to, options) {\r\n      return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || \"range\");\r\n    },\r\n    setBookmark: function(pos, options) {\r\n      var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\r\n                      insertLeft: options && options.insertLeft,\r\n                      clearWhenEmpty: false, shared: options && options.shared,\r\n                      handleMouseEvents: options && options.handleMouseEvents};\r\n      pos = clipPos(this, pos);\r\n      return markText(this, pos, pos, realOpts, \"bookmark\");\r\n    },\r\n    findMarksAt: function(pos) {\r\n      pos = clipPos(this, pos);\r\n      var markers = [], spans = getLine(this, pos.line).markedSpans;\r\n      if (spans) for (var i = 0; i < spans.length; ++i) {\r\n        var span = spans[i];\r\n        if ((span.from == null || span.from <= pos.ch) &&\r\n            (span.to == null || span.to >= pos.ch))\r\n          markers.push(span.marker.parent || span.marker);\r\n      }\r\n      return markers;\r\n    },\r\n    findMarks: function(from, to, filter) {\r\n      from = clipPos(this, from); to = clipPos(this, to);\r\n      var found = [], lineNo = from.line;\r\n      this.iter(from.line, to.line + 1, function(line) {\r\n        var spans = line.markedSpans;\r\n        if (spans) for (var i = 0; i < spans.length; i++) {\r\n          var span = spans[i];\r\n          if (!(span.to != null && lineNo == from.line && from.ch >= span.to ||\r\n                span.from == null && lineNo != from.line ||\r\n                span.from != null && lineNo == to.line && span.from >= to.ch) &&\r\n              (!filter || filter(span.marker)))\r\n            found.push(span.marker.parent || span.marker);\r\n        }\r\n        ++lineNo;\r\n      });\r\n      return found;\r\n    },\r\n    getAllMarks: function() {\r\n      var markers = [];\r\n      this.iter(function(line) {\r\n        var sps = line.markedSpans;\r\n        if (sps) for (var i = 0; i < sps.length; ++i)\r\n          if (sps[i].from != null) markers.push(sps[i].marker);\r\n      });\r\n      return markers;\r\n    },\r\n\r\n    posFromIndex: function(off) {\r\n      var ch, lineNo = this.first, sepSize = this.lineSeparator().length;\r\n      this.iter(function(line) {\r\n        var sz = line.text.length + sepSize;\r\n        if (sz > off) { ch = off; return true; }\r\n        off -= sz;\r\n        ++lineNo;\r\n      });\r\n      return clipPos(this, Pos(lineNo, ch));\r\n    },\r\n    indexFromPos: function (coords) {\r\n      coords = clipPos(this, coords);\r\n      var index = coords.ch;\r\n      if (coords.line < this.first || coords.ch < 0) return 0;\r\n      var sepSize = this.lineSeparator().length;\r\n      this.iter(this.first, coords.line, function (line) {\r\n        index += line.text.length + sepSize;\r\n      });\r\n      return index;\r\n    },\r\n\r\n    copy: function(copyHistory) {\r\n      var doc = new Doc(getLines(this, this.first, this.first + this.size),\r\n                        this.modeOption, this.first, this.lineSep);\r\n      doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\r\n      doc.sel = this.sel;\r\n      doc.extend = false;\r\n      if (copyHistory) {\r\n        doc.history.undoDepth = this.history.undoDepth;\r\n        doc.setHistory(this.getHistory());\r\n      }\r\n      return doc;\r\n    },\r\n\r\n    linkedDoc: function(options) {\r\n      if (!options) options = {};\r\n      var from = this.first, to = this.first + this.size;\r\n      if (options.from != null && options.from > from) from = options.from;\r\n      if (options.to != null && options.to < to) to = options.to;\r\n      var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep);\r\n      if (options.sharedHist) copy.history = this.history;\r\n      (this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\r\n      copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\r\n      copySharedMarkers(copy, findSharedMarkers(this));\r\n      return copy;\r\n    },\r\n    unlinkDoc: function(other) {\r\n      if (other instanceof CodeMirror) other = other.doc;\r\n      if (this.linked) for (var i = 0; i < this.linked.length; ++i) {\r\n        var link = this.linked[i];\r\n        if (link.doc != other) continue;\r\n        this.linked.splice(i, 1);\r\n        other.unlinkDoc(this);\r\n        detachSharedMarkers(findSharedMarkers(this));\r\n        break;\r\n      }\r\n      // If the histories were shared, split them again\r\n      if (other.history == this.history) {\r\n        var splitIds = [other.id];\r\n        linkedDocs(other, function(doc) {splitIds.push(doc.id);}, true);\r\n        other.history = new History(null);\r\n        other.history.done = copyHistoryArray(this.history.done, splitIds);\r\n        other.history.undone = copyHistoryArray(this.history.undone, splitIds);\r\n      }\r\n    },\r\n    iterLinkedDocs: function(f) {linkedDocs(this, f);},\r\n\r\n    getMode: function() {return this.mode;},\r\n    getEditor: function() {return this.cm;},\r\n\r\n    splitLines: function(str) {\r\n      if (this.lineSep) return str.split(this.lineSep);\r\n      return splitLinesAuto(str);\r\n    },\r\n    lineSeparator: function() { return this.lineSep || \"\\n\"; }\r\n  });\r\n\r\n  // Public alias.\r\n  Doc.prototype.eachLine = Doc.prototype.iter;\r\n\r\n  // Set up methods on CodeMirror's prototype to redirect to the editor's document.\r\n  var dontDelegate = \"iter insert remove copy getEditor constructor\".split(\" \");\r\n  for (var prop in Doc.prototype) if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\r\n    CodeMirror.prototype[prop] = (function(method) {\r\n      return function() {return method.apply(this.doc, arguments);};\r\n    })(Doc.prototype[prop]);\r\n\r\n  eventMixin(Doc);\r\n\r\n  // Call f for all linked documents.\r\n  function linkedDocs(doc, f, sharedHistOnly) {\r\n    function propagate(doc, skip, sharedHist) {\r\n      if (doc.linked) for (var i = 0; i < doc.linked.length; ++i) {\r\n        var rel = doc.linked[i];\r\n        if (rel.doc == skip) continue;\r\n        var shared = sharedHist && rel.sharedHist;\r\n        if (sharedHistOnly && !shared) continue;\r\n        f(rel.doc, shared);\r\n        propagate(rel.doc, doc, shared);\r\n      }\r\n    }\r\n    propagate(doc, null, true);\r\n  }\r\n\r\n  // Attach a document to an editor.\r\n  function attachDoc(cm, doc) {\r\n    if (doc.cm) throw new Error(\"This document is already in use.\");\r\n    cm.doc = doc;\r\n    doc.cm = cm;\r\n    estimateLineHeights(cm);\r\n    loadMode(cm);\r\n    if (!cm.options.lineWrapping) findMaxLine(cm);\r\n    cm.options.mode = doc.modeOption;\r\n    regChange(cm);\r\n  }\r\n\r\n  // LINE UTILITIES\r\n\r\n  // Find the line object corresponding to the given line number.\r\n  function getLine(doc, n) {\r\n    n -= doc.first;\r\n    if (n < 0 || n >= doc.size) throw new Error(\"There is no line \" + (n + doc.first) + \" in the document.\");\r\n    for (var chunk = doc; !chunk.lines;) {\r\n      for (var i = 0;; ++i) {\r\n        var child = chunk.children[i], sz = child.chunkSize();\r\n        if (n < sz) { chunk = child; break; }\r\n        n -= sz;\r\n      }\r\n    }\r\n    return chunk.lines[n];\r\n  }\r\n\r\n  // Get the part of a document between two positions, as an array of\r\n  // strings.\r\n  function getBetween(doc, start, end) {\r\n    var out = [], n = start.line;\r\n    doc.iter(start.line, end.line + 1, function(line) {\r\n      var text = line.text;\r\n      if (n == end.line) text = text.slice(0, end.ch);\r\n      if (n == start.line) text = text.slice(start.ch);\r\n      out.push(text);\r\n      ++n;\r\n    });\r\n    return out;\r\n  }\r\n  // Get the lines between from and to, as array of strings.\r\n  function getLines(doc, from, to) {\r\n    var out = [];\r\n    doc.iter(from, to, function(line) { out.push(line.text); });\r\n    return out;\r\n  }\r\n\r\n  // Update the height of a line, propagating the height change\r\n  // upwards to parent nodes.\r\n  function updateLineHeight(line, height) {\r\n    var diff = height - line.height;\r\n    if (diff) for (var n = line; n; n = n.parent) n.height += diff;\r\n  }\r\n\r\n  // Given a line object, find its line number by walking up through\r\n  // its parent links.\r\n  function lineNo(line) {\r\n    if (line.parent == null) return null;\r\n    var cur = line.parent, no = indexOf(cur.lines, line);\r\n    for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\r\n      for (var i = 0;; ++i) {\r\n        if (chunk.children[i] == cur) break;\r\n        no += chunk.children[i].chunkSize();\r\n      }\r\n    }\r\n    return no + cur.first;\r\n  }\r\n\r\n  // Find the line at the given vertical position, using the height\r\n  // information in the document tree.\r\n  function lineAtHeight(chunk, h) {\r\n    var n = chunk.first;\r\n    outer: do {\r\n      for (var i = 0; i < chunk.children.length; ++i) {\r\n        var child = chunk.children[i], ch = child.height;\r\n        if (h < ch) { chunk = child; continue outer; }\r\n        h -= ch;\r\n        n += child.chunkSize();\r\n      }\r\n      return n;\r\n    } while (!chunk.lines);\r\n    for (var i = 0; i < chunk.lines.length; ++i) {\r\n      var line = chunk.lines[i], lh = line.height;\r\n      if (h < lh) break;\r\n      h -= lh;\r\n    }\r\n    return n + i;\r\n  }\r\n\r\n\r\n  // Find the height above the given line.\r\n  function heightAtLine(lineObj) {\r\n    lineObj = visualLine(lineObj);\r\n\r\n    var h = 0, chunk = lineObj.parent;\r\n    for (var i = 0; i < chunk.lines.length; ++i) {\r\n      var line = chunk.lines[i];\r\n      if (line == lineObj) break;\r\n      else h += line.height;\r\n    }\r\n    for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\r\n      for (var i = 0; i < p.children.length; ++i) {\r\n        var cur = p.children[i];\r\n        if (cur == chunk) break;\r\n        else h += cur.height;\r\n      }\r\n    }\r\n    return h;\r\n  }\r\n\r\n  // Get the bidi ordering for the given line (and cache it). Returns\r\n  // false for lines that are fully left-to-right, and an array of\r\n  // BidiSpan objects otherwise.\r\n  function getOrder(line) {\r\n    var order = line.order;\r\n    if (order == null) order = line.order = bidiOrdering(line.text);\r\n    return order;\r\n  }\r\n\r\n  // HISTORY\r\n\r\n  function History(startGen) {\r\n    // Arrays of change events and selections. Doing something adds an\r\n    // event to done and clears undo. Undoing moves events from done\r\n    // to undone, redoing moves them in the other direction.\r\n    this.done = []; this.undone = [];\r\n    this.undoDepth = Infinity;\r\n    // Used to track when changes can be merged into a single undo\r\n    // event\r\n    this.lastModTime = this.lastSelTime = 0;\r\n    this.lastOp = this.lastSelOp = null;\r\n    this.lastOrigin = this.lastSelOrigin = null;\r\n    // Used by the isClean() method\r\n    this.generation = this.maxGeneration = startGen || 1;\r\n  }\r\n\r\n  // Create a history change event from an updateDoc-style change\r\n  // object.\r\n  function historyChangeFromChange(doc, change) {\r\n    var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\r\n    attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\r\n    linkedDocs(doc, function(doc) {attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);}, true);\r\n    return histChange;\r\n  }\r\n\r\n  // Pop all selection events off the end of a history array. Stop at\r\n  // a change event.\r\n  function clearSelectionEvents(array) {\r\n    while (array.length) {\r\n      var last = lst(array);\r\n      if (last.ranges) array.pop();\r\n      else break;\r\n    }\r\n  }\r\n\r\n  // Find the top change event in the history. Pop off selection\r\n  // events that are in the way.\r\n  function lastChangeEvent(hist, force) {\r\n    if (force) {\r\n      clearSelectionEvents(hist.done);\r\n      return lst(hist.done);\r\n    } else if (hist.done.length && !lst(hist.done).ranges) {\r\n      return lst(hist.done);\r\n    } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {\r\n      hist.done.pop();\r\n      return lst(hist.done);\r\n    }\r\n  }\r\n\r\n  // Register a change in the history. Merges changes that are within\r\n  // a single operation, or are close together with an origin that\r\n  // allows merging (starting with \"+\") into a single event.\r\n  function addChangeToHistory(doc, change, selAfter, opId) {\r\n    var hist = doc.history;\r\n    hist.undone.length = 0;\r\n    var time = +new Date, cur;\r\n\r\n    if ((hist.lastOp == opId ||\r\n         hist.lastOrigin == change.origin && change.origin &&\r\n         ((change.origin.charAt(0) == \"+\" && doc.cm && hist.lastModTime > time - doc.cm.options.historyEventDelay) ||\r\n          change.origin.charAt(0) == \"*\")) &&\r\n        (cur = lastChangeEvent(hist, hist.lastOp == opId))) {\r\n      // Merge this change into the last event\r\n      var last = lst(cur.changes);\r\n      if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {\r\n        // Optimized case for simple insertion -- don't want to add\r\n        // new changesets for every character typed\r\n        last.to = changeEnd(change);\r\n      } else {\r\n        // Add new sub-event\r\n        cur.changes.push(historyChangeFromChange(doc, change));\r\n      }\r\n    } else {\r\n      // Can not be merged, start a new event.\r\n      var before = lst(hist.done);\r\n      if (!before || !before.ranges)\r\n        pushSelectionToHistory(doc.sel, hist.done);\r\n      cur = {changes: [historyChangeFromChange(doc, change)],\r\n             generation: hist.generation};\r\n      hist.done.push(cur);\r\n      while (hist.done.length > hist.undoDepth) {\r\n        hist.done.shift();\r\n        if (!hist.done[0].ranges) hist.done.shift();\r\n      }\r\n    }\r\n    hist.done.push(selAfter);\r\n    hist.generation = ++hist.maxGeneration;\r\n    hist.lastModTime = hist.lastSelTime = time;\r\n    hist.lastOp = hist.lastSelOp = opId;\r\n    hist.lastOrigin = hist.lastSelOrigin = change.origin;\r\n\r\n    if (!last) signal(doc, \"historyAdded\");\r\n  }\r\n\r\n  function selectionEventCanBeMerged(doc, origin, prev, sel) {\r\n    var ch = origin.charAt(0);\r\n    return ch == \"*\" ||\r\n      ch == \"+\" &&\r\n      prev.ranges.length == sel.ranges.length &&\r\n      prev.somethingSelected() == sel.somethingSelected() &&\r\n      new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500);\r\n  }\r\n\r\n  // Called whenever the selection changes, sets the new selection as\r\n  // the pending selection in the history, and pushes the old pending\r\n  // selection into the 'done' array when it was significantly\r\n  // different (in number of selected ranges, emptiness, or time).\r\n  function addSelectionToHistory(doc, sel, opId, options) {\r\n    var hist = doc.history, origin = options && options.origin;\r\n\r\n    // A new event is started when the previous origin does not match\r\n    // the current, or the origins don't allow matching. Origins\r\n    // starting with * are always merged, those starting with + are\r\n    // merged when similar and close together in time.\r\n    if (opId == hist.lastSelOp ||\r\n        (origin && hist.lastSelOrigin == origin &&\r\n         (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||\r\n          selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))\r\n      hist.done[hist.done.length - 1] = sel;\r\n    else\r\n      pushSelectionToHistory(sel, hist.done);\r\n\r\n    hist.lastSelTime = +new Date;\r\n    hist.lastSelOrigin = origin;\r\n    hist.lastSelOp = opId;\r\n    if (options && options.clearRedo !== false)\r\n      clearSelectionEvents(hist.undone);\r\n  }\r\n\r\n  function pushSelectionToHistory(sel, dest) {\r\n    var top = lst(dest);\r\n    if (!(top && top.ranges && top.equals(sel)))\r\n      dest.push(sel);\r\n  }\r\n\r\n  // Used to store marked span information in the history.\r\n  function attachLocalSpans(doc, change, from, to) {\r\n    var existing = change[\"spans_\" + doc.id], n = 0;\r\n    doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function(line) {\r\n      if (line.markedSpans)\r\n        (existing || (existing = change[\"spans_\" + doc.id] = {}))[n] = line.markedSpans;\r\n      ++n;\r\n    });\r\n  }\r\n\r\n  // When un/re-doing restores text containing marked spans, those\r\n  // that have been explicitly cleared should not be restored.\r\n  function removeClearedSpans(spans) {\r\n    if (!spans) return null;\r\n    for (var i = 0, out; i < spans.length; ++i) {\r\n      if (spans[i].marker.explicitlyCleared) { if (!out) out = spans.slice(0, i); }\r\n      else if (out) out.push(spans[i]);\r\n    }\r\n    return !out ? spans : out.length ? out : null;\r\n  }\r\n\r\n  // Retrieve and filter the old marked spans stored in a change event.\r\n  function getOldSpans(doc, change) {\r\n    var found = change[\"spans_\" + doc.id];\r\n    if (!found) return null;\r\n    for (var i = 0, nw = []; i < change.text.length; ++i)\r\n      nw.push(removeClearedSpans(found[i]));\r\n    return nw;\r\n  }\r\n\r\n  // Used both to provide a JSON-safe object in .getHistory, and, when\r\n  // detaching a document, to split the history in two\r\n  function copyHistoryArray(events, newGroup, instantiateSel) {\r\n    for (var i = 0, copy = []; i < events.length; ++i) {\r\n      var event = events[i];\r\n      if (event.ranges) {\r\n        copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);\r\n        continue;\r\n      }\r\n      var changes = event.changes, newChanges = [];\r\n      copy.push({changes: newChanges});\r\n      for (var j = 0; j < changes.length; ++j) {\r\n        var change = changes[j], m;\r\n        newChanges.push({from: change.from, to: change.to, text: change.text});\r\n        if (newGroup) for (var prop in change) if (m = prop.match(/^spans_(\\d+)$/)) {\r\n          if (indexOf(newGroup, Number(m[1])) > -1) {\r\n            lst(newChanges)[prop] = change[prop];\r\n            delete change[prop];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return copy;\r\n  }\r\n\r\n  // Rebasing/resetting history to deal with externally-sourced changes\r\n\r\n  function rebaseHistSelSingle(pos, from, to, diff) {\r\n    if (to < pos.line) {\r\n      pos.line += diff;\r\n    } else if (from < pos.line) {\r\n      pos.line = from;\r\n      pos.ch = 0;\r\n    }\r\n  }\r\n\r\n  // Tries to rebase an array of history events given a change in the\r\n  // document. If the change touches the same lines as the event, the\r\n  // event, and everything 'behind' it, is discarded. If the change is\r\n  // before the event, the event's positions are updated. Uses a\r\n  // copy-on-write scheme for the positions, to avoid having to\r\n  // reallocate them all on every rebase, but also avoid problems with\r\n  // shared position objects being unsafely updated.\r\n  function rebaseHistArray(array, from, to, diff) {\r\n    for (var i = 0; i < array.length; ++i) {\r\n      var sub = array[i], ok = true;\r\n      if (sub.ranges) {\r\n        if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }\r\n        for (var j = 0; j < sub.ranges.length; j++) {\r\n          rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);\r\n          rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);\r\n        }\r\n        continue;\r\n      }\r\n      for (var j = 0; j < sub.changes.length; ++j) {\r\n        var cur = sub.changes[j];\r\n        if (to < cur.from.line) {\r\n          cur.from = Pos(cur.from.line + diff, cur.from.ch);\r\n          cur.to = Pos(cur.to.line + diff, cur.to.ch);\r\n        } else if (from <= cur.to.line) {\r\n          ok = false;\r\n          break;\r\n        }\r\n      }\r\n      if (!ok) {\r\n        array.splice(0, i + 1);\r\n        i = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  function rebaseHist(hist, change) {\r\n    var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\r\n    rebaseHistArray(hist.done, from, to, diff);\r\n    rebaseHistArray(hist.undone, from, to, diff);\r\n  }\r\n\r\n  // EVENT UTILITIES\r\n\r\n  // Due to the fact that we still support jurassic IE versions, some\r\n  // compatibility wrappers are needed.\r\n\r\n  var e_preventDefault = CodeMirror.e_preventDefault = function(e) {\r\n    if (e.preventDefault) e.preventDefault();\r\n    else e.returnValue = false;\r\n  };\r\n  var e_stopPropagation = CodeMirror.e_stopPropagation = function(e) {\r\n    if (e.stopPropagation) e.stopPropagation();\r\n    else e.cancelBubble = true;\r\n  };\r\n  function e_defaultPrevented(e) {\r\n    return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false;\r\n  }\r\n  var e_stop = CodeMirror.e_stop = function(e) {e_preventDefault(e); e_stopPropagation(e);};\r\n\r\n  function e_target(e) {return e.target || e.srcElement;}\r\n  function e_button(e) {\r\n    var b = e.which;\r\n    if (b == null) {\r\n      if (e.button & 1) b = 1;\r\n      else if (e.button & 2) b = 3;\r\n      else if (e.button & 4) b = 2;\r\n    }\r\n    if (mac && e.ctrlKey && b == 1) b = 3;\r\n    return b;\r\n  }\r\n\r\n  // EVENT HANDLING\r\n\r\n  // Lightweight event framework. on/off also work on DOM nodes,\r\n  // registering native DOM handlers.\r\n\r\n  var on = CodeMirror.on = function(emitter, type, f) {\r\n    if (emitter.addEventListener)\r\n      emitter.addEventListener(type, f, false);\r\n    else if (emitter.attachEvent)\r\n      emitter.attachEvent(\"on\" + type, f);\r\n    else {\r\n      var map = emitter._handlers || (emitter._handlers = {});\r\n      var arr = map[type] || (map[type] = []);\r\n      arr.push(f);\r\n    }\r\n  };\r\n\r\n  var noHandlers = []\r\n  function getHandlers(emitter, type, copy) {\r\n    var arr = emitter._handlers && emitter._handlers[type]\r\n    if (copy) return arr && arr.length > 0 ? arr.slice() : noHandlers\r\n    else return arr || noHandlers\r\n  }\r\n\r\n  var off = CodeMirror.off = function(emitter, type, f) {\r\n    if (emitter.removeEventListener)\r\n      emitter.removeEventListener(type, f, false);\r\n    else if (emitter.detachEvent)\r\n      emitter.detachEvent(\"on\" + type, f);\r\n    else {\r\n      var handlers = getHandlers(emitter, type, false)\r\n      for (var i = 0; i < handlers.length; ++i)\r\n        if (handlers[i] == f) { handlers.splice(i, 1); break; }\r\n    }\r\n  };\r\n\r\n  var signal = CodeMirror.signal = function(emitter, type /*, values...*/) {\r\n    var handlers = getHandlers(emitter, type, true)\r\n    if (!handlers.length) return;\r\n    var args = Array.prototype.slice.call(arguments, 2);\r\n    for (var i = 0; i < handlers.length; ++i) handlers[i].apply(null, args);\r\n  };\r\n\r\n  var orphanDelayedCallbacks = null;\r\n\r\n  // Often, we want to signal events at a point where we are in the\r\n  // middle of some work, but don't want the handler to start calling\r\n  // other methods on the editor, which might be in an inconsistent\r\n  // state or simply not expect any other events to happen.\r\n  // signalLater looks whether there are any handlers, and schedules\r\n  // them to be executed when the last operation ends, or, if no\r\n  // operation is active, when a timeout fires.\r\n  function signalLater(emitter, type /*, values...*/) {\r\n    var arr = getHandlers(emitter, type, false)\r\n    if (!arr.length) return;\r\n    var args = Array.prototype.slice.call(arguments, 2), list;\r\n    if (operationGroup) {\r\n      list = operationGroup.delayedCallbacks;\r\n    } else if (orphanDelayedCallbacks) {\r\n      list = orphanDelayedCallbacks;\r\n    } else {\r\n      list = orphanDelayedCallbacks = [];\r\n      setTimeout(fireOrphanDelayed, 0);\r\n    }\r\n    function bnd(f) {return function(){f.apply(null, args);};};\r\n    for (var i = 0; i < arr.length; ++i)\r\n      list.push(bnd(arr[i]));\r\n  }\r\n\r\n  function fireOrphanDelayed() {\r\n    var delayed = orphanDelayedCallbacks;\r\n    orphanDelayedCallbacks = null;\r\n    for (var i = 0; i < delayed.length; ++i) delayed[i]();\r\n  }\r\n\r\n  // The DOM events that CodeMirror handles can be overridden by\r\n  // registering a (non-DOM) handler on the editor for the event name,\r\n  // and preventDefault-ing the event in that handler.\r\n  function signalDOMEvent(cm, e, override) {\r\n    if (typeof e == \"string\")\r\n      e = {type: e, preventDefault: function() { this.defaultPrevented = true; }};\r\n    signal(cm, override || e.type, cm, e);\r\n    return e_defaultPrevented(e) || e.codemirrorIgnore;\r\n  }\r\n\r\n  function signalCursorActivity(cm) {\r\n    var arr = cm._handlers && cm._handlers.cursorActivity;\r\n    if (!arr) return;\r\n    var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);\r\n    for (var i = 0; i < arr.length; ++i) if (indexOf(set, arr[i]) == -1)\r\n      set.push(arr[i]);\r\n  }\r\n\r\n  function hasHandler(emitter, type) {\r\n    return getHandlers(emitter, type).length > 0\r\n  }\r\n\r\n  // Add on and off methods to a constructor's prototype, to make\r\n  // registering events on such objects more convenient.\r\n  function eventMixin(ctor) {\r\n    ctor.prototype.on = function(type, f) {on(this, type, f);};\r\n    ctor.prototype.off = function(type, f) {off(this, type, f);};\r\n  }\r\n\r\n  // MISC UTILITIES\r\n\r\n  // Number of pixels added to scroller and sizer to hide scrollbar\r\n  var scrollerGap = 30;\r\n\r\n  // Returned or thrown by various protocols to signal 'I'm not\r\n  // handling this'.\r\n  var Pass = CodeMirror.Pass = {toString: function(){return \"CodeMirror.Pass\";}};\r\n\r\n  // Reused option objects for setSelection & friends\r\n  var sel_dontScroll = {scroll: false}, sel_mouse = {origin: \"*mouse\"}, sel_move = {origin: \"+move\"};\r\n\r\n  function Delayed() {this.id = null;}\r\n  Delayed.prototype.set = function(ms, f) {\r\n    clearTimeout(this.id);\r\n    this.id = setTimeout(f, ms);\r\n  };\r\n\r\n  // Counts the column offset in a string, taking tabs into account.\r\n  // Used mostly to find indentation.\r\n  var countColumn = CodeMirror.countColumn = function(string, end, tabSize, startIndex, startValue) {\r\n    if (end == null) {\r\n      end = string.search(/[^\\s\\u00a0]/);\r\n      if (end == -1) end = string.length;\r\n    }\r\n    for (var i = startIndex || 0, n = startValue || 0;;) {\r\n      var nextTab = string.indexOf(\"\\t\", i);\r\n      if (nextTab < 0 || nextTab >= end)\r\n        return n + (end - i);\r\n      n += nextTab - i;\r\n      n += tabSize - (n % tabSize);\r\n      i = nextTab + 1;\r\n    }\r\n  };\r\n\r\n  // The inverse of countColumn -- find the offset that corresponds to\r\n  // a particular column.\r\n  var findColumn = CodeMirror.findColumn = function(string, goal, tabSize) {\r\n    for (var pos = 0, col = 0;;) {\r\n      var nextTab = string.indexOf(\"\\t\", pos);\r\n      if (nextTab == -1) nextTab = string.length;\r\n      var skipped = nextTab - pos;\r\n      if (nextTab == string.length || col + skipped >= goal)\r\n        return pos + Math.min(skipped, goal - col);\r\n      col += nextTab - pos;\r\n      col += tabSize - (col % tabSize);\r\n      pos = nextTab + 1;\r\n      if (col >= goal) return pos;\r\n    }\r\n  }\r\n\r\n  var spaceStrs = [\"\"];\r\n  function spaceStr(n) {\r\n    while (spaceStrs.length <= n)\r\n      spaceStrs.push(lst(spaceStrs) + \" \");\r\n    return spaceStrs[n];\r\n  }\r\n\r\n  function lst(arr) { return arr[arr.length-1]; }\r\n\r\n  var selectInput = function(node) { node.select(); };\r\n  if (ios) // Mobile Safari apparently has a bug where select() is broken.\r\n    selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; };\r\n  else if (ie) // Suppress mysterious IE10 errors\r\n    selectInput = function(node) { try { node.select(); } catch(_e) {} };\r\n\r\n  function indexOf(array, elt) {\r\n    for (var i = 0; i < array.length; ++i)\r\n      if (array[i] == elt) return i;\r\n    return -1;\r\n  }\r\n  function map(array, f) {\r\n    var out = [];\r\n    for (var i = 0; i < array.length; i++) out[i] = f(array[i], i);\r\n    return out;\r\n  }\r\n\r\n  function insertSorted(array, value, score) {\r\n    var pos = 0, priority = score(value)\r\n    while (pos < array.length && score(array[pos]) <= priority) pos++\r\n    array.splice(pos, 0, value)\r\n  }\r\n\r\n  function nothing() {}\r\n\r\n  function createObj(base, props) {\r\n    var inst;\r\n    if (Object.create) {\r\n      inst = Object.create(base);\r\n    } else {\r\n      nothing.prototype = base;\r\n      inst = new nothing();\r\n    }\r\n    if (props) copyObj(props, inst);\r\n    return inst;\r\n  };\r\n\r\n  function copyObj(obj, target, overwrite) {\r\n    if (!target) target = {};\r\n    for (var prop in obj)\r\n      if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))\r\n        target[prop] = obj[prop];\r\n    return target;\r\n  }\r\n\r\n  function bind(f) {\r\n    var args = Array.prototype.slice.call(arguments, 1);\r\n    return function(){return f.apply(null, args);};\r\n  }\r\n\r\n  var nonASCIISingleCaseWordChar = /[\\u00df\\u0587\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\r\n  var isWordCharBasic = CodeMirror.isWordChar = function(ch) {\r\n    return /\\w/.test(ch) || ch > \"\\x80\" &&\r\n      (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch));\r\n  };\r\n  function isWordChar(ch, helper) {\r\n    if (!helper) return isWordCharBasic(ch);\r\n    if (helper.source.indexOf(\"\\\\w\") > -1 && isWordCharBasic(ch)) return true;\r\n    return helper.test(ch);\r\n  }\r\n\r\n  function isEmpty(obj) {\r\n    for (var n in obj) if (obj.hasOwnProperty(n) && obj[n]) return false;\r\n    return true;\r\n  }\r\n\r\n  // Extending unicode characters. A series of a non-extending char +\r\n  // any number of extending chars is treated as a single unit as far\r\n  // as editing and measuring is concerned. This is not fully correct,\r\n  // since some scripts/fonts/browsers also treat other configurations\r\n  // of code points as a group.\r\n  var extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;\r\n  function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch); }\r\n\r\n  // DOM UTILITIES\r\n\r\n  function elt(tag, content, className, style) {\r\n    var e = document.createElement(tag);\r\n    if (className) e.className = className;\r\n    if (style) e.style.cssText = style;\r\n    if (typeof content == \"string\") e.appendChild(document.createTextNode(content));\r\n    else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);\r\n    return e;\r\n  }\r\n\r\n  var range;\r\n  if (document.createRange) range = function(node, start, end, endNode) {\r\n    var r = document.createRange();\r\n    r.setEnd(endNode || node, end);\r\n    r.setStart(node, start);\r\n    return r;\r\n  };\r\n  else range = function(node, start, end) {\r\n    var r = document.body.createTextRange();\r\n    try { r.moveToElementText(node.parentNode); }\r\n    catch(e) { return r; }\r\n    r.collapse(true);\r\n    r.moveEnd(\"character\", end);\r\n    r.moveStart(\"character\", start);\r\n    return r;\r\n  };\r\n\r\n  function removeChildren(e) {\r\n    for (var count = e.childNodes.length; count > 0; --count)\r\n      e.removeChild(e.firstChild);\r\n    return e;\r\n  }\r\n\r\n  function removeChildrenAndAdd(parent, e) {\r\n    return removeChildren(parent).appendChild(e);\r\n  }\r\n\r\n  var contains = CodeMirror.contains = function(parent, child) {\r\n    if (child.nodeType == 3) // Android browser always returns false when child is a textnode\r\n      child = child.parentNode;\r\n    if (parent.contains)\r\n      return parent.contains(child);\r\n    do {\r\n      if (child.nodeType == 11) child = child.host;\r\n      if (child == parent) return true;\r\n    } while (child = child.parentNode);\r\n  };\r\n\r\n  function activeElt() {\r\n    var activeElement = document.activeElement;\r\n    while (activeElement && activeElement.root && activeElement.root.activeElement)\r\n      activeElement = activeElement.root.activeElement;\r\n    return activeElement;\r\n  }\r\n  // Older versions of IE throws unspecified error when touching\r\n  // document.activeElement in some cases (during loading, in iframe)\r\n  if (ie && ie_version < 11) activeElt = function() {\r\n    try { return document.activeElement; }\r\n    catch(e) { return document.body; }\r\n  };\r\n\r\n  function classTest(cls) { return new RegExp(\"(^|\\\\s)\" + cls + \"(?:$|\\\\s)\\\\s*\"); }\r\n  var rmClass = CodeMirror.rmClass = function(node, cls) {\r\n    var current = node.className;\r\n    var match = classTest(cls).exec(current);\r\n    if (match) {\r\n      var after = current.slice(match.index + match[0].length);\r\n      node.className = current.slice(0, match.index) + (after ? match[1] + after : \"\");\r\n    }\r\n  };\r\n  var addClass = CodeMirror.addClass = function(node, cls) {\r\n    var current = node.className;\r\n    if (!classTest(cls).test(current)) node.className += (current ? \" \" : \"\") + cls;\r\n  };\r\n  function joinClasses(a, b) {\r\n    var as = a.split(\" \");\r\n    for (var i = 0; i < as.length; i++)\r\n      if (as[i] && !classTest(as[i]).test(b)) b += \" \" + as[i];\r\n    return b;\r\n  }\r\n\r\n  // WINDOW-WIDE EVENTS\r\n\r\n  // These must be handled carefully, because naively registering a\r\n  // handler for each editor will cause the editors to never be\r\n  // garbage collected.\r\n\r\n  function forEachCodeMirror(f) {\r\n    if (!document.body.getElementsByClassName) return;\r\n    var byClass = document.body.getElementsByClassName(\"CodeMirror\");\r\n    for (var i = 0; i < byClass.length; i++) {\r\n      var cm = byClass[i].CodeMirror;\r\n      if (cm) f(cm);\r\n    }\r\n  }\r\n\r\n  var globalsRegistered = false;\r\n  function ensureGlobalHandlers() {\r\n    if (globalsRegistered) return;\r\n    registerGlobalHandlers();\r\n    globalsRegistered = true;\r\n  }\r\n  function registerGlobalHandlers() {\r\n    // When the window resizes, we need to refresh active editors.\r\n    var resizeTimer;\r\n    on(window, \"resize\", function() {\r\n      if (resizeTimer == null) resizeTimer = setTimeout(function() {\r\n        resizeTimer = null;\r\n        forEachCodeMirror(onResize);\r\n      }, 100);\r\n    });\r\n    // When the window loses focus, we want to show the editor as blurred\r\n    on(window, \"blur\", function() {\r\n      forEachCodeMirror(onBlur);\r\n    });\r\n  }\r\n\r\n  // FEATURE DETECTION\r\n\r\n  // Detect drag-and-drop\r\n  var dragAndDrop = function() {\r\n    // There is *some* kind of drag-and-drop support in IE6-8, but I\r\n    // couldn't get it to work yet.\r\n    if (ie && ie_version < 9) return false;\r\n    var div = elt('div');\r\n    return \"draggable\" in div || \"dragDrop\" in div;\r\n  }();\r\n\r\n  var zwspSupported;\r\n  function zeroWidthElement(measure) {\r\n    if (zwspSupported == null) {\r\n      var test = elt(\"span\", \"\\u200b\");\r\n      removeChildrenAndAdd(measure, elt(\"span\", [test, document.createTextNode(\"x\")]));\r\n      if (measure.firstChild.offsetHeight != 0)\r\n        zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8);\r\n    }\r\n    var node = zwspSupported ? elt(\"span\", \"\\u200b\") :\r\n      elt(\"span\", \"\\u00a0\", null, \"display: inline-block; width: 1px; margin-right: -1px\");\r\n    node.setAttribute(\"cm-text\", \"\");\r\n    return node;\r\n  }\r\n\r\n  // Feature-detect IE's crummy client rect reporting for bidi text\r\n  var badBidiRects;\r\n  function hasBadBidiRects(measure) {\r\n    if (badBidiRects != null) return badBidiRects;\r\n    var txt = removeChildrenAndAdd(measure, document.createTextNode(\"A\\u062eA\"));\r\n    var r0 = range(txt, 0, 1).getBoundingClientRect();\r\n    var r1 = range(txt, 1, 2).getBoundingClientRect();\r\n    removeChildren(measure);\r\n    if (!r0 || r0.left == r0.right) return false; // Safari returns null in some cases (#2780)\r\n    return badBidiRects = (r1.right - r0.right < 3);\r\n  }\r\n\r\n  // See if \"\".split is the broken IE version, if so, provide an\r\n  // alternative way to split lines.\r\n  var splitLinesAuto = CodeMirror.splitLines = \"\\n\\nb\".split(/\\n/).length != 3 ? function(string) {\r\n    var pos = 0, result = [], l = string.length;\r\n    while (pos <= l) {\r\n      var nl = string.indexOf(\"\\n\", pos);\r\n      if (nl == -1) nl = string.length;\r\n      var line = string.slice(pos, string.charAt(nl - 1) == \"\\r\" ? nl - 1 : nl);\r\n      var rt = line.indexOf(\"\\r\");\r\n      if (rt != -1) {\r\n        result.push(line.slice(0, rt));\r\n        pos += rt + 1;\r\n      } else {\r\n        result.push(line);\r\n        pos = nl + 1;\r\n      }\r\n    }\r\n    return result;\r\n  } : function(string){return string.split(/\\r\\n?|\\n/);};\r\n\r\n  var hasSelection = window.getSelection ? function(te) {\r\n    try { return te.selectionStart != te.selectionEnd; }\r\n    catch(e) { return false; }\r\n  } : function(te) {\r\n    try {var range = te.ownerDocument.selection.createRange();}\r\n    catch(e) {}\r\n    if (!range || range.parentElement() != te) return false;\r\n    return range.compareEndPoints(\"StartToEnd\", range) != 0;\r\n  };\r\n\r\n  var hasCopyEvent = (function() {\r\n    var e = elt(\"div\");\r\n    if (\"oncopy\" in e) return true;\r\n    e.setAttribute(\"oncopy\", \"return;\");\r\n    return typeof e.oncopy == \"function\";\r\n  })();\r\n\r\n  var badZoomedRects = null;\r\n  function hasBadZoomedRects(measure) {\r\n    if (badZoomedRects != null) return badZoomedRects;\r\n    var node = removeChildrenAndAdd(measure, elt(\"span\", \"x\"));\r\n    var normal = node.getBoundingClientRect();\r\n    var fromRange = range(node, 0, 1).getBoundingClientRect();\r\n    return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1;\r\n  }\r\n\r\n  // KEY NAMES\r\n\r\n  var keyNames = CodeMirror.keyNames = {\r\n    3: \"Enter\", 8: \"Backspace\", 9: \"Tab\", 13: \"Enter\", 16: \"Shift\", 17: \"Ctrl\", 18: \"Alt\",\r\n    19: \"Pause\", 20: \"CapsLock\", 27: \"Esc\", 32: \"Space\", 33: \"PageUp\", 34: \"PageDown\", 35: \"End\",\r\n    36: \"Home\", 37: \"Left\", 38: \"Up\", 39: \"Right\", 40: \"Down\", 44: \"PrintScrn\", 45: \"Insert\",\r\n    46: \"Delete\", 59: \";\", 61: \"=\", 91: \"Mod\", 92: \"Mod\", 93: \"Mod\",\r\n    106: \"*\", 107: \"=\", 109: \"-\", 110: \".\", 111: \"/\", 127: \"Delete\",\r\n    173: \"-\", 186: \";\", 187: \"=\", 188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",\r\n    221: \"]\", 222: \"'\", 63232: \"Up\", 63233: \"Down\", 63234: \"Left\", 63235: \"Right\", 63272: \"Delete\",\r\n    63273: \"Home\", 63275: \"End\", 63276: \"PageUp\", 63277: \"PageDown\", 63302: \"Insert\"\r\n  };\r\n  (function() {\r\n    // Number keys\r\n    for (var i = 0; i < 10; i++) keyNames[i + 48] = keyNames[i + 96] = String(i);\r\n    // Alphabetic keys\r\n    for (var i = 65; i <= 90; i++) keyNames[i] = String.fromCharCode(i);\r\n    // Function keys\r\n    for (var i = 1; i <= 12; i++) keyNames[i + 111] = keyNames[i + 63235] = \"F\" + i;\r\n  })();\r\n\r\n  // BIDI HELPERS\r\n\r\n  function iterateBidiSections(order, from, to, f) {\r\n    if (!order) return f(from, to, \"ltr\");\r\n    var found = false;\r\n    for (var i = 0; i < order.length; ++i) {\r\n      var part = order[i];\r\n      if (part.from < to && part.to > from || from == to && part.to == from) {\r\n        f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? \"rtl\" : \"ltr\");\r\n        found = true;\r\n      }\r\n    }\r\n    if (!found) f(from, to, \"ltr\");\r\n  }\r\n\r\n  function bidiLeft(part) { return part.level % 2 ? part.to : part.from; }\r\n  function bidiRight(part) { return part.level % 2 ? part.from : part.to; }\r\n\r\n  function lineLeft(line) { var order = getOrder(line); return order ? bidiLeft(order[0]) : 0; }\r\n  function lineRight(line) {\r\n    var order = getOrder(line);\r\n    if (!order) return line.text.length;\r\n    return bidiRight(lst(order));\r\n  }\r\n\r\n  function lineStart(cm, lineN) {\r\n    var line = getLine(cm.doc, lineN);\r\n    var visual = visualLine(line);\r\n    if (visual != line) lineN = lineNo(visual);\r\n    var order = getOrder(visual);\r\n    var ch = !order ? 0 : order[0].level % 2 ? lineRight(visual) : lineLeft(visual);\r\n    return Pos(lineN, ch);\r\n  }\r\n  function lineEnd(cm, lineN) {\r\n    var merged, line = getLine(cm.doc, lineN);\r\n    while (merged = collapsedSpanAtEnd(line)) {\r\n      line = merged.find(1, true).line;\r\n      lineN = null;\r\n    }\r\n    var order = getOrder(line);\r\n    var ch = !order ? line.text.length : order[0].level % 2 ? lineLeft(line) : lineRight(line);\r\n    return Pos(lineN == null ? lineNo(line) : lineN, ch);\r\n  }\r\n  function lineStartSmart(cm, pos) {\r\n    var start = lineStart(cm, pos.line);\r\n    var line = getLine(cm.doc, start.line);\r\n    var order = getOrder(line);\r\n    if (!order || order[0].level == 0) {\r\n      var firstNonWS = Math.max(0, line.text.search(/\\S/));\r\n      var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;\r\n      return Pos(start.line, inWS ? 0 : firstNonWS);\r\n    }\r\n    return start;\r\n  }\r\n\r\n  function compareBidiLevel(order, a, b) {\r\n    var linedir = order[0].level;\r\n    if (a == linedir) return true;\r\n    if (b == linedir) return false;\r\n    return a < b;\r\n  }\r\n  var bidiOther;\r\n  function getBidiPartAt(order, pos) {\r\n    bidiOther = null;\r\n    for (var i = 0, found; i < order.length; ++i) {\r\n      var cur = order[i];\r\n      if (cur.from < pos && cur.to > pos) return i;\r\n      if ((cur.from == pos || cur.to == pos)) {\r\n        if (found == null) {\r\n          found = i;\r\n        } else if (compareBidiLevel(order, cur.level, order[found].level)) {\r\n          if (cur.from != cur.to) bidiOther = found;\r\n          return i;\r\n        } else {\r\n          if (cur.from != cur.to) bidiOther = i;\r\n          return found;\r\n        }\r\n      }\r\n    }\r\n    return found;\r\n  }\r\n\r\n  function moveInLine(line, pos, dir, byUnit) {\r\n    if (!byUnit) return pos + dir;\r\n    do pos += dir;\r\n    while (pos > 0 && isExtendingChar(line.text.charAt(pos)));\r\n    return pos;\r\n  }\r\n\r\n  // This is needed in order to move 'visually' through bi-directional\r\n  // text -- i.e., pressing left should make the cursor go left, even\r\n  // when in RTL text. The tricky part is the 'jumps', where RTL and\r\n  // LTR text touch each other. This often requires the cursor offset\r\n  // to move more than one unit, in order to visually move one unit.\r\n  function moveVisually(line, start, dir, byUnit) {\r\n    var bidi = getOrder(line);\r\n    if (!bidi) return moveLogically(line, start, dir, byUnit);\r\n    var pos = getBidiPartAt(bidi, start), part = bidi[pos];\r\n    var target = moveInLine(line, start, part.level % 2 ? -dir : dir, byUnit);\r\n\r\n    for (;;) {\r\n      if (target > part.from && target < part.to) return target;\r\n      if (target == part.from || target == part.to) {\r\n        if (getBidiPartAt(bidi, target) == pos) return target;\r\n        part = bidi[pos += dir];\r\n        return (dir > 0) == part.level % 2 ? part.to : part.from;\r\n      } else {\r\n        part = bidi[pos += dir];\r\n        if (!part) return null;\r\n        if ((dir > 0) == part.level % 2)\r\n          target = moveInLine(line, part.to, -1, byUnit);\r\n        else\r\n          target = moveInLine(line, part.from, 1, byUnit);\r\n      }\r\n    }\r\n  }\r\n\r\n  function moveLogically(line, start, dir, byUnit) {\r\n    var target = start + dir;\r\n    if (byUnit) while (target > 0 && isExtendingChar(line.text.charAt(target))) target += dir;\r\n    return target < 0 || target > line.text.length ? null : target;\r\n  }\r\n\r\n  // Bidirectional ordering algorithm\r\n  // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\r\n  // that this (partially) implements.\r\n\r\n  // One-char codes used for character types:\r\n  // L (L):   Left-to-Right\r\n  // R (R):   Right-to-Left\r\n  // r (AL):  Right-to-Left Arabic\r\n  // 1 (EN):  European Number\r\n  // + (ES):  European Number Separator\r\n  // % (ET):  European Number Terminator\r\n  // n (AN):  Arabic Number\r\n  // , (CS):  Common Number Separator\r\n  // m (NSM): Non-Spacing Mark\r\n  // b (BN):  Boundary Neutral\r\n  // s (B):   Paragraph Separator\r\n  // t (S):   Segment Separator\r\n  // w (WS):  Whitespace\r\n  // N (ON):  Other Neutrals\r\n\r\n  // Returns null if characters are ordered as they appear\r\n  // (left-to-right), or an array of sections ({from, to, level}\r\n  // objects) in the order in which they occur visually.\r\n  var bidiOrdering = (function() {\r\n    // Character types for codepoints 0 to 0xff\r\n    var lowTypes = \"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN\";\r\n    // Character types for codepoints 0x600 to 0x6ff\r\n    var arabicTypes = \"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm\";\r\n    function charType(code) {\r\n      if (code <= 0xf7) return lowTypes.charAt(code);\r\n      else if (0x590 <= code && code <= 0x5f4) return \"R\";\r\n      else if (0x600 <= code && code <= 0x6ed) return arabicTypes.charAt(code - 0x600);\r\n      else if (0x6ee <= code && code <= 0x8ac) return \"r\";\r\n      else if (0x2000 <= code && code <= 0x200b) return \"w\";\r\n      else if (code == 0x200c) return \"b\";\r\n      else return \"L\";\r\n    }\r\n\r\n    var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\r\n    var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\r\n    // Browsers seem to always treat the boundaries of block elements as being L.\r\n    var outerType = \"L\";\r\n\r\n    function BidiSpan(level, from, to) {\r\n      this.level = level;\r\n      this.from = from; this.to = to;\r\n    }\r\n\r\n    return function(str) {\r\n      if (!bidiRE.test(str)) return false;\r\n      var len = str.length, types = [];\r\n      for (var i = 0, type; i < len; ++i)\r\n        types.push(type = charType(str.charCodeAt(i)));\r\n\r\n      // W1. Examine each non-spacing mark (NSM) in the level run, and\r\n      // change the type of the NSM to the type of the previous\r\n      // character. If the NSM is at the start of the level run, it will\r\n      // get the type of sor.\r\n      for (var i = 0, prev = outerType; i < len; ++i) {\r\n        var type = types[i];\r\n        if (type == \"m\") types[i] = prev;\r\n        else prev = type;\r\n      }\r\n\r\n      // W2. Search backwards from each instance of a European number\r\n      // until the first strong type (R, L, AL, or sor) is found. If an\r\n      // AL is found, change the type of the European number to Arabic\r\n      // number.\r\n      // W3. Change all ALs to R.\r\n      for (var i = 0, cur = outerType; i < len; ++i) {\r\n        var type = types[i];\r\n        if (type == \"1\" && cur == \"r\") types[i] = \"n\";\r\n        else if (isStrong.test(type)) { cur = type; if (type == \"r\") types[i] = \"R\"; }\r\n      }\r\n\r\n      // W4. A single European separator between two European numbers\r\n      // changes to a European number. A single common separator between\r\n      // two numbers of the same type changes to that type.\r\n      for (var i = 1, prev = types[0]; i < len - 1; ++i) {\r\n        var type = types[i];\r\n        if (type == \"+\" && prev == \"1\" && types[i+1] == \"1\") types[i] = \"1\";\r\n        else if (type == \",\" && prev == types[i+1] &&\r\n                 (prev == \"1\" || prev == \"n\")) types[i] = prev;\r\n        prev = type;\r\n      }\r\n\r\n      // W5. A sequence of European terminators adjacent to European\r\n      // numbers changes to all European numbers.\r\n      // W6. Otherwise, separators and terminators change to Other\r\n      // Neutral.\r\n      for (var i = 0; i < len; ++i) {\r\n        var type = types[i];\r\n        if (type == \",\") types[i] = \"N\";\r\n        else if (type == \"%\") {\r\n          for (var end = i + 1; end < len && types[end] == \"%\"; ++end) {}\r\n          var replace = (i && types[i-1] == \"!\") || (end < len && types[end] == \"1\") ? \"1\" : \"N\";\r\n          for (var j = i; j < end; ++j) types[j] = replace;\r\n          i = end - 1;\r\n        }\r\n      }\r\n\r\n      // W7. Search backwards from each instance of a European number\r\n      // until the first strong type (R, L, or sor) is found. If an L is\r\n      // found, then change the type of the European number to L.\r\n      for (var i = 0, cur = outerType; i < len; ++i) {\r\n        var type = types[i];\r\n        if (cur == \"L\" && type == \"1\") types[i] = \"L\";\r\n        else if (isStrong.test(type)) cur = type;\r\n      }\r\n\r\n      // N1. A sequence of neutrals takes the direction of the\r\n      // surrounding strong text if the text on both sides has the same\r\n      // direction. European and Arabic numbers act as if they were R in\r\n      // terms of their influence on neutrals. Start-of-level-run (sor)\r\n      // and end-of-level-run (eor) are used at level run boundaries.\r\n      // N2. Any remaining neutrals take the embedding direction.\r\n      for (var i = 0; i < len; ++i) {\r\n        if (isNeutral.test(types[i])) {\r\n          for (var end = i + 1; end < len && isNeutral.test(types[end]); ++end) {}\r\n          var before = (i ? types[i-1] : outerType) == \"L\";\r\n          var after = (end < len ? types[end] : outerType) == \"L\";\r\n          var replace = before || after ? \"L\" : \"R\";\r\n          for (var j = i; j < end; ++j) types[j] = replace;\r\n          i = end - 1;\r\n        }\r\n      }\r\n\r\n      // Here we depart from the documented algorithm, in order to avoid\r\n      // building up an actual levels array. Since there are only three\r\n      // levels (0, 1, 2) in an implementation that doesn't take\r\n      // explicit embedding into account, we can build up the order on\r\n      // the fly, without following the level-based algorithm.\r\n      var order = [], m;\r\n      for (var i = 0; i < len;) {\r\n        if (countsAsLeft.test(types[i])) {\r\n          var start = i;\r\n          for (++i; i < len && countsAsLeft.test(types[i]); ++i) {}\r\n          order.push(new BidiSpan(0, start, i));\r\n        } else {\r\n          var pos = i, at = order.length;\r\n          for (++i; i < len && types[i] != \"L\"; ++i) {}\r\n          for (var j = pos; j < i;) {\r\n            if (countsAsNum.test(types[j])) {\r\n              if (pos < j) order.splice(at, 0, new BidiSpan(1, pos, j));\r\n              var nstart = j;\r\n              for (++j; j < i && countsAsNum.test(types[j]); ++j) {}\r\n              order.splice(at, 0, new BidiSpan(2, nstart, j));\r\n              pos = j;\r\n            } else ++j;\r\n          }\r\n          if (pos < i) order.splice(at, 0, new BidiSpan(1, pos, i));\r\n        }\r\n      }\r\n      if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\r\n        order[0].from = m[0].length;\r\n        order.unshift(new BidiSpan(0, 0, m[0].length));\r\n      }\r\n      if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\r\n        lst(order).to -= m[0].length;\r\n        order.push(new BidiSpan(0, len - m[0].length, len));\r\n      }\r\n      if (order[0].level == 2)\r\n        order.unshift(new BidiSpan(1, order[0].to, order[0].to));\r\n      if (order[0].level != lst(order).level)\r\n        order.push(new BidiSpan(order[0].level, len, len));\r\n\r\n      return order;\r\n    };\r\n  })();\r\n\r\n  // THE END\r\n\r\n  CodeMirror.version = \"5.18.2\";\r\n\r\n  return CodeMirror;\r\n});\r\n"]}